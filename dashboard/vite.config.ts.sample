// Vite設定ファイル（移行検討用サンプル）
// 
// Create React AppからViteへの移行を検討する際の参考設定
// 
// 移行手順:
// 1. 依存関係の更新
//    - react-scripts削除
//    - vite, @vitejs/plugin-react追加
// 2. index.htmlの移行（public/ → ルート）
// 3. 環境変数の変更（REACT_APP_ → VITE_）
// 4. package.jsonのscripts更新
// 5. tsconfig.jsonの調整
//
// 参考: https://vitejs.dev/guide/migration.html

import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  
  // 開発サーバー設定
  server: {
    port: 3000,
    open: true,
    proxy: {
      // API プロキシ設定（必要に応じて）
      '/api': {
        target: process.env.VITE_API_ENDPOINT || 'http://localhost:4566',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },

  // ビルド設定
  build: {
    outDir: 'build',
    sourcemap: true,
    // チャンク分割最適化
    rollupOptions: {
      output: {
        manualChunks: {
          // ベンダーチャンク分割
          'react-vendor': ['react', 'react-dom'],
          'mui-vendor': ['@mui/material', '@mui/icons-material'],
          'axios-vendor': ['axios'],
        },
      },
    },
    // チャンクサイズ警告の閾値
    chunkSizeWarningLimit: 1000,
  },

  // パスエイリアス
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@services': path.resolve(__dirname, './src/services'),
      '@types': path.resolve(__dirname, './src/types'),
      '@utils': path.resolve(__dirname, './src/utils'),
    },
  },

  // 環境変数プレフィックス
  envPrefix: 'VITE_',

  // テスト設定（Vitest使用時）
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/setupTests.ts',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/setupTests.ts',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData',
        'src/__tests__/**',
      ],
    },
  },

  // 最適化設定
  optimizeDeps: {
    include: ['react', 'react-dom', '@mui/material', '@mui/icons-material', 'axios'],
  },
});

// 移行時の主な変更点:
//
// 1. package.json
//    "scripts": {
//      "start": "vite",
//      "build": "tsc && vite build",
//      "preview": "vite preview",
//      "test": "vitest",
//      "test:ui": "vitest --ui",
//      "test:coverage": "vitest --coverage"
//    }
//
// 2. 環境変数
//    REACT_APP_API_ENDPOINT → VITE_API_ENDPOINT
//    REACT_APP_API_KEY → VITE_API_KEY
//
// 3. index.html
//    public/index.html → index.html（ルート）
//    <script type="module" src="/src/index.tsx"></script> 追加
//
// 4. tsconfig.json
//    "types": ["vite/client"] 追加
//
// 5. 依存関係
//    npm install -D vite @vitejs/plugin-react
//    npm install -D vitest @vitest/ui jsdom
//    npm uninstall react-scripts
//
// 期待される効果:
// - ビルド速度: 5-10倍高速化
// - HMR: より高速なホットリロード
// - バンドルサイズ: 最適化により10-20%削減
// - 開発体験: より快適な開発環境
