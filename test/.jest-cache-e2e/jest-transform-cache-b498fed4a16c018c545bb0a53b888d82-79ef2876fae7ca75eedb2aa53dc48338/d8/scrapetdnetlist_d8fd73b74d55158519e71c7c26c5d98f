d4e117f32b6fe4cff9e9f1f03119203c
"use strict";
/**
 * TDnet List Scraper
 *
 * 指定日のTDnet開示情報リストを取得し、メタデータを抽出します。
 * レート制限と再試行ロジックを適用して、TDnetサーバーへの負荷を最小化します。
 *
 * Requirements: 要件1.1, 9.1
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.scrapeTdnetList = scrapeTdnetList;
const axios_1 = __importDefault(require("axios"));
const iconv = __importStar(require("iconv-lite"));
const html_parser_1 = require("../../scraper/html-parser");
const rate_limiter_1 = require("../../utils/rate-limiter");
const retry_1 = require("../../utils/retry");
const logger_1 = require("../../utils/logger");
const cloudwatch_metrics_1 = require("../../utils/cloudwatch-metrics");
const errors_1 = require("../../errors");
/**
 * レート制限設定（2秒間隔）
 * TDnetサーバーへの過度な負荷を防ぐため
 */
const rateLimiter = new rate_limiter_1.RateLimiter({ minDelayMs: 2000 });
/**
 * HTTPタイムアウト設定（30秒）
 */
const HTTP_TIMEOUT_MS = 30000;
/**
 * User-Agent設定
 */
const USER_AGENT = 'TDnet-Data-Collector/1.0 (https://github.com/your-org/tdnet-data-collector)';
/**
 * 指定日のTDnet開示情報リストを取得（全ページ）
 *
 * @param date 日付（YYYY-MM-DD形式）
 * @returns 開示情報メタデータの配列
 * @throws ValidationError 日付フォーマットが不正な場合
 * @throws RetryableError ネットワークエラーまたはHTTPエラー
 *
 * @example
 * ```typescript
 * const disclosures = await scrapeTdnetList('2024-01-15');
 * console.log(`Found ${disclosures.length} disclosures`);
 * ```
 */
async function scrapeTdnetList(date) {
    // 日付フォーマットのバリデーション
    validateDateFormat(date);
    try {
        logger_1.logger.info('Scraping TDnet list', { date });
        const allDisclosures = [];
        let pageNumber = 1;
        let hasMorePages = true;
        // すべてのページを取得
        while (hasMorePages) {
            // レート制限を適用
            await rateLimiter.waitIfNeeded();
            try {
                // TDnetからHTMLを取得（再試行あり）
                const html = await fetchTdnetHtml(date, pageNumber);
                // HTMLをパース（日付を渡す）
                const disclosures = (0, html_parser_1.parseDisclosureList)(html, date);
                if (disclosures.length === 0) {
                    // 開示情報がない場合は終了
                    hasMorePages = false;
                }
                else {
                    allDisclosures.push(...disclosures);
                    logger_1.logger.info('TDnet page scraped', {
                        date,
                        page: pageNumber,
                        count: disclosures.length,
                        total: allDisclosures.length,
                    });
                    // 100件未満の場合は最終ページ
                    if (disclosures.length < 100) {
                        hasMorePages = false;
                    }
                    else {
                        pageNumber++;
                    }
                }
            }
            catch (error) {
                // 404エラー（ページが存在しない）の場合
                if (error instanceof errors_1.ValidationError && error.message.includes('not found')) {
                    // 最初のページで404エラーが発生した場合は、エラーをスロー
                    if (pageNumber === 1) {
                        throw error;
                    }
                    // 2ページ目以降で404エラーが発生した場合は、これ以上ページがないと判断
                    logger_1.logger.info('TDnet page not found, stopping pagination', {
                        date,
                        page: pageNumber,
                        total: allDisclosures.length,
                    });
                    hasMorePages = false;
                }
                else {
                    // その他のエラーは再スロー
                    throw error;
                }
            }
        }
        logger_1.logger.info('TDnet list scraped successfully', {
            date,
            total_pages: pageNumber,
            total_count: allDisclosures.length,
        });
        // 成功メトリクス送信
        await (0, cloudwatch_metrics_1.sendSuccessMetric)(allDisclosures.length, 'ScrapeTdnetList', {
            Date: date,
        });
        return allDisclosures;
    }
    catch (error) {
        logger_1.logger.error('Failed to scrape TDnet list', (0, logger_1.createErrorContext)(error, { date }));
        // エラーメトリクス送信
        await (0, cloudwatch_metrics_1.sendErrorMetric)(error instanceof Error ? error.constructor.name : 'Unknown', 'ScrapeTdnetList', { Date: date });
        throw error;
    }
}
/**
 * 日付フォーマットのバリデーション
 *
 * @param date 日付（YYYY-MM-DD形式）
 * @throws ValidationError 日付フォーマットが不正な場合
 *
 * @remarks
 * 以下のバリデーションを実施：
 * 1. フォーマット検証（YYYY-MM-DD形式）
 * 2. 存在する日付の検証（2024-02-30などを拒否）
 * 3. 範囲検証（1970-01-01以降、現在+1日以内）
 */
function validateDateFormat(date) {
    // 1. フォーマット検証
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (!dateRegex.test(date)) {
        throw new errors_1.ValidationError(`Invalid date format: ${date}. Expected YYYY-MM-DD format.`);
    }
    // 2. 存在する日付の検証
    const dateObj = new Date(date);
    if (isNaN(dateObj.getTime())) {
        throw new errors_1.ValidationError(`Invalid date: ${date}. Date does not exist.`);
    }
    // 日付の各部分を抽出して検証
    const [year, month, day] = date.split('-').map(Number);
    const reconstructedDate = new Date(year, month - 1, day);
    // 日付が正規化されていないか確認（例: 2024-02-30 → 2024-03-02）
    if (reconstructedDate.getFullYear() !== year ||
        reconstructedDate.getMonth() !== month - 1 ||
        reconstructedDate.getDate() !== day) {
        throw new errors_1.ValidationError(`Invalid date: ${date}. Date does not exist (e.g., February 30th).`);
    }
    // 3. 範囲検証（1970-01-01以降、現在+1日以内）
    const minDate = new Date('1970-01-01T00:00:00Z');
    const maxDate = new Date(Date.now() + 24 * 60 * 60 * 1000); // 現在時刻+1日
    if (dateObj < minDate) {
        throw new errors_1.ValidationError(`Date out of range: ${date}. Must be on or after 1970-01-01.`);
    }
    if (dateObj > maxDate) {
        throw new errors_1.ValidationError(`Date out of range: ${date}. Must be within 1 day of current date.`);
    }
}
/**
 * TDnetからHTMLを取得（再試行あり）
 *
 * @param date 日付（YYYY-MM-DD形式）
 * @param pageNumber ページ番号（デフォルト: 1）
 * @returns HTMLコンテンツ（UTF-8にデコード済み）
 * @throws RetryableError ネットワークエラーまたはHTTPエラー
 */
async function fetchTdnetHtml(date, pageNumber = 1) {
    const url = buildTdnetUrl(date, pageNumber);
    return await (0, retry_1.retryWithBackoff)(async () => {
        try {
            logger_1.logger.debug('Fetching TDnet HTML', { url, date });
            const response = await axios_1.default.get(url, {
                timeout: HTTP_TIMEOUT_MS,
                headers: {
                    'User-Agent': USER_AGENT,
                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                    'Accept-Language': 'ja,en-US;q=0.9,en;q=0.8',
                    'Accept-Encoding': 'gzip, deflate',
                    'Connection': 'keep-alive',
                },
                // Shift_JISエンコーディング対応
                responseType: 'arraybuffer',
                validateStatus: (status) => status >= 200 && status < 300,
            });
            // Shift_JISからUTF-8にデコード
            const html = decodeShiftJIS(response.data);
            logger_1.logger.debug('TDnet HTML fetched successfully', {
                url,
                date,
                status: response.status,
                content_length: html.length,
            });
            return html;
        }
        catch (error) {
            // AxiosErrorを適切なエラーに変換
            throw convertAxiosError(error, url);
        }
    }, {
        maxRetries: 3,
        initialDelay: 2000,
        backoffMultiplier: 2,
        jitter: true,
        shouldRetry: (error) => {
            // RetryableErrorのみ再試行
            return error instanceof errors_1.RetryableError;
        },
    });
}
/**
 * Shift_JISバイト配列をUTF-8文字列にデコード
 *
 * @param buffer Shift_JISエンコードされたバイト配列またはUTF-8文字列
 * @returns UTF-8文字列
 */
function decodeShiftJIS(buffer) {
    // 既に文字列の場合はそのまま返す（テスト互換性のため）
    if (typeof buffer === 'string') {
        return buffer;
    }
    try {
        // iconv-liteを使用してShift_JISをデコード
        // ArrayBufferをBufferに変換
        const uint8Array = new Uint8Array(buffer);
        const nodeBuffer = Buffer.from(uint8Array);
        // Shift_JISからUTF-8にデコード
        const decoded = iconv.decode(nodeBuffer, 'shift_jis');
        logger_1.logger.debug('Shift_JIS decoded successfully', {
            buffer_size: nodeBuffer.length,
            decoded_length: decoded.length,
        });
        return decoded;
    }
    catch (error) {
        logger_1.logger.error('Failed to decode Shift_JIS', {
            error_type: error instanceof Error ? error.constructor.name : 'Unknown',
            error_message: error instanceof Error ? error.message : String(error),
        });
        // フォールバック: UTF-8として解釈
        try {
            const uint8Array = new Uint8Array(buffer);
            const nodeBuffer = Buffer.from(uint8Array);
            return iconv.decode(nodeBuffer, 'utf-8');
        }
        catch (fallbackError) {
            logger_1.logger.error('Fallback UTF-8 decode also failed', {
                error_type: fallbackError instanceof Error ? fallbackError.constructor.name : 'Unknown',
                error_message: fallbackError instanceof Error ? fallbackError.message : String(fallbackError),
            });
            // 最終フォールバック: 空文字列を返す
            return '';
        }
    }
}
/**
 * TDnet URLを構築
 *
 * @param date 日付（YYYY-MM-DD形式）
 * @param pageNumber ページ番号（デフォルト: 1）
 * @returns TDnet URL
 *
 * @remarks
 * TDnetの実際のURL形式:
 * - 1ページ目: https://www.release.tdnet.info/inbs/I_list_001_YYYYMMDD.html
 * - 2ページ目: https://www.release.tdnet.info/inbs/I_list_002_YYYYMMDD.html
 * - 3ページ目: https://www.release.tdnet.info/inbs/I_list_003_YYYYMMDD.html
 * 日付はハイフンなしの8桁形式（例: 20260214）
 */
function buildTdnetUrl(date, pageNumber = 1) {
    const baseUrl = process.env.TDNET_BASE_URL || 'https://www.release.tdnet.info/inbs';
    // YYYY-MM-DD → YYYYMMDD に変換
    const dateWithoutHyphens = date.replace(/-/g, '');
    // ページ番号を3桁にゼロパディング（例: 1 → 001, 2 → 002）
    const pageNumberPadded = String(pageNumber).padStart(3, '0');
    return `${baseUrl}/I_list_${pageNumberPadded}_${dateWithoutHyphens}.html`;
}
/**
 * AxiosErrorを適切なエラーに変換
 *
 * @param error AxiosError
 * @param url リクエストURL
 * @returns 変換されたエラー
 */
function convertAxiosError(error, url) {
    // ネットワークエラー
    if (error.code === 'ECONNRESET' || error.code === 'ETIMEDOUT' || error.code === 'ENOTFOUND') {
        return new errors_1.RetryableError(`Network error: ${error.code} - ${error.message}`, error);
    }
    // タイムアウトエラー
    if (error.code === 'ECONNABORTED' || error.message?.includes('timeout')) {
        return new errors_1.RetryableError(`Request timeout: ${error.message}`, error);
    }
    // HTTPエラー
    if (error.response) {
        const status = error.response.status;
        // 5xxエラー（サーバーエラー）- 再試行可能
        if (status >= 500) {
            return new errors_1.RetryableError(`Server error: ${status} ${error.response.statusText}`, error);
        }
        // 429エラー（レート制限）- 再試行可能
        if (status === 429) {
            return new errors_1.RetryableError(`Rate limit exceeded: ${status} ${error.response.statusText}`, error);
        }
        // 404エラー（ページが存在しない）- 再試行不可
        if (status === 404) {
            return new errors_1.ValidationError(`TDnet page not found: ${url}. The specified date may not have any disclosures.`);
        }
        // その他のHTTPエラー - 再試行不可
        return new Error(`HTTP error: ${status} ${error.response.statusText}`);
    }
    // その他のエラー
    return new Error(`Failed to fetch TDnet HTML: ${error.message}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3Rvclxcc2NyYXBlLXRkbmV0LWxpc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUNILDBDQTJGQztBQWxJRCxrREFBMEM7QUFDMUMsa0RBQW9DO0FBQ3BDLDJEQUFvRjtBQUNwRiwyREFBdUQ7QUFDdkQsNkNBQXFEO0FBQ3JELCtDQUFnRTtBQUNoRSx1RUFBb0Y7QUFDcEYseUNBQStEO0FBRS9EOzs7R0FHRztBQUNILE1BQU0sV0FBVyxHQUFHLElBQUksMEJBQVcsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRTFEOztHQUVHO0FBQ0gsTUFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDO0FBRTlCOztHQUVHO0FBQ0gsTUFBTSxVQUFVLEdBQUcsNkVBQTZFLENBQUM7QUFFakc7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUNJLEtBQUssVUFBVSxlQUFlLENBQUMsSUFBWTtJQUNoRCxtQkFBbUI7SUFDbkIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFekIsSUFBSSxDQUFDO1FBQ0gsZUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFFN0MsTUFBTSxjQUFjLEdBQXlCLEVBQUUsQ0FBQztRQUNoRCxJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDbkIsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBRXhCLGFBQWE7UUFDYixPQUFPLFlBQVksRUFBRSxDQUFDO1lBQ3BCLFdBQVc7WUFDWCxNQUFNLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUVqQyxJQUFJLENBQUM7Z0JBQ0gsd0JBQXdCO2dCQUN4QixNQUFNLElBQUksR0FBRyxNQUFNLGNBQWMsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7Z0JB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QUFLLENBQ04sQ0FBQztRQUNKLENBQUM7UUFFRCx1QkFBdUI7UUFDdkIsSUFBSSxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDbkIsT0FBTyxJQUFJLHVCQUFjLENBQ3ZCLHdCQUF3QixNQUFNLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsRUFDN0QsS0FBSyxDQUNOLENBQUM7UUFDSixDQUFDO1FBRUQsMkJBQTJCO1FBQzNCLElBQUksTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ25CLE9BQU8sSUFBSSx3QkFBZSxDQUN4Qix5QkFBeUIsR0FBRyxvREFBb0QsQ0FDakYsQ0FBQztRQUNKLENBQUM7UUFFRCxzQkFBc0I7UUFDdEIsT0FBTyxJQUFJLEtBQUssQ0FDZCxlQUFlLE1BQU0sSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUNyRCxDQUFDO0lBQ0osQ0FBQztJQUVELFVBQVU7SUFDVixPQUFPLElBQUksS0FBSyxDQUNkLCtCQUErQixLQUFLLENBQUMsT0FBTyxFQUFFLENBQy9DLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcbGFtYmRhXFxjb2xsZWN0b3JcXHNjcmFwZS10ZG5ldC1saXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBURG5ldCBMaXN0IFNjcmFwZXJcclxuICpcclxuICog5oyH5a6a5pel44GuVERuZXTplovnpLrmg4XloLHjg6rjgrnjg4jjgpLlj5blvpfjgZfjgIHjg6Hjgr/jg4fjg7zjgr/jgpLmir3lh7rjgZfjgb7jgZnjgIJcclxuICog44Os44O844OI5Yi26ZmQ44Go5YaN6Kmm6KGM44Ot44K444OD44Kv44KS6YGp55So44GX44Gm44CBVERuZXTjgrXjg7zjg5Djg7zjgbjjga7osqDojbfjgpLmnIDlsI/ljJbjgZfjgb7jgZnjgIJcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7YxLjEsIDkuMVxyXG4gKi9cclxuXHJcbmltcG9ydCBheGlvcywgeyBBeGlvc0Vycm9yIH0gZnJvbSAnYXhpb3MnO1xyXG5pbXBvcnQgKiBhcyBpY29udiBmcm9tICdpY29udi1saXRlJztcclxuaW1wb3J0IHsgcGFyc2VEaXNjbG9zdXJlTGlzdCwgRGlzY2xvc3VyZU1ldGFkYXRhIH0gZnJvbSAnLi4vLi4vc2NyYXBlci9odG1sLXBhcnNlcic7XHJcbmltcG9ydCB7IFJhdGVMaW1pdGVyIH0gZnJvbSAnLi4vLi4vdXRpbHMvcmF0ZS1saW1pdGVyJztcclxuaW1wb3J0IHsgcmV0cnlXaXRoQmFja29mZiB9IGZyb20gJy4uLy4uL3V0aWxzL3JldHJ5JztcclxuaW1wb3J0IHsgbG9nZ2VyLCBjcmVhdGVFcnJvckNvbnRleHQgfSBmcm9tICcuLi8uLi91dGlscy9sb2dnZXInO1xyXG5pbXBvcnQgeyBzZW5kRXJyb3JNZXRyaWMsIHNlbmRTdWNjZXNzTWV0cmljIH0gZnJvbSAnLi4vLi4vdXRpbHMvY2xvdWR3YXRjaC1tZXRyaWNzJztcclxuaW1wb3J0IHsgUmV0cnlhYmxlRXJyb3IsIFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4uLy4uL2Vycm9ycyc7XHJcblxyXG4vKipcclxuICog44Os44O844OI5Yi26ZmQ6Kit5a6a77yIMuenkumWk+malO+8iVxyXG4gKiBURG5ldOOCteODvOODkOODvOOBuOOBrumBjuW6puOBquiyoOiNt+OCkumYsuOBkOOBn+OCgVxyXG4gKi9cclxuY29uc3QgcmF0ZUxpbWl0ZXIgPSBuZXcgUmF0ZUxpbWl0ZXIoeyBtaW5EZWxheU1zOiAyMDAwIH0pO1xyXG5cclxuLyoqXHJcbiAqIEhUVFDjgr/jgqTjg6DjgqLjgqbjg4joqK3lrprvvIgzMOenku+8iVxyXG4gKi9cclxuY29uc3QgSFRUUF9USU1FT1VUX01TID0gMzAwMDA7XHJcblxyXG4vKipcclxuICogVXNlci1BZ2VudOioreWumlxyXG4gKi9cclxuY29uc3QgVVNFUl9BR0VOVCA9ICdURG5ldC1EYXRhLUNvbGxlY3Rvci8xLjAgKGh0dHBzOi8vZ2l0aHViLmNvbS95b3VyLW9yZy90ZG5ldC1kYXRhLWNvbGxlY3RvciknO1xyXG5cclxuLyoqXHJcbiAqIOaMh+WumuaXpeOBrlREbmV06ZaL56S65oOF5aCx44Oq44K544OI44KS5Y+W5b6X77yI5YWo44Oa44O844K477yJXHJcbiAqXHJcbiAqIEBwYXJhbSBkYXRlIOaXpeS7mO+8iFlZWVktTU0tRETlvaLlvI/vvIlcclxuICogQHJldHVybnMg6ZaL56S65oOF5aCx44Oh44K/44OH44O844K/44Gu6YWN5YiXXHJcbiAqIEB0aHJvd3MgVmFsaWRhdGlvbkVycm9yIOaXpeS7mOODleOCqeODvOODnuODg+ODiOOBjOS4jeato+OBquWgtOWQiFxyXG4gKiBAdGhyb3dzIFJldHJ5YWJsZUVycm9yIOODjeODg+ODiOODr+ODvOOCr+OCqOODqeODvOOBvuOBn+OBr0hUVFDjgqjjg6njg7xcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBjb25zdCBkaXNjbG9zdXJlcyA9IGF3YWl0IHNjcmFwZVRkbmV0TGlzdCgnMjAyNC0wMS0xNScpO1xyXG4gKiBjb25zb2xlLmxvZyhgRm91bmQgJHtkaXNjbG9zdXJlcy5sZW5ndGh9IGRpc2Nsb3N1cmVzYCk7XHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNjcmFwZVRkbmV0TGlzdChkYXRlOiBzdHJpbmcpOiBQcm9taXNlPERpc2Nsb3N1cmVNZXRhZGF0YVtdPiB7XHJcbiAgLy8g5pel5LuY44OV44Kp44O844Oe44OD44OI44Gu44OQ44Oq44OH44O844K344On44OzXHJcbiAgdmFsaWRhdGVEYXRlRm9ybWF0KGRhdGUpO1xyXG5cclxuICB0cnkge1xyXG4gICAgbG9nZ2VyLmluZm8oJ1NjcmFwaW5nIFREbmV0IGxpc3QnLCB7IGRhdGUgfSk7XHJcblxyXG4gICAgY29uc3QgYWxsRGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVNZXRhZGF0YVtdID0gW107XHJcbiAgICBsZXQgcGFnZU51bWJlciA9IDE7XHJcbiAgICBsZXQgaGFzTW9yZVBhZ2VzID0gdHJ1ZTtcclxuXHJcbiAgICAvLyDjgZnjgbnjgabjga7jg5rjg7zjgrjjgpLlj5blvpdcclxuICAgIHdoaWxlIChoYXNNb3JlUGFnZXMpIHtcclxuICAgICAgLy8g44Os44O844OI5Yi26ZmQ44KS6YGp55SoXHJcbiAgICAgIGF3YWl0IHJhdGVMaW1pdGVyLndhaXRJZk5lZWRlZCgpO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBURG5ldOOBi+OCiUhUTUzjgpLlj5blvpfvvIjlho3oqabooYzjgYLjgorvvIlcclxuICAgICAgICBjb25zdCBodG1sID0gYXdhaXQgZmV0Y2hUZG5ldEh0bWwoZGF0ZSwgcGFnZU51bWJlcik7XHJcblxyXG4gICAgICAgIC8vIEhUTUzjgpLjg5Hjg7zjgrnvvIjml6Xku5jjgpLmuKHjgZnvvIlcclxuICAgICAgICBjb25zdCBkaXNjbG9zdXJlcyA9IHBhcnNlRGlzY2xvc3VyZUxpc3QoaHRtbCwgZGF0ZSk7XHJcblxyXG4gICAgICAgIGlmIChkaXNjbG9zdXJlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIC8vIOmWi+ekuuaDheWgseOBjOOBquOBhOWgtOWQiOOBr+e1guS6hlxyXG4gICAgICAgICAgaGFzTW9yZVBhZ2VzID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFsbERpc2Nsb3N1cmVzLnB1c2goLi4uZGlzY2xvc3VyZXMpO1xyXG4gICAgICAgICAgbG9nZ2VyLmluZm8oJ1REbmV0IHBhZ2Ugc2NyYXBlZCcsIHtcclxuICAgICAgICAgICAgZGF0ZSxcclxuICAgICAgICAgICAgcGFnZTogcGFnZU51bWJlcixcclxuICAgICAgICAgICAgY291bnQ6IGRpc2Nsb3N1cmVzLmxlbmd0aCxcclxuICAgICAgICAgICAgdG90YWw6IGFsbERpc2Nsb3N1cmVzLmxlbmd0aCxcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIC8vIDEwMOS7tuacqua6gOOBruWgtOWQiOOBr+acgOe1guODmuODvOOCuFxyXG4gICAgICAgICAgaWYgKGRpc2Nsb3N1cmVzLmxlbmd0aCA8IDEwMCkge1xyXG4gICAgICAgICAgICBoYXNNb3JlUGFnZXMgPSBmYWxzZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIrKztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgLy8gNDA044Ko44Op44O877yI44Oa44O844K444GM5a2Y5Zyo44GX44Gq44GE77yJ44Gu5aC05ZCIXHJcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XHJcbiAgICAgICAgICAvLyDmnIDliJ3jga7jg5rjg7zjgrjjgac0MDTjgqjjg6njg7zjgYznmbrnlJ/jgZfjgZ/loLTlkIjjga/jgIHjgqjjg6njg7zjgpLjgrnjg63jg7xcclxuICAgICAgICAgIGlmIChwYWdlTnVtYmVyID09PSAxKSB7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyAy44Oa44O844K455uu5Lul6ZmN44GnNDA044Ko44Op44O844GM55m655Sf44GX44Gf5aC05ZCI44Gv44CB44GT44KM5Lul5LiK44Oa44O844K444GM44Gq44GE44Go5Yik5patXHJcbiAgICAgICAgICBsb2dnZXIuaW5mbygnVERuZXQgcGFnZSBub3QgZm91bmQsIHN0b3BwaW5nIHBhZ2luYXRpb24nLCB7XHJcbiAgICAgICAgICAgIGRhdGUsXHJcbiAgICAgICAgICAgIHBhZ2U6IHBhZ2VOdW1iZXIsXHJcbiAgICAgICAgICAgIHRvdGFsOiBhbGxEaXNjbG9zdXJlcy5sZW5ndGgsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGhhc01vcmVQYWdlcyA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyDjgZ3jga7ku5bjga7jgqjjg6njg7zjga/lho3jgrnjg63jg7xcclxuICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxvZ2dlci5pbmZvKCdURG5ldCBsaXN0IHNjcmFwZWQgc3VjY2Vzc2Z1bGx5Jywge1xyXG4gICAgICBkYXRlLFxyXG4gICAgICB0b3RhbF9wYWdlczogcGFnZU51bWJlcixcclxuICAgICAgdG90YWxfY291bnQ6IGFsbERpc2Nsb3N1cmVzLmxlbmd0aCxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOaIkOWKn+ODoeODiOODquOCr+OCuemAgeS/oVxyXG4gICAgYXdhaXQgc2VuZFN1Y2Nlc3NNZXRyaWMoYWxsRGlzY2xvc3VyZXMubGVuZ3RoLCAnU2NyYXBlVGRuZXRMaXN0Jywge1xyXG4gICAgICBEYXRlOiBkYXRlLFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGFsbERpc2Nsb3N1cmVzO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoXHJcbiAgICAgICdGYWlsZWQgdG8gc2NyYXBlIFREbmV0IGxpc3QnLFxyXG4gICAgICBjcmVhdGVFcnJvckNvbnRleHQoZXJyb3IgYXMgRXJyb3IsIHsgZGF0ZSB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyDjgqjjg6njg7zjg6Hjg4jjg6rjgq/jgrnpgIHkv6FcclxuICAgIGF3YWl0IHNlbmRFcnJvck1ldHJpYyhcclxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLmNvbnN0cnVjdG9yLm5hbWUgOiAnVW5rbm93bicsXHJcbiAgICAgICdTY3JhcGVUZG5ldExpc3QnLFxyXG4gICAgICB7IERhdGU6IGRhdGUgfVxyXG4gICAgKTtcclxuXHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDml6Xku5jjg5Xjgqnjg7zjg57jg4Pjg4jjga7jg5Djg6rjg4fjg7zjgrfjg6fjg7NcclxuICpcclxuICogQHBhcmFtIGRhdGUg5pel5LuY77yIWVlZWS1NTS1EROW9ouW8j++8iVxyXG4gKiBAdGhyb3dzIFZhbGlkYXRpb25FcnJvciDml6Xku5jjg5Xjgqnjg7zjg57jg4Pjg4jjgYzkuI3mraPjgarloLTlkIhcclxuICpcclxuICogQHJlbWFya3NcclxuICog5Lul5LiL44Gu44OQ44Oq44OH44O844K344On44Oz44KS5a6f5pa977yaXHJcbiAqIDEuIOODleOCqeODvOODnuODg+ODiOaknOiovO+8iFlZWVktTU0tRETlvaLlvI/vvIlcclxuICogMi4g5a2Y5Zyo44GZ44KL5pel5LuY44Gu5qSc6Ki877yIMjAyNC0wMi0zMOOBquOBqeOCkuaLkuWQpu+8iVxyXG4gKiAzLiDnr4Tlm7LmpJzoqLzvvIgxOTcwLTAxLTAx5Lul6ZmN44CB54++5ZyoKzHml6Xku6XlhoXvvIlcclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlRGF0ZUZvcm1hdChkYXRlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAvLyAxLiDjg5Xjgqnjg7zjg57jg4Pjg4jmpJzoqLxcclxuICBjb25zdCBkYXRlUmVnZXggPSAvXlxcZHs0fS1cXGR7Mn0tXFxkezJ9JC87XHJcbiAgaWYgKCFkYXRlUmVnZXgudGVzdChkYXRlKSkge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihcclxuICAgICAgYEludmFsaWQgZGF0ZSBmb3JtYXQ6ICR7ZGF0ZX0uIEV4cGVjdGVkIFlZWVktTU0tREQgZm9ybWF0LmBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyAyLiDlrZjlnKjjgZnjgovml6Xku5jjga7mpJzoqLxcclxuICBjb25zdCBkYXRlT2JqID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgaWYgKGlzTmFOKGRhdGVPYmouZ2V0VGltZSgpKSkge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihcclxuICAgICAgYEludmFsaWQgZGF0ZTogJHtkYXRlfS4gRGF0ZSBkb2VzIG5vdCBleGlzdC5gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8g5pel5LuY44Gu5ZCE6YOo5YiG44KS5oq95Ye644GX44Gm5qSc6Ki8XHJcbiAgY29uc3QgW3llYXIsIG1vbnRoLCBkYXldID0gZGF0ZS5zcGxpdCgnLScpLm1hcChOdW1iZXIpO1xyXG4gIGNvbnN0IHJlY29uc3RydWN0ZWREYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXkpO1xyXG4gIFxyXG4gIC8vIOaXpeS7mOOBjOato+imj+WMluOBleOCjOOBpuOBhOOBquOBhOOBi+eiuuiqje+8iOS+izogMjAyNC0wMi0zMCDihpIgMjAyNC0wMy0wMu+8iVxyXG4gIGlmIChcclxuICAgIHJlY29uc3RydWN0ZWREYXRlLmdldEZ1bGxZZWFyKCkgIT09IHllYXIgfHxcclxuICAgIHJlY29uc3RydWN0ZWREYXRlLmdldE1vbnRoKCkgIT09IG1vbnRoIC0gMSB8fFxyXG4gICAgcmVjb25zdHJ1Y3RlZERhdGUuZ2V0RGF0ZSgpICE9PSBkYXlcclxuICApIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBJbnZhbGlkIGRhdGU6ICR7ZGF0ZX0uIERhdGUgZG9lcyBub3QgZXhpc3QgKGUuZy4sIEZlYnJ1YXJ5IDMwdGgpLmBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyAzLiDnr4Tlm7LmpJzoqLzvvIgxOTcwLTAxLTAx5Lul6ZmN44CB54++5ZyoKzHml6Xku6XlhoXvvIlcclxuICBjb25zdCBtaW5EYXRlID0gbmV3IERhdGUoJzE5NzAtMDEtMDFUMDA6MDA6MDBaJyk7XHJcbiAgY29uc3QgbWF4RGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8g54++5Zyo5pmC5Yi7KzHml6VcclxuICBcclxuICBpZiAoZGF0ZU9iaiA8IG1pbkRhdGUpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBEYXRlIG91dCBvZiByYW5nZTogJHtkYXRlfS4gTXVzdCBiZSBvbiBvciBhZnRlciAxOTcwLTAxLTAxLmBcclxuICAgICk7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChkYXRlT2JqID4gbWF4RGF0ZSkge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihcclxuICAgICAgYERhdGUgb3V0IG9mIHJhbmdlOiAke2RhdGV9LiBNdXN0IGJlIHdpdGhpbiAxIGRheSBvZiBjdXJyZW50IGRhdGUuYFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBURG5ldOOBi+OCiUhUTUzjgpLlj5blvpfvvIjlho3oqabooYzjgYLjgorvvIlcclxuICpcclxuICogQHBhcmFtIGRhdGUg5pel5LuY77yIWVlZWS1NTS1EROW9ouW8j++8iVxyXG4gKiBAcGFyYW0gcGFnZU51bWJlciDjg5rjg7zjgrjnlarlj7fvvIjjg4fjg5Xjgqnjg6vjg4g6IDHvvIlcclxuICogQHJldHVybnMgSFRNTOOCs+ODs+ODhuODs+ODhO+8iFVURi0444Gr44OH44Kz44O844OJ5riI44G/77yJXHJcbiAqIEB0aHJvd3MgUmV0cnlhYmxlRXJyb3Ig44ON44OD44OI44Ov44O844Kv44Ko44Op44O844G+44Gf44GvSFRUUOOCqOODqeODvFxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hUZG5ldEh0bWwoZGF0ZTogc3RyaW5nLCBwYWdlTnVtYmVyOiBudW1iZXIgPSAxKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBjb25zdCB1cmwgPSBidWlsZFRkbmV0VXJsKGRhdGUsIHBhZ2VOdW1iZXIpO1xyXG5cclxuICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihcclxuICAgIGFzeW5jICgpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBsb2dnZXIuZGVidWcoJ0ZldGNoaW5nIFREbmV0IEhUTUwnLCB7IHVybCwgZGF0ZSB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQodXJsLCB7XHJcbiAgICAgICAgICB0aW1lb3V0OiBIVFRQX1RJTUVPVVRfTVMsXHJcbiAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdVc2VyLUFnZW50JzogVVNFUl9BR0VOVCxcclxuICAgICAgICAgICAgJ0FjY2VwdCc6ICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSwqLyo7cT0wLjgnLFxyXG4gICAgICAgICAgICAnQWNjZXB0LUxhbmd1YWdlJzogJ2phLGVuLVVTO3E9MC45LGVuO3E9MC44JyxcclxuICAgICAgICAgICAgJ0FjY2VwdC1FbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJyxcclxuICAgICAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgLy8gU2hpZnRfSklT44Ko44Oz44Kz44O844OH44Kj44Oz44Kw5a++5b+cXHJcbiAgICAgICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicsXHJcbiAgICAgICAgICB2YWxpZGF0ZVN0YXR1czogKHN0YXR1cykgPT4gc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFNoaWZ0X0pJU+OBi+OCiVVURi0444Gr44OH44Kz44O844OJXHJcbiAgICAgICAgY29uc3QgaHRtbCA9IGRlY29kZVNoaWZ0SklTKHJlc3BvbnNlLmRhdGEpO1xyXG5cclxuICAgICAgICBsb2dnZXIuZGVidWcoJ1REbmV0IEhUTUwgZmV0Y2hlZCBzdWNjZXNzZnVsbHknLCB7XHJcbiAgICAgICAgICB1cmwsXHJcbiAgICAgICAgICBkYXRlLFxyXG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgICAgICBjb250ZW50X2xlbmd0aDogaHRtbC5sZW5ndGgsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBodG1sO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIC8vIEF4aW9zRXJyb3LjgpLpganliIfjgarjgqjjg6njg7zjgavlpInmj5tcclxuICAgICAgICB0aHJvdyBjb252ZXJ0QXhpb3NFcnJvcihlcnJvciBhcyBBeGlvc0Vycm9yLCB1cmwpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBtYXhSZXRyaWVzOiAzLFxyXG4gICAgICBpbml0aWFsRGVsYXk6IDIwMDAsXHJcbiAgICAgIGJhY2tvZmZNdWx0aXBsaWVyOiAyLFxyXG4gICAgICBqaXR0ZXI6IHRydWUsXHJcbiAgICAgIHNob3VsZFJldHJ5OiAoZXJyb3IpID0+IHtcclxuICAgICAgICAvLyBSZXRyeWFibGVFcnJvcuOBruOBv+WGjeippuihjFxyXG4gICAgICAgIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIFJldHJ5YWJsZUVycm9yO1xyXG4gICAgICB9LFxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaGlmdF9KSVPjg5DjgqTjg4jphY3liJfjgpJVVEYtOOaWh+Wtl+WIl+OBq+ODh+OCs+ODvOODiVxyXG4gKlxyXG4gKiBAcGFyYW0gYnVmZmVyIFNoaWZ0X0pJU+OCqOODs+OCs+ODvOODieOBleOCjOOBn+ODkOOCpOODiOmFjeWIl+OBvuOBn+OBr1VURi045paH5a2X5YiXXHJcbiAqIEByZXR1cm5zIFVURi045paH5a2X5YiXXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWNvZGVTaGlmdEpJUyhidWZmZXI6IEFycmF5QnVmZmVyIHwgc3RyaW5nKTogc3RyaW5nIHtcclxuICAvLyDml6LjgavmloflrZfliJfjga7loLTlkIjjga/jgZ3jga7jgb7jgb7ov5TjgZnvvIjjg4bjgrnjg4jkupLmj5vmgKfjga7jgZ/jgoHvvIlcclxuICBpZiAodHlwZW9mIGJ1ZmZlciA9PT0gJ3N0cmluZycpIHtcclxuICAgIHJldHVybiBidWZmZXI7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgLy8gaWNvbnYtbGl0ZeOCkuS9v+eUqOOBl+OBplNoaWZ0X0pJU+OCkuODh+OCs+ODvOODiVxyXG4gICAgLy8gQXJyYXlCdWZmZXLjgpJCdWZmZXLjgavlpInmj5tcclxuICAgIGNvbnN0IHVpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xyXG4gICAgY29uc3Qgbm9kZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHVpbnQ4QXJyYXkpO1xyXG4gICAgXHJcbiAgICAvLyBTaGlmdF9KSVPjgYvjgolVVEYtOOOBq+ODh+OCs+ODvOODiVxyXG4gICAgY29uc3QgZGVjb2RlZCA9IGljb252LmRlY29kZShub2RlQnVmZmVyLCAnc2hpZnRfamlzJyk7XHJcbiAgICBcclxuICAgIGxvZ2dlci5kZWJ1ZygnU2hpZnRfSklTIGRlY29kZWQgc3VjY2Vzc2Z1bGx5Jywge1xyXG4gICAgICBidWZmZXJfc2l6ZTogbm9kZUJ1ZmZlci5sZW5ndGgsXHJcbiAgICAgIGRlY29kZWRfbGVuZ3RoOiBkZWNvZGVkLmxlbmd0aCxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXR1cm4gZGVjb2RlZDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVjb2RlIFNoaWZ0X0pJUycsIHtcclxuICAgICAgZXJyb3JfdHlwZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLmNvbnN0cnVjdG9yLm5hbWUgOiAnVW5rbm93bicsXHJcbiAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyDjg5Xjgqnjg7zjg6vjg5Djg4Pjgq86IFVURi0444Go44GX44Gm6Kej6YeIXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1aW50OEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcclxuICAgICAgY29uc3Qgbm9kZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHVpbnQ4QXJyYXkpO1xyXG4gICAgICByZXR1cm4gaWNvbnYuZGVjb2RlKG5vZGVCdWZmZXIsICd1dGYtOCcpO1xyXG4gICAgfSBjYXRjaCAoZmFsbGJhY2tFcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhbGxiYWNrIFVURi04IGRlY29kZSBhbHNvIGZhaWxlZCcsIHtcclxuICAgICAgICBlcnJvcl90eXBlOiBmYWxsYmFja0Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBmYWxsYmFja0Vycm9yLmNvbnN0cnVjdG9yLm5hbWUgOiAnVW5rbm93bicsXHJcbiAgICAgICAgZXJyb3JfbWVzc2FnZTogZmFsbGJhY2tFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZmFsbGJhY2tFcnJvci5tZXNzYWdlIDogU3RyaW5nKGZhbGxiYWNrRXJyb3IpLFxyXG4gICAgICB9KTtcclxuICAgICAgLy8g5pyA57WC44OV44Kp44O844Or44OQ44OD44KvOiDnqbrmloflrZfliJfjgpLov5TjgZlcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFREbmV0IFVSTOOCkuani+eviVxyXG4gKlxyXG4gKiBAcGFyYW0gZGF0ZSDml6Xku5jvvIhZWVlZLU1NLURE5b2i5byP77yJXHJcbiAqIEBwYXJhbSBwYWdlTnVtYmVyIOODmuODvOOCuOeVquWPt++8iOODh+ODleOCqeODq+ODiDogMe+8iVxyXG4gKiBAcmV0dXJucyBURG5ldCBVUkxcclxuICpcclxuICogQHJlbWFya3NcclxuICogVERuZXTjga7lrp/pmpvjga5VUkzlvaLlvI86XHJcbiAqIC0gMeODmuODvOOCuOebrjogaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvSV9saXN0XzAwMV9ZWVlZTU1ERC5odG1sXHJcbiAqIC0gMuODmuODvOOCuOebrjogaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvSV9saXN0XzAwMl9ZWVlZTU1ERC5odG1sXHJcbiAqIC0gM+ODmuODvOOCuOebrjogaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvSV9saXN0XzAwM19ZWVlZTU1ERC5odG1sXHJcbiAqIOaXpeS7mOOBr+ODj+OCpOODleODs+OBquOBl+OBrjjmoYHlvaLlvI/vvIjkvos6IDIwMjYwMjE077yJXHJcbiAqL1xyXG5mdW5jdGlvbiBidWlsZFRkbmV0VXJsKGRhdGU6IHN0cmluZywgcGFnZU51bWJlcjogbnVtYmVyID0gMSk6IHN0cmluZyB7XHJcbiAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52LlRETkVUX0JBU0VfVVJMIHx8ICdodHRwczovL3d3dy5yZWxlYXNlLnRkbmV0LmluZm8vaW5icyc7XHJcbiAgLy8gWVlZWS1NTS1ERCDihpIgWVlZWU1NREQg44Gr5aSJ5o+bXHJcbiAgY29uc3QgZGF0ZVdpdGhvdXRIeXBoZW5zID0gZGF0ZS5yZXBsYWNlKC8tL2csICcnKTtcclxuICAvLyDjg5rjg7zjgrjnlarlj7fjgpIz5qGB44Gr44K844Ot44OR44OH44Kj44Oz44Kw77yI5L6LOiAxIOKGkiAwMDEsIDIg4oaSIDAwMu+8iVxyXG4gIGNvbnN0IHBhZ2VOdW1iZXJQYWRkZWQgPSBTdHJpbmcocGFnZU51bWJlcikucGFkU3RhcnQoMywgJzAnKTtcclxuICByZXR1cm4gYCR7YmFzZVVybH0vSV9saXN0XyR7cGFnZU51bWJlclBhZGRlZH1fJHtkYXRlV2l0aG91dEh5cGhlbnN9Lmh0bWxgO1xyXG59XHJcblxyXG4vKipcclxuICogQXhpb3NFcnJvcuOCkumBqeWIh+OBquOCqOODqeODvOOBq+WkieaPm1xyXG4gKlxyXG4gKiBAcGFyYW0gZXJyb3IgQXhpb3NFcnJvclxyXG4gKiBAcGFyYW0gdXJsIOODquOCr+OCqOOCueODiFVSTFxyXG4gKiBAcmV0dXJucyDlpInmj5vjgZXjgozjgZ/jgqjjg6njg7xcclxuICovXHJcbmZ1bmN0aW9uIGNvbnZlcnRBeGlvc0Vycm9yKGVycm9yOiBBeGlvc0Vycm9yLCB1cmw6IHN0cmluZyk6IEVycm9yIHtcclxuICAvLyDjg43jg4Pjg4jjg6/jg7zjgq/jgqjjg6njg7xcclxuICBpZiAoZXJyb3IuY29kZSA9PT0gJ0VDT05OUkVTRVQnIHx8IGVycm9yLmNvZGUgPT09ICdFVElNRURPVVQnIHx8IGVycm9yLmNvZGUgPT09ICdFTk9URk9VTkQnKSB7XHJcbiAgICByZXR1cm4gbmV3IFJldHJ5YWJsZUVycm9yKFxyXG4gICAgICBgTmV0d29yayBlcnJvcjogJHtlcnJvci5jb2RlfSAtICR7ZXJyb3IubWVzc2FnZX1gLFxyXG4gICAgICBlcnJvclxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vIOOCv+OCpOODoOOCouOCpuODiOOCqOODqeODvFxyXG4gIGlmIChlcnJvci5jb2RlID09PSAnRUNPTk5BQk9SVEVEJyB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygndGltZW91dCcpKSB7XHJcbiAgICByZXR1cm4gbmV3IFJldHJ5YWJsZUVycm9yKFxyXG4gICAgICBgUmVxdWVzdCB0aW1lb3V0OiAke2Vycm9yLm1lc3NhZ2V9YCxcclxuICAgICAgZXJyb3JcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBIVFRQ44Ko44Op44O8XHJcbiAgaWYgKGVycm9yLnJlc3BvbnNlKSB7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBlcnJvci5yZXNwb25zZS5zdGF0dXM7XHJcblxyXG4gICAgLy8gNXh444Ko44Op44O877yI44K144O844OQ44O844Ko44Op44O877yJLSDlho3oqabooYzlj6/og71cclxuICAgIGlmIChzdGF0dXMgPj0gNTAwKSB7XHJcbiAgICAgIHJldHVybiBuZXcgUmV0cnlhYmxlRXJyb3IoXHJcbiAgICAgICAgYFNlcnZlciBlcnJvcjogJHtzdGF0dXN9ICR7ZXJyb3IucmVzcG9uc2Uuc3RhdHVzVGV4dH1gLFxyXG4gICAgICAgIGVycm9yXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gNDI544Ko44Op44O877yI44Os44O844OI5Yi26ZmQ77yJLSDlho3oqabooYzlj6/og71cclxuICAgIGlmIChzdGF0dXMgPT09IDQyOSkge1xyXG4gICAgICByZXR1cm4gbmV3IFJldHJ5YWJsZUVycm9yKFxyXG4gICAgICAgIGBSYXRlIGxpbWl0IGV4Y2VlZGVkOiAke3N0YXR1c30gJHtlcnJvci5yZXNwb25zZS5zdGF0dXNUZXh0fWAsXHJcbiAgICAgICAgZXJyb3JcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA0MDTjgqjjg6njg7zvvIjjg5rjg7zjgrjjgYzlrZjlnKjjgZfjgarjgYTvvIktIOWGjeippuihjOS4jeWPr1xyXG4gICAgaWYgKHN0YXR1cyA9PT0gNDA0KSB7XHJcbiAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICAgIGBURG5ldCBwYWdlIG5vdCBmb3VuZDogJHt1cmx9LiBUaGUgc3BlY2lmaWVkIGRhdGUgbWF5IG5vdCBoYXZlIGFueSBkaXNjbG9zdXJlcy5gXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g44Gd44Gu5LuW44GuSFRUUOOCqOODqeODvCAtIOWGjeippuihjOS4jeWPr1xyXG4gICAgcmV0dXJuIG5ldyBFcnJvcihcclxuICAgICAgYEhUVFAgZXJyb3I6ICR7c3RhdHVzfSAke2Vycm9yLnJlc3BvbnNlLnN0YXR1c1RleHR9YFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vIOOBneOBruS7luOBruOCqOODqeODvFxyXG4gIHJldHVybiBuZXcgRXJyb3IoXHJcbiAgICBgRmFpbGVkIHRvIGZldGNoIFREbmV0IEhUTUw6ICR7ZXJyb3IubWVzc2FnZX1gXHJcbiAgKTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=