0e8e279d4a9f02ea88076126706d4e32
"use strict";
/**
 * 構造化ロガー
 *
 * Winstonを使用した構造化ロギングを提供します。
 * CloudWatch Logs形式のJSON出力をサポートし、ログレベルに応じた適切なログ記録を行います。
 *
 * Requirements: 要件6.3（構造化ログ）
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports.LogLevel = void 0;
exports.setLogLevel = setLogLevel;
exports.createErrorContext = createErrorContext;
exports.logLambdaError = logLambdaError;
const winston_1 = __importDefault(require("winston"));
/**
 * ログレベル
 */
var LogLevel;
(function (LogLevel) {
    LogLevel["DEBUG"] = "debug";
    LogLevel["INFO"] = "info";
    LogLevel["WARN"] = "warn";
    LogLevel["ERROR"] = "error";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
/**
 * Winston ロガーの設定
 */
const isLambdaEnvironment = !!process.env.AWS_LAMBDA_FUNCTION_NAME;
// Lambda環境では、Winstonの代わりにconsole.logを使用
// これにより、CloudWatch Logsに確実にログが出力される
const winstonLogger = isLambdaEnvironment
    ? null
    : winston_1.default.createLogger({
        level: process.env.LOG_LEVEL || LogLevel.INFO,
        format: winston_1.default.format.combine(winston_1.default.format.timestamp({
            format: 'YYYY-MM-DDTHH:mm:ss.SSSZ',
        }), winston_1.default.format.errors({ stack: true }), winston_1.default.format.json()),
        defaultMeta: {
            service: 'tdnet-data-collector',
            environment: process.env.NODE_ENV || 'development',
        },
        transports: [
            new winston_1.default.transports.Console({
                format: winston_1.default.format.combine(winston_1.default.format.colorize(), winston_1.default.format.printf(({ timestamp, level, message, ...meta }) => {
                    const metaStr = Object.keys(meta).length > 0 ? JSON.stringify(meta, null, 2) : '';
                    return `${timestamp} [${level}]: ${message} ${metaStr}`;
                })),
            }),
        ],
    });
/**
 * 構造化ロガー実装
 */
class StructuredLogger {
    /**
     * DEBUGレベルのログを記録
     *
     * @param message ログメッセージ
     * @param context ログコンテキスト（オプション）
     *
     * @example
     * ```typescript
     * logger.debug('Processing disclosure', {
     *   disclosure_id: 'TD20240115001',
     *   company_code: '1234',
     * });
     * ```
     */
    debug(message, context) {
        if (isLambdaEnvironment) {
            console.log(JSON.stringify({ level: 'debug', message, ...context }));
        }
        else {
            winstonLogger.debug(message, context);
        }
    }
    /**
     * INFOレベルのログを記録
     *
     * @param message ログメッセージ
     * @param context ログコンテキスト（オプション）
     *
     * @example
     * ```typescript
     * logger.info('Disclosure saved successfully', {
     *   disclosure_id: 'TD20240115001',
     *   date_partition: '2024-01',
     * });
     * ```
     */
    info(message, context) {
        if (isLambdaEnvironment) {
            console.log(JSON.stringify({ level: 'info', message, ...context }));
        }
        else {
            winstonLogger.info(message, context);
        }
    }
    /**
     * WARNレベルのログを記録
     *
     * @param message ログメッセージ
     * @param context ログコンテキスト（オプション）
     *
     * @example
     * ```typescript
     * logger.warn('Duplicate item detected', {
     *   disclosure_id: 'TD20240115001',
     * });
     * ```
     */
    warn(message, context) {
        if (isLambdaEnvironment) {
            console.warn(JSON.stringify({ level: 'warn', message, ...context }));
        }
        else {
            winstonLogger.warn(message, context);
        }
    }
    /**
     * ERRORレベルのログを記録
     *
     * @param message ログメッセージ
     * @param context ログコンテキスト（オプション）
     *
     * @example
     * ```typescript
     * logger.error('Failed to save disclosure', {
     *   error_type: 'ValidationError',
     *   error_message: error.message,
     *   context: {
     *     disclosure_id: 'TD20240115001',
     *   },
     *   stack_trace: error.stack,
     * });
     * ```
     */
    error(message, context) {
        if (isLambdaEnvironment) {
            console.error(JSON.stringify({ level: 'error', message, ...context }));
        }
        else {
            winstonLogger.error(message, context);
        }
    }
}
/**
 * グローバルロガーインスタンス
 *
 * プロジェクト全体で共有されるロガーインスタンスです。
 *
 * @example
 * ```typescript
 * import { logger } from './utils/logger';
 *
 * logger.info('Application started');
 * logger.error('Operation failed', {
 *   error_type: 'NetworkError',
 *   error_message: error.message,
 * });
 * ```
 */
exports.logger = new StructuredLogger();
/**
 * ログレベルを設定
 *
 * @param level ログレベル
 *
 * @example
 * ```typescript
 * import { setLogLevel, LogLevel } from './utils/logger';
 *
 * setLogLevel(LogLevel.DEBUG);
 * ```
 */
function setLogLevel(level) {
    if (winstonLogger) {
        winstonLogger.level = level;
    }
    // Lambda環境では、LOG_LEVEL環境変数で制御されるため、何もしない
}
/**
 * エラーオブジェクトから構造化ログコンテキストを生成
 *
 * Steering準拠の標準フォーマット: { error_type, error_message, context, stack_trace }
 *
 * @param error エラーオブジェクト
 * @param additionalContext 追加のコンテキスト（オプション）
 * @returns ログコンテキスト
 *
 * @example
 * ```typescript
 * try {
 *   await operation();
 * } catch (error) {
 *   logger.error('Operation failed', createErrorContext(error, {
 *     disclosure_id: 'TD20240115001',
 *   }));
 * }
 * ```
 */
function createErrorContext(error, additionalContext) {
    return {
        error_type: error.constructor.name,
        error_message: error.message,
        context: additionalContext || {},
        stack_trace: error.stack,
    };
}
/**
 * Lambda実行コンテキストを含むエラーログを記録
 *
 * Lambda実装チェックリストに準拠した標準エラーログフォーマット。
 * CloudWatch Logsに構造化ログとして記録されます。
 *
 * @param message エラーメッセージ
 * @param error エラーオブジェクト
 * @param lambdaContext Lambda実行コンテキスト（オプション）
 * @param additionalContext 追加のコンテキスト（オプション）
 *
 * @example
 * ```typescript
 * export async function handler(event: any, context: any) {
 *   try {
 *     await operation();
 *   } catch (error) {
 *     logLambdaError('Lambda execution failed', error, context, {
 *       disclosure_id: 'TD20240115001',
 *     });
 *     throw error;
 *   }
 * }
 * ```
 */
function logLambdaError(message, error, lambdaContext, additionalContext) {
    exports.logger.error(message, {
        error_type: error.constructor.name,
        error_message: error.message,
        context: {
            request_id: lambdaContext?.requestId,
            function_name: lambdaContext?.functionName,
            ...additionalContext,
        },
        stack_trace: error.stack,
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFx1dGlsc1xcbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7Ozs7QUFnTUgsa0NBS0M7QUFzQkQsZ0RBVUM7QUEyQkQsd0NBZ0JDO0FBOVFELHNEQUE4QjtBQUU5Qjs7R0FFRztBQUNILElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNsQiwyQkFBZSxDQUFBO0lBQ2YseUJBQWEsQ0FBQTtJQUNiLHlCQUFhLENBQUE7SUFDYiwyQkFBZSxDQUFBO0FBQ2pCLENBQUMsRUFMVyxRQUFRLHdCQUFSLFFBQVEsUUFLbkI7QUFtQkQ7O0dBRUc7QUFDSCxNQUFNLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDO0FBRW5FLHdDQUF3QztBQUN4QyxvQ0FBb0M7QUFDcEMsTUFBTSxhQUFhLEdBQUcsbUJBQW1CO0lBQ3ZDLENBQUMsQ0FBQyxJQUFJO0lBQ04sQ0FBQyxDQUFDLGlCQUFPLENBQUMsWUFBWSxDQUFDO1FBQ25CLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsSUFBSSxRQUFRLENBQUMsSUFBSTtRQUM3QyxNQUFNLEVBQUUsaUJBQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUM1QixpQkFBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFDdkIsTUFBTSxFQUFFLDBCQUEwQjtTQUNuQyxDQUFDLEVBQ0YsaUJBQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQ3RDLGlCQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUN0QjtRQUNELFdBQVcsRUFBRTtZQUNYLE9BQU8sRUFBRSxzQkFBc0I7WUFDL0IsV0FBVyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLGFBQWE7U0FDbkQ7UUFDRCxVQUFVLEVBQUU7WUFDVixJQUFJLGlCQUFPLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQztnQkFDN0IsTUFBTSxFQUFFLGlCQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FDNUIsaUJBQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQ3pCLGlCQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxFQUFFO29CQUMvRCxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUNsRixPQUFPLEdBQUcsU0FBUyxLQUFLLEtBQUssTUFBTSxPQUFPLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQzFELENBQUMsQ0FBQyxDQUNIO2FBQ0YsQ0FBQztTQUNIO0tBQ0YsQ0FBQyxDQUFDO0FBRVA7O0dBRUc7QUFDSCxNQUFNLGdCQUFnQjtJQUNwQjs7Ozs7Ozs7Ozs7OztPQWFHO0lBQ0gsS0FBSyxDQUFDLE9BQWUsRUFBRSxPQUFvQjtRQUN6QyxJQUFJLG1CQUFtQixFQUFFLENBQUM7WUFDeEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkUsQ0FBQzthQUFNLENBQUM7WUFDTixhQUFjLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN6QyxDQUFDO0lBQ0gsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7O09BYUc7SUFDSCxJQUFJLENBQUMsT0FBZSxFQUFFLE9BQW9CO1FBQ3hDLElBQUksbUJBQW1CLEVBQUUsQ0FBQztZQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RSxDQUFDO2FBQU0sQ0FBQztZQUNOLGFBQWMsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7OztPQVlHO0lBQ0gsSUFBSSxDQUFDLE9BQWUsRUFBRSxPQUFvQjtRQUN4QyxJQUFJLG1CQUFtQixFQUFFLENBQUM7WUFDeEIsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkUsQ0FBQzthQUFNLENBQUM7WUFDTixhQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4QyxDQUFDO0lBQ0gsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7OztPQWlCRztJQUNILEtBQUssQ0FBQyxPQUFlLEVBQUUsT0FBb0I7UUFDekMsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1lBQ3hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEdBQUcsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUM7YUFBTSxDQUFDO1lBQ04sYUFBYyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNILENBQUM7Q0FDRjtBQUVEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNVLFFBQUEsTUFBTSxHQUFXLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztBQUVyRDs7Ozs7Ozs7Ozs7R0FXRztBQUNILFNBQWdCLFdBQVcsQ0FBQyxLQUFlO0lBQ3pDLElBQUksYUFBYSxFQUFFLENBQUM7UUFDbEIsYUFBYSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUNELHlDQUF5QztBQUMzQyxDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFDSCxTQUFnQixrQkFBa0IsQ0FDaEMsS0FBWSxFQUNaLGlCQUE4QjtJQUU5QixPQUFPO1FBQ0wsVUFBVSxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSTtRQUNsQyxhQUFhLEVBQUUsS0FBSyxDQUFDLE9BQU87UUFDNUIsT0FBTyxFQUFFLGlCQUFpQixJQUFJLEVBQUU7UUFDaEMsV0FBVyxFQUFFLEtBQUssQ0FBQyxLQUFLO0tBQ3pCLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXdCRztBQUNILFNBQWdCLGNBQWMsQ0FDNUIsT0FBZSxFQUNmLEtBQVksRUFDWixhQUE2RCxFQUM3RCxpQkFBOEI7SUFFOUIsY0FBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUU7UUFDcEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSTtRQUNsQyxhQUFhLEVBQUUsS0FBSyxDQUFDLE9BQU87UUFDNUIsT0FBTyxFQUFFO1lBQ1AsVUFBVSxFQUFFLGFBQWEsRUFBRSxTQUFTO1lBQ3BDLGFBQWEsRUFBRSxhQUFhLEVBQUUsWUFBWTtZQUMxQyxHQUFHLGlCQUFpQjtTQUNyQjtRQUNELFdBQVcsRUFBRSxLQUFLLENBQUMsS0FBSztLQUN6QixDQUFDLENBQUM7QUFDTCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcdXRpbHNcXGxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog5qeL6YCg5YyW44Ot44Ks44O8XHJcbiAqXHJcbiAqIFdpbnN0b27jgpLkvb/nlKjjgZfjgZ/mp4vpgKDljJbjg63jgq7jg7PjgrDjgpLmj5DkvpvjgZfjgb7jgZnjgIJcclxuICogQ2xvdWRXYXRjaCBMb2dz5b2i5byP44GuSlNPTuWHuuWKm+OCkuOCteODneODvOODiOOBl+OAgeODreOCsOODrOODmeODq+OBq+W/nOOBmOOBn+mBqeWIh+OBquODreOCsOiomOmMsuOCkuihjOOBhOOBvuOBmeOAglxyXG4gKlxyXG4gKiBSZXF1aXJlbWVudHM6IOimgeS7tjYuM++8iOani+mAoOWMluODreOCsO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCB3aW5zdG9uIGZyb20gJ3dpbnN0b24nO1xyXG5cclxuLyoqXHJcbiAqIOODreOCsOODrOODmeODq1xyXG4gKi9cclxuZXhwb3J0IGVudW0gTG9nTGV2ZWwge1xyXG4gIERFQlVHID0gJ2RlYnVnJyxcclxuICBJTkZPID0gJ2luZm8nLFxyXG4gIFdBUk4gPSAnd2FybicsXHJcbiAgRVJST1IgPSAnZXJyb3InLFxyXG59XHJcblxyXG4vKipcclxuICog44Ot44Kw44Kz44Oz44OG44Kt44K544OIXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIExvZ0NvbnRleHQge1xyXG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjg63jgqzjg7zjgqTjg7Pjgr/jg7zjg5Xjgqfjg7zjgrlcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgTG9nZ2VyIHtcclxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZDtcclxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkO1xyXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQ7XHJcbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBXaW5zdG9uIOODreOCrOODvOOBruioreWumlxyXG4gKi9cclxuY29uc3QgaXNMYW1iZGFFbnZpcm9ubWVudCA9ICEhcHJvY2Vzcy5lbnYuQVdTX0xBTUJEQV9GVU5DVElPTl9OQU1FO1xyXG5cclxuLy8gTGFtYmRh55Kw5aKD44Gn44Gv44CBV2luc3RvbuOBruS7o+OCj+OCiuOBq2NvbnNvbGUubG9n44KS5L2/55SoXHJcbi8vIOOBk+OCjOOBq+OCiOOCiuOAgUNsb3VkV2F0Y2ggTG9nc+OBq+eiuuWun+OBq+ODreOCsOOBjOWHuuWKm+OBleOCjOOCi1xyXG5jb25zdCB3aW5zdG9uTG9nZ2VyID0gaXNMYW1iZGFFbnZpcm9ubWVudFxyXG4gID8gbnVsbFxyXG4gIDogd2luc3Rvbi5jcmVhdGVMb2dnZXIoe1xyXG4gICAgICBsZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIHx8IExvZ0xldmVsLklORk8sXHJcbiAgICAgIGZvcm1hdDogd2luc3Rvbi5mb3JtYXQuY29tYmluZShcclxuICAgICAgICB3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoe1xyXG4gICAgICAgICAgZm9ybWF0OiAnWVlZWS1NTS1ERFRISDptbTpzcy5TU1NaJyxcclxuICAgICAgICB9KSxcclxuICAgICAgICB3aW5zdG9uLmZvcm1hdC5lcnJvcnMoeyBzdGFjazogdHJ1ZSB9KSxcclxuICAgICAgICB3aW5zdG9uLmZvcm1hdC5qc29uKClcclxuICAgICAgKSxcclxuICAgICAgZGVmYXVsdE1ldGE6IHtcclxuICAgICAgICBzZXJ2aWNlOiAndGRuZXQtZGF0YS1jb2xsZWN0b3InLFxyXG4gICAgICAgIGVudmlyb25tZW50OiBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCAnZGV2ZWxvcG1lbnQnLFxyXG4gICAgICB9LFxyXG4gICAgICB0cmFuc3BvcnRzOiBbXHJcbiAgICAgICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcclxuICAgICAgICAgIGZvcm1hdDogd2luc3Rvbi5mb3JtYXQuY29tYmluZShcclxuICAgICAgICAgICAgd2luc3Rvbi5mb3JtYXQuY29sb3JpemUoKSxcclxuICAgICAgICAgICAgd2luc3Rvbi5mb3JtYXQucHJpbnRmKCh7IHRpbWVzdGFtcCwgbGV2ZWwsIG1lc3NhZ2UsIC4uLm1ldGEgfSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG1ldGFTdHIgPSBPYmplY3Qua2V5cyhtZXRhKS5sZW5ndGggPiAwID8gSlNPTi5zdHJpbmdpZnkobWV0YSwgbnVsbCwgMikgOiAnJztcclxuICAgICAgICAgICAgICByZXR1cm4gYCR7dGltZXN0YW1wfSBbJHtsZXZlbH1dOiAke21lc3NhZ2V9ICR7bWV0YVN0cn1gO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKSxcclxuICAgICAgICB9KSxcclxuICAgICAgXSxcclxuICAgIH0pO1xyXG5cclxuLyoqXHJcbiAqIOani+mAoOWMluODreOCrOODvOWun+ijhVxyXG4gKi9cclxuY2xhc3MgU3RydWN0dXJlZExvZ2dlciBpbXBsZW1lbnRzIExvZ2dlciB7XHJcbiAgLyoqXHJcbiAgICogREVCVUfjg6zjg5njg6vjga7jg63jgrDjgpLoqJjpjLJcclxuICAgKlxyXG4gICAqIEBwYXJhbSBtZXNzYWdlIOODreOCsOODoeODg+OCu+ODvOOCuFxyXG4gICAqIEBwYXJhbSBjb250ZXh0IOODreOCsOOCs+ODs+ODhuOCreOCueODiO+8iOOCquODl+OCt+ODp+ODs++8iVxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbG9nZ2VyLmRlYnVnKCdQcm9jZXNzaW5nIGRpc2Nsb3N1cmUnLCB7XHJcbiAgICogICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMScsXHJcbiAgICogICBjb21wYW55X2NvZGU6ICcxMjM0JyxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZCB7XHJcbiAgICBpZiAoaXNMYW1iZGFFbnZpcm9ubWVudCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7IGxldmVsOiAnZGVidWcnLCBtZXNzYWdlLCAuLi5jb250ZXh0IH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbnN0b25Mb2dnZXIhLmRlYnVnKG1lc3NhZ2UsIGNvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSU5GT+ODrOODmeODq+OBruODreOCsOOCkuiomOmMslxyXG4gICAqXHJcbiAgICogQHBhcmFtIG1lc3NhZ2Ug44Ot44Kw44Oh44OD44K744O844K4XHJcbiAgICogQHBhcmFtIGNvbnRleHQg44Ot44Kw44Kz44Oz44OG44Kt44K544OI77yI44Kq44OX44K344On44Oz77yJXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBsb2dnZXIuaW5mbygnRGlzY2xvc3VyZSBzYXZlZCBzdWNjZXNzZnVsbHknLCB7XHJcbiAgICogICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMScsXHJcbiAgICogICBkYXRlX3BhcnRpdGlvbjogJzIwMjQtMDEnLFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQge1xyXG4gICAgaWYgKGlzTGFtYmRhRW52aXJvbm1lbnQpIHtcclxuICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoeyBsZXZlbDogJ2luZm8nLCBtZXNzYWdlLCAuLi5jb250ZXh0IH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbnN0b25Mb2dnZXIhLmluZm8obWVzc2FnZSwgY29udGV4dCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXQVJO44Os44OZ44Or44Gu44Ot44Kw44KS6KiY6YyyXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbWVzc2FnZSDjg63jgrDjg6Hjg4Pjgrvjg7zjgrhcclxuICAgKiBAcGFyYW0gY29udGV4dCDjg63jgrDjgrPjg7Pjg4bjgq3jgrnjg4jvvIjjgqrjg5fjgrfjg6fjg7PvvIlcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxvZ2dlci53YXJuKCdEdXBsaWNhdGUgaXRlbSBkZXRlY3RlZCcsIHtcclxuICAgKiAgIGRpc2Nsb3N1cmVfaWQ6ICdURDIwMjQwMTE1MDAxJyxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICB3YXJuKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkIHtcclxuICAgIGlmIChpc0xhbWJkYUVudmlyb25tZW50KSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihKU09OLnN0cmluZ2lmeSh7IGxldmVsOiAnd2FybicsIG1lc3NhZ2UsIC4uLmNvbnRleHQgfSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luc3RvbkxvZ2dlciEud2FybihtZXNzYWdlLCBjb250ZXh0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVSUk9S44Os44OZ44Or44Gu44Ot44Kw44KS6KiY6YyyXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbWVzc2FnZSDjg63jgrDjg6Hjg4Pjgrvjg7zjgrhcclxuICAgKiBAcGFyYW0gY29udGV4dCDjg63jgrDjgrPjg7Pjg4bjgq3jgrnjg4jvvIjjgqrjg5fjgrfjg6fjg7PvvIlcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHNhdmUgZGlzY2xvc3VyZScsIHtcclxuICAgKiAgIGVycm9yX3R5cGU6ICdWYWxpZGF0aW9uRXJyb3InLFxyXG4gICAqICAgZXJyb3JfbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgKiAgIGNvbnRleHQ6IHtcclxuICAgKiAgICAgZGlzY2xvc3VyZV9pZDogJ1REMjAyNDAxMTUwMDEnLFxyXG4gICAqICAgfSxcclxuICAgKiAgIHN0YWNrX3RyYWNlOiBlcnJvci5zdGFjayxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZCB7XHJcbiAgICBpZiAoaXNMYW1iZGFFbnZpcm9ubWVudCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKEpTT04uc3RyaW5naWZ5KHsgbGV2ZWw6ICdlcnJvcicsIG1lc3NhZ2UsIC4uLmNvbnRleHQgfSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luc3RvbkxvZ2dlciEuZXJyb3IobWVzc2FnZSwgY29udGV4dCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog44Kw44Ot44O844OQ44Or44Ot44Ks44O844Kk44Oz44K544K/44Oz44K5XHJcbiAqXHJcbiAqIOODl+ODreOCuOOCp+OCr+ODiOWFqOS9k+OBp+WFseacieOBleOCjOOCi+ODreOCrOODvOOCpOODs+OCueOCv+ODs+OCueOBp+OBmeOAglxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGB0eXBlc2NyaXB0XHJcbiAqIGltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcclxuICpcclxuICogbG9nZ2VyLmluZm8oJ0FwcGxpY2F0aW9uIHN0YXJ0ZWQnKTtcclxuICogbG9nZ2VyLmVycm9yKCdPcGVyYXRpb24gZmFpbGVkJywge1xyXG4gKiAgIGVycm9yX3R5cGU6ICdOZXR3b3JrRXJyb3InLFxyXG4gKiAgIGVycm9yX21lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBjb25zdCBsb2dnZXI6IExvZ2dlciA9IG5ldyBTdHJ1Y3R1cmVkTG9nZ2VyKCk7XHJcblxyXG4vKipcclxuICog44Ot44Kw44Os44OZ44Or44KS6Kit5a6aXHJcbiAqXHJcbiAqIEBwYXJhbSBsZXZlbCDjg63jgrDjg6zjg5njg6tcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBpbXBvcnQgeyBzZXRMb2dMZXZlbCwgTG9nTGV2ZWwgfSBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XHJcbiAqXHJcbiAqIHNldExvZ0xldmVsKExvZ0xldmVsLkRFQlVHKTtcclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc2V0TG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVsKTogdm9pZCB7XHJcbiAgaWYgKHdpbnN0b25Mb2dnZXIpIHtcclxuICAgIHdpbnN0b25Mb2dnZXIubGV2ZWwgPSBsZXZlbDtcclxuICB9XHJcbiAgLy8gTGFtYmRh55Kw5aKD44Gn44Gv44CBTE9HX0xFVkVM55Kw5aKD5aSJ5pWw44Gn5Yi25b6h44GV44KM44KL44Gf44KB44CB5L2V44KC44GX44Gq44GEXHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjgqjjg6njg7zjgqrjg5bjgrjjgqfjgq/jg4jjgYvjgonmp4vpgKDljJbjg63jgrDjgrPjg7Pjg4bjgq3jgrnjg4jjgpLnlJ/miJBcclxuICpcclxuICogU3RlZXJpbmfmupbmi6Djga7mqJnmupbjg5Xjgqnjg7zjg57jg4Pjg4g6IHsgZXJyb3JfdHlwZSwgZXJyb3JfbWVzc2FnZSwgY29udGV4dCwgc3RhY2tfdHJhY2UgfVxyXG4gKlxyXG4gKiBAcGFyYW0gZXJyb3Ig44Ko44Op44O844Kq44OW44K444Kn44Kv44OIXHJcbiAqIEBwYXJhbSBhZGRpdGlvbmFsQ29udGV4dCDov73liqDjga7jgrPjg7Pjg4bjgq3jgrnjg4jvvIjjgqrjg5fjgrfjg6fjg7PvvIlcclxuICogQHJldHVybnMg44Ot44Kw44Kz44Oz44OG44Kt44K544OIXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogdHJ5IHtcclxuICogICBhd2FpdCBvcGVyYXRpb24oKTtcclxuICogfSBjYXRjaCAoZXJyb3IpIHtcclxuICogICBsb2dnZXIuZXJyb3IoJ09wZXJhdGlvbiBmYWlsZWQnLCBjcmVhdGVFcnJvckNvbnRleHQoZXJyb3IsIHtcclxuICogICAgIGRpc2Nsb3N1cmVfaWQ6ICdURDIwMjQwMTE1MDAxJyxcclxuICogICB9KSk7XHJcbiAqIH1cclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRXJyb3JDb250ZXh0KFxyXG4gIGVycm9yOiBFcnJvcixcclxuICBhZGRpdGlvbmFsQ29udGV4dD86IExvZ0NvbnRleHRcclxuKTogTG9nQ29udGV4dCB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGVycm9yX3R5cGU6IGVycm9yLmNvbnN0cnVjdG9yLm5hbWUsXHJcbiAgICBlcnJvcl9tZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgY29udGV4dDogYWRkaXRpb25hbENvbnRleHQgfHwge30sXHJcbiAgICBzdGFja190cmFjZTogZXJyb3Iuc3RhY2ssXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIExhbWJkYeWun+ihjOOCs+ODs+ODhuOCreOCueODiOOCkuWQq+OCgOOCqOODqeODvOODreOCsOOCkuiomOmMslxyXG4gKlxyXG4gKiBMYW1iZGHlrp/oo4Xjg4Hjgqfjg4Pjgq/jg6rjgrnjg4jjgavmupbmi6DjgZfjgZ/mqJnmupbjgqjjg6njg7zjg63jgrDjg5Xjgqnjg7zjg57jg4Pjg4jjgIJcclxuICogQ2xvdWRXYXRjaCBMb2dz44Gr5qeL6YCg5YyW44Ot44Kw44Go44GX44Gm6KiY6Yyy44GV44KM44G+44GZ44CCXHJcbiAqXHJcbiAqIEBwYXJhbSBtZXNzYWdlIOOCqOODqeODvOODoeODg+OCu+ODvOOCuFxyXG4gKiBAcGFyYW0gZXJyb3Ig44Ko44Op44O844Kq44OW44K444Kn44Kv44OIXHJcbiAqIEBwYXJhbSBsYW1iZGFDb250ZXh0IExhbWJkYeWun+ihjOOCs+ODs+ODhuOCreOCueODiO+8iOOCquODl+OCt+ODp+ODs++8iVxyXG4gKiBAcGFyYW0gYWRkaXRpb25hbENvbnRleHQg6L+95Yqg44Gu44Kz44Oz44OG44Kt44K544OI77yI44Kq44OX44K344On44Oz77yJXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQ6IGFueSwgY29udGV4dDogYW55KSB7XHJcbiAqICAgdHJ5IHtcclxuICogICAgIGF3YWl0IG9wZXJhdGlvbigpO1xyXG4gKiAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAqICAgICBsb2dMYW1iZGFFcnJvcignTGFtYmRhIGV4ZWN1dGlvbiBmYWlsZWQnLCBlcnJvciwgY29udGV4dCwge1xyXG4gKiAgICAgICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMScsXHJcbiAqICAgICB9KTtcclxuICogICAgIHRocm93IGVycm9yO1xyXG4gKiAgIH1cclxuICogfVxyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2dMYW1iZGFFcnJvcihcclxuICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgZXJyb3I6IEVycm9yLFxyXG4gIGxhbWJkYUNvbnRleHQ/OiB7IHJlcXVlc3RJZD86IHN0cmluZzsgZnVuY3Rpb25OYW1lPzogc3RyaW5nIH0sXHJcbiAgYWRkaXRpb25hbENvbnRleHQ/OiBMb2dDb250ZXh0XHJcbik6IHZvaWQge1xyXG4gIGxvZ2dlci5lcnJvcihtZXNzYWdlLCB7XHJcbiAgICBlcnJvcl90eXBlOiBlcnJvci5jb25zdHJ1Y3Rvci5uYW1lLFxyXG4gICAgZXJyb3JfbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgIGNvbnRleHQ6IHtcclxuICAgICAgcmVxdWVzdF9pZDogbGFtYmRhQ29udGV4dD8ucmVxdWVzdElkLFxyXG4gICAgICBmdW5jdGlvbl9uYW1lOiBsYW1iZGFDb250ZXh0Py5mdW5jdGlvbk5hbWUsXHJcbiAgICAgIC4uLmFkZGl0aW9uYWxDb250ZXh0LFxyXG4gICAgfSxcclxuICAgIHN0YWNrX3RyYWNlOiBlcnJvci5zdGFjayxcclxuICB9KTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=