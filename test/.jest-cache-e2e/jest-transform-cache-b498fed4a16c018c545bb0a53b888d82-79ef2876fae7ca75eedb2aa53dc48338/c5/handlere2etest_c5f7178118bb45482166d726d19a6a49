a13d1e783a8b7f84a0b2c3a54c7ffce9
"use strict";
/**
 * Lambda Collect Status Handler E2E Tests
 *
 * LocalStack環境でのエンドツーエンドテスト。
 * 実際のDynamoDBとの統合を検証します。
 *
 * Requirements: タスク35
 */
Object.defineProperty(exports, "__esModule", { value: true });
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const util_dynamodb_1 = require("@aws-sdk/util-dynamodb");
const handler_1 = require("../handler");
// LocalStack用のクライアント設定
const dynamoClient = new client_dynamodb_1.DynamoDBClient({
    region: process.env.AWS_REGION || 'ap-northeast-1',
    endpoint: process.env.AWS_ENDPOINT || 'http://localhost:4566',
});
// テスト用のモックコンテキスト
const mockContext = {
    awsRequestId: 'test-request-id-e2e',
    functionName: 'tdnet-collect-status-e2e',
    functionVersion: '1',
    invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-collect-status-e2e',
    memoryLimitInMB: '256',
    logGroupName: '/aws/lambda/tdnet-collect-status-e2e',
    logStreamName: '2024/01/15/[$LATEST]e2e-test',
    getRemainingTimeInMillis: () => 30000,
    callbackWaitsForEmptyEventLoop: false,
    done: jest.fn(),
    fail: jest.fn(),
    succeed: jest.fn(),
};
describe('Lambda Collect Status Handler E2E Tests', () => {
    describe('実行状態取得', () => {
        it('存在する実行IDの状態を取得できる', async () => {
            // Arrange
            const execution_id = `test_exec_${Date.now()}`;
            const executionStatus = {
                execution_id,
                status: 'running',
                progress: 50,
                collected_count: 10,
                failed_count: 2,
                started_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            };
            // DynamoDBにテストデータを挿入
            await putExecutionStatus(executionStatus);
            const event = createMockEvent(execution_id);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(200);
            expect(response.headers).toHaveProperty('Content-Type', 'application/json');
            expect(response.headers).toHaveProperty('Access-Control-Allow-Origin', '*');
            const body = JSON.parse(response.body);
            expect(body.status).toBe('success');
            expect(body.data).toBeDefined();
            expect(body.data.execution_id).toBe(execution_id);
            expect(body.data.status).toBe('running');
            expect(body.data.progress).toBe(50);
            expect(body.data.collected_count).toBe(10);
            expect(body.data.failed_count).toBe(2);
        });
        it('完了状態の実行IDを取得できる', async () => {
            // Arrange
            const execution_id = `test_exec_completed_${Date.now()}`;
            const executionStatus = {
                execution_id,
                status: 'completed',
                progress: 100,
                collected_count: 50,
                failed_count: 0,
                started_at: new Date(Date.now() - 60000).toISOString(),
                updated_at: new Date(Date.now() - 30000).toISOString(),
                completed_at: new Date(Date.now() - 30000).toISOString(),
            };
            await putExecutionStatus(executionStatus);
            const event = createMockEvent(execution_id);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(200);
            const body = JSON.parse(response.body);
            expect(body.data.status).toBe('completed');
            expect(body.data.progress).toBe(100);
            expect(body.data.completed_at).toBeDefined();
        });
        it('失敗状態の実行IDを取得できる', async () => {
            // Arrange
            const execution_id = `test_exec_failed_${Date.now()}`;
            const executionStatus = {
                execution_id,
                status: 'failed',
                progress: 30,
                collected_count: 5,
                failed_count: 10,
                started_at: new Date(Date.now() - 60000).toISOString(),
                updated_at: new Date(Date.now() - 30000).toISOString(),
                completed_at: new Date(Date.now() - 30000).toISOString(),
                error_message: 'Network error occurred',
            };
            await putExecutionStatus(executionStatus);
            const event = createMockEvent(execution_id);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(200);
            const body = JSON.parse(response.body);
            expect(body.data.status).toBe('failed');
            expect(body.data.error_message).toBe('Network error occurred');
        });
    });
    describe('エラーハンドリング', () => {
        it('存在しない実行IDの場合は404エラー', async () => {
            // Arrange
            const execution_id = 'non_existent_execution_id';
            const event = createMockEvent(execution_id);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(404);
            expect(response.headers).toHaveProperty('Content-Type', 'application/json');
            expect(response.headers).toHaveProperty('Access-Control-Allow-Origin', '*');
            const body = JSON.parse(response.body);
            expect(body.status).toBe('error');
            expect(body.error.code).toBe('NOT_FOUND');
            expect(body.error.message).toContain('Execution not found');
        });
        it('execution_idが未指定の場合は400エラー', async () => {
            // Arrange
            const event = createMockEvent(null);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(400);
            const body = JSON.parse(response.body);
            expect(body.status).toBe('error');
            expect(body.error.code).toBe('VALIDATION_ERROR');
            expect(body.error.message).toContain('execution_id is required');
        });
    });
    describe('CORS対応', () => {
        it('すべてのレスポンスにCORSヘッダーが含まれる', async () => {
            // Arrange
            const execution_id = `test_exec_cors_${Date.now()}`;
            const executionStatus = {
                execution_id,
                status: 'running',
                progress: 25,
                collected_count: 5,
                failed_count: 0,
                started_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            };
            await putExecutionStatus(executionStatus);
            const event = createMockEvent(execution_id);
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.headers).toHaveProperty('Access-Control-Allow-Origin', '*');
        });
        it('エラーレスポンスにもCORSヘッダーが含まれる', async () => {
            // Arrange
            const event = createMockEvent('non_existent');
            // Act
            const response = await (0, handler_1.handler)(event, mockContext);
            // Assert
            expect(response.statusCode).toBe(404);
            expect(response.headers).toHaveProperty('Access-Control-Allow-Origin', '*');
        });
    });
});
/**
 * DynamoDBに実行状態を挿入
 */
async function putExecutionStatus(executionStatus) {
    const command = new client_dynamodb_1.PutItemCommand({
        TableName: process.env.DYNAMODB_EXECUTIONS_TABLE || 'tdnet_executions',
        Item: (0, util_dynamodb_1.marshall)(executionStatus),
    });
    await dynamoClient.send(command);
}
/**
 * モックイベントを作成
 */
function createMockEvent(execution_id) {
    return {
        body: null,
        headers: {},
        multiValueHeaders: {},
        httpMethod: 'GET',
        isBase64Encoded: false,
        path: `/collect/${execution_id}`,
        pathParameters: execution_id ? { execution_id } : null,
        queryStringParameters: null,
        multiValueQueryStringParameters: null,
        stageVariables: null,
        requestContext: {
            accountId: '123456789012',
            apiId: 'test-api-id',
            protocol: 'HTTP/1.1',
            httpMethod: 'GET',
            path: `/collect/${execution_id}`,
            stage: 'prod',
            requestId: 'test-request-id',
            requestTime: '15/Jan/2024:10:30:00 +0000',
            requestTimeEpoch: 1705315800000,
            identity: {
                accessKey: null,
                accountId: null,
                apiKey: null,
                apiKeyId: null,
                caller: null,
                clientCert: null,
                cognitoAuthenticationProvider: null,
                cognitoAuthenticationType: null,
                cognitoIdentityId: null,
                cognitoIdentityPoolId: null,
                principalOrgId: null,
                sourceIp: '192.168.1.1',
                user: null,
                userAgent: 'Mozilla/5.0',
                userArn: null,
            },
            authorizer: null,
            domainName: 'api.example.com',
            domainPrefix: 'api',
            resourceId: 'test-resource-id',
            resourcePath: '/collect/{execution_id}',
        },
        resource: '/collect/{execution_id}',
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3Qtc3RhdHVzXFxfX3Rlc3RzX19cXGhhbmRsZXIuZTJlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7O0FBR0gsOERBQTBFO0FBQzFFLDBEQUFrRDtBQUNsRCx3Q0FBcUM7QUFFckMsdUJBQXVCO0FBQ3ZCLE1BQU0sWUFBWSxHQUFHLElBQUksZ0NBQWMsQ0FBQztJQUN0QyxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksZ0JBQWdCO0lBQ2xELFFBQVEsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSx1QkFBdUI7Q0FDOUQsQ0FBQyxDQUFDO0FBRUgsaUJBQWlCO0FBQ2pCLE1BQU0sV0FBVyxHQUFZO0lBQzNCLFlBQVksRUFBRSxxQkFBcUI7SUFDbkMsWUFBWSxFQUFFLDBCQUEwQjtJQUN4QyxlQUFlLEVBQUUsR0FBRztJQUNwQixrQkFBa0IsRUFBRSw4RUFBOEU7SUFDbEcsZUFBZSxFQUFFLEtBQUs7SUFDdEIsWUFBWSxFQUFFLHNDQUFzQztJQUNwRCxhQUFhLEVBQUUsOEJBQThCO0lBQzdDLHdCQUF3QixFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUs7SUFDckMsOEJBQThCLEVBQUUsS0FBSztJQUNyQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNmLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDbkIsQ0FBQztBQUVGLFFBQVEsQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7SUFDdkQsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pDLFVBQVU7WUFDVixNQUFNLFlBQVksR0FBRyxhQUFhLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFB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QUFVO1lBQ3BCLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLElBQUksRUFBRSxZQUFZLFlBQVksRUFBRTtZQUNoQyxLQUFLLEVBQUUsTUFBTTtZQUNiLFNBQVMsRUFBRSxpQkFBaUI7WUFDNUIsV0FBVyxFQUFFLDRCQUE0QjtZQUN6QyxnQkFBZ0IsRUFBRSxhQUFhO1lBQy9CLFFBQVEsRUFBRTtnQkFDUixTQUFTLEVBQUUsSUFBSTtnQkFDZixTQUFTLEVBQUUsSUFBSTtnQkFDZixNQUFNLEVBQUUsSUFBSTtnQkFDWixRQUFRLEVBQUUsSUFBSTtnQkFDZCxNQUFNLEVBQUUsSUFBSTtnQkFDWixVQUFVLEVBQUUsSUFBSTtnQkFDaEIsNkJBQTZCLEVBQUUsSUFBSTtnQkFDbkMseUJBQXlCLEVBQUUsSUFBSTtnQkFDL0IsaUJBQWlCLEVBQUUsSUFBSTtnQkFDdkIscUJBQXFCLEVBQUUsSUFBSTtnQkFDM0IsY0FBYyxFQUFFLElBQUk7Z0JBQ3BCLFFBQVEsRUFBRSxhQUFhO2dCQUN2QixJQUFJLEVBQUUsSUFBSTtnQkFDVixTQUFTLEVBQUUsYUFBYTtnQkFDeEIsT0FBTyxFQUFFLElBQUk7YUFDZDtZQUNELFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFVBQVUsRUFBRSxpQkFBaUI7WUFDN0IsWUFBWSxFQUFFLEtBQUs7WUFDbkIsVUFBVSxFQUFFLGtCQUFrQjtZQUM5QixZQUFZLEVBQUUseUJBQXlCO1NBQ3hDO1FBQ0QsUUFBUSxFQUFFLHlCQUF5QjtLQUNwQyxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcY29sbGVjdC1zdGF0dXNcXF9fdGVzdHNfX1xcaGFuZGxlci5lMmUudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogTGFtYmRhIENvbGxlY3QgU3RhdHVzIEhhbmRsZXIgRTJFIFRlc3RzXHJcbiAqXHJcbiAqIExvY2FsU3RhY2vnkrDlooPjgafjga7jgqjjg7Pjg4njg4Tjg7zjgqjjg7Pjg4njg4bjgrnjg4jjgIJcclxuICog5a6f6Zqb44GuRHluYW1vRELjgajjga7ntbHlkIjjgpLmpJzoqLzjgZfjgb7jgZnjgIJcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDjgr/jgrnjgq8zNVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50LCBDb250ZXh0IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IER5bmFtb0RCQ2xpZW50LCBQdXRJdGVtQ29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1keW5hbW9kYic7XHJcbmltcG9ydCB7IG1hcnNoYWxsIH0gZnJvbSAnQGF3cy1zZGsvdXRpbC1keW5hbW9kYic7XHJcbmltcG9ydCB7IGhhbmRsZXIgfSBmcm9tICcuLi9oYW5kbGVyJztcclxuXHJcbi8vIExvY2FsU3RhY2vnlKjjga7jgq/jg6njgqTjgqLjg7Pjg4joqK3lrppcclxuY29uc3QgZHluYW1vQ2xpZW50ID0gbmV3IER5bmFtb0RCQ2xpZW50KHtcclxuICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gfHwgJ2FwLW5vcnRoZWFzdC0xJyxcclxuICBlbmRwb2ludDogcHJvY2Vzcy5lbnYuQVdTX0VORFBPSU5UIHx8ICdodHRwOi8vbG9jYWxob3N0OjQ1NjYnLFxyXG59KTtcclxuXHJcbi8vIOODhuOCueODiOeUqOOBruODouODg+OCr+OCs+ODs+ODhuOCreOCueODiFxyXG5jb25zdCBtb2NrQ29udGV4dDogQ29udGV4dCA9IHtcclxuICBhd3NSZXF1ZXN0SWQ6ICd0ZXN0LXJlcXVlc3QtaWQtZTJlJyxcclxuICBmdW5jdGlvbk5hbWU6ICd0ZG5ldC1jb2xsZWN0LXN0YXR1cy1lMmUnLFxyXG4gIGZ1bmN0aW9uVmVyc2lvbjogJzEnLFxyXG4gIGludm9rZWRGdW5jdGlvbkFybjogJ2Fybjphd3M6bGFtYmRhOmFwLW5vcnRoZWFzdC0xOjEyMzQ1Njc4OTAxMjpmdW5jdGlvbjp0ZG5ldC1jb2xsZWN0LXN0YXR1cy1lMmUnLFxyXG4gIG1lbW9yeUxpbWl0SW5NQjogJzI1NicsXHJcbiAgbG9nR3JvdXBOYW1lOiAnL2F3cy9sYW1iZGEvdGRuZXQtY29sbGVjdC1zdGF0dXMtZTJlJyxcclxuICBsb2dTdHJlYW1OYW1lOiAnMjAyNC8wMS8xNS9bJExBVEVTVF1lMmUtdGVzdCcsXHJcbiAgZ2V0UmVtYWluaW5nVGltZUluTWlsbGlzOiAoKSA9PiAzMDAwMCxcclxuICBjYWxsYmFja1dhaXRzRm9yRW1wdHlFdmVudExvb3A6IGZhbHNlLFxyXG4gIGRvbmU6IGplc3QuZm4oKSxcclxuICBmYWlsOiBqZXN0LmZuKCksXHJcbiAgc3VjY2VlZDogamVzdC5mbigpLFxyXG59O1xyXG5cclxuZGVzY3JpYmUoJ0xhbWJkYSBDb2xsZWN0IFN0YXR1cyBIYW5kbGVyIEUyRSBUZXN0cycsICgpID0+IHtcclxuICBkZXNjcmliZSgn5a6f6KGM54q25oWL5Y+W5b6XJywgKCkgPT4ge1xyXG4gICAgaXQoJ+WtmOWcqOOBmeOCi+Wun+ihjElE44Gu54q25oWL44KS5Y+W5b6X44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvbl9pZCA9IGB0ZXN0X2V4ZWNfJHtEYXRlLm5vdygpfWA7XHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblN0YXR1cyA9IHtcclxuICAgICAgICBleGVjdXRpb25faWQsXHJcbiAgICAgICAgc3RhdHVzOiAncnVubmluZycsXHJcbiAgICAgICAgcHJvZ3Jlc3M6IDUwLFxyXG4gICAgICAgIGNvbGxlY3RlZF9jb3VudDogMTAsXHJcbiAgICAgICAgZmFpbGVkX2NvdW50OiAyLFxyXG4gICAgICAgIHN0YXJ0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBEeW5hbW9EQuOBq+ODhuOCueODiOODh+ODvOOCv+OCkuaMv+WFpVxyXG4gICAgICBhd2FpdCBwdXRFeGVjdXRpb25TdGF0dXMoZXhlY3V0aW9uU3RhdHVzKTtcclxuXHJcbiAgICAgIGNvbnN0IGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IGNyZWF0ZU1vY2tFdmVudChleGVjdXRpb25faWQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihldmVudCwgbW9ja0NvbnRleHQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzKS50b0hhdmVQcm9wZXJ0eSgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnMpLnRvSGF2ZVByb3BlcnR5KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpO1xyXG5cclxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzcG9uc2UuYm9keSk7XHJcbiAgICAgIGV4cGVjdChib2R5LnN0YXR1cykudG9CZSgnc3VjY2VzcycpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLmV4ZWN1dGlvbl9pZCkudG9CZShleGVjdXRpb25faWQpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLnN0YXR1cykudG9CZSgncnVubmluZycpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLnByb2dyZXNzKS50b0JlKDUwKTtcclxuICAgICAgZXhwZWN0KGJvZHkuZGF0YS5jb2xsZWN0ZWRfY291bnQpLnRvQmUoMTApO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLmZhaWxlZF9jb3VudCkudG9CZSgyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCflrozkuobnirbmhYvjga7lrp/ooYxJROOCkuWPluW+l+OBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleGVjdXRpb25faWQgPSBgdGVzdF9leGVjX2NvbXBsZXRlZF8ke0RhdGUubm93KCl9YDtcclxuICAgICAgY29uc3QgZXhlY3V0aW9uU3RhdHVzID0ge1xyXG4gICAgICAgIGV4ZWN1dGlvbl9pZCxcclxuICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgIHByb2dyZXNzOiAxMDAsXHJcbiAgICAgICAgY29sbGVjdGVkX2NvdW50OiA1MCxcclxuICAgICAgICBmYWlsZWRfY291bnQ6IDAsXHJcbiAgICAgICAgc3RhcnRlZF9hdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDYwMDAwKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMDAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBjb21wbGV0ZWRfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMDAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGF3YWl0IHB1dEV4ZWN1dGlvblN0YXR1cyhleGVjdXRpb25TdGF0dXMpO1xyXG5cclxuICAgICAgY29uc3QgZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KGV4ZWN1dGlvbl9pZCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYW5kbGVyKGV2ZW50LCBtb2NrQ29udGV4dCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcclxuXHJcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmJvZHkpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLnN0YXR1cykudG9CZSgnY29tcGxldGVkJyk7XHJcbiAgICAgIGV4cGVjdChib2R5LmRhdGEucHJvZ3Jlc3MpLnRvQmUoMTAwKTtcclxuICAgICAgZXhwZWN0KGJvZHkuZGF0YS5jb21wbGV0ZWRfYXQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5aSx5pWX54q25oWL44Gu5a6f6KGMSUTjgpLlj5blvpfjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhlY3V0aW9uX2lkID0gYHRlc3RfZXhlY19mYWlsZWRfJHtEYXRlLm5vdygpfWA7XHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblN0YXR1cyA9IHtcclxuICAgICAgICBleGVjdXRpb25faWQsXHJcbiAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgICBwcm9ncmVzczogMzAsXHJcbiAgICAgICAgY29sbGVjdGVkX2NvdW50OiA1LFxyXG4gICAgICAgIGZhaWxlZF9jb3VudDogMTAsXHJcbiAgICAgICAgc3RhcnRlZF9hdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDYwMDAwKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMDAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBjb21wbGV0ZWRfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMDAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBlcnJvcl9tZXNzYWdlOiAnTmV0d29yayBlcnJvciBvY2N1cnJlZCcsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCBwdXRFeGVjdXRpb25TdGF0dXMoZXhlY3V0aW9uU3RhdHVzKTtcclxuXHJcbiAgICAgIGNvbnN0IGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IGNyZWF0ZU1vY2tFdmVudChleGVjdXRpb25faWQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihldmVudCwgbW9ja0NvbnRleHQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XHJcblxyXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgZXhwZWN0KGJvZHkuZGF0YS5zdGF0dXMpLnRvQmUoJ2ZhaWxlZCcpO1xyXG4gICAgICBleHBlY3QoYm9keS5kYXRhLmVycm9yX21lc3NhZ2UpLnRvQmUoJ05ldHdvcmsgZXJyb3Igb2NjdXJyZWQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn44Ko44Op44O844OP44Oz44OJ44Oq44Oz44KwJywgKCkgPT4ge1xyXG4gICAgaXQoJ+WtmOWcqOOBl+OBquOBhOWun+ihjElE44Gu5aC05ZCI44GvNDA044Ko44Op44O8JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvbl9pZCA9ICdub25fZXhpc3RlbnRfZXhlY3V0aW9uX2lkJztcclxuICAgICAgY29uc3QgZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KGV4ZWN1dGlvbl9pZCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYW5kbGVyKGV2ZW50LCBtb2NrQ29udGV4dCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvQmUoNDA0KTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnMpLnRvSGF2ZVByb3BlcnR5KCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVycykudG9IYXZlUHJvcGVydHkoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7XHJcblxyXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXNwb25zZS5ib2R5KTtcclxuICAgICAgZXhwZWN0KGJvZHkuc3RhdHVzKS50b0JlKCdlcnJvcicpO1xyXG4gICAgICBleHBlY3QoYm9keS5lcnJvci5jb2RlKS50b0JlKCdOT1RfRk9VTkQnKTtcclxuICAgICAgZXhwZWN0KGJvZHkuZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdFeGVjdXRpb24gbm90IGZvdW5kJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZXhlY3V0aW9uX2lk44GM5pyq5oyH5a6a44Gu5aC05ZCI44GvNDAw44Ko44Op44O8JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IGNyZWF0ZU1vY2tFdmVudChudWxsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGhhbmRsZXIoZXZlbnQsIG1vY2tDb250ZXh0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzQ29kZSkudG9CZSg0MDApO1xyXG5cclxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzcG9uc2UuYm9keSk7XHJcbiAgICAgIGV4cGVjdChib2R5LnN0YXR1cykudG9CZSgnZXJyb3InKTtcclxuICAgICAgZXhwZWN0KGJvZHkuZXJyb3IuY29kZSkudG9CZSgnVkFMSURBVElPTl9FUlJPUicpO1xyXG4gICAgICBleHBlY3QoYm9keS5lcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ2V4ZWN1dGlvbl9pZCBpcyByZXF1aXJlZCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDT1JT5a++5b+cJywgKCkgPT4ge1xyXG4gICAgaXQoJ+OBmeOBueOBpuOBruODrOOCueODneODs+OCueOBq0NPUlPjg5jjg4Pjg4Djg7zjgYzlkKvjgb7jgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhlY3V0aW9uX2lkID0gYHRlc3RfZXhlY19jb3JzXyR7RGF0ZS5ub3coKX1gO1xyXG4gICAgICBjb25zdCBleGVjdXRpb25TdGF0dXMgPSB7XHJcbiAgICAgICAgZXhlY3V0aW9uX2lkLFxyXG4gICAgICAgIHN0YXR1czogJ3J1bm5pbmcnLFxyXG4gICAgICAgIHByb2dyZXNzOiAyNSxcclxuICAgICAgICBjb2xsZWN0ZWRfY291bnQ6IDUsXHJcbiAgICAgICAgZmFpbGVkX2NvdW50OiAwLFxyXG4gICAgICAgIHN0YXJ0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCBwdXRFeGVjdXRpb25TdGF0dXMoZXhlY3V0aW9uU3RhdHVzKTtcclxuXHJcbiAgICAgIGNvbnN0IGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IGNyZWF0ZU1vY2tFdmVudChleGVjdXRpb25faWQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihldmVudCwgbW9ja0NvbnRleHQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzKS50b0hhdmVQcm9wZXJ0eSgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgqjjg6njg7zjg6zjgrnjg53jg7PjgrnjgavjgoJDT1JT44OY44OD44OA44O844GM5ZCr44G+44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnbm9uX2V4aXN0ZW50Jyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYW5kbGVyKGV2ZW50LCBtb2NrQ29udGV4dCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvQmUoNDA0KTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnMpLnRvSGF2ZVByb3BlcnR5KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIER5bmFtb0RC44Gr5a6f6KGM54q25oWL44KS5oy/5YWlXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBwdXRFeGVjdXRpb25TdGF0dXMoZXhlY3V0aW9uU3RhdHVzOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCBjb21tYW5kID0gbmV3IFB1dEl0ZW1Db21tYW5kKHtcclxuICAgIFRhYmxlTmFtZTogcHJvY2Vzcy5lbnYuRFlOQU1PREJfRVhFQ1VUSU9OU19UQUJMRSB8fCAndGRuZXRfZXhlY3V0aW9ucycsXHJcbiAgICBJdGVtOiBtYXJzaGFsbChleGVjdXRpb25TdGF0dXMpLFxyXG4gIH0pO1xyXG5cclxuICBhd2FpdCBkeW5hbW9DbGllbnQuc2VuZChjb21tYW5kKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOODouODg+OCr+OCpOODmeODs+ODiOOCkuS9nOaIkFxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlTW9ja0V2ZW50KGV4ZWN1dGlvbl9pZDogc3RyaW5nIHwgbnVsbCk6IEFQSUdhdGV3YXlQcm94eUV2ZW50IHtcclxuICByZXR1cm4ge1xyXG4gICAgYm9keTogbnVsbCxcclxuICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgbXVsdGlWYWx1ZUhlYWRlcnM6IHt9LFxyXG4gICAgaHR0cE1ldGhvZDogJ0dFVCcsXHJcbiAgICBpc0Jhc2U2NEVuY29kZWQ6IGZhbHNlLFxyXG4gICAgcGF0aDogYC9jb2xsZWN0LyR7ZXhlY3V0aW9uX2lkfWAsXHJcbiAgICBwYXRoUGFyYW1ldGVyczogZXhlY3V0aW9uX2lkID8geyBleGVjdXRpb25faWQgfSA6IG51bGwsXHJcbiAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IG51bGwsXHJcbiAgICBtdWx0aVZhbHVlUXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiBudWxsLFxyXG4gICAgc3RhZ2VWYXJpYWJsZXM6IG51bGwsXHJcbiAgICByZXF1ZXN0Q29udGV4dDoge1xyXG4gICAgICBhY2NvdW50SWQ6ICcxMjM0NTY3ODkwMTInLFxyXG4gICAgICBhcGlJZDogJ3Rlc3QtYXBpLWlkJyxcclxuICAgICAgcHJvdG9jb2w6ICdIVFRQLzEuMScsXHJcbiAgICAgIGh0dHBNZXRob2Q6ICdHRVQnLFxyXG4gICAgICBwYXRoOiBgL2NvbGxlY3QvJHtleGVjdXRpb25faWR9YCxcclxuICAgICAgc3RhZ2U6ICdwcm9kJyxcclxuICAgICAgcmVxdWVzdElkOiAndGVzdC1yZXF1ZXN0LWlkJyxcclxuICAgICAgcmVxdWVzdFRpbWU6ICcxNS9KYW4vMjAyNDoxMDozMDowMCArMDAwMCcsXHJcbiAgICAgIHJlcXVlc3RUaW1lRXBvY2g6IDE3MDUzMTU4MDAwMDAsXHJcbiAgICAgIGlkZW50aXR5OiB7XHJcbiAgICAgICAgYWNjZXNzS2V5OiBudWxsLFxyXG4gICAgICAgIGFjY291bnRJZDogbnVsbCxcclxuICAgICAgICBhcGlLZXk6IG51bGwsXHJcbiAgICAgICAgYXBpS2V5SWQ6IG51bGwsXHJcbiAgICAgICAgY2FsbGVyOiBudWxsLFxyXG4gICAgICAgIGNsaWVudENlcnQ6IG51bGwsXHJcbiAgICAgICAgY29nbml0b0F1dGhlbnRpY2F0aW9uUHJvdmlkZXI6IG51bGwsXHJcbiAgICAgICAgY29nbml0b0F1dGhlbnRpY2F0aW9uVHlwZTogbnVsbCxcclxuICAgICAgICBjb2duaXRvSWRlbnRpdHlJZDogbnVsbCxcclxuICAgICAgICBjb2duaXRvSWRlbnRpdHlQb29sSWQ6IG51bGwsXHJcbiAgICAgICAgcHJpbmNpcGFsT3JnSWQ6IG51bGwsXHJcbiAgICAgICAgc291cmNlSXA6ICcxOTIuMTY4LjEuMScsXHJcbiAgICAgICAgdXNlcjogbnVsbCxcclxuICAgICAgICB1c2VyQWdlbnQ6ICdNb3ppbGxhLzUuMCcsXHJcbiAgICAgICAgdXNlckFybjogbnVsbCxcclxuICAgICAgfSxcclxuICAgICAgYXV0aG9yaXplcjogbnVsbCxcclxuICAgICAgZG9tYWluTmFtZTogJ2FwaS5leGFtcGxlLmNvbScsXHJcbiAgICAgIGRvbWFpblByZWZpeDogJ2FwaScsXHJcbiAgICAgIHJlc291cmNlSWQ6ICd0ZXN0LXJlc291cmNlLWlkJyxcclxuICAgICAgcmVzb3VyY2VQYXRoOiAnL2NvbGxlY3Qve2V4ZWN1dGlvbl9pZH0nLFxyXG4gICAgfSxcclxuICAgIHJlc291cmNlOiAnL2NvbGxlY3Qve2V4ZWN1dGlvbl9pZH0nLFxyXG4gIH07XHJcbn1cclxuIl0sInZlcnNpb24iOjN9