02151f9e4744cc562fe8a0e95dde6786
"use strict";
/**
 * S3エクスポート
 *
 * JSON/CSV形式でS3に保存します。大量データ対応（ストリーム処理）。
 *
 * Requirements: 要件5.2（エクスポート形式）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.exportToS3 = exportToS3;
const client_s3_1 = require("@aws-sdk/client-s3");
const logger_1 = require("../../utils/logger");
const retry_1 = require("../../utils/retry");
// S3クライアント（グローバルスコープで初期化）
const s3Client = new client_s3_1.S3Client({ region: process.env.AWS_REGION || 'ap-northeast-1' });
// 環境変数
const EXPORT_BUCKET = process.env.EXPORT_BUCKET_NAME || 'tdnet-exports';
/**
 * S3にエクスポート
 *
 * @param export_id エクスポートID
 * @param disclosures 開示情報のリスト
 * @param format フォーマット（json, csv）
 * @returns S3キー
 */
async function exportToS3(export_id, disclosures, format) {
    logger_1.logger.info('Exporting to S3', {
        export_id,
        format,
        count: disclosures.length,
    });
    // S3キーを生成
    const s3_key = generateS3Key(export_id, format);
    // フォーマットに応じて変換
    const content = format === 'json' ? toJSON(disclosures) : toCSV(disclosures);
    // S3にアップロード
    await (0, retry_1.retryWithBackoff)(async () => {
        await s3Client.send(new client_s3_1.PutObjectCommand({
            Bucket: EXPORT_BUCKET,
            Key: s3_key,
            Body: content,
            ContentType: format === 'json' ? 'application/json' : 'text/csv',
            // ライフサイクルポリシーで7日後に自動削除されるようにタグを設定
            Tagging: 'auto-delete=true',
        }));
    }, {
        maxRetries: 3,
        initialDelay: 2000,
        backoffMultiplier: 2,
        jitter: true,
    });
    logger_1.logger.info('Exported to S3 successfully', {
        export_id,
        s3_key,
        size_bytes: Buffer.byteLength(content, 'utf8'),
    });
    return s3_key;
}
/**
 * S3キーを生成
 *
 * フォーマット: exports/YYYY/MM/DD/export_id.format
 * 例: exports/2024/01/15/export_1705305600000_abc123_12345678.json
 *
 * @param export_id エクスポートID
 * @param format フォーマット（json, csv）
 * @returns S3キー
 */
function generateS3Key(export_id, format) {
    const now = new Date();
    const year = now.getUTCFullYear();
    const month = String(now.getUTCMonth() + 1).padStart(2, '0');
    const day = String(now.getUTCDate()).padStart(2, '0');
    return `exports/${year}/${month}/${day}/${export_id}.${format}`;
}
/**
 * JSON形式に変換
 *
 * @param disclosures 開示情報のリスト
 * @returns JSON文字列
 */
function toJSON(disclosures) {
    return JSON.stringify({
        count: disclosures.length,
        disclosures,
    }, null, 2);
}
/**
 * CSV形式に変換
 *
 * @param disclosures 開示情報のリスト
 * @returns CSV文字列
 */
function toCSV(disclosures) {
    // CSVヘッダー
    const headers = [
        'disclosure_id',
        'company_code',
        'company_name',
        'disclosure_type',
        'title',
        'disclosed_at',
        'pdf_url',
        's3_key',
        'collected_at',
        'date_partition',
    ];
    // CSVヘッダー行
    const headerRow = headers.join(',');
    // CSVデータ行
    const dataRows = disclosures.map((disclosure) => {
        return headers
            .map((header) => {
            const value = disclosure[header];
            // カンマやダブルクォートを含む場合はエスケープ
            return escapeCSVValue(String(value));
        })
            .join(',');
    });
    // ヘッダー + データ行
    return [headerRow, ...dataRows].join('\n');
}
/**
 * CSV値をエスケープ
 *
 * カンマ、ダブルクォート、改行を含む場合はダブルクォートで囲み、
 * ダブルクォートは2つ重ねてエスケープします。
 *
 * @param value 値
 * @returns エスケープ後の値
 */
function escapeCSVValue(value) {
    // カンマ、ダブルクォート、改行を含む場合はエスケープが必要
    if (value.includes(',') || value.includes('"') || value.includes('\n')) {
        // ダブルクォートを2つ重ねてエスケープ
        const escaped = value.replace(/"/g, '""');
        return `"${escaped}"`;
    }
    return value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcZXhwb3J0LXRvLXMzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7O0FBcUJILGdDQThDQztBQWpFRCxrREFBZ0U7QUFDaEUsK0NBQTRDO0FBQzVDLDZDQUFxRDtBQUdyRCwwQkFBMEI7QUFDMUIsTUFBTSxRQUFRLEdBQUcsSUFBSSxvQkFBUSxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLGdCQUFnQixFQUFFLENBQUMsQ0FBQztBQUV0RixPQUFPO0FBQ1AsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSxlQUFlLENBQUM7QUFFeEU7Ozs7Ozs7R0FPRztBQUNJLEtBQUssVUFBVSxVQUFVLENBQzlCLFNBQWlCLEVBQ2pCLFdBQXlCLEVBQ3pCLE1BQXNCO0lBRXRCLGVBQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7UUFDN0IsU0FBUztRQUNULE1BQU07UUFDTixLQUFLLEVBQUUsV0FBVyxDQUFDLE1BQU07S0FDMUIsQ0FBQyxDQUFDO0lBRUgsVUFBVTtJQUNWLE1BQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFaEQsZUFBZTtJQUNmLE1BQU0sT0FBTyxHQUFHLE1BQU0sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRTdFLFlBQVk7SUFDWixNQUFNLElBQUEsd0JBQWdCLEVBQ3BCLEtBQUssSUFBSSxFQUFFO1FBQ1QsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUNqQixJQUFJLDRCQUFnQixDQUFDO1lBQ25CLE1BQU0sRUFBRSxhQUFhO1lBQ3JCLEdBQUcsRUFBRSxNQUFNO1lBQ1gsSUFBSSxFQUFFLE9BQU87WUFDYixXQUFX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LHFCQUFxQjtRQUNyQixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMxQyxPQUFPLElBQUksT0FBTyxHQUFHLENBQUM7SUFDeEIsQ0FBQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcZXhwb3J0XFxleHBvcnQtdG8tczMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFMz44Ko44Kv44K544Od44O844OIXHJcbiAqXHJcbiAqIEpTT04vQ1NW5b2i5byP44GnUzPjgavkv53lrZjjgZfjgb7jgZnjgILlpKfph4/jg4fjg7zjgr/lr77lv5zvvIjjgrnjg4jjg6rjg7zjg6Dlh6bnkIbvvInjgIJcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7Y1LjLvvIjjgqjjgq/jgrnjg53jg7zjg4jlvaLlvI/vvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBTM0NsaWVudCwgUHV0T2JqZWN0Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZ2dlcic7XHJcbmltcG9ydCB7IHJldHJ5V2l0aEJhY2tvZmYgfSBmcm9tICcuLi8uLi91dGlscy9yZXRyeSc7XHJcbmltcG9ydCB7IERpc2Nsb3N1cmUgfSBmcm9tICcuLi8uLi90eXBlcyc7XHJcblxyXG4vLyBTM+OCr+ODqeOCpOOCouODs+ODiO+8iOOCsOODreODvOODkOODq+OCueOCs+ODvOODl+OBp+WIneacn+WMlu+8iVxyXG5jb25zdCBzM0NsaWVudCA9IG5ldyBTM0NsaWVudCh7IHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAnYXAtbm9ydGhlYXN0LTEnIH0pO1xyXG5cclxuLy8g55Kw5aKD5aSJ5pWwXHJcbmNvbnN0IEVYUE9SVF9CVUNLRVQgPSBwcm9jZXNzLmVudi5FWFBPUlRfQlVDS0VUX05BTUUgfHwgJ3RkbmV0LWV4cG9ydHMnO1xyXG5cclxuLyoqXHJcbiAqIFMz44Gr44Ko44Kv44K544Od44O844OIXHJcbiAqXHJcbiAqIEBwYXJhbSBleHBvcnRfaWQg44Ko44Kv44K544Od44O844OISURcclxuICogQHBhcmFtIGRpc2Nsb3N1cmVzIOmWi+ekuuaDheWgseOBruODquOCueODiFxyXG4gKiBAcGFyYW0gZm9ybWF0IOODleOCqeODvOODnuODg+ODiO+8iGpzb24sIGNzdu+8iVxyXG4gKiBAcmV0dXJucyBTM+OCreODvFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4cG9ydFRvUzMoXHJcbiAgZXhwb3J0X2lkOiBzdHJpbmcsXHJcbiAgZGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXSxcclxuICBmb3JtYXQ6ICdqc29uJyB8ICdjc3YnXHJcbik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgbG9nZ2VyLmluZm8oJ0V4cG9ydGluZyB0byBTMycsIHtcclxuICAgIGV4cG9ydF9pZCxcclxuICAgIGZvcm1hdCxcclxuICAgIGNvdW50OiBkaXNjbG9zdXJlcy5sZW5ndGgsXHJcbiAgfSk7XHJcblxyXG4gIC8vIFMz44Kt44O844KS55Sf5oiQXHJcbiAgY29uc3QgczNfa2V5ID0gZ2VuZXJhdGVTM0tleShleHBvcnRfaWQsIGZvcm1hdCk7XHJcblxyXG4gIC8vIOODleOCqeODvOODnuODg+ODiOOBq+W/nOOBmOOBpuWkieaPm1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBmb3JtYXQgPT09ICdqc29uJyA/IHRvSlNPTihkaXNjbG9zdXJlcykgOiB0b0NTVihkaXNjbG9zdXJlcyk7XHJcblxyXG4gIC8vIFMz44Gr44Ki44OD44OX44Ot44O844OJXHJcbiAgYXdhaXQgcmV0cnlXaXRoQmFja29mZihcclxuICAgIGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgczNDbGllbnQuc2VuZChcclxuICAgICAgICBuZXcgUHV0T2JqZWN0Q29tbWFuZCh7XHJcbiAgICAgICAgICBCdWNrZXQ6IEVYUE9SVF9CVUNLRVQsXHJcbiAgICAgICAgICBLZXk6IHMzX2tleSxcclxuICAgICAgICAgIEJvZHk6IGNvbnRlbnQsXHJcbiAgICAgICAgICBDb250ZW50VHlwZTogZm9ybWF0ID09PSAnanNvbicgPyAnYXBwbGljYXRpb24vanNvbicgOiAndGV4dC9jc3YnLFxyXG4gICAgICAgICAgLy8g44Op44Kk44OV44K144Kk44Kv44Or44Od44Oq44K344O844GnN+aXpeW+jOOBq+iHquWLleWJiumZpOOBleOCjOOCi+OCiOOBhuOBq+OCv+OCsOOCkuioreWumlxyXG4gICAgICAgICAgVGFnZ2luZzogJ2F1dG8tZGVsZXRlPXRydWUnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBtYXhSZXRyaWVzOiAzLFxyXG4gICAgICBpbml0aWFsRGVsYXk6IDIwMDAsXHJcbiAgICAgIGJhY2tvZmZNdWx0aXBsaWVyOiAyLFxyXG4gICAgICBqaXR0ZXI6IHRydWUsXHJcbiAgICB9XHJcbiAgKTtcclxuXHJcbiAgbG9nZ2VyLmluZm8oJ0V4cG9ydGVkIHRvIFMzIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgIGV4cG9ydF9pZCxcclxuICAgIHMzX2tleSxcclxuICAgIHNpemVfYnl0ZXM6IEJ1ZmZlci5ieXRlTGVuZ3RoKGNvbnRlbnQsICd1dGY4JyksXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBzM19rZXk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTM+OCreODvOOCkueUn+aIkFxyXG4gKlxyXG4gKiDjg5Xjgqnjg7zjg57jg4Pjg4g6IGV4cG9ydHMvWVlZWS9NTS9ERC9leHBvcnRfaWQuZm9ybWF0XHJcbiAqIOS+izogZXhwb3J0cy8yMDI0LzAxLzE1L2V4cG9ydF8xNzA1MzA1NjAwMDAwX2FiYzEyM18xMjM0NTY3OC5qc29uXHJcbiAqXHJcbiAqIEBwYXJhbSBleHBvcnRfaWQg44Ko44Kv44K544Od44O844OISURcclxuICogQHBhcmFtIGZvcm1hdCDjg5Xjgqnjg7zjg57jg4Pjg4jvvIhqc29uLCBjc3bvvIlcclxuICogQHJldHVybnMgUzPjgq3jg7xcclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlUzNLZXkoZXhwb3J0X2lkOiBzdHJpbmcsIGZvcm1hdDogJ2pzb24nIHwgJ2NzdicpOiBzdHJpbmcge1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgY29uc3QgeWVhciA9IG5vdy5nZXRVVENGdWxsWWVhcigpO1xyXG4gIGNvbnN0IG1vbnRoID0gU3RyaW5nKG5vdy5nZXRVVENNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKTtcclxuICBjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldFVUQ0RhdGUoKSkucGFkU3RhcnQoMiwgJzAnKTtcclxuXHJcbiAgcmV0dXJuIGBleHBvcnRzLyR7eWVhcn0vJHttb250aH0vJHtkYXl9LyR7ZXhwb3J0X2lkfS4ke2Zvcm1hdH1gO1xyXG59XHJcblxyXG4vKipcclxuICogSlNPTuW9ouW8j+OBq+WkieaPm1xyXG4gKlxyXG4gKiBAcGFyYW0gZGlzY2xvc3VyZXMg6ZaL56S65oOF5aCx44Gu44Oq44K544OIXHJcbiAqIEByZXR1cm5zIEpTT07mloflrZfliJdcclxuICovXHJcbmZ1bmN0aW9uIHRvSlNPTihkaXNjbG9zdXJlczogRGlzY2xvc3VyZVtdKTogc3RyaW5nIHtcclxuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoXHJcbiAgICB7XHJcbiAgICAgIGNvdW50OiBkaXNjbG9zdXJlcy5sZW5ndGgsXHJcbiAgICAgIGRpc2Nsb3N1cmVzLFxyXG4gICAgfSxcclxuICAgIG51bGwsXHJcbiAgICAyXHJcbiAgKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENTVuW9ouW8j+OBq+WkieaPm1xyXG4gKlxyXG4gKiBAcGFyYW0gZGlzY2xvc3VyZXMg6ZaL56S65oOF5aCx44Gu44Oq44K544OIXHJcbiAqIEByZXR1cm5zIENTVuaWh+Wtl+WIl1xyXG4gKi9cclxuZnVuY3Rpb24gdG9DU1YoZGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXSk6IHN0cmluZyB7XHJcbiAgLy8gQ1NW44OY44OD44OA44O8XHJcbiAgY29uc3QgaGVhZGVycyA9IFtcclxuICAgICdkaXNjbG9zdXJlX2lkJyxcclxuICAgICdjb21wYW55X2NvZGUnLFxyXG4gICAgJ2NvbXBhbnlfbmFtZScsXHJcbiAgICAnZGlzY2xvc3VyZV90eXBlJyxcclxuICAgICd0aXRsZScsXHJcbiAgICAnZGlzY2xvc2VkX2F0JyxcclxuICAgICdwZGZfdXJsJyxcclxuICAgICdzM19rZXknLFxyXG4gICAgJ2NvbGxlY3RlZF9hdCcsXHJcbiAgICAnZGF0ZV9wYXJ0aXRpb24nLFxyXG4gIF07XHJcblxyXG4gIC8vIENTVuODmOODg+ODgOODvOihjFxyXG4gIGNvbnN0IGhlYWRlclJvdyA9IGhlYWRlcnMuam9pbignLCcpO1xyXG5cclxuICAvLyBDU1bjg4fjg7zjgr/ooYxcclxuICBjb25zdCBkYXRhUm93cyA9IGRpc2Nsb3N1cmVzLm1hcCgoZGlzY2xvc3VyZSkgPT4ge1xyXG4gICAgcmV0dXJuIGhlYWRlcnNcclxuICAgICAgLm1hcCgoaGVhZGVyKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBkaXNjbG9zdXJlW2hlYWRlciBhcyBrZXlvZiBEaXNjbG9zdXJlXTtcclxuICAgICAgICAvLyDjgqvjg7Pjg57jgoTjg4Djg5bjg6vjgq/jgqnjg7zjg4jjgpLlkKvjgoDloLTlkIjjga/jgqjjgrnjgrHjg7zjg5dcclxuICAgICAgICByZXR1cm4gZXNjYXBlQ1NWVmFsdWUoU3RyaW5nKHZhbHVlKSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5qb2luKCcsJyk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIOODmOODg+ODgOODvCArIOODh+ODvOOCv+ihjFxyXG4gIHJldHVybiBbaGVhZGVyUm93LCAuLi5kYXRhUm93c10uam9pbignXFxuJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDU1blgKTjgpLjgqjjgrnjgrHjg7zjg5dcclxuICpcclxuICog44Kr44Oz44Oe44CB44OA44OW44Or44Kv44Kp44O844OI44CB5pS56KGM44KS5ZCr44KA5aC05ZCI44Gv44OA44OW44Or44Kv44Kp44O844OI44Gn5Zuy44G/44CBXHJcbiAqIOODgOODluODq+OCr+OCqeODvOODiOOBrzLjgaTph43jga3jgabjgqjjgrnjgrHjg7zjg5fjgZfjgb7jgZnjgIJcclxuICpcclxuICogQHBhcmFtIHZhbHVlIOWApFxyXG4gKiBAcmV0dXJucyDjgqjjgrnjgrHjg7zjg5flvozjga7lgKRcclxuICovXHJcbmZ1bmN0aW9uIGVzY2FwZUNTVlZhbHVlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIC8vIOOCq+ODs+ODnuOAgeODgOODluODq+OCr+OCqeODvOODiOOAgeaUueihjOOCkuWQq+OCgOWgtOWQiOOBr+OCqOOCueOCseODvOODl+OBjOW/heimgVxyXG4gIGlmICh2YWx1ZS5pbmNsdWRlcygnLCcpIHx8IHZhbHVlLmluY2x1ZGVzKCdcIicpIHx8IHZhbHVlLmluY2x1ZGVzKCdcXG4nKSkge1xyXG4gICAgLy8g44OA44OW44Or44Kv44Kp44O844OI44KSMuOBpOmHjeOBreOBpuOCqOOCueOCseODvOODl1xyXG4gICAgY29uc3QgZXNjYXBlZCA9IHZhbHVlLnJlcGxhY2UoL1wiL2csICdcIlwiJyk7XHJcbiAgICByZXR1cm4gYFwiJHtlc2NhcGVkfVwiYDtcclxuICB9XHJcbiAgcmV0dXJuIHZhbHVlO1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==