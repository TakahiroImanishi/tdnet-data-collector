---
inclusion: fileMatch
fileMatchPattern: '**/.kiro/specs/**/tasks*.md|**/.kiro/specs/**/spec.md|**/.kiro/specs/**/work-logs/**/*.md|**/.kiro/specs/**/improvements/**/*.md'
---

# ワークフローガイドライン

サブエージェントの活用方法と並列実行パターン。

## サブエージェント活用

### 基本方針

タスク実行時は、適切な場面でサブエージェントを積極的に活用。並列実行可能なタスクは分割して効率化。

### 利用可能なサブエージェント

| サブエージェント | 役割 | 使用場面 |
|---------------|------|---------|
| **context-gatherer** | コードベース探索 | 新機能実装前、バグ調査、既存コード理解 |
| **general-task-execution** | サブタスク委譲 | 独立した作業、並列実行可能なタスク |
| **custom-agent-creator** | 自動化 | 繰り返しタスクの自動化 |

### context-gatherer使用ルール

- ✅ タスク開始時に1回のみ使用
- ✅ 収集したコンテキストを基に作業
- ❌ 再度の呼び出しは避ける

## 並列実行ルール

### 並列実行可能な判定基準

| 判定項目 | 並列実行可能 ✅ | 並列実行不可 ❌ |
|---------|--------------|--------------|
| ファイル依存 | 異なるファイルを編集 | 同一ファイルを編集 |
| データ依存 | データの読み書きが独立 | 同じデータを読み書き |
| 実行順序 | 順序に依存しない | 順序に依存する |
| リソース競合 | リソースが競合しない | リソースが競合する |

### 並列実行可能なタスク例

| タスク | 並列実行 |
|--------|---------|
| 複数のLambda関数を作成 | ✅ 可能 |
| 複数のテストファイルを作成 | ✅ 可能 |
| 複数のドキュメントを作成 | ✅ 可能 |
| Lambda関数とそのテストを作成 | ✅ 可能 |
| 同一ファイルの複数箇所を編集 | ❌ 不可 |
| 依存関係のあるファイルを順次作成 | ❌ 不可 |

## 並列実行パターン

独立したサブタスク（異なるファイル、データ独立、順序非依存、リソース非競合）は並列実行可能。

例: 複数Lambda関数作成、複数テストファイル作成、複数ドキュメント作成

## 並列実行不可パターン

同一ファイル編集、依存関係のあるファイル作成は順次実行。

## ベストプラクティス

| 原則 | 説明 |
|------|------|
| context-gathererを最初に使用 | 不慣れなコードベースでは必ず最初に使用 |
| 1クエリ1回の原則 | context-gathererは1つのクエリで1回のみ |
| 並列実行を積極的に活用 | 独立したタスクは並列実行で効率化 |
| 競合を回避 | 同一ファイル編集や依存関係のあるタスクは並列実行しない |
| 結果を信頼 | サブエージェントの分析結果を信頼し、重複調査を避ける |
| Autopilotモード | サブエージェントはAutopilotモードでのみ利用可能 |

## 関連

`../core/tdnet-data-collector.md`
