---
inclusion: fileMatch
fileMatchPattern: '**/.kiro/specs/**/tasks*.md|**/.kiro/specs/**/spec.md|**/.kiro/specs/**/work-logs/**/*.md|**/.kiro/specs/**/improvements/**/*.md'
---

# ワークフローガイドライン

サブエージェントの活用方法と並列実行パターン。

## サブエージェント活用

### 基本方針

タスク実行時は、適切な場面でサブエージェントを積極的に活用。並列実行可能なタスクは分割して効率化。

### 利用可能なサブエージェント

| サブエージェント | 役割 | 使用場面 |
|---------------|------|---------|
| **context-gatherer** | コードベース探索 | 新機能実装前、バグ調査、既存コード理解 |
| **general-task-execution** | サブタスク委譲 | 独立した作業、並列実行可能なタスク |
| **custom-agent-creator** | 自動化 | 繰り返しタスクの自動化 |

### context-gatherer使用ルール

- ✅ タスク開始時に1回のみ使用
- ✅ 収集したコンテキストを基に作業
- ❌ 再度の呼び出しは避ける

## 並列実行ルール

### 並列実行可能な判定基準

| 判定項目 | 並列実行可能 ✅ | 並列実行不可 ❌ |
|---------|--------------|--------------|
| ファイル依存 | 異なるファイルを編集 | 同一ファイルを編集 |
| データ依存 | データの読み書きが独立 | 同じデータを読み書き |
| 実行順序 | 順序に依存しない | 順序に依存する |
| リソース競合 | リソースが競合しない | リソースが競合する |

### 並列実行可能なタスク例

| タスク | 並列実行 |
|--------|---------|
| 複数のLambda関数を作成 | ✅ 可能 |
| 複数のテストファイルを作成 | ✅ 可能 |
| 複数のドキュメントを作成 | ✅ 可能 |
| Lambda関数とそのテストを作成 | ✅ 可能 |
| 同一ファイルの複数箇所を編集 | ❌ 不可 |
| 依存関係のあるファイルを順次作成 | ❌ 不可 |

## 並列実行パターン

### パターン1: 複数Lambda関数の並列作成

```
タスク: 3つのLambda関数（collector, parser, query）を作成

並列実行:
- サブエージェント1: collector Lambda関数
- サブエージェント2: parser Lambda関数
- サブエージェント3: query Lambda関数
```

### パターン2: Lambda関数とテストの並列作成

```
タスク: Lambda関数とテストファイルを作成

並列実行:
- サブエージェント1: Lambda関数の実装
- サブエージェント2: テストファイル
```

### パターン3: 複数ドキュメントの並列作成

```
タスク: README.md、API仕様書、デプロイガイドを作成

並列実行:
- サブエージェント1: README.md
- サブエージェント2: API仕様書
- サブエージェント3: デプロイガイド
```

## 並列実行不可パターン

### 競合パターン1: 同一ファイルの編集

```
❌ 不可: 同一ファイルの複数箇所を並列編集

正しいアプローチ: 自分で順次実行、またはサブエージェント1つに委譲
```

### 競合パターン2: 依存関係のあるファイル

```
❌ 不可: 依存関係のあるファイルを並列作成

正しいアプローチ: インターフェースを先に作成 → 実装クラスを作成
```

## 並列実行の判断フローチャート

```
タスクを分析
    ↓
複数の独立したサブタスクに分割可能？
    ↓ YES
各サブタスクは異なるファイルを編集？
    ↓ YES
各サブタスクは実行順序に依存しない？
    ↓ YES
各サブタスクはリソース競合しない？
    ↓ YES
✅ 並列実行可能 → サブエージェントに分割
    ↓ NO（いずれかの条件）
❌ 並列実行不可 → 順次実行または自分で実行
```

## 並列実行時の注意事項

- タスクの独立性を確認
- ファイル競合を回避
- 依存関係を考慮
- リソース競合を回避
- エラーハンドリング（1つ失敗しても他は継続）
- 結果の統合と検証

## ベストプラクティス

| 原則 | 説明 |
|------|------|
| context-gathererを最初に使用 | 不慣れなコードベースでは必ず最初に使用 |
| 1クエリ1回の原則 | context-gathererは1つのクエリで1回のみ |
| 並列実行を積極的に活用 | 独立したタスクは並列実行で効率化 |
| 競合を回避 | 同一ファイル編集や依存関係のあるタスクは並列実行しない |
| 結果を信頼 | サブエージェントの分析結果を信頼し、重複調査を避ける |
| Autopilotモード | サブエージェントはAutopilotモードでのみ利用可能 |

## 関連ドキュメント

- `../core/tdnet-data-collector.md` - サブエージェント活用の基本方針
