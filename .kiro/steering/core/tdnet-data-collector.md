# TDnet Data Collector - タスク実行ルール

このファイルは、TDnet Data Collectorプロジェクトのタスク実行時に従うべき基本ルールをまとめたものです。

---

## タスク実行の3ステップ

### 1️⃣ タスク開始: 作業記録を作成

**最優先で実施:**
```
✅ work-log-[YYYYMMDD-HHMMSS].md を作成
✅ タスク概要、目的、背景を記入
```

**保存先:** `.kiro/specs/tdnet-data-collector/work-logs/`

**重要:** 作業記録の作成は、コード実装やファイル作成よりも優先されます。

---

### 2️⃣ タスク実行: 作業内容を随時記録

**実施内容:**
- コード実装、ファイル作成、テスト実行など
- 問題が発生したら、問題と解決策を作業記録に追記
- 作業の進捗を随時記録

---

### 3️⃣ タスク完了: コミット & 振り返り

**必須作業:**
```
✅ 作業記録に成果物と次回への申し送りを記入
✅ git commit & push（変更をリモートにプッシュ）
✅ 振り返り: 問題点があれば改善記録を作成
```

---

## 作業記録の詳細

### ファイル命名規則

```
work-log-[YYYYMMDD-HHMMSS].md
```

**例:** `work-log-20260207-143025.md`

### 記録内容

| セクション | 内容 |
|-----------|------|
| **タスク概要** | 目的、背景、目標 |
| **実施内容** | 実施した作業、問題と解決策 |
| **成果物** | 作成・変更したファイル |
| **次回への申し送り** | 未完了の作業、注意点 |

詳細は `.kiro/specs/tdnet-data-collector/work-logs/README.md` を参照。

---

## Git Commit & Push

### コミットメッセージ規則

```
[タスク種別] 簡潔な変更内容

関連: work-log-[日時].md または task-[番号]-improvement-[連番]-[日時].md
```

**タスク種別:**
- `feat`: 新機能追加
- `fix`: バグ修正
- `docs`: ドキュメント更新
- `refactor`: リファクタリング
- `test`: テスト追加・修正
- `chore`: その他の変更
- `improve`: 改善実施

**例:**
```
feat: TDnet開示情報収集Lambda関数を実装

関連: work-log-20260207-143025.md
```

### Git操作手順

```powershell
git add .
git commit -m "[タスク種別] 簡潔な変更内容"
git push origin main
```

---

## 振り返りと改善（タスク完了後）

### いつ振り返るか？

**タスク完了後、以下の場合は改善記録を作成:**
- ❌ エラーや問題が発生した
- ⚠️ パフォーマンスやコストに懸念がある
- 🔄 コードの品質や保守性を改善したい
- 📚 ドキュメントを充実させたい

**問題がなければ、振り返りは不要です。**

---

### 改善記録の作成

**ファイル命名規則:**
```
task-[タスク番号]-improvement-[連番]-[YYYYMMDD-HHMMSS].md
```

**例:** `task-1.1-improvement-1-20260207-143025.md`

**保存先:** `.kiro/specs/tdnet-data-collector/improvements/`

**記録内容:**
- 問題点の分析
- 改善点の特定
- 実施した改善内容
- 改善結果の検証

詳細は `.kiro/specs/tdnet-data-collector/improvements/README.md` を参照。

---

### 改善の優先順位

| 優先度 | 対象 |
|--------|------|
| 🔴 **Critical** | システムが動作しない、データ損失のリスク |
| 🟠 **High** | パフォーマンス、セキュリティ、コスト問題 |
| 🟡 **Medium** | コード品質、保守性、テストカバレッジ |
| 🟢 **Low** | ドキュメント、コメント、スタイル |

---

## 作業記録 vs 改善記録

| 項目 | 作業記録 | 改善記録 |
|------|---------|---------|
| **作成タイミング** | タスク開始時（必須） | タスク完了後（問題があれば） |
| **目的** | 作業履歴の記録 | 継続的改善の記録 |
| **内容** | 実施した作業、成果物 | 問題分析、改善内容 |
| **対象** | すべてのタスク | 改善が必要なタスクのみ |

---

## サブエージェントの活用

### 基本方針

**タスク実行時は、適切な場面でサブエージェントを積極的に活用すること。特に並列実行可能なタスクは、必ずサブエージェントに分割して効率的に実行すること。**

### 🔴 必須ルール: 並列実行の判断

タスクを開始する前に、以下を必ず確認：

1. **タスクを分析**: 複数の独立したサブタスクに分割可能か？
2. **並列実行可能性を判定**: 以下の条件をすべて満たすか？
   - ✅ 各サブタスクは異なるファイルを編集
   - ✅ 各サブタスクは実行順序に依存しない
   - ✅ 各サブタスクはリソース競合しない
3. **並列実行を実施**: 条件を満たす場合、サブエージェントに分割

**並列実行可能なのに順次実行した場合、その理由を作業記録に明記すること。**

### 並列実行可能なタスクの例

| タスク | 並列実行 | 理由 |
|--------|---------|------|
| 複数のLambda関数を作成 | ✅ 必須 | 異なるファイルを作成 |
| 複数のテストファイルを作成 | ✅ 必須 | 異なるファイルを作成 |
| 複数のドキュメントを作成 | ✅ 必須 | 異なるファイルを作成 |
| 複数のsteeringファイルを更新 | ✅ 必須 | 異なるファイルを更新 |
| Lambda関数とそのテストを作成 | ✅ 推奨 | 異なるファイルを作成 |
| 同一ファイルの複数箇所を編集 | ❌ 不可 | ファイル競合のリスク |
| 依存関係のあるファイルを順次作成 | ❌ 不可 | 実行順序に依存 |

### 利用可能なサブエージェント

| サブエージェント | 役割 | 使用場面 |
|----------------|------|---------|
| **context-gatherer** | コードベース探索 | 新機能実装前、バグ調査、リファクタリング前 |
| **general-task-execution** | サブタスク委譲 | 独立したサブタスク、並列実行可能なタスク |
| **custom-agent-creator** | タスク自動化 | 繰り返しタスク、プロジェクト固有ワークフロー |

詳細は `../development/workflow-guidelines.md` を参照。

---

## 関連ドキュメント

- **実装ルール**: `tdnet-implementation-rules.md` - 基本的な実装原則
- **エラーハンドリング**: `error-handling-patterns.md` - エラー処理の詳細パターン
- **ワークフローガイドライン**: `../development/workflow-guidelines.md` - サブエージェント活用と並列実行
- **ドキュメント標準**: `../development/documentation-standards.md` - ドキュメント作成の標準規則
- **作業記録**: `../../specs/tdnet-data-collector/work-logs/README.md` - 作業記録の作成方法
- **改善記録**: `../../specs/tdnet-data-collector/improvements/README.md` - 改善記録の作成方法
