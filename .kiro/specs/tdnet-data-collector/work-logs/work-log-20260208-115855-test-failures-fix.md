# 作業記録: 残存テスト失敗の修正（28件）

**作成日時**: 2026-02-08 11:58:55  
**タスク**: 15.10 - 残存テスト失敗の修正（28件）

## タスク概要

### 目的
collect handlerのバリデーションエラーに関連する28件のテスト失敗を修正し、テスト成功率を100%にする。

### 背景
- 現在のテスト成功率: 96.0% (679/707)
- 残存する28件の失敗はすべてcollect handlerのバリデーション関連
- 正常系テストで400エラーが返される（期待値: 200）
- バリデーションエラーメッセージが期待値と異なる
- Lambda呼び出しエラーテストで500エラーではなく400エラーが返される

### 目標
- すべてのテストを成功させる（テスト成功率: 100%）
- バリデーションロジックとテストケースの整合性を確保
- エラーハンドリングの正確性を検証

## 実施内容

### 1. 問題の調査

テストを実行して失敗の原因を特定しました。

**根本原因:**
- テストで使用している日付（2024-01-15, 2024-01-20）が現在日（2026-02-08）から1年以上前
- バリデーションロジックは過去1年以内の日付のみを許可
- すべての正常系テストと一部のバリデーションテストが日付チェックで失敗

**失敗しているテスト:**
1. 正常系テスト（3件）: 日付が古すぎて400エラー（期待値: 200）
2. バリデーションテスト（3件）: 日付順序チェックの前に古い日付チェックで失敗
3. Lambda呼び出しエラーテスト（3件）: バリデーションで失敗し、Lambda呼び出しに到達しない

**修正方針:**
- テストで使用する日付を現在日から計算した相対的な日付に変更
- 過去1年以内の有効な日付を使用
- 未来日のテストは現在日+2日を使用
