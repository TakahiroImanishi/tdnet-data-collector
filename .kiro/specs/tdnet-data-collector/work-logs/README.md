# 作業記録（Work Logs）

このフォルダには、TDnet Data Collectorプロジェクトのタスク実行時の作業記録が格納されています。

## 目的

- タスクの実行履歴を追跡
- 実施した作業内容を記録
- 問題点と解決策を文書化
- 次回の作業時の参考資料

## ファイル命名規則

```
work-log-[YYYYMMDD-HHMMSS].md
```

**例:**
- `work-log-20260207-143025.md`
- `work-log-20260207-150530.md`

**日時の取得:**
```powershell
Get-Date -Format "yyyyMMdd-HHmmss"
```

## 作業記録フォーマット

```markdown
# 作業記録 - [作業タイトル]

**作成日時**: YYYY-MM-DD HH:MM:SS JST
**作業者**: Kiro AI Assistant
**関連タスク**: [タスク番号または説明]

## 作業概要

[作業の目的と概要を簡潔に記述]

## 実施内容

### 1. [作業項目1]

- 実施内容の詳細
- 変更したファイル
- 実行したコマンド

### 2. [作業項目2]

- 実施内容の詳細
- 変更したファイル
- 実行したコマンド

## 発生した問題と解決策

### 問題1: [問題の概要]

**状況:**
[問題が発生した状況]

**原因:**
[問題の原因]

**解決策:**
[実施した解決策]

## 成果物

- [作成・更新したファイル一覧]
- [実行結果のサマリー]

## 次回への申し送り

- [次回作業時の注意点]
- [未完了の作業]
- [改善提案]

## 参考情報

- [参照したドキュメント]
- [関連するissueやPR]
```

## 作業記録作成のタイミング

### 1. タスク開始時

作業記録ファイルを作成し、作業概要を記入：

```powershell
# 現在時刻を取得
$timestamp = Get-Date -Format "yyyyMMdd-HHmmss"

# 作業記録ファイルを作成
New-Item -Path ".kiro/specs/tdnet-data-collector/work-logs/work-log-$timestamp.md" -ItemType File
```

### 2. 作業中

実施内容を随時更新：
- 変更したファイル
- 実行したコマンド
- 実施した作業の詳細

### 3. 問題発生時

問題と解決策を記録：
- 問題の状況
- 原因の分析
- 実施した解決策

### 4. タスク完了時

成果物と次回への申し送りを記入：
- 作成・更新したファイル一覧
- 実行結果のサマリー
- 次回作業時の注意点

## 作業記録の管理

### 基本原則

- **1つのタスクに1つの作業記録**: タスクごとに独立した作業記録を作成
- **継続作業の場合**: 新しい作業記録を作成し、前回の作業記録を参照
- **長期タスクの場合**: 日ごとまたは作業セッションごとに作業記録を作成

### ファイル整理

作業記録が増えてきた場合、年月ごとにサブフォルダを作成：

```
work-logs/
├── 2026-01/
│   ├── work-log-20260115-143025.md
│   └── work-log-20260120-150530.md
├── 2026-02/
│   ├── work-log-20260207-143025.md
│   └── work-log-20260215-150530.md
└── README.md
```

## 作業記録の活用

### 1. 振り返り

過去の作業内容を確認：
- 同じタスクを再度実施する際の参考
- 作業時間の見積もり
- 作業プロセスの改善

### 2. トラブルシューティング

類似問題の解決策を参照：
- 過去に発生した問題の解決策を検索
- 同じエラーの再発防止
- ナレッジベースとして活用

### 3. ナレッジ共有

チームメンバーへの情報共有：
- 新しいメンバーのオンボーディング
- ベストプラクティスの共有
- 作業手順の標準化

### 4. 改善提案

作業プロセスの改善点を特定：
- 繰り返し発生する問題の特定
- 自動化可能な作業の洗い出し
- steeringファイルの更新提案

## 作業記録と改善記録の違い

### 作業記録（work-logs/）

- **目的**: タスク実行の履歴を記録
- **タイミング**: タスク実行時に作成
- **内容**: 実施した作業、問題と解決策、成果物
- **対象**: すべてのタスク

### 改善記録（improvements/）

- **目的**: フィードバックループの結果を記録
- **タイミング**: タスク完了後の改善分析時に作成
- **内容**: 問題点の洗い出し、改善点の特定、改善の実施結果
- **対象**: 改善が必要なタスク

**関係性:**
作業記録を基に改善記録を作成します。作業記録で発見した問題点を改善記録で詳細に分析し、改善策を実施します。

## 作業記録テンプレート

新しい作業記録を作成する際は、以下のテンプレートを使用してください：

```markdown
# 作業記録 - [作業タイトル]

**作成日時**: 2026-02-07 14:30:25 JST
**作業者**: Kiro AI Assistant
**関連タスク**: タスク1.1 - Lambda関数の実装

## 作業概要

Lambda関数のエラーハンドリングを改善し、再試行ロジックを実装する。

## 実施内容

### 1. エラーハンドリングユーティリティの作成

- `src/utils/error-handling.ts` を作成
- `RetryableError` クラスを実装
- `retryWithBackoff()` 関数を実装

**変更ファイル:**
- `src/utils/error-handling.ts` (新規作成)

**実行コマンド:**
```bash
npm run test -- error-handling.test.ts
```

### 2. Lambda関数への適用

- `src/lambda/collector/handler.ts` を更新
- エラーハンドリングユーティリティを適用
- ログ出力を構造化

**変更ファイル:**
- `src/lambda/collector/handler.ts` (更新)

## 発生した問題と解決策

### 問題1: TypeScriptの型エラー

**状況:**
`retryWithBackoff()` 関数の型定義でジェネリクスのエラーが発生。

**原因:**
Promise型の推論が正しく行われていなかった。

**解決策:**
明示的に `Promise<T>` を返すように型定義を修正。

```typescript
async function retryWithBackoff<T>(
    fn: () => Promise<T>,
    options?: RetryOptions
): Promise<T> {
    // ...
}
```

## 成果物

- `src/utils/error-handling.ts` - エラーハンドリングユーティリティ
- `src/utils/error-handling.test.ts` - ユニットテスト
- `src/lambda/collector/handler.ts` - 更新されたLambda関数

**テスト結果:**
- ユニットテスト: 15/15 passed
- カバレッジ: 95%

## 次回への申し送り

- 他のLambda関数にも同じエラーハンドリングを適用する
- サーキットブレーカーパターンの実装を検討
- エラーログの集約とアラート設定を追加

## 参考情報

- `error-handling-patterns.md` - エラーハンドリングのベストプラクティス
- AWS Lambda エラーハンドリング: https://docs.aws.amazon.com/lambda/latest/dg/nodejs-exceptions.html
```

## 関連ドキュメント

- **タスク実行ルール**: `.kiro/steering/core/tdnet-data-collector.md`
- **改善記録**: `.kiro/specs/tdnet-data-collector/improvements/README.md`
- **実装ルール**: `.kiro/steering/core/tdnet-implementation-rules.md`

## 変更履歴

- 2026-02-07: 初版作成
