# ä½œæ¥­è¨˜éŒ²: è¨­è¨ˆã¨å®Ÿè£…ã®ä¹–é›¢ãƒã‚§ãƒƒã‚¯

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

**ç›®çš„**: steering filesã§å®šç¾©ã•ã‚ŒãŸè¨­è¨ˆåŽŸå‰‡ã¨å®Ÿéš›ã®å®Ÿè£…ã‚’æ¯”è¼ƒã—ã€ä¹–é›¢ã‚’ç‰¹å®šã™ã‚‹

**èƒŒæ™¯**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆsteering filesï¼‰ãŒå……å®Ÿã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿè£…ãŒè¨­è¨ˆã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**ç›®æ¨™**: 
- è¨­è¨ˆã¨å®Ÿè£…ã®ä¹–é›¢ã‚’ç‰¹å®š
- é‡å¤§ãªå•é¡ŒãŒã‚ã‚Œã°æŒ‡æ‘˜
- æ”¹å–„ãŒå¿…è¦ãªç®‡æ‰€ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—

## å®Ÿæ–½å†…å®¹

### 1. ãƒã‚§ãƒƒã‚¯å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªï¼š

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/errors/index.ts` - ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
- `src/utils/date-partition.ts` - date_partitionç”Ÿæˆ
- `src/utils/retry.ts` - å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
- `src/utils/logger.ts` - æ§‹é€ åŒ–ãƒ­ã‚¬ãƒ¼
- `src/models/disclosure.ts` - Disclosureãƒ¢ãƒ‡ãƒ«
- `src/lambda/collector/handler.ts` - Lambda Collectorãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- `src/lambda/collector/save-metadata.ts` - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- `src/lambda/collector/scrape-tdnet-list.ts` - TDnetã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- `src/types/index.ts` - åž‹å®šç¾©
- `cdk/lib/tdnet-data-collector-stack.ts` - CDKã‚¹ã‚¿ãƒƒã‚¯

**è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- `.kiro/steering/core/tdnet-implementation-rules.md`
- `.kiro/steering/core/error-handling-patterns.md`
- `.kiro/steering/development/lambda-implementation.md`

### 2. ãƒã‚§ãƒƒã‚¯çµæžœ

#### âœ… è¨­è¨ˆã«æº–æ‹ ã—ã¦ã„ã‚‹é …ç›®

1. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ï¼ˆ`RetryableError`, `ValidationError`, `NotFoundError`ç­‰ï¼‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - `retryWithBackoff`ãŒæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã¨ã‚¸ãƒƒã‚¿ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹
   - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒæ§‹é€ åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼ˆ`error_type`, `error_message`, `context`, `stack_trace`ï¼‰

2. **date_partitionå®Ÿè£…**
   - JSTåŸºæº–ã§YYYY-MMå½¢å¼ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹
   - UTCâ†’JSTå¤‰æ›ï¼ˆ+9æ™‚é–“ï¼‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - æœˆã¾ãŸãŽã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’é©åˆ‡ã«å‡¦ç†ã—ã¦ã„ã‚‹
   - ISO 8601å½¢å¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆ1970-01-01ä»¥é™ã€ç¾åœ¨+1æ—¥ä»¥å†…ï¼‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

3. **Lambdaé–¢æ•°ã®åŸºæœ¬æ§‹é€ **
   - ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆ`index.ts`ï¼‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆ`handler.ts`ï¼‰ãŒtry-catchã§å›²ã¾ã‚Œã¦ã„ã‚‹
   - ç’°å¢ƒå¤‰æ•°ãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
   - CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒé€ä¿¡ã•ã‚Œã¦ã„ã‚‹

4. **DynamoDBæ“ä½œ**
   - æ¡ä»¶ä»˜ãæ›¸ãè¾¼ã¿ï¼ˆ`ConditionExpression`ï¼‰ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
   - é‡è¤‡ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - `ConditionalCheckFailedException`ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ï¼ˆè­¦å‘Šãƒ¬ãƒ™ãƒ«ï¼‰
   - `ProvisionedThroughputExceededException`ã«å¯¾ã—ã¦å†è©¦è¡ŒãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

5. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**
   - `RateLimiter`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆ2ç§’é–“éš”ï¼‰
   - TDnetã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰ã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹

6. **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‡¦ç†**
   - JSTåŸºæº–ã§date_partitionã‚’ç”Ÿæˆã—ã¦ã„ã‚‹
   - UTCâ†’JSTå¤‰æ›ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
   - æœˆã¾ãŸãŽã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹

#### âš ï¸ è»½å¾®ãªä¹–é›¢ï¼ˆæ”¹å–„æŽ¨å¥¨ï¼‰

1. **Lambdaé–¢æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**
   - **è¨­è¨ˆ**: `lambda-implementation.md`ã§ã¯ä»¥ä¸‹ã®æ§‹æˆã‚’æŽ¨å¥¨
     ```
     src/lambda/{function-name}/
     â”œâ”€â”€ index.ts                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
     â”œâ”€â”€ handler.ts               # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
     â”œâ”€â”€ types.ts                 # åž‹å®šç¾©
     â””â”€â”€ {function-name}.test.ts  # ãƒ†ã‚¹ãƒˆ
     ```
   - **å®Ÿè£…**: `src/lambda/collector/`ã«ã¯`types.ts`ãŒå­˜åœ¨ã—ãªã„
   - **å½±éŸ¿**: è»½å¾®ï¼ˆåž‹å®šç¾©ã¯`src/types/index.ts`ã§é›†ç´„ã•ã‚Œã¦ã„ã‚‹ï¼‰
   - **æŽ¨å¥¨**: é–¢æ•°å›ºæœ‰ã®åž‹å®šç¾©ãŒã‚ã‚‹å ´åˆã¯`types.ts`ã‚’ä½œæˆ

2. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®**
   - **è¨­è¨ˆ**: `lambda-implementation.md`ã§ã¯`{function-name}.test.ts`ã‚’æŽ¨å¥¨
   - **å®Ÿè£…**: `src/lambda/collector/__tests__/handler.test.ts`ï¼ˆ`__tests__`ãƒ•ã‚©ãƒ«ãƒ€å†…ï¼‰
   - **å½±éŸ¿**: ãªã—ï¼ˆJestæ¨™æº–ã®é…ç½®ï¼‰
   - **æŽ¨å¥¨**: ç¾åœ¨ã®é…ç½®ã§å•é¡Œãªã—

3. **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›**
   - **è¨­è¨ˆ**: `lambda-implementation.md`ã§ã¯`src/utils/error-response.ts`ã‚’æŽ¨å¥¨
   - **å®Ÿè£…**: è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ï¼ˆAPI Gatewayçµ±åˆæ™‚ã«å¿…è¦ï¼‰
   - **å½±éŸ¿**: ç¾æ™‚ç‚¹ã§ã¯å½±éŸ¿ãªã—ï¼ˆCollectoré–¢æ•°ã¯API GatewayçµŒç”±ã§ã¯ãªã„ï¼‰
   - **æŽ¨å¥¨**: API Gatewayçµ±åˆæ™‚ã«å®Ÿè£…

4. **ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼**
   - **è¨­è¨ˆ**: `lambda-implementation.md`ã§ã¯ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼é–¢æ•°ï¼ˆ`loadConfig()`ï¼‰ã‚’æŽ¨å¥¨
   - **å®Ÿè£…**: å„ãƒ•ã‚¡ã‚¤ãƒ«ã§`process.env`ã‚’ç›´æŽ¥ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚ã‚Šï¼‰
   - **å½±éŸ¿**: è»½å¾®ï¼ˆç’°å¢ƒå¤‰æ•°æœªè¨­å®šæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ï¼‰
   - **æŽ¨å¥¨**: ç’°å¢ƒå¤‰æ•°æ¤œè¨¼é–¢æ•°ã‚’å®Ÿè£…

#### âŒ é‡å¤§ãªä¹–é›¢ï¼ˆä¿®æ­£å¿…è¦ï¼‰

åŽ³ã—ããƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸçµæžœã€ä»¥ä¸‹ã®é‡å¤§ãªå•é¡Œã‚’ç™ºè¦‹ã—ã¾ã—ãŸï¼š

##### 1. **TDnet URLå®Ÿè£…ãŒæœªå®Œæˆï¼ˆCriticalï¼‰**

**å ´æ‰€**: `src/lambda/collector/scrape-tdnet-list.ts:217`

```typescript
// TODO: å®Ÿéš›ã®TDnet URLã«ç½®ãæ›ãˆã‚‹
// ç¾åœ¨ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼URL
const baseUrl = process.env.TDNET_BASE_URL || 'https://www.release.tdnet.info/inbs';
return `${baseUrl}/I_list_001_${date}.html`;
```

**å•é¡Œç‚¹**:
- å®Ÿéš›ã®TDnet URLãŒæœªå®Ÿè£…ï¼ˆTODOã‚³ãƒ¡ãƒ³ãƒˆï¼‰
- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼URLã§ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿åŽé›†ãŒä¸å¯èƒ½
- ç’°å¢ƒå¤‰æ•°`TDNET_BASE_URL`ã‚‚æœªè¨­å®š

**å½±éŸ¿**: ðŸ”´ **Critical** - ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­æ ¸æ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„

**ä¿®æ­£å¿…è¦æ€§**: å³åº§ã«ä¿®æ­£ãŒå¿…è¦

**æŽ¨å¥¨å¯¾å¿œ**:
1. å®Ÿéš›ã®TDnet URLã‚’èª¿æŸ»ãƒ»ç¢ºèª
2. æ­£ã—ã„URLå½¢å¼ã‚’å®Ÿè£…
3. ç’°å¢ƒå¤‰æ•°è¨­å®šã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
4. çµ±åˆãƒ†ã‚¹ãƒˆã§å®Ÿéš›ã®TDnetã¸ã®æŽ¥ç¶šã‚’æ¤œè¨¼

##### 2. **HTMLæ§‹é€ ãŒä»®å®šã«åŸºã¥ã„ã¦ã„ã‚‹ï¼ˆHighï¼‰**

**å ´æ‰€**: `src/scraper/html-parser.ts:68-90`

```typescript
// TDnetã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã«åŸºã¥ã„ã¦ãƒ‘ãƒ¼ã‚¹
// æ³¨: å®Ÿéš›ã®TDnetã®HTMLæ§‹é€ ã«åˆã‚ã›ã¦èª¿æ•´ãŒå¿…è¦
$('table.disclosure-list tr').each((index, element) => {
  // ...
  const cells = $row.find('td');
  if (cells.length < 6) {
    logger.warn('Invalid row structure', { index, cellCount: cells.length });
    return;
  }
```

**å•é¡Œç‚¹**:
- HTMLæ§‹é€ ãŒä»®å®šã«åŸºã¥ã„ã¦ã„ã‚‹ï¼ˆ`table.disclosure-list`ã‚¯ãƒ©ã‚¹ï¼‰
- å®Ÿéš›ã®TDnet HTMLã¨ä¸€è‡´ã—ãªã„å¯èƒ½æ€§ãŒé«˜ã„
- ã‚»ãƒ¬ã‚¯ã‚¿ãŒé–“é•ã£ã¦ã„ã‚‹å ´åˆã€ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„

**å½±éŸ¿**: ðŸŸ  **High** - ãƒ‡ãƒ¼ã‚¿åŽé›†ãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„

**ä¿®æ­£å¿…è¦æ€§**: å®Ÿéš›ã®TDnet HTMLã‚’ç¢ºèªã—ã¦ä¿®æ­£

**æŽ¨å¥¨å¯¾å¿œ**:
1. å®Ÿéš›ã®TDnet HTMLã‚’å–å¾—ãƒ»åˆ†æž
2. æ­£ã—ã„ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ç‰¹å®š
3. HTMLæ§‹é€ å¤‰æ›´æ¤œçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¼·åŒ–
4. å®Ÿéš›ã®HTMLã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½

##### 3. **ç’°å¢ƒå¤‰æ•°æ¤œè¨¼ãŒä¸ååˆ†ï¼ˆMediumï¼‰**

**å ´æ‰€**: è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«

```typescript
// src/lambda/collector/save-metadata.ts
function getDynamoTable(): string {
  return process.env.DYNAMODB_TABLE || 'tdnet_disclosures';
}

// src/lambda/collector/download-pdf.ts
function getS3Bucket(): string {
  return process.env.S3_BUCKET || 'tdnet-data-collector-pdfs';
}
```

**å•é¡Œç‚¹**:
- ç’°å¢ƒå¤‰æ•°ãŒæœªè¨­å®šã§ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§å‹•ä½œã—ã¦ã—ã¾ã†
- æœ¬ç•ªç’°å¢ƒã§èª¤ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å±é™ºæ€§
- `lambda-implementation.md`ã§æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹æ¤œè¨¼é–¢æ•°ãŒæœªå®Ÿè£…

**å½±éŸ¿**: ðŸŸ¡ **Medium** - æœ¬ç•ªç’°å¢ƒã§äºˆæœŸã—ãªã„å‹•ä½œã®å¯èƒ½æ€§

**ä¿®æ­£å¿…è¦æ€§**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ä¿®æ­£

**æŽ¨å¥¨å¯¾å¿œ**:
1. `src/lambda/collector/config.ts`ã‚’ä½œæˆ
2. å¿…é ˆç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼ã‚’å®Ÿè£…
3. ç’°å¢ƒå¤‰æ•°æœªè¨­å®šæ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼
4. åž‹å®‰å…¨ãªè¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æä¾›

##### 4. **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ãŒæœªå®Ÿè£…ï¼ˆMediumï¼‰**

**å ´æ‰€**: `src/utils/error-response.ts`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ãŒå­˜åœ¨ã—ãªã„ï¼‰

**å•é¡Œç‚¹**:
- `lambda-implementation.md`ã§æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹`error-response.ts`ãŒæœªå®Ÿè£…
- API Gatewayçµ±åˆæ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒä¸å®Œå…¨ã«ãªã‚‹
- ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ä»•çµ„ã¿ãŒãªã„

**å½±éŸ¿**: ðŸŸ¡ **Medium** - API Gatewayçµ±åˆæ™‚ã«å•é¡ŒãŒç™ºç”Ÿ

**ä¿®æ­£å¿…è¦æ€§**: API Gatewayçµ±åˆå‰ã«å®Ÿè£…

**æŽ¨å¥¨å¯¾å¿œ**:
1. `src/utils/error-response.ts`ã‚’ä½œæˆ
2. `toErrorResponse`é–¢æ•°ã‚’å®Ÿè£…
3. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ãƒžãƒƒãƒ—ã‚’å®šç¾©
4. API Gatewayçµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½

##### 5. **DLQï¼ˆDead Letter Queueï¼‰ãŒæœªè¨­å®šï¼ˆMediumï¼‰**

**å ´æ‰€**: `cdk/lib/tdnet-data-collector-stack.ts`

```typescript
const collectorFunction = new lambda.Function(this, 'CollectorFunction', {
  // ...
  // DLQè¨­å®šãªã—
});
```

**å•é¡Œç‚¹**:
- `error-handling-patterns.md`ã§æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹DLQãŒæœªè¨­å®š
- Lambdaé–¢æ•°ã®éžåŒæœŸå‘¼ã³å‡ºã—ã§å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¤±ã‚ã‚Œã‚‹
- ã‚¨ãƒ©ãƒ¼åˆ†æžãƒ»ãƒªãƒˆãƒ©ã‚¤ã®ä»•çµ„ã¿ãŒãªã„

**å½±éŸ¿**: ðŸŸ¡ **Medium** - å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½è·¡ãƒ»ãƒªãƒˆãƒ©ã‚¤ãŒã§ããªã„

**ä¿®æ­£å¿…è¦æ€§**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å®Ÿè£…

**æŽ¨å¥¨å¯¾å¿œ**:
1. SQS DLQã‚’ä½œæˆ
2. Lambdaé–¢æ•°ã«DLQã‚’è¨­å®š
3. DLQãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼Lambdaã‚’å®Ÿè£…
4. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã‚’è¿½åŠ 

##### 6. **X-Rayãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒæœªæœ‰åŠ¹åŒ–ï¼ˆLowï¼‰**

**å ´æ‰€**: `cdk/lib/tdnet-data-collector-stack.ts`

```typescript
const collectorFunction = new lambda.Function(this, 'CollectorFunction', {
  // ...
  // tracingè¨­å®šãªã—
});
```

**å•é¡Œç‚¹**:
- `lambda-implementation.md`ã§æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹X-Rayãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒæœªæœ‰åŠ¹åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åˆ†æžãŒå›°é›£
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®šãŒé›£ã—ã„

**å½±éŸ¿**: ðŸŸ¢ **Low** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åˆ†æžãŒå›°é›£

**ä¿®æ­£å¿…è¦æ€§**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–æ™‚ã«å®Ÿè£…

**æŽ¨å¥¨å¯¾å¿œ**:
1. Lambdaé–¢æ•°ã§X-Rayã‚’æœ‰åŠ¹åŒ–ï¼ˆ`tracing: lambda.Tracing.ACTIVE`ï¼‰
2. AWS SDKã‚’X-Rayã§ãƒ©ãƒƒãƒ—
3. ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

##### 7. **Provisioned ConcurrencyãŒæœªè¨­å®šï¼ˆLowï¼‰**

**å ´æ‰€**: `cdk/lib/tdnet-data-collector-stack.ts`

**å•é¡Œç‚¹**:
- `lambda-implementation.md`ã§æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹Provisioned ConcurrencyãŒæœªè¨­å®š
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒä¸å®‰å®š

**å½±éŸ¿**: ðŸŸ¢ **Low** - ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å¢—åŠ 

**ä¿®æ­£å¿…è¦æ€§**: æœ¬ç•ªç’°å¢ƒã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è¦ä»¶ã«å¿œã˜ã¦å®Ÿè£…

**æŽ¨å¥¨å¯¾å¿œ**:
1. æœ¬ç•ªç’°å¢ƒã®ã¿Provisioned Concurrencyã‚’è¨­å®š
2. é©åˆ‡ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã‚’æ±ºå®š
3. ã‚³ã‚¹ãƒˆå½±éŸ¿ã‚’è©•ä¾¡

##### 8. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ä¸è¶³ï¼ˆMediumï¼‰**

**å•é¡Œç‚¹**:
- `src/lambda/collector/handler.ts`ã®çµ±åˆãƒ†ã‚¹ãƒˆãŒä¸ååˆ†
- å®Ÿéš›ã®TDnet HTMLã‚’ä½¿ç”¨ã—ãŸE2Eãƒ†ã‚¹ãƒˆãŒãªã„
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆãŒä¸è¶³

**å½±éŸ¿**: ðŸŸ¡ **Medium** - æœ¬ç•ªç’°å¢ƒã§äºˆæœŸã—ãªã„å‹•ä½œã®å¯èƒ½æ€§

**ä¿®æ­£å¿…è¦æ€§**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å¼·åŒ–

**æŽ¨å¥¨å¯¾å¿œ**:
1. å®Ÿéš›ã®TDnet HTMLã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
2. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€HTMLæ§‹é€ å¤‰æ›´ç­‰ï¼‰ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
3. E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
4. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç›®æ¨™

##### 9. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä¸é©åˆ‡ãªä½¿ç”¨ï¼ˆLowï¼‰**

**å ´æ‰€**: è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«

```typescript
logger.debug('Rate limiter: first request, no delay');
logger.debug('Fetching TDnet HTML', { url, date });
```

**å•é¡Œç‚¹**:
- æœ¬ç•ªç’°å¢ƒã§é‡è¦ãªæƒ…å ±ãŒ`debug`ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- `info`ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²ã™ã¹ãæƒ…å ±ãŒ`debug`ã«ãªã£ã¦ã„ã‚‹
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘ãŒä¸æ˜Žç¢º

**å½±éŸ¿**: ðŸŸ¢ **Low** - æœ¬ç•ªç’°å¢ƒã§ã®ãƒ­ã‚°åˆ†æžãŒå›°é›£

**ä¿®æ­£å¿…è¦æ€§**: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®è¦‹ç›´ã—

**æŽ¨å¥¨å¯¾å¿œ**:
1. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ
2. é‡è¦ãªæƒ…å ±ã¯`info`ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²
3. ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®ã¿`debug`ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²

##### 10. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—æ™‚ã®å‡¦ç†ï¼ˆLowï¼‰**

**å ´æ‰€**: `src/utils/cloudwatch-metrics.ts:88-96`

```typescript
} catch (error) {
  // ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ã¯ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ãŒã€ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ãªã„
  // ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ã§ãƒ¡ã‚¤ãƒ³å‡¦ç†ã‚’ä¸­æ–­ã—ãªã„ãŸã‚
  logger.warn('Failed to send metric to CloudWatch', {
    // ...
  });
}
```

**å•é¡Œç‚¹**:
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ãŒè­¦å‘Šãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²ã•ã‚Œã‚‹ã®ã¿
- ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆãŒæ©Ÿèƒ½ã—ãªã„å¯èƒ½æ€§
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ã®åŽŸå› ãŒè¿½è·¡å›°é›£

**å½±éŸ¿**: ðŸŸ¢ **Low** - ç›£è¦–æ©Ÿèƒ½ã®ä¿¡é ¼æ€§ä½Žä¸‹

**ä¿®æ­£å¿…è¦æ€§**: ç›£è¦–å¼·åŒ–æ™‚ã«æ”¹å–„

**æŽ¨å¥¨å¯¾å¿œ**:
1. ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
2. é€£ç¶šå¤±æ•—æ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡
3. ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—ã®åŽŸå› ã‚’åˆ†æž

### 3. è¿½åŠ ã®ç¢ºèªäº‹é …

#### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

- `src/utils/__tests__/date-partition.test.ts` - âœ… å……å®Ÿã—ãŸãƒ†ã‚¹ãƒˆ
  - æ­£å¸¸ç³»ã€ç•°å¸¸ç³»ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’ç¶²ç¾…
  - JSTå¤‰æ›ã€æœˆã¾ãŸãŽã€ã†ã‚‹ã†å¹´ã€å¹´ã¾ãŸãŽã‚’ãƒ†ã‚¹ãƒˆ
  - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

- ãã®ä»–ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«:
  - `src/__tests__/date-partition.property.test.ts` - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
  - `src/__tests__/project-structure.test.ts` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãƒ†ã‚¹ãƒˆ
  - `src/__tests__/type-definitions.test.ts` - åž‹å®šç¾©ãƒ†ã‚¹ãƒˆ

#### CDKã‚¹ã‚¿ãƒƒã‚¯

- DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`tdnet_disclosures`, `tdnet_executions`ï¼‰ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- GSIï¼ˆ`GSI_CompanyCode_DiscloseDate`, `GSI_DatePartition`ï¼‰ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- S3ãƒã‚±ãƒƒãƒˆï¼ˆPDFs, Exports, Dashboard, CloudTrail Logsï¼‰ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- Lambdaé–¢æ•°ï¼ˆCollectorï¼‰ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- IAMæ¨©é™ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹

## æˆæžœç‰©

### ä½œæˆãƒ»å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

- ã“ã®work-logï¼ˆ`work-log-20260208-164500-design-implementation-gap-analysis.md`ï¼‰

### ç¢ºèªã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

- `src/errors/index.ts`
- `src/utils/date-partition.ts`
- `src/utils/retry.ts`
- `src/utils/logger.ts`
- `src/models/disclosure.ts`
- `src/lambda/collector/handler.ts`
- `src/lambda/collector/save-metadata.ts`
- `src/lambda/collector/scrape-tdnet-list.ts`
- `src/types/index.ts`
- `cdk/lib/tdnet-data-collector-stack.ts`
- `src/utils/__tests__/date-partition.test.ts`

## æ¬¡å›žã¸ã®ç”³ã—é€ã‚Š

### æ”¹å–„æŽ¨å¥¨äº‹é …ï¼ˆå„ªå…ˆåº¦: Lowï¼‰

1. **ç’°å¢ƒå¤‰æ•°æ¤œè¨¼é–¢æ•°ã®å®Ÿè£…**
   - `src/lambda/collector/config.ts`ã‚’ä½œæˆ
   - å¿…é ˆç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼ã‚’å®Ÿè£…
   - åž‹å®‰å…¨ãªè¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æä¾›

2. **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ã®å®Ÿè£…ï¼ˆAPI Gatewayçµ±åˆæ™‚ï¼‰**
   - `src/utils/error-response.ts`ã‚’ä½œæˆ
   - ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›
   - æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’å®Ÿè£…

3. **Lambdaé–¢æ•°å›ºæœ‰ã®åž‹å®šç¾©ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰**
   - `src/lambda/collector/types.ts`ã‚’ä½œæˆ
   - Collectoré–¢æ•°å›ºæœ‰ã®åž‹å®šç¾©ã‚’ç§»å‹•

### çµè«–

**åŽ³ã—ããƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸçµæžœã€é‡å¤§ãªå•é¡Œã‚’è¤‡æ•°ç™ºè¦‹ã—ã¾ã—ãŸã€‚**

#### ðŸ”´ Criticalï¼ˆå³åº§ã«ä¿®æ­£ãŒå¿…è¦ï¼‰

1. **TDnet URLå®Ÿè£…ãŒæœªå®Œæˆ** - ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­æ ¸æ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„

#### ðŸŸ  Highï¼ˆæœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ä¿®æ­£ãŒå¿…è¦ï¼‰

2. **HTMLæ§‹é€ ãŒä»®å®šã«åŸºã¥ã„ã¦ã„ã‚‹** - ãƒ‡ãƒ¼ã‚¿åŽé›†ãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„

#### ðŸŸ¡ Mediumï¼ˆæœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å¯¾å¿œæŽ¨å¥¨ï¼‰

3. **ç’°å¢ƒå¤‰æ•°æ¤œè¨¼ãŒä¸ååˆ†** - æœ¬ç•ªç’°å¢ƒã§äºˆæœŸã—ãªã„å‹•ä½œã®å¯èƒ½æ€§
4. **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ãŒæœªå®Ÿè£…** - API Gatewayçµ±åˆæ™‚ã«å•é¡ŒãŒç™ºç”Ÿ
5. **DLQï¼ˆDead Letter Queueï¼‰ãŒæœªè¨­å®š** - å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½è·¡ãƒ»ãƒªãƒˆãƒ©ã‚¤ãŒã§ããªã„
8. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ä¸è¶³** - æœ¬ç•ªç’°å¢ƒã§äºˆæœŸã—ãªã„å‹•ä½œã®å¯èƒ½æ€§

#### ðŸŸ¢ Lowï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–æ™‚ã«å¯¾å¿œï¼‰

6. **X-Rayãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒæœªæœ‰åŠ¹åŒ–** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åˆ†æžãŒå›°é›£
7. **Provisioned ConcurrencyãŒæœªè¨­å®š** - ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å¢—åŠ 
9. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä¸é©åˆ‡ãªä½¿ç”¨** - æœ¬ç•ªç’°å¢ƒã§ã®ãƒ­ã‚°åˆ†æžãŒå›°é›£
10. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡å¤±æ•—æ™‚ã®å‡¦ç†** - ç›£è¦–æ©Ÿèƒ½ã®ä¿¡é ¼æ€§ä½Žä¸‹

### ç·åˆè©•ä¾¡

**å®Ÿè£…å“è³ª**: âš ï¸ **è¦æ”¹å–„**

**ç†ç”±**:
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€date_partitionå®Ÿè£…ã€å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯å„ªã‚Œã¦ã„ã‚‹
- ã—ã‹ã—ã€**TDnet URLå®Ÿè£…ãŒæœªå®Œæˆ**ã¨ã„ã†è‡´å‘½çš„ãªå•é¡ŒãŒã‚ã‚‹
- HTMLæ§‹é€ ãŒä»®å®šã«åŸºã¥ã„ã¦ãŠã‚Šã€å®Ÿéš›ã®TDnetã¨ä¸€è‡´ã—ãªã„å¯èƒ½æ€§ãŒé«˜ã„
- ç’°å¢ƒå¤‰æ•°æ¤œè¨¼ã€DLQè¨­å®šã€ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ãªã©ã€æœ¬ç•ªç’°å¢ƒã§å¿…è¦ãªæ©Ÿèƒ½ãŒæœªå®Ÿè£…

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
1. **æœ€å„ªå…ˆ**: TDnet URLå®Ÿè£…ã‚’å®Œæˆã•ã›ã‚‹
2. **é«˜å„ªå…ˆ**: å®Ÿéš›ã®TDnet HTMLã‚’ç¢ºèªã—ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä¿®æ­£
3. **ä¸­å„ªå…ˆ**: ç’°å¢ƒå¤‰æ•°æ¤œè¨¼ã€DLQè¨­å®šã€ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ã‚’å®Ÿè£…
4. **ä½Žå„ªå…ˆ**: X-Rayãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã€Provisioned Concurrencyã€ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¦‹ç›´ã—

**æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
- Phase 1ã®å®Ÿè£…ã‚’ä¸€æ™‚åœæ­¢
- Critical/Highå„ªå…ˆåº¦ã®å•é¡Œã‚’ä¿®æ­£
- å®Ÿéš›ã®TDnetã§ã®å‹•ä½œç¢ºèªã‚’å®Ÿæ–½
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å¼·åŒ–
- ä¿®æ­£å®Œäº†å¾Œã€Phase 2ã«é€²ã‚€
