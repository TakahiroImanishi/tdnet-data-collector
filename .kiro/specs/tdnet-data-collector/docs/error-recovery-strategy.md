# エラーリカバリー戦略

**バージョン:** 1.0  
**最終更新:** 2026-02-07  
**ステータス:** Draft

---

## 目次

1. [概要](#概要)
2. [Dead Letter Queue (DLQ) 設計](#dead-letter-queue-dlq-設計)
3. [自動リカバリーの範囲](#自動リカバリーの範囲)
4. [手動介入が必要なケース](#手動介入が必要なケース)
5. [リカバリー手順書](#リカバリー手順書)
6. [リカバリーLambda関数の実装](#リカバリーlambda関数の実装)
7. [監視とアラート](#監視とアラート)
8. [テスト戦略](#テスト戦略)
9. [関連ドキュメント](#関連ドキュメント)

---

## 概要

### エラーリカバリーの重要性

TDnet Data Collectorは、外部API（TDnet）からデータを収集するシステムであり、以下のような一時的な障害が発生する可能性があります：

- **ネットワーク障害**: 一時的な接続エラー、タイムアウト
- **外部サービス障害**: TDnetのメンテナンス、過負荷
- **レート制限**: APIリクエスト制限の超過
- **AWS一時的障害**: DynamoDB/S3のスロットリング

これらの障害に対して、適切なエラーリカバリー戦略を実装することで、システムの信頼性と可用性を向上させます。

### 自動リカバリーと手動介入の使い分け

| 種類 | 対象エラー | 対応方法 | 例 |
|------|-----------|---------|-----|
| **自動リカバリー** | 一時的な障害 | 指数バックオフによる再試行 | ネットワークエラー、5xxエラー、レート制限 |
| **手動介入** | 恒久的な障害 | DLQに保存し、アラート通知 | 認証エラー、設定エラー、データ整合性エラー |

**基本方針:**
- 再試行可能なエラーは自動リカバリー（最大3回）
- 再試行不可能なエラーはDLQに送信し、手動介入を促す
- 部分的失敗は成功分をコミットし、失敗分をログ記録

---

## Dead Letter Queue (DLQ) 設計

### DLQの目的

Dead Letter Queue (DLQ) は、処理に失敗したメッセージを一時的に保存し、後で再処理または分析するための仕組みです。

**主な用途:**
