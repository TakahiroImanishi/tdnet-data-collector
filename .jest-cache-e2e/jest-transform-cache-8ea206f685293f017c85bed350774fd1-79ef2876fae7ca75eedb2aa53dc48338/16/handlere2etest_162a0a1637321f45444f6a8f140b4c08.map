{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\handler.e2e.test.ts","mappings":";AAAA;;;;;;;;;GASG;;AAGH,wCAAqC;AACrC,8DAA0D;AAC1D,wDAA2E;AAG3E,iBAAiB;AACjB,MAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,gBAAgB,KAAK,SAAS,CAAC;AAChE,MAAM,YAAY,GAAG,IAAI,gCAAc,CAAC;IACtC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,gBAAgB;IAClD,GAAG,CAAC,YAAY,IAAI;QAClB,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAgB;QACtC,WAAW,EAAE;YACX,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI,MAAM;YACpD,eAAe,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB,IAAI,MAAM;SAC7D;KACF,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,SAAS,GAAG,qCAAsB,CAAC,IAAI,CAAC,YAAY,EAAE;IAC1D,eAAe,EAAE;QACf,qBAAqB,EAAE,IAAI;QAC3B,yBAAyB,EAAE,IAAI;KAChC;CACF,CAAC,CAAC;AAEH,QAAQ,CAAC,qEAAqE,EAAE,GAAG,EAAE;IACnF,IAAI,WAAoB,CAAC;IACzB,IAAI,SAA+B,CAAC;IACpC,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI,mBAAmB,CAAC;IAEzE,SAAS,CAAC,KAAK,IAAI,EAAE;QACnB,qBAAqB;QACrB,MAAM,cAAc,GAAe;YACjC,aAAa,EAAE,eAAe;YAC9B,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,QAAQ;YACtB,eAAe,EAAE,MAAM;YACvB,KAAK,EAAE,oBAAoB;YAC3B,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,yDAAyD;YAClE,MAAM,EAAE,mCAAmC;YAC3C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B,CAAC;QAEF,IAAI,CAAC;YACH,MAAM,SAAS,CAAC,IAAI,CAClB,IAAI,yBAAU,CAAC;gBACb,SAAS,EAAE,SAAS;gBACpB,IAAI,EAAE,cAAc;aACrB,CAAC,CACH,CAAC;YACF,OAAO,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;QACjD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,UAAU,CAAC,GAAG,EAAE;QACd,YAAY;QACZ,WAAW,GAAG;YACZ,YAAY,EAAE,qBAAqB;YACnC,YAAY,EAAE,iBAAiB;YAC/B,eAAe,EAAE,GAAG;YACpB,kBAAkB,EAAE,qEAAqE;YACzF,eAAe,EAAE,KAAK;YACtB,YAAY,EAAE,6BAA6B;YAC3C,aAAa,EAAE,8BAA8B;YAC7C,wBAAwB,EAAE,GAAG,EAAE,CAAC,KAAK;YACrC,8BAA8B,EAAE,IAAI;YACpC,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;YACf,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;YACf,OAAO,EAAE,IAAI,CAAC,EAAE,EAAE;SACnB,CAAC;QAEF,cAAc;QACd,SAAS,GAAG;YACV,IAAI,EAAE,IAAI;YACV,OAAO,EAAE,EAAE;YACX,iBAAiB,EAAE,EAAE;YACrB,UAAU,EAAE,KAAK;YACjB,eAAe,EAAE,KAAK;YACtB,IAAI,EAAE,cAAc;YACpB,cAAc,EAAE,IAAI;YACpB,qBAAqB,EAAE,IAAI;YAC3B,+BAA+B,EAAE,IAAI;YACrC,cAAc,EAAE,IAAI;YACpB,cAAc,EAAE;gBACd,SAAS,EAAE,cAAc;gBACzB,KAAK,EAAE,iBAAiB;gBACxB,QAAQ,EAAE,UAAU;gBACpB,UAAU,EAAE,KAAK;gBACjB,IAAI,EAAE,cAAc;gBACpB,KAAK,EAAE,MAAM;gBACb,SAAS,EAAE,qBAAqB;gBAChC,WAAW,EAAE,4BAA4B;gBACzC,gBAAgB,EAAE,aAAa;gBAC/B,QAAQ,EAAE;oBACR,SAAS,EAAE,IAAI;oBACf,SAAS,EAAE,IAAI;oBACf,MAAM,EAAE,IAAI;oBACZ,QAAQ,EAAE,IAAI;oBACd,MAAM,EAAE,IAAI;oBACZ,UAAU,EAAE,IAAI;oBAChB,6BAA6B,EAAE,IAAI;oBACnC,yBAAyB,EAAE,IAAI;oBAC/B,iBAAiB,EAAE,IAAI;oBACvB,qBAAqB,EAAE,IAAI;oBAC3B,cAAc,EAAE,IAAI;oBACpB,QAAQ,EAAE,aAAa;oBACvB,IAAI,EAAE,IAAI;oBACV,SAAS,EAAE,aAAa;oBACxB,OAAO,EAAE,IAAI;iBACd;gBACD,UAAU,EAAE,IAAI;gBAChB,UAAU,EAAE,iBAAiB;gBAC7B,YAAY,EAAE,KAAK;gBACnB,UAAU,EAAE,kBAAkB;gBAC9B,YAAY,EAAE,cAAc;aAC7B;YACD,QAAQ,EAAE,cAAc;SACzB,CAAC;QAEF,SAAS;QACT,OAAO,CAAC,GAAG,CAAC,OAAO,GAAG,kBAAkB,CAAC;QACzC,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,SAAS,CAAC;QAC5C,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,kBAAkB,CAAC;IAClD,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,8CAA8C,EAAE,GAAG,EAAE;QAC5D,EAAE,CAAC,uBAAuB,EAAE,KAAK,IAAI,EAAE;YACrC,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,iBAAiB;aAC/B,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;YACxD,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;YAEvD,cAAc;YACd,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,6BAA6B,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;YACtC,UAAU;YACV,SAAS,CAAC,OAAO,GAAG,EAAE,CAAC,CAAC,UAAU;YAElC,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC;YAC5D,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;YAEvD,cAAc;YACd,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,6BAA6B,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0BAA0B,EAAE,KAAK,IAAI,EAAE;YACxC,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,iBAAiB,EAAE,MAAM;aACvC,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sCAAsC,EAAE,GAAG,EAAE;QACpD,EAAE,CAAC,0BAA0B,EAAE,KAAK,IAAI,EAAE;YACxC,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,YAAY,EAAE,MAAM;aACrB,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,wCAAwC;YACxC,IAAI,MAAM,CAAC,UAAU,KAAK,GAAG,EAAE,CAAC;gBAC9B,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC;gBAC7D,OAAO,CAAC,KAAK,CAAC,gBAAgB,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;YAC/C,CAAC;YAED,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YAClE,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,6BAA6B,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAElE,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;YAC3C,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YACtC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YAErC,SAAS;YACT,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnD,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAChC,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;gBACvC,MAAM,CAAC,UAAU,CAAC,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;gBACnD,MAAM,CAAC,UAAU,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;gBAClD,MAAM,CAAC,UAAU,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;gBAClD,MAAM,CAAC,UAAU,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;YACpD,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sBAAsB,EAAE,KAAK,IAAI,EAAE;YACpC,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,UAAU,EAAE,YAAY;gBACxB,QAAQ,EAAE,YAAY;aACvB,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;YAC3C,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE;YAC1C,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,MAAM,EAAE,KAAK;gBACb,YAAY,EAAE,MAAM;aACrB,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC1D,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,qBAAqB,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;YACxE,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,6BAA6B,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAElE,aAAa;YACb,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;YAC/C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;YAC9C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qCAAqC,EAAE,GAAG,EAAE;QACnD,EAAE,CAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE;YAC/C,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,YAAY,EAAE,KAAK,EAAE,QAAQ;aAC9B,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACjD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;YAC3C,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,UAAU,EAAE,YAAY,EAAE,kBAAkB;aAC7C,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACjD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,2BAA2B,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACjD,UAAU;YACV,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,kBAAkB;aAChC,CAAC;YACF,SAAS,CAAC,qBAAqB,GAAG;gBAChC,UAAU,EAAE,YAAY;gBACxB,QAAQ,EAAE,YAAY;aACvB,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACjD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;YACnD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,4BAA4B,CAAC,CAAC;YACnE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,4BAA4B,EAAE,GAAG,EAAE;QAC1C,EAAE,CAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE;YAC1C,mBAAmB;YACnB,SAAS,CAAC,OAAO,GAAG,EAAE,CAAC;YAEvB,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,6BAA6B,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClE,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;YAC5C,oBAAoB;YACpB,SAAS,CAAC,OAAO,GAAG;gBAClB,WAAW,EAAE,iBAAiB;aAC/B,CAAC;YAEF,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oBAAoB,EAAE,KAAK,IAAI,EAAE;YAClC,mBAAmB;YACnB,SAAS,CAAC,OAAO,GAAG,EAAE,CAAC;YAEvB,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,iBAAO,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAErD,SAAS;YACT,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YACtC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YACrC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC;YAC1C,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;YAC1C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;YAC7C,MAAM,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC9C,MAAM,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjD,MAAM,CAAC,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\handler.e2e.test.ts"],"sourcesContent":["/**\r\n * Lambda Query Handler E2E Tests\r\n *\r\n * Property 9: APIキー認証の必須性\r\n *\r\n * Requirements: 要件11.3, 14.4（E2Eテスト、API認証）\r\n *\r\n * このE2Eテストは、LocalStack環境または開発環境で実行され、\r\n * 実際のAWS SDKクライアントを使用してAPIキー認証を検証します。\r\n */\r\n\r\nimport { Context, APIGatewayProxyEvent } from 'aws-lambda';\r\nimport { handler } from '../handler';\r\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\r\nimport { DynamoDBDocumentClient, PutCommand } from '@aws-sdk/lib-dynamodb';\r\nimport { Disclosure } from '../../../types';\r\n\r\n// LocalStack環境設定\r\nconst isLocalStack = process.env.AWS_ENDPOINT_URL !== undefined;\r\nconst dynamoClient = new DynamoDBClient({\r\n  region: process.env.AWS_REGION || 'ap-northeast-1',\r\n  ...(isLocalStack && {\r\n    endpoint: process.env.AWS_ENDPOINT_URL,\r\n    credentials: {\r\n      accessKeyId: process.env.AWS_ACCESS_KEY_ID || 'test',\r\n      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || 'test',\r\n    },\r\n  }),\r\n});\r\n\r\nconst docClient = DynamoDBDocumentClient.from(dynamoClient, {\r\n  marshallOptions: {\r\n    removeUndefinedValues: true,\r\n    convertClassInstanceToMap: true,\r\n  },\r\n});\r\n\r\ndescribe('Lambda Query Handler E2E Tests - Property 9: API Key Authentication', () => {\r\n  let mockContext: Context;\r\n  let mockEvent: APIGatewayProxyEvent;\r\n  const tableName = process.env.DYNAMODB_TABLE_NAME || 'tdnet_disclosures';\r\n\r\n  beforeAll(async () => {\r\n    // テストデータをDynamoDBに挿入\r\n    const testDisclosure: Disclosure = {\r\n      disclosure_id: 'TD20240115001',\r\n      company_code: '7203',\r\n      company_name: 'トヨタ自動車',\r\n      disclosure_type: '決算短信',\r\n      title: '2024年3月期 第3四半期決算短信',\r\n      disclosed_at: '2024-01-15T10:30:00Z',\r\n      pdf_url: 'https://www.release.tdnet.info/inbs/140120240115001.pdf',\r\n      s3_key: '2024/01/15/TD20240115001_7203.pdf',\r\n      collected_at: '2024-01-15T10:35:00Z',\r\n      date_partition: '2024-01',\r\n    };\r\n\r\n    try {\r\n      await docClient.send(\r\n        new PutCommand({\r\n          TableName: tableName,\r\n          Item: testDisclosure,\r\n        })\r\n      );\r\n      console.log('Test data inserted successfully');\r\n    } catch (error) {\r\n      console.error('Failed to insert test data:', error);\r\n      throw error;\r\n    }\r\n  });\r\n\r\n  beforeEach(() => {\r\n    // モックコンテキスト\r\n    mockContext = {\r\n      awsRequestId: 'test-request-id-e2e',\r\n      functionName: 'tdnet-query-e2e',\r\n      functionVersion: '1',\r\n      invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-query-e2e',\r\n      memoryLimitInMB: '256',\r\n      logGroupName: '/aws/lambda/tdnet-query-e2e',\r\n      logStreamName: '2024/01/15/[$LATEST]e2e-test',\r\n      getRemainingTimeInMillis: () => 30000,\r\n      callbackWaitsForEmptyEventLoop: true,\r\n      done: jest.fn(),\r\n      fail: jest.fn(),\r\n      succeed: jest.fn(),\r\n    };\r\n\r\n    // モックイベント（基本）\r\n    mockEvent = {\r\n      body: null,\r\n      headers: {},\r\n      multiValueHeaders: {},\r\n      httpMethod: 'GET',\r\n      isBase64Encoded: false,\r\n      path: '/disclosures',\r\n      pathParameters: null,\r\n      queryStringParameters: null,\r\n      multiValueQueryStringParameters: null,\r\n      stageVariables: null,\r\n      requestContext: {\r\n        accountId: '123456789012',\r\n        apiId: 'test-api-id-e2e',\r\n        protocol: 'HTTP/1.1',\r\n        httpMethod: 'GET',\r\n        path: '/disclosures',\r\n        stage: 'test',\r\n        requestId: 'test-request-id-e2e',\r\n        requestTime: '15/Jan/2024:10:30:00 +0000',\r\n        requestTimeEpoch: 1705315800000,\r\n        identity: {\r\n          accessKey: null,\r\n          accountId: null,\r\n          apiKey: null,\r\n          apiKeyId: null,\r\n          caller: null,\r\n          clientCert: null,\r\n          cognitoAuthenticationProvider: null,\r\n          cognitoAuthenticationType: null,\r\n          cognitoIdentityId: null,\r\n          cognitoIdentityPoolId: null,\r\n          principalOrgId: null,\r\n          sourceIp: '192.168.1.1',\r\n          user: null,\r\n          userAgent: 'Mozilla/5.0',\r\n          userArn: null,\r\n        },\r\n        authorizer: null,\r\n        domainName: 'api.example.com',\r\n        domainPrefix: 'api',\r\n        resourceId: 'test-resource-id',\r\n        resourcePath: '/disclosures',\r\n      },\r\n      resource: '/disclosures',\r\n    };\r\n\r\n    // 環境変数設定\r\n    process.env.API_KEY = 'test-api-key-e2e';\r\n    process.env.DYNAMODB_TABLE_NAME = tableName;\r\n    process.env.S3_BUCKET_NAME = 'tdnet-pdfs-local';\r\n  });\r\n\r\n  describe('Property 9.1: 無効なAPIキーで401 Unauthorizedが返される', () => {\r\n    it('無効なAPIキーの場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'invalid-api-key',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n\r\n      // CORSヘッダーの確認\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n    });\r\n\r\n    it('APIキーが未設定の場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {}; // APIキーなし\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('API key is required');\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n\r\n      // CORSヘッダーの確認\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n    });\r\n\r\n    it('大文字小文字が異なるヘッダー名でも認証が機能する', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'X-Api-Key': 'invalid-api-key', // 大文字\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n    });\r\n  });\r\n\r\n  describe('Property 9.2: 有効なAPIキーで正常にレスポンスが返される', () => {\r\n    it('有効なAPIキーで認証成功し、データが取得できる', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        company_code: '7203',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Debug: Log error if status is not 200\r\n      if (result.statusCode !== 200) {\r\n        console.error('Test failed with status:', result.statusCode);\r\n        console.error('Response body:', result.body);\r\n      }\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      expect(result.headers?.['Content-Type']).toBe('application/json');\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n\r\n      const body = JSON.parse(result.body);\r\n      expect(body).toHaveProperty('disclosures');\r\n      expect(body).toHaveProperty('total');\r\n      expect(body).toHaveProperty('count');\r\n      expect(body).toHaveProperty('offset');\r\n      expect(body).toHaveProperty('limit');\r\n\r\n      // データの検証\r\n      expect(Array.isArray(body.disclosures)).toBe(true);\r\n      if (body.disclosures.length > 0) {\r\n        const disclosure = body.disclosures[0];\r\n        expect(disclosure).toHaveProperty('disclosure_id');\r\n        expect(disclosure).toHaveProperty('company_code');\r\n        expect(disclosure).toHaveProperty('company_name');\r\n        expect(disclosure).toHaveProperty('disclosed_at');\r\n      }\r\n    });\r\n\r\n    it('有効なAPIキーで日付範囲検索が機能する', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-20',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      const body = JSON.parse(result.body);\r\n      expect(body).toHaveProperty('disclosures');\r\n      expect(body).toHaveProperty('total');\r\n    });\r\n\r\n    it('有効なAPIキーでCSV形式のレスポンスが取得できる', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        format: 'csv',\r\n        company_code: '7203',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      expect(result.headers?.['Content-Type']).toBe('text/csv');\r\n      expect(result.headers?.['Content-Disposition']).toContain('attachment');\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n\r\n      // CSVヘッダーの確認\r\n      expect(result.body).toContain('disclosure_id');\r\n      expect(result.body).toContain('company_code');\r\n      expect(result.body).toContain('company_name');\r\n    });\r\n  });\r\n\r\n  describe('Property 9.3: APIキー認証とバリデーションの組み合わせ', () => {\r\n    it('有効なAPIキーでも不正なクエリパラメータは400エラーを返す', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        company_code: '123', // 4桁でない\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid company_code');\r\n    });\r\n\r\n    it('有効なAPIキーでも不正な日付形式は400エラーを返す', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        start_date: '2024/01/15', // YYYY-MM-DD形式でない\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid start_date format');\r\n    });\r\n\r\n    it('有効なAPIキーでも開始日が終了日より後の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      mockEvent.headers = {\r\n        'x-api-key': 'test-api-key-e2e',\r\n      };\r\n      mockEvent.queryStringParameters = {\r\n        start_date: '2024-01-20',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('start_date');\r\n      expect(body.error.message).toContain('must be before or equal to');\r\n      expect(body.error.message).toContain('end_date');\r\n    });\r\n  });\r\n\r\n  describe('Property 9.4: エラーレスポンスの一貫性', () => {\r\n    it('すべてのエラーレスポンスにCORSヘッダーが含まれる', async () => {\r\n      // Arrange: APIキーなし\r\n      mockEvent.headers = {};\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n      expect(result.headers?.['Content-Type']).toBe('application/json');\r\n    });\r\n\r\n    it('すべてのエラーレスポンスにrequest_idが含まれる', async () => {\r\n      // Arrange: 無効なAPIキー\r\n      mockEvent.headers = {\r\n        'x-api-key': 'invalid-api-key',\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n    });\r\n\r\n    it('エラーレスポンスの構造が一貫している', async () => {\r\n      // Arrange: APIキーなし\r\n      mockEvent.headers = {};\r\n\r\n      // Act\r\n      const result = await handler(mockEvent, mockContext);\r\n\r\n      // Assert\r\n      const body = JSON.parse(result.body);\r\n      expect(body).toHaveProperty('status');\r\n      expect(body).toHaveProperty('error');\r\n      expect(body).toHaveProperty('request_id');\r\n      expect(body.status).toBe('error');\r\n      expect(body.error).toHaveProperty('code');\r\n      expect(body.error).toHaveProperty('message');\r\n      expect(typeof body.error.code).toBe('string');\r\n      expect(typeof body.error.message).toBe('string');\r\n      expect(typeof body.request_id).toBe('string');\r\n    });\r\n  });\r\n});\r\n"],"version":3}