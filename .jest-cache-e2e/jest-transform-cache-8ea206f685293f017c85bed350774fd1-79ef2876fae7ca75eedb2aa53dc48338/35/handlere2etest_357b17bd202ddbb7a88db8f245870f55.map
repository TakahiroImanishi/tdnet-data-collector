{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\handler.e2e.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\handler.e2e.test.ts"],"sourcesContent":["/**\r\n * Lambda Export Handler E2E Tests\r\n *\r\n * Property 9: APIキー認証の必須性\r\n *\r\n * Requirements: 要件11.3, 14.4（E2Eテスト、API認証）\r\n *\r\n * このE2Eテストは、LocalStack環境または開発環境で実行され、\r\n * 実際のAWS SDKクライアントを使用してAPIキー認証を検証します。\r\n */\r\n\r\nimport { Context } from 'aws-lambda';\r\nimport { handler } from '../handler';\r\nimport { ExportEvent } from '../types';\r\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\r\nimport { DynamoDBDocumentClient, GetCommand } from '@aws-sdk/lib-dynamodb';\r\n\r\n// LocalStack環境設定\r\nconst isLocalStack = process.env.AWS_ENDPOINT_URL !== undefined;\r\nconst dynamoClient = new DynamoDBClient({\r\n  region: process.env.AWS_REGION || 'ap-northeast-1',\r\n  ...(isLocalStack && {\r\n    endpoint: process.env.AWS_ENDPOINT_URL,\r\n    credentials: {\r\n      accessKeyId: process.env.AWS_ACCESS_KEY_ID || 'test',\r\n      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || 'test',\r\n    },\r\n  }),\r\n});\r\n\r\nconst docClient = DynamoDBDocumentClient.from(dynamoClient, {\r\n  marshallOptions: {\r\n    removeUndefinedValues: true,\r\n    convertClassInstanceToMap: true,\r\n  },\r\n});\r\n\r\ndescribe('Lambda Export Handler E2E Tests - Property 9: API Key Authentication', () => {\r\n  const mockContext: Context = {\r\n    awsRequestId: 'test-request-id-e2e-export',\r\n    functionName: 'tdnet-export-e2e',\r\n    functionVersion: '1',\r\n    invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-export-e2e',\r\n    memoryLimitInMB: '512',\r\n    logGroupName: '/aws/lambda/tdnet-export-e2e',\r\n    logStreamName: '2024/01/15/[$LATEST]e2e-test',\r\n    callbackWaitsForEmptyEventLoop: true,\r\n    getRemainingTimeInMillis: () => 30000,\r\n    done: jest.fn(),\r\n    fail: jest.fn(),\r\n    succeed: jest.fn(),\r\n  };\r\n\r\n  const tableName = process.env.DYNAMODB_TABLE_NAME || 'tdnet-disclosures-local';\r\n  const exportTableName = process.env.EXPORT_STATUS_TABLE_NAME || 'tdnet_executions';\r\n\r\n  beforeEach(() => {\r\n    // 環境変数設定\r\n    process.env.API_KEY = 'test-api-key-e2e-export';\r\n    process.env.DYNAMODB_TABLE_NAME = tableName;\r\n    process.env.EXPORT_STATUS_TABLE_NAME = exportTableName;\r\n    process.env.S3_BUCKET_NAME = 'tdnet-pdfs-local';\r\n  });\r\n\r\n  describe('Property 9.1: 無効なAPIキーで401 Unauthorizedが返される', () => {\r\n    it('APIキーが未指定の場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {},\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('API key is required');\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n\r\n      // CORSヘッダーの確認\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n      expect(result.headers?.['Access-Control-Allow-Headers']).toContain('X-Api-Key');\r\n    });\r\n\r\n    it('APIキーが不正な場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'invalid-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n\r\n      // CORSヘッダーの確認\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n    });\r\n\r\n    it('大文字小文字が異なるヘッダー名でも認証が機能する', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'X-Api-Key': 'invalid-api-key', // 大文字\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n    });\r\n\r\n    it('空文字列のAPIキーは401エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': '', // 空文字列\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n    });\r\n  });\r\n\r\n  describe('Property 9.2: 有効なAPIキーで正常にレスポンスが返される', () => {\r\n    it('JSON形式のエクスポートリクエストが受け付けられる', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(202); // Accepted\r\n      expect(result.headers?.['Content-Type']).toBe('application/json');\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n\r\n      const body = JSON.parse(result.body);\r\n      expect(body).toHaveProperty('export_id');\r\n      expect(body).toHaveProperty('status');\r\n      expect(body).toHaveProperty('message');\r\n      expect(body).toHaveProperty('progress');\r\n\r\n      // エクスポートIDの形式確認（base36形式: 数字とa-zの小文字、requestIdPrefixにはハイフンも含まれる）\r\n      expect(body.export_id).toMatch(/^export_\\d+_[a-z0-9]+_[a-z0-9\\-]+$/);\r\n      expect(body.status).toBe('pending');\r\n      expect(body.message).toContain('Export job created successfully');\r\n      expect(body.progress).toBe(0);\r\n\r\n      // DynamoDBにエクスポートジョブが作成されたか確認\r\n      const getResult = await docClient.send(\r\n        new GetCommand({\r\n          TableName: exportTableName,\r\n          Key: { export_id: body.export_id },\r\n        })\r\n      );\r\n\r\n      expect(getResult.Item).toBeDefined();\r\n      expect(getResult.Item?.export_id).toBe(body.export_id);\r\n      // ステータスは pending または processing（バックグラウンド処理が開始されている場合）\r\n      expect(['pending', 'processing']).toContain(getResult.Item?.status);\r\n      expect(getResult.Item?.format).toBe('json');\r\n    });\r\n\r\n    it('CSV形式のエクスポートリクエストが受け付けられる', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'csv',\r\n          filter: {\r\n            company_code: '1234',\r\n            start_date: '2024-01-01',\r\n            end_date: '2024-01-31',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(202);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.export_id).toBeDefined();\r\n      expect(body.status).toBe('pending');\r\n\r\n      // DynamoDBにエクスポートジョブが作成されたか確認\r\n      const getResult = await docClient.send(\r\n        new GetCommand({\r\n          TableName: exportTableName,\r\n          Key: { export_id: body.export_id },\r\n        })\r\n      );\r\n\r\n      expect(getResult.Item).toBeDefined();\r\n      expect(getResult.Item?.format).toBe('csv');\r\n      const filter = JSON.parse(getResult.Item?.filter || '{}');\r\n      expect(filter.company_code).toBe('1234');\r\n    });\r\n\r\n    it('有効なAPIキーで複数のエクスポートリクエストが処理できる', async () => {\r\n      // Arrange\r\n      const event1 = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      const event2 = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'csv',\r\n          filter: {\r\n            start_date: '2024-01-01',\r\n            end_date: '2024-01-31',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result1 = await handler(event1, mockContext);\r\n      const result2 = await handler(event2, mockContext);\r\n\r\n      // Assert\r\n      expect(result1.statusCode).toBe(202);\r\n      expect(result2.statusCode).toBe(202);\r\n\r\n      const body1 = JSON.parse(result1.body);\r\n      const body2 = JSON.parse(result2.body);\r\n\r\n      // 異なるエクスポートIDが生成される\r\n      expect(body1.export_id).not.toBe(body2.export_id);\r\n    });\r\n  });\r\n\r\n  describe('Property 9.3: APIキー認証とバリデーションの組み合わせ', () => {\r\n    it('有効なAPIキーでも不正なフォーマットは400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'xml', // 不正なフォーマット\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid format');\r\n    });\r\n\r\n    it('有効なAPIキーでも不正な日付フォーマットは400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024/01/15', // 不正なフォーマット\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid start_date format');\r\n    });\r\n\r\n    it('有効なAPIキーでも開始日が終了日より後の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-20',\r\n            end_date: '2024-01-15', // 開始日より前\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('start_date');\r\n      expect(body.error.message).toContain('must be before or equal to');\r\n      expect(body.error.message).toContain('end_date');\r\n    });\r\n\r\n    it('有効なAPIキーでも不正な企業コードは400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            company_code: '12345', // 5桁（不正）\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid company_code format');\r\n    });\r\n\r\n    it('有効なAPIキーでもリクエストボディが空の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: '',\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n    });\r\n\r\n    it('有効なAPIキーでも不正なJSON形式は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key-e2e-export',\r\n        },\r\n        body: 'invalid json',\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n    });\r\n  });\r\n\r\n  describe('Property 9.4: エラーレスポンスの一貫性', () => {\r\n    it('すべてのエラーレスポンスにCORSヘッダーが含まれる', async () => {\r\n      // Arrange: APIキーなし\r\n      const event = {\r\n        headers: {},\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n      expect(result.headers?.['Access-Control-Allow-Headers']).toContain('X-Api-Key');\r\n      expect(result.headers?.['Content-Type']).toBe('application/json');\r\n    });\r\n\r\n    it('すべてのエラーレスポンスにrequest_idが含まれる', async () => {\r\n      // Arrange: 無効なAPIキー\r\n      const event = {\r\n        headers: {\r\n          'x-api-key': 'invalid-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.request_id).toBe(mockContext.awsRequestId);\r\n    });\r\n\r\n    it('エラーレスポンスの構造が一貫している', async () => {\r\n      // Arrange: APIキーなし\r\n      const event = {\r\n        headers: {},\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as unknown as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      const body = JSON.parse(result.body);\r\n      expect(body).toHaveProperty('status');\r\n      expect(body).toHaveProperty('error');\r\n      expect(body).toHaveProperty('request_id');\r\n      expect(body.status).toBe('error');\r\n      expect(body.error).toHaveProperty('code');\r\n      expect(body.error).toHaveProperty('message');\r\n      expect(body.error).toHaveProperty('details');\r\n      expect(typeof body.error.code).toBe('string');\r\n      expect(typeof body.error.message).toBe('string');\r\n      expect(typeof body.error.details).toBe('object');\r\n    });\r\n  });\r\n});\r\n"],"version":3}