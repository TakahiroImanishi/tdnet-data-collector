23824f060385ae7baf9466569551a253
/**
 * Jest Setup for E2E Tests
 *
 * LocalStack環境変数を設定し、E2Eテストの実行環境を準備します。
 */

// デバッグ: 環境変数の読み込み状況を確認
console.log('=== E2E Test Environment Variables ===');
console.log('AWS_ENDPOINT_URL:', process.env.AWS_ENDPOINT_URL);
console.log('AWS_REGION:', process.env.AWS_REGION);
console.log('DYNAMODB_TABLE_DISCLOSURES:', process.env.DYNAMODB_TABLE_DISCLOSURES);
console.log('DYNAMODB_TABLE_EXECUTIONS:', process.env.DYNAMODB_TABLE_EXECUTIONS);
console.log('EXPORT_STATUS_TABLE_NAME:', process.env.EXPORT_STATUS_TABLE_NAME);
console.log('S3_BUCKET_PDFS:', process.env.S3_BUCKET_PDFS);
console.log('S3_BUCKET_EXPORTS:', process.env.S3_BUCKET_EXPORTS);
console.log('API_KEY:', process.env.API_KEY ? '***' : 'undefined');
console.log('LOG_LEVEL:', process.env.LOG_LEVEL);
console.log('NODE_ENV:', process.env.NODE_ENV);
console.log('TEST_ENV:', process.env.TEST_ENV);
console.log('======================================');

// LocalStack環境変数のフォールバック設定（.env.localが読み込まれていない場合のみ）
if (process.env.NODE_ENV === 'test' || process.env.TEST_ENV === 'e2e') {
  process.env.AWS_ENDPOINT_URL = process.env.AWS_ENDPOINT_URL || 'http://localhost:4566';
  process.env.AWS_REGION = process.env.AWS_REGION || 'ap-northeast-1';
  process.env.AWS_ACCESS_KEY_ID = process.env.AWS_ACCESS_KEY_ID || 'test';
  process.env.AWS_SECRET_ACCESS_KEY = process.env.AWS_SECRET_ACCESS_KEY || 'test';
  process.env.DYNAMODB_TABLE_DISCLOSURES = process.env.DYNAMODB_TABLE_DISCLOSURES || 'tdnet_disclosures';
  process.env.DYNAMODB_TABLE_EXECUTIONS = process.env.DYNAMODB_TABLE_EXECUTIONS || 'tdnet_executions';
  process.env.EXPORT_STATUS_TABLE_NAME = process.env.EXPORT_STATUS_TABLE_NAME || 'tdnet-export-status';
  process.env.S3_BUCKET_PDFS = process.env.S3_BUCKET_PDFS || 'tdnet-data-collector-pdfs-local';
  process.env.S3_BUCKET_EXPORTS = process.env.S3_BUCKET_EXPORTS || 'tdnet-data-collector-exports-local';
  process.env.LOG_LEVEL = process.env.LOG_LEVEL || 'error'; // E2Eテスト中はエラーログのみ
  process.env.NODE_ENV = 'test';
}

// テストタイムアウトの延長（E2Eテストは時間がかかる）
jest.setTimeout(60000); // 60秒
