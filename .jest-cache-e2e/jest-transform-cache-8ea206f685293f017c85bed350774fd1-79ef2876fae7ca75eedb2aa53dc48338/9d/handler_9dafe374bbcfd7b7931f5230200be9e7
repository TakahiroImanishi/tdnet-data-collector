19955eaa34d4fddb623a22f6601256f3
"use strict";
/**
 * Lambda Export Handler
 *
 * TDnet開示情報をJSON/CSV形式でエクスポートするLambda関数のメインハンドラー。
 * APIキー認証を実装し、非同期でエクスポート処理を実行します。
 *
 * Requirements: 要件5.1, 5.2, 5.4, 11.1（エクスポート、認証）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = handler;
const logger_1 = require("../../utils/logger");
const cloudwatch_metrics_1 = require("../../utils/cloudwatch-metrics");
const errors_1 = require("../../errors");
const create_export_job_1 = require("./create-export-job");
const process_export_1 = require("./process-export");
/**
 * Lambda Exportハンドラー
 *
 * @param event ExportEvent（API Gateway経由）
 * @param context Lambda Context
 * @returns APIGatewayProxyResult
 *
 * @example
 * ```typescript
 * // JSON形式でエクスポート
 * const response = await handler({
 *   headers: { 'x-api-key': 'your-api-key' },
 *   body: JSON.stringify({
 *     format: 'json',
 *     filter: {
 *       start_date: '2024-01-15',
 *       end_date: '2024-01-20',
 *     },
 *   }),
 * }, context);
 *
 * // CSV形式でエクスポート
 * const response = await handler({
 *   headers: { 'x-api-key': 'your-api-key' },
 *   body: JSON.stringify({
 *     format: 'csv',
 *     filter: {
 *       company_code: '1234',
 *       start_date: '2024-01-01',
 *       end_date: '2024-01-31',
 *     },
 *   }),
 * }, context);
 * ```
 */
async function handler(event, context) {
    const startTime = Date.now();
    try {
        logger_1.logger.info('Lambda Export started', {
            request_id: context.awsRequestId,
            function_name: context.functionName,
        });
        // リクエストボディのパース
        const requestBody = parseRequestBody(event.body);
        // バリデーション
        validateRequestBody(requestBody);
        // エクスポートジョブを作成
        const exportJob = await (0, create_export_job_1.createExportJob)(requestBody, context.awsRequestId);
        // 非同期でエクスポート処理を開始（await しない）
        (0, process_export_1.processExport)(exportJob.export_id, requestBody)
            .catch((error) => {
            logger_1.logger.error('Export processing failed', (0, logger_1.createErrorContext)(error, {
                export_id: exportJob.export_id,
            }));
        });
        const duration = Date.now() - startTime;
        logger_1.logger.info('Lambda Export completed', {
            export_id: exportJob.export_id,
            status: exportJob.status,
            duration_ms: duration,
        });
        // 成功メトリクス送信
        await (0, cloudwatch_metrics_1.sendMetrics)([
            {
                name: 'LambdaExecutionTime',
                value: duration,
                unit: 'Milliseconds',
                dimensions: { FunctionName: 'Export' },
            },
            {
                name: 'ExportJobsCreated',
                value: 1,
                unit: 'Count',
                dimensions: { Format: requestBody.format },
            },
        ]);
        // レスポンス
        const response = {
            export_id: exportJob.export_id,
            status: exportJob.status,
            message: 'Export job created successfully',
            progress: exportJob.progress,
        };
        return {
            statusCode: 202, // Accepted
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Headers': 'Content-Type,X-Api-Key',
            },
            body: JSON.stringify(response),
        };
    }
    catch (error) {
        const duration = Date.now() - startTime;
        logger_1.logger.error('Lambda Export failed', (0, logger_1.createErrorContext)(error, {
            request_id: context.awsRequestId,
            duration_ms: duration,
        }));
        // エラーメトリクス送信
        await (0, cloudwatch_metrics_1.sendErrorMetric)(error instanceof Error ? error.constructor.name : 'Unknown', 'Export');
        // エラーレスポンス
        return handleError(error, context.awsRequestId);
    }
}
/**
 * リクエストボディのパース
 *
 * @param body リクエストボディ（JSON文字列）
 * @returns ExportRequestBody
 * @throws ValidationError パースエラーの場合
 */
function parseRequestBody(body) {
    if (!body) {
        throw new errors_1.ValidationError('Request body is required');
    }
    try {
        return JSON.parse(body);
    }
    catch (error) {
        throw new errors_1.ValidationError('Invalid JSON format in request body', {
            body,
            error: error instanceof Error ? error.message : String(error),
        });
    }
}
/**
 * リクエストボディのバリデーション
 *
 * @param requestBody ExportRequestBody
 * @throws ValidationError バリデーションエラーの場合
 */
function validateRequestBody(requestBody) {
    // フォーマットのバリデーション
    if (!requestBody.format || !['json', 'csv'].includes(requestBody.format)) {
        throw new errors_1.ValidationError(`Invalid format: ${requestBody.format}. Expected 'json' or 'csv'.`);
    }
    // フィルターのバリデーション
    if (!requestBody.filter) {
        throw new errors_1.ValidationError('Filter is required');
    }
    const { filter } = requestBody;
    // 日付フォーマットのバリデーション（YYYY-MM-DD）
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (filter.start_date && !dateRegex.test(filter.start_date)) {
        throw new errors_1.ValidationError(`Invalid start_date format: ${filter.start_date}. Expected YYYY-MM-DD format.`);
    }
    if (filter.end_date && !dateRegex.test(filter.end_date)) {
        throw new errors_1.ValidationError(`Invalid end_date format: ${filter.end_date}. Expected YYYY-MM-DD format.`);
    }
    // 日付の有効性チェック
    if (filter.start_date) {
        const startDate = new Date(filter.start_date);
        if (isNaN(startDate.getTime())) {
            throw new errors_1.ValidationError(`Invalid start_date: ${filter.start_date}. Date does not exist.`);
        }
    }
    if (filter.end_date) {
        const endDate = new Date(filter.end_date);
        if (isNaN(endDate.getTime())) {
            throw new errors_1.ValidationError(`Invalid end_date: ${filter.end_date}. Date does not exist.`);
        }
    }
    // 日付順序チェック
    if (filter.start_date && filter.end_date) {
        const startDate = new Date(filter.start_date);
        const endDate = new Date(filter.end_date);
        if (startDate > endDate) {
            throw new errors_1.ValidationError(`start_date (${filter.start_date}) must be before or equal to end_date (${filter.end_date})`);
        }
    }
    // 企業コードのバリデーション（4桁の数字）
    if (filter.company_code && !/^\d{4}$/.test(filter.company_code)) {
        throw new errors_1.ValidationError(`Invalid company_code format: ${filter.company_code}. Expected 4-digit number.`);
    }
}
/**
 * エラーハンドリング
 *
 * @param error エラーオブジェクト
 * @param requestId リクエストID
 * @returns APIGatewayProxyResult
 */
function handleError(error, requestId) {
    // エラー種別に応じたステータスコードとエラーコード
    let statusCode = 500;
    let errorCode = 'INTERNAL_ERROR';
    if (error instanceof errors_1.ValidationError) {
        statusCode = 400;
        errorCode = 'VALIDATION_ERROR';
    }
    else if (error instanceof errors_1.AuthenticationError) {
        statusCode = 401;
        errorCode = 'UNAUTHORIZED';
    }
    return {
        statusCode,
        headers: {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Headers': 'Content-Type,X-Api-Key',
        },
        body: JSON.stringify({
            status: 'error',
            error: {
                code: errorCode,
                message: error.message,
                details: error.details || {},
            },
            request_id: requestId,
        }),
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcaGFuZGxlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUE2Q0gsMEJBNkZDO0FBdklELCtDQUFnRTtBQUNoRSx1RUFBOEU7QUFDOUUseUNBQW9FO0FBRXBFLDJEQUFzRDtBQUN0RCxxREFBaUQ7QUFFakQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FrQ0c7QUFDSSxLQUFLLFVBQVUsT0FBTyxDQUMzQixLQUFrQixFQUNsQixPQUFnQjtJQUVoQixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFFN0IsSUFBSSxDQUFDO1FBQ0gsZUFBTSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRTtZQUNuQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFlBQVk7WUFDaEMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxZQUFZO1NBQ3BDLENBQUMsQ0FBQztRQUVILGVBQWU7UUFDZixNQUFNLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakQsVUFBVTtRQUNWLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRWpDLGVBQWU7UUFDZixNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUEsbUNBQWUsRUFBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTNFLDZCQUE2QjtRQUM3QixJQUFBLDhCQUFhLEVBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUM7YUFDNUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDZixlQUFNLENBQUMsS0FBSyxDQUNWLDBCQUEwQixFQUMxQixJQUFBLDJCQUFrQixFQUFDLEtBQWMsRUFBRTtnQkFDakMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxTQUFTO2FBQy9CLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFF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QUssWUFBWSx3QkFBZSxFQUFFLENBQUM7UUFDckMsVUFBVSxHQUFHLEdBQUcsQ0FBQztRQUNqQixTQUFTLEdBQUcsa0JBQWtCLENBQUM7SUFDakMsQ0FBQztTQUFNLElBQUksS0FBSyxZQUFZLDRCQUFtQixFQUFFLENBQUM7UUFDaEQsVUFBVSxHQUFHLEdBQUcsQ0FBQztRQUNqQixTQUFTLEdBQUcsY0FBYyxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPO1FBQ0wsVUFBVTtRQUNWLE9BQU8sRUFBRTtZQUNQLGNBQWMsRUFBRSxrQkFBa0I7WUFDbEMsNkJBQTZCLEVBQUUsR0FBRztZQUNsQyw4QkFBOEIsRUFBRSx3QkFBd0I7U0FDekQ7UUFDRCxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUNuQixNQUFNLEVBQUUsT0FBTztZQUNmLEtBQUssRUFBRTtnQkFDTCxJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3RCLE9BQU8sRUFBRyxLQUFhLENBQUMsT0FBTyxJQUFJLEVBQUU7YUFDdEM7WUFDRCxVQUFVLEVBQUUsU0FBUztTQUN0QixDQUFDO0tBQ0gsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcaGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogTGFtYmRhIEV4cG9ydCBIYW5kbGVyXHJcbiAqXHJcbiAqIFREbmV06ZaL56S65oOF5aCx44KSSlNPTi9DU1blvaLlvI/jgafjgqjjgq/jgrnjg53jg7zjg4jjgZnjgotMYW1iZGHplqLmlbDjga7jg6HjgqTjg7Pjg4/jg7Pjg4njg6njg7zjgIJcclxuICogQVBJ44Kt44O86KqN6Ki844KS5a6f6KOF44GX44CB6Z2e5ZCM5pyf44Gn44Ko44Kv44K544Od44O844OI5Yem55CG44KS5a6f6KGM44GX44G+44GZ44CCXHJcbiAqXHJcbiAqIFJlcXVpcmVtZW50czog6KaB5Lu2NS4xLCA1LjIsIDUuNCwgMTEuMe+8iOOCqOOCr+OCueODneODvOODiOOAgeiqjeiovO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eVJlc3VsdCwgQ29udGV4dCB9IGZyb20gJ2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgeyBsb2dnZXIsIGNyZWF0ZUVycm9yQ29udGV4dCB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZ2dlcic7XHJcbmltcG9ydCB7IHNlbmRFcnJvck1ldHJpYywgc2VuZE1ldHJpY3MgfSBmcm9tICcuLi8uLi91dGlscy9jbG91ZHdhdGNoLW1ldHJpY3MnO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IsIEF1dGhlbnRpY2F0aW9uRXJyb3IgfSBmcm9tICcuLi8uLi9lcnJvcnMnO1xyXG5pbXBvcnQgeyBFeHBvcnRFdmVudCwgRXhwb3J0UmVxdWVzdEJvZHksIEV4cG9ydFJlc3BvbnNlIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IGNyZWF0ZUV4cG9ydEpvYiB9IGZyb20gJy4vY3JlYXRlLWV4cG9ydC1qb2InO1xyXG5pbXBvcnQgeyBwcm9jZXNzRXhwb3J0IH0gZnJvbSAnLi9wcm9jZXNzLWV4cG9ydCc7XHJcblxyXG4vKipcclxuICogTGFtYmRhIEV4cG9ydOODj+ODs+ODieODqeODvFxyXG4gKlxyXG4gKiBAcGFyYW0gZXZlbnQgRXhwb3J0RXZlbnTvvIhBUEkgR2F0ZXdheee1jOeUse+8iVxyXG4gKiBAcGFyYW0gY29udGV4dCBMYW1iZGEgQ29udGV4dFxyXG4gKiBAcmV0dXJucyBBUElHYXRld2F5UHJveHlSZXN1bHRcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiAvLyBKU09O5b2i5byP44Gn44Ko44Kv44K544Od44O844OIXHJcbiAqIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcih7XHJcbiAqICAgaGVhZGVyczogeyAneC1hcGkta2V5JzogJ3lvdXItYXBpLWtleScgfSxcclxuICogICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAqICAgICBmb3JtYXQ6ICdqc29uJyxcclxuICogICAgIGZpbHRlcjoge1xyXG4gKiAgICAgICBzdGFydF9kYXRlOiAnMjAyNC0wMS0xNScsXHJcbiAqICAgICAgIGVuZF9kYXRlOiAnMjAyNC0wMS0yMCcsXHJcbiAqICAgICB9LFxyXG4gKiAgIH0pLFxyXG4gKiB9LCBjb250ZXh0KTtcclxuICpcclxuICogLy8gQ1NW5b2i5byP44Gn44Ko44Kv44K544Od44O844OIXHJcbiAqIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcih7XHJcbiAqICAgaGVhZGVyczogeyAneC1hcGkta2V5JzogJ3lvdXItYXBpLWtleScgfSxcclxuICogICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAqICAgICBmb3JtYXQ6ICdjc3YnLFxyXG4gKiAgICAgZmlsdGVyOiB7XHJcbiAqICAgICAgIGNvbXBhbnlfY29kZTogJzEyMzQnLFxyXG4gKiAgICAgICBzdGFydF9kYXRlOiAnMjAyNC0wMS0wMScsXHJcbiAqICAgICAgIGVuZF9kYXRlOiAnMjAyNC0wMS0zMScsXHJcbiAqICAgICB9LFxyXG4gKiAgIH0pLFxyXG4gKiB9LCBjb250ZXh0KTtcclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcclxuICBldmVudDogRXhwb3J0RXZlbnQsXHJcbiAgY29udGV4dDogQ29udGV4dFxyXG4pOiBQcm9taXNlPEFQSUdhdGV3YXlQcm94eVJlc3VsdD4ge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBsb2dnZXIuaW5mbygnTGFtYmRhIEV4cG9ydCBzdGFydGVkJywge1xyXG4gICAgICByZXF1ZXN0X2lkOiBjb250ZXh0LmF3c1JlcXVlc3RJZCxcclxuICAgICAgZnVuY3Rpb25fbmFtZTogY29udGV4dC5mdW5jdGlvbk5hbWUsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDjg6rjgq/jgqjjgrnjg4jjg5zjg4fjgqPjga7jg5Hjg7zjgrlcclxuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gcGFyc2VSZXF1ZXN0Qm9keShldmVudC5ib2R5KTtcclxuXHJcbiAgICAvLyDjg5Djg6rjg4fjg7zjgrfjg6fjg7NcclxuICAgIHZhbGlkYXRlUmVxdWVzdEJvZHkocmVxdWVzdEJvZHkpO1xyXG5cclxuICAgIC8vIOOCqOOCr+OCueODneODvOODiOOCuOODp+ODluOCkuS9nOaIkFxyXG4gICAgY29uc3QgZXhwb3J0Sm9iID0gYXdhaXQgY3JlYXRlRXhwb3J0Sm9iKHJlcXVlc3RCb2R5LCBjb250ZXh0LmF3c1JlcXVlc3RJZCk7XHJcblxyXG4gICAgLy8g6Z2e5ZCM5pyf44Gn44Ko44Kv44K544Od44O844OI5Yem55CG44KS6ZaL5aeL77yIYXdhaXQg44GX44Gq44GE77yJXHJcbiAgICBwcm9jZXNzRXhwb3J0KGV4cG9ydEpvYi5leHBvcnRfaWQsIHJlcXVlc3RCb2R5KVxyXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxyXG4gICAgICAgICAgJ0V4cG9ydCBwcm9jZXNzaW5nIGZhaWxlZCcsXHJcbiAgICAgICAgICBjcmVhdGVFcnJvckNvbnRleHQoZXJyb3IgYXMgRXJyb3IsIHtcclxuICAgICAgICAgICAgZXhwb3J0X2lkOiBleHBvcnRKb2IuZXhwb3J0X2lkLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ0xhbWJkYSBFeHBvcnQgY29tcGxldGVkJywge1xyXG4gICAgICBleHBvcnRfaWQ6IGV4cG9ydEpvYi5leHBvcnRfaWQsXHJcbiAgICAgIHN0YXR1czogZXhwb3J0Sm9iLnN0YXR1cyxcclxuICAgICAgZHVyYXRpb25fbXM6IGR1cmF0aW9uLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5oiQ5Yqf44Oh44OI44Oq44Kv44K56YCB5L+hXHJcbiAgICBhd2FpdCBzZW5kTWV0cmljcyhbXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiAnTGFtYmRhRXhlY3V0aW9uVGltZScsXHJcbiAgICAgICAgdmFsdWU6IGR1cmF0aW9uLFxyXG4gICAgICAgIHVuaXQ6ICdNaWxsaXNlY29uZHMnLFxyXG4gICAgICAgIGRpbWVuc2lvbnM6IHsgRnVuY3Rpb25OYW1lOiAnRXhwb3J0JyB9LFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogJ0V4cG9ydEpvYnNDcmVhdGVkJyxcclxuICAgICAgICB2YWx1ZTogMSxcclxuICAgICAgICB1bml0OiAnQ291bnQnLFxyXG4gICAgICAgIGRpbWVuc2lvbnM6IHsgRm9ybWF0OiByZXF1ZXN0Qm9keS5mb3JtYXQgfSxcclxuICAgICAgfSxcclxuICAgIF0pO1xyXG5cclxuICAgIC8vIOODrOOCueODneODs+OCuVxyXG4gICAgY29uc3QgcmVzcG9uc2U6IEV4cG9ydFJlc3BvbnNlID0ge1xyXG4gICAgICBleHBvcnRfaWQ6IGV4cG9ydEpvYi5leHBvcnRfaWQsXHJcbiAgICAgIHN0YXR1czogZXhwb3J0Sm9iLnN0YXR1cyxcclxuICAgICAgbWVzc2FnZTogJ0V4cG9ydCBqb2IgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICBwcm9ncmVzczogZXhwb3J0Sm9iLnByb2dyZXNzLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXNDb2RlOiAyMDIsIC8vIEFjY2VwdGVkXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXHJcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnOiAnQ29udGVudC1UeXBlLFgtQXBpLUtleScsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICBsb2dnZXIuZXJyb3IoXHJcbiAgICAgICdMYW1iZGEgRXhwb3J0IGZhaWxlZCcsXHJcbiAgICAgIGNyZWF0ZUVycm9yQ29udGV4dChlcnJvciBhcyBFcnJvciwge1xyXG4gICAgICAgIHJlcXVlc3RfaWQ6IGNvbnRleHQuYXdzUmVxdWVzdElkLFxyXG4gICAgICAgIGR1cmF0aW9uX21zOiBkdXJhdGlvbixcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgLy8g44Ko44Op44O844Oh44OI44Oq44Kv44K56YCB5L+hXHJcbiAgICBhd2FpdCBzZW5kRXJyb3JNZXRyaWMoXHJcbiAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5jb25zdHJ1Y3Rvci5uYW1lIDogJ1Vua25vd24nLFxyXG4gICAgICAnRXhwb3J0J1xyXG4gICAgKTtcclxuXHJcbiAgICAvLyDjgqjjg6njg7zjg6zjgrnjg53jg7PjgrlcclxuICAgIHJldHVybiBoYW5kbGVFcnJvcihlcnJvciBhcyBFcnJvciwgY29udGV4dC5hd3NSZXF1ZXN0SWQpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOODquOCr+OCqOOCueODiOODnOODh+OCo+OBruODkeODvOOCuVxyXG4gKlxyXG4gKiBAcGFyYW0gYm9keSDjg6rjgq/jgqjjgrnjg4jjg5zjg4fjgqPvvIhKU09O5paH5a2X5YiX77yJXHJcbiAqIEByZXR1cm5zIEV4cG9ydFJlcXVlc3RCb2R5XHJcbiAqIEB0aHJvd3MgVmFsaWRhdGlvbkVycm9yIOODkeODvOOCueOCqOODqeODvOOBruWgtOWQiFxyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VSZXF1ZXN0Qm9keShib2R5OiBzdHJpbmcpOiBFeHBvcnRSZXF1ZXN0Qm9keSB7XHJcbiAgaWYgKCFib2R5KSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdSZXF1ZXN0IGJvZHkgaXMgcmVxdWlyZWQnKTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShib2R5KSBhcyBFeHBvcnRSZXF1ZXN0Qm9keTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignSW52YWxpZCBKU09OIGZvcm1hdCBpbiByZXF1ZXN0IGJvZHknLCB7XHJcbiAgICAgIGJvZHksXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjg6rjgq/jgqjjgrnjg4jjg5zjg4fjgqPjga7jg5Djg6rjg4fjg7zjgrfjg6fjg7NcclxuICpcclxuICogQHBhcmFtIHJlcXVlc3RCb2R5IEV4cG9ydFJlcXVlc3RCb2R5XHJcbiAqIEB0aHJvd3MgVmFsaWRhdGlvbkVycm9yIOODkOODquODh+ODvOOCt+ODp+ODs+OCqOODqeODvOOBruWgtOWQiFxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVSZXF1ZXN0Qm9keShyZXF1ZXN0Qm9keTogRXhwb3J0UmVxdWVzdEJvZHkpOiB2b2lkIHtcclxuICAvLyDjg5Xjgqnjg7zjg57jg4Pjg4jjga7jg5Djg6rjg4fjg7zjgrfjg6fjg7NcclxuICBpZiAoIXJlcXVlc3RCb2R5LmZvcm1hdCB8fCAhWydqc29uJywgJ2NzdiddLmluY2x1ZGVzKHJlcXVlc3RCb2R5LmZvcm1hdCkpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBJbnZhbGlkIGZvcm1hdDogJHtyZXF1ZXN0Qm9keS5mb3JtYXR9LiBFeHBlY3RlZCAnanNvbicgb3IgJ2NzdicuYFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vIOODleOCo+ODq+OCv+ODvOOBruODkOODquODh+ODvOOCt+ODp+ODs1xyXG4gIGlmICghcmVxdWVzdEJvZHkuZmlsdGVyKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdGaWx0ZXIgaXMgcmVxdWlyZWQnKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgZmlsdGVyIH0gPSByZXF1ZXN0Qm9keTtcclxuXHJcbiAgLy8g5pel5LuY44OV44Kp44O844Oe44OD44OI44Gu44OQ44Oq44OH44O844K344On44Oz77yIWVlZWS1NTS1ERO+8iVxyXG4gIGNvbnN0IGRhdGVSZWdleCA9IC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLztcclxuXHJcbiAgaWYgKGZpbHRlci5zdGFydF9kYXRlICYmICFkYXRlUmVnZXgudGVzdChmaWx0ZXIuc3RhcnRfZGF0ZSkpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBJbnZhbGlkIHN0YXJ0X2RhdGUgZm9ybWF0OiAke2ZpbHRlci5zdGFydF9kYXRlfS4gRXhwZWN0ZWQgWVlZWS1NTS1ERCBmb3JtYXQuYFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmIChmaWx0ZXIuZW5kX2RhdGUgJiYgIWRhdGVSZWdleC50ZXN0KGZpbHRlci5lbmRfZGF0ZSkpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBJbnZhbGlkIGVuZF9kYXRlIGZvcm1hdDogJHtmaWx0ZXIuZW5kX2RhdGV9LiBFeHBlY3RlZCBZWVlZLU1NLUREIGZvcm1hdC5gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8g5pel5LuY44Gu5pyJ5Yq55oCn44OB44Kn44OD44KvXHJcbiAgaWYgKGZpbHRlci5zdGFydF9kYXRlKSB7XHJcbiAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShmaWx0ZXIuc3RhcnRfZGF0ZSk7XHJcbiAgICBpZiAoaXNOYU4oc3RhcnREYXRlLmdldFRpbWUoKSkpIHtcclxuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihcclxuICAgICAgICBgSW52YWxpZCBzdGFydF9kYXRlOiAke2ZpbHRlci5zdGFydF9kYXRlfS4gRGF0ZSBkb2VzIG5vdCBleGlzdC5gXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAoZmlsdGVyLmVuZF9kYXRlKSB7XHJcbiAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoZmlsdGVyLmVuZF9kYXRlKTtcclxuICAgIGlmIChpc05hTihlbmREYXRlLmdldFRpbWUoKSkpIHtcclxuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihcclxuICAgICAgICBgSW52YWxpZCBlbmRfZGF0ZTogJHtmaWx0ZXIuZW5kX2RhdGV9LiBEYXRlIGRvZXMgbm90IGV4aXN0LmBcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIOaXpeS7mOmghuW6j+ODgeOCp+ODg+OCr1xyXG4gIGlmIChmaWx0ZXIuc3RhcnRfZGF0ZSAmJiBmaWx0ZXIuZW5kX2RhdGUpIHtcclxuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKGZpbHRlci5zdGFydF9kYXRlKTtcclxuICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShmaWx0ZXIuZW5kX2RhdGUpO1xyXG5cclxuICAgIGlmIChzdGFydERhdGUgPiBlbmREYXRlKSB7XHJcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgICAgYHN0YXJ0X2RhdGUgKCR7ZmlsdGVyLnN0YXJ0X2RhdGV9KSBtdXN0IGJlIGJlZm9yZSBvciBlcXVhbCB0byBlbmRfZGF0ZSAoJHtmaWx0ZXIuZW5kX2RhdGV9KWBcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIOS8gealreOCs+ODvOODieOBruODkOODquODh+ODvOOCt+ODp+ODs++8iDTmoYHjga7mlbDlrZfvvIlcclxuICBpZiAoZmlsdGVyLmNvbXBhbnlfY29kZSAmJiAhL15cXGR7NH0kLy50ZXN0KGZpbHRlci5jb21wYW55X2NvZGUpKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICBgSW52YWxpZCBjb21wYW55X2NvZGUgZm9ybWF0OiAke2ZpbHRlci5jb21wYW55X2NvZGV9LiBFeHBlY3RlZCA0LWRpZ2l0IG51bWJlci5gXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOOCqOODqeODvOODj+ODs+ODieODquODs+OCsFxyXG4gKlxyXG4gKiBAcGFyYW0gZXJyb3Ig44Ko44Op44O844Kq44OW44K444Kn44Kv44OIXHJcbiAqIEBwYXJhbSByZXF1ZXN0SWQg44Oq44Kv44Ko44K544OISURcclxuICogQHJldHVybnMgQVBJR2F0ZXdheVByb3h5UmVzdWx0XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnJvcjogRXJyb3IsIHJlcXVlc3RJZDogc3RyaW5nKTogQVBJR2F0ZXdheVByb3h5UmVzdWx0IHtcclxuICAvLyDjgqjjg6njg7znqK7liKXjgavlv5zjgZjjgZ/jgrnjg4bjg7zjgr/jgrnjgrPjg7zjg4njgajjgqjjg6njg7zjgrPjg7zjg4lcclxuICBsZXQgc3RhdHVzQ29kZSA9IDUwMDtcclxuICBsZXQgZXJyb3JDb2RlID0gJ0lOVEVSTkFMX0VSUk9SJztcclxuXHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yKSB7XHJcbiAgICBzdGF0dXNDb2RlID0gNDAwO1xyXG4gICAgZXJyb3JDb2RlID0gJ1ZBTElEQVRJT05fRVJST1InO1xyXG4gIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBdXRoZW50aWNhdGlvbkVycm9yKSB7XHJcbiAgICBzdGF0dXNDb2RlID0gNDAxO1xyXG4gICAgZXJyb3JDb2RlID0gJ1VOQVVUSE9SSVpFRCc7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgc3RhdHVzQ29kZSxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnOiAnQ29udGVudC1UeXBlLFgtQXBpLUtleScsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgY29kZTogZXJyb3JDb2RlLFxyXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgZGV0YWlsczogKGVycm9yIGFzIGFueSkuZGV0YWlscyB8fCB7fSxcclxuICAgICAgfSxcclxuICAgICAgcmVxdWVzdF9pZDogcmVxdWVzdElkLFxyXG4gICAgfSksXHJcbiAgfTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=