# TDnet Data Collector

TDnet Data Collectorã¯ã€æ—¥æœ¬å–å¼•æ‰€ã‚°ãƒ«ãƒ¼ãƒ—ã®TDnetï¼ˆé©æ™‚é–‹ç¤ºæƒ…å ±é–²è¦§ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‹ã‚‰ä¸Šå ´ä¼æ¥­ã®é–‹ç¤ºæƒ…å ±ã‚’è‡ªå‹•åé›†ã™ã‚‹AWSãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**æœ€çµ‚æ›´æ–°æ—¥**: 2026-02-22

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ä¸»è¦æ©Ÿèƒ½](#ä¸»è¦æ©Ÿèƒ½)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [é–‹ç™º](#é–‹ç™º)
- [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
- [ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒ‡ãƒ—ãƒ­ã‚¤)
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹](#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹)

---

## æ¦‚è¦

TDnet Data Collectorã¯ã€æ—¥æœ¬ã®ä¸Šå ´ä¼æ¥­ãŒå…¬é–‹ã™ã‚‹é©æ™‚é–‹ç¤ºæƒ…å ±ã‚’è‡ªå‹•çš„ã«åé›†ãƒ»ä¿å­˜ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã€AWSç„¡æ–™æ å†…ã§é‹ç”¨å¯èƒ½ãªã‚³ã‚¹ãƒˆåŠ¹ç‡ã®é«˜ã„è¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚

**å®Ÿè£…çŠ¶æ³**: Phase 1-4å®Œäº†ï¼ˆåŸºæœ¬æ©Ÿèƒ½ã€APIå®Ÿè£…ã€Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€é‹ç”¨æ”¹å–„ï¼‰ã€Phase 5é€²è¡Œä¸­ï¼ˆæœ¬ç•ªé‹ç”¨å¾Œã®è‡ªå‹•åŒ–å¼·åŒ–ï¼‰

### ä¸»è¦æ©Ÿèƒ½

#### âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 1-4ï¼‰

- âœ… **ãƒ‡ãƒ¼ã‚¿åé›†**: æŒ‡å®šæœŸé–“ã®é–‹ç¤ºæƒ…å ±ã‚’æ‰‹å‹•ã§åé›†ï¼ˆã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰åé›†ï¼‰
- âœ… **PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: é–‹ç¤ºè³‡æ–™ï¼ˆPDFï¼‰ã‚’è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦S3ã«ä¿å­˜
- âœ… **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: é–‹ç¤ºæƒ…å ±ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’DynamoDBã«ä¿å­˜
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: éƒ¨åˆ†çš„å¤±æ•—ã‚’è¨±å®¹ã—ã€å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
- âœ… **å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†**: åé›†å‡¦ç†ã®é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¿½è·¡
- âœ… **ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ**: CloudWatchã«ã‚ˆã‚‹ç›£è¦–ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡
- âœ… **æ¤œç´¢API**: ä¼æ¥­ã‚³ãƒ¼ãƒ‰ã€æ—¥ä»˜ç¯„å›²ã€é–‹ç¤ºç¨®åˆ¥ã«ã‚ˆã‚‹æ¤œç´¢
- âœ… **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆAPI**: JSON/CSVå½¢å¼ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- âœ… **APIã‚­ãƒ¼èªè¨¼**: Secrets ManagerçµŒç”±ã®å®‰å…¨ãªèªè¨¼
- âœ… **Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: åé›†çŠ¶æ³ã®å¯è¦–åŒ–ï¼ˆPhase 3ï¼‰
- âœ… **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: GitHub Actionsã«ã‚ˆã‚‹è‡ªå‹•ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆPhase 4ï¼‰
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: CloudTrailç›£æŸ»ãƒ­ã‚°ã€WAFä¿è­·ï¼ˆPhase 4ï¼‰

#### ğŸš§ Phase 5é€²è¡Œä¸­ï¼ˆè¨­å®šãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼‰

- âœ… **Secrets Managerãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: 90æ—¥ã”ã¨ã®è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æœ‰åŠ¹åŒ–
- âœ… **CloudFront TLS 1.2**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ä½¿ç”¨æ™‚ã®è¨­å®šæ–¹æ³•ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
- âœ… **ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ**: API Gateway 4XXErrorã‚¢ãƒ©ãƒ¼ãƒ é–¾å€¤ã®æ˜ç¢ºåŒ–
- âœ… **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: README.mdã€monitoring-alerts.mdã®æ›´æ–°

#### âš ï¸ æœªå®Ÿè£…ï¼ˆPhase 5æ®‹ã‚¿ã‚¹ã‚¯ï¼‰

- âš ï¸ **è‡ªå‹•åé›†**: æ¯æ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰ã®è‡ªå‹•åé›†ï¼ˆEventBridgeæœªè¨­å®šï¼‰
- âš ï¸ **SNSé€šçŸ¥**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ãƒ»ãƒãƒƒãƒå®Œäº†æ™‚ã®é€šçŸ¥ï¼ˆSNSæœªè¨­å®šï¼‰

---

## æœ¬ç•ªç’°å¢ƒ

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- **URL**: `https://[CLOUDFRONT_DISTRIBUTION_ID].cloudfront.net` ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«æ›´æ–°ï¼‰
- **èª¬æ˜**: TDneté–‹ç¤ºæƒ…å ±ã®æ¤œç´¢ãƒ»é–²è¦§Webã‚¢ãƒ—ãƒª

### API Endpoint
- **URL**: `https://[API_GATEWAY_ID].execute-api.ap-northeast-1.amazonaws.com/prod` ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«æ›´æ–°ï¼‰
- **èªè¨¼**: APIã‚­ãƒ¼å¿…é ˆï¼ˆ`x-api-key`ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [APIè¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](.kiro/steering/api/api-design-guidelines.md)

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|---------|------|
| **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ** | Node.js 20.x |
| **è¨€èª** | TypeScript 5.x |
| **ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°** | AWS Lambda |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Amazon DynamoDB |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** | Amazon S3 |
| **API** | Amazon API Gateway (Phase 2ä»¥é™) |
| **IaC** | AWS CDK (TypeScript) |
| **ç›£è¦–** | CloudWatch Logs & Metrics |
| **ãƒ†ã‚¹ãƒˆ** | Jest, fast-check (Property-Based Testing) |
| **ã‚³ãƒ¼ãƒ‰å“è³ª** | ESLint, Prettier |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
tdnet-data-collector/
â”œâ”€â”€ src/                          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ lambda/                   # Lambdaé–¢æ•°ï¼ˆ9å€‹å®Ÿè£…æ¸ˆã¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ collector/            # é–‹ç¤ºæƒ…å ±åé›†Lambda
â”‚   â”‚   â”œâ”€â”€ query/                # é–‹ç¤ºæƒ…å ±æ¤œç´¢Lambda
â”‚   â”‚   â”œâ”€â”€ export/               # ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆLambda
â”‚   â”‚   â”œâ”€â”€ collect/              # åé›†å‡¦ç†ãƒˆãƒªã‚¬ãƒ¼Lambda
â”‚   â”‚   â”œâ”€â”€ collect-status/       # åé›†çŠ¶æ…‹å–å¾—Lambda
â”‚   â”‚   â”œâ”€â”€ stats/                # çµ±è¨ˆæƒ…å ±å–å¾—Lambda
â”‚   â”‚   â”œâ”€â”€ health/               # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯Lambda
â”‚   â”‚   â””â”€â”€ api/                  # APIé–¢é€£Lambda
â”‚   â”‚       â”œâ”€â”€ pdf-download/     # PDFç½²åä»˜ãURLç”ŸæˆLambda
â”‚   â”‚       â””â”€â”€ export-status/    # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆçŠ¶æ…‹å–å¾—Lambda
â”‚   â”œâ”€â”€ validators/               # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â””â”€â”€ disclosure-schema.ts  # Zodã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚   â”œâ”€â”€ models/                   # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ disclosure.ts         # Disclosureãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ logger.ts             # æ§‹é€ åŒ–ãƒ­ã‚¬ãƒ¼
â”‚   â”‚   â”œâ”€â”€ cloudwatch-metrics.ts # ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡
â”‚   â”‚   â”œâ”€â”€ retry.ts              # å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ disclosure-id.ts      # é–‹ç¤ºIDç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ date-partition.ts     # date_partitionç”Ÿæˆ
â”‚   â”œâ”€â”€ scraper/                  # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
â”‚   â”‚   â””â”€â”€ html-parser.ts        # HTMLãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”œâ”€â”€ types/                    # å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts              # å…±é€šå‹å®šç¾©
â”‚   â””â”€â”€ errors/                   # ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼
â”‚       â””â”€â”€ index.ts              # ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹å®šç¾©
â”œâ”€â”€ cdk/                          # CDKã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ¼ãƒ‰ï¼ˆPhase 2ä»¥é™ï¼‰
â”‚   â”œâ”€â”€ bin/                      # CDKã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ lib/                      # CDKã‚¹ã‚¿ãƒƒã‚¯å®šç¾©
â”‚       â”œâ”€â”€ stacks/               # 4ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆFoundation, Compute, API, Monitoringï¼‰
â”‚       â””â”€â”€ constructs/           # å†åˆ©ç”¨å¯èƒ½ãªConstruct
â”œâ”€â”€ dashboard/                    # React Webã‚¢ãƒ—ãƒªï¼ˆPhase 3ï¼‰
â”‚   â”œâ”€â”€ src/                      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â””â”€â”€ public/                   # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ scripts/                      # é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ deploy-split-stacks.ps1  # åˆ†å‰²ã‚¹ã‚¿ãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚   â”œâ”€â”€ localstack-setup.ps1     # LocalStackç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â””â”€â”€ delete-all-data.ps1      # ãƒ‡ãƒ¼ã‚¿å…¨å‰Šé™¤
â”œâ”€â”€ .kiro/                        # Kiroè¨­å®šã¨Spec
â”‚   â”œâ”€â”€ specs/                    # ä»•æ§˜æ›¸ã¨ã‚¿ã‚¹ã‚¯
â”‚   â”‚   â””â”€â”€ tdnet-data-collector/
â”‚   â”‚       â”œâ”€â”€ docs/             # è¦ä»¶ãƒ»è¨­è¨ˆæ›¸
â”‚   â”‚       â”œâ”€â”€ tasks/            # ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ
â”‚   â”‚       â”œâ”€â”€ work-logs/        # ä½œæ¥­è¨˜éŒ²
â”‚   â”‚       â””â”€â”€ improvements/     # æ”¹å–„è¨˜éŒ²
â”‚   â””â”€â”€ steering/                 # å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
â”‚       â”œâ”€â”€ core/                 # åŸºæœ¬ãƒ«ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ development/          # é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
â”‚       â”œâ”€â”€ infrastructure/       # ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â”œâ”€â”€ security/             # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
â”‚       â””â”€â”€ api/                  # APIè¨­è¨ˆ
â””â”€â”€ __tests__/                    # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    â”œâ”€â”€ unit/                     # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ integration/              # çµ±åˆãƒ†ã‚¹ãƒˆ
    â””â”€â”€ property/                 # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
```

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- **Node.js**: 20.xä»¥ä¸Š
- **npm**: 10.xä»¥ä¸Š
- **AWS CLI**: è¨­å®šæ¸ˆã¿ï¼ˆ`aws configure`ï¼‰
- **AWS CDK CLI**: `npm install -g aws-cdk`ï¼ˆPhase 2ä»¥é™ï¼‰

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/your-org/tdnet-data-collector.git
cd tdnet-data-collector

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# TypeScriptã®ãƒ“ãƒ«ãƒ‰
npm run build
```

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `.env` ã‚’ä½œæˆã—ã€å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

```bash
cp .env.example .env
```

**å¿…é ˆç’°å¢ƒå¤‰æ•°**:

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| `S3_BUCKET_NAME` | PDFãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å…ˆS3ãƒã‚±ãƒƒãƒˆå | `tdnet-pdfs-prod` |
| `DYNAMODB_TABLE_NAME` | é–‹ç¤ºæƒ…å ±ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«å | `tdnet-disclosures` |
| `DYNAMODB_EXECUTIONS_TABLE` | å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«å | `tdnet-executions` |
| `LOG_LEVEL` | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« | `info` / `debug` / `warn` / `error` |

è©³ç´°ã¯ [ç’°å¢ƒå¤‰æ•°ã‚¬ã‚¤ãƒ‰](.kiro/steering/infrastructure/environment-variables.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## é–‹ç™º

### ãƒ“ãƒ«ãƒ‰

```bash
# TypeScriptã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm run build

# ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm run watch
```

### ã‚³ãƒ¼ãƒ‰å“è³ª

```bash
# ESLintã§ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
npm run lint

# ESLintã§è‡ªå‹•ä¿®æ­£
npm run lint:fix

# Prettierã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
npm run format:check
```

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ãƒ†ã‚¹ãƒˆç›£è¦–ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•å®Ÿè¡Œï¼‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
npm run test:coverage
```

### ãƒ†ã‚¹ãƒˆã®ç¨®é¡

| ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ— | èª¬æ˜ | å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ |
|------------|------|------------|
| **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** | å€‹åˆ¥ã®é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ | `npm test -- unit` |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºãƒ†ã‚¹ãƒˆ | `npm test -- integration` |
| **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ** | ãƒ©ãƒ³ãƒ€ãƒ å…¥åŠ›ã«ã‚ˆã‚‹ç¶²ç¾…çš„ãƒ†ã‚¹ãƒˆ | `npm test -- property` |

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- **Statements**: 80%ä»¥ä¸Š
- **Branches**: 75%ä»¥ä¸Š
- **Functions**: 80%ä»¥ä¸Š
- **Lines**: 80%ä»¥ä¸Š
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: ä¸»è¦ãƒ•ãƒ­ãƒ¼100%
- **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ**: é‡è¦ãªé–¢æ•°100%

è©³ç´°ã¯ [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚¬ã‚¤ãƒ‰](.kiro/steering/development/testing-strategy.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã®é¸æŠ

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯2ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼š

#### 1. åˆ†å‰²ã‚¹ã‚¿ãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

4ã¤ã®ç‹¬ç«‹ã—ãŸã‚¹ã‚¿ãƒƒã‚¯ã«åˆ†å‰²ã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“ã‚’70-90%çŸ­ç¸®ã—ã¾ã™ã€‚

```bash
# å…¨ã‚¹ã‚¿ãƒƒã‚¯ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
.\scripts\deploy-split-stacks.ps1 -Environment dev -Action deploy -Stack all

# Lambdaé–¢æ•°ã®ã¿æ›´æ–°ï¼ˆ3-5åˆ†ï¼‰
.\scripts\deploy-split-stacks.ps1 -Environment dev -Action deploy -Stack compute

# APIè¨­å®šã®ã¿æ›´æ–°ï¼ˆ2-3åˆ†ï¼‰
.\scripts\deploy-split-stacks.ps1 -Environment dev -Action deploy -Stack api
```

**åˆ©ç‚¹**:
- ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“: å¾“æ¥15-20åˆ† â†’ å¤‰æ›´ç®‡æ‰€ã®ã¿2-5åˆ†
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å½±éŸ¿: å¤‰æ›´ã—ãŸã‚¹ã‚¿ãƒƒã‚¯ã®ã¿
- ä¸¦åˆ—é–‹ç™º: è¤‡æ•°ãƒãƒ¼ãƒ ãŒç‹¬ç«‹ã—ã¦ä½œæ¥­å¯èƒ½

è©³ç´°ã¯ [ã‚¹ã‚¿ãƒƒã‚¯åˆ†å‰²è¨­è¨ˆ](docs/stack-split-design.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### 2. å˜ä¸€ã‚¹ã‚¿ãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå¾“æ¥æ–¹å¼ï¼‰

```bash
# CDKç’°å¢ƒã®åˆæœŸåŒ–ï¼ˆåˆå›ã®ã¿ï¼‰
cdk bootstrap

# å¤‰æ›´å·®åˆ†ã‚’ç¢ºèª
npm run cdk:diff

# CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
npm run cdk:synth

# AWSã«ãƒ‡ãƒ—ãƒ­ã‚¤
npm run cdk:deploy

# ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤
npm run cdk:destroy
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] IAMãƒ­ãƒ¼ãƒ«ã¨æ¨©é™ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] CloudWatchã‚¢ãƒ©ãƒ¼ãƒ ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

è©³ç´°ã¯ [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](.kiro/steering/infrastructure/deployment-checklist.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ä½¿ç”¨æ–¹æ³•

### Lambdaé–¢æ•°ã®æ‰‹å‹•å®Ÿè¡Œ

#### AWS CLIã§ã®å®Ÿè¡Œ

```bash
# Collector Lambdaï¼ˆé–‹ç¤ºæƒ…å ±åé›†ï¼‰ã‚’æ‰‹å‹•å®Ÿè¡Œ
aws lambda invoke \
  --function-name tdnet-collector \
  --payload '{"date":"2024-01-15"}' \
  response.json

# å®Ÿè¡Œçµæœã‚’ç¢ºèª
cat response.json
```

#### AWS Consoleã§ã®å®Ÿè¡Œ

1. AWS Consoleã«ãƒ­ã‚°ã‚¤ãƒ³
2. Lambda > é–¢æ•° > `tdnet-collector` ã‚’é¸æŠ
3. ã€Œãƒ†ã‚¹ãƒˆã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ:
   ```json
   {
     "date": "2024-01-15"
   }
   ```
5. ã€Œãƒ†ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### EventBridgeã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ç¢ºèª

```bash
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã®ç¢ºèª
aws events list-rules --name-prefix tdnet

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°ã‚’ç¢ºèª
aws events describe-rule --name tdnet-daily-collector
```

### DynamoDBãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª

```bash
# é–‹ç¤ºæƒ…å ±ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆæœ€æ–°10ä»¶ï¼‰
aws dynamodb scan \
  --table-name tdnet-disclosures \
  --limit 10 \
  --output table

# ç‰¹å®šã®é–‹ç¤ºæƒ…å ±ã‚’å–å¾—
aws dynamodb get-item \
  --table-name tdnet-disclosures \
  --key '{"disclosure_id":{"S":"TD202401151234001"}}'
```

### S3ãƒã‚±ãƒƒãƒˆã®ç¢ºèª

```bash
# PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§ã‚’å–å¾—
aws s3 ls s3://tdnet-pdfs-prod/ --recursive

# ç‰¹å®šã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
aws s3 cp s3://tdnet-pdfs-prod/2024/01/TD202401151234001.pdf ./
```

### APIå‘¼ã³å‡ºã—ä¾‹ï¼ˆPhase 2ä»¥é™ï¼‰

#### æ¤œç´¢API

```bash
# æ—¥ä»˜ç¯„å›²ã§æ¤œç´¢
curl -X GET "https://api.example.com/disclosures?start_date=2024-01-01&end_date=2024-01-31"

# ä¼æ¥­ã‚³ãƒ¼ãƒ‰ã§æ¤œç´¢
curl -X GET "https://api.example.com/disclosures?company_code=7203"

# é–‹ç¤ºç¨®åˆ¥ã§æ¤œç´¢
curl -X GET "https://api.example.com/disclosures?disclosure_type=æ±ºç®—çŸ­ä¿¡"
```

#### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆAPI

```bash
# CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
curl -X POST "https://api.example.com/export" \
  -H "Content-Type: application/json" \
  -d '{
    "format": "csv",
    "start_date": "2024-01-01",
    "end_date": "2024-01-31"
  }'

# JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
curl -X POST "https://api.example.com/export" \
  -H "Content-Type: application/json" \
  -d '{
    "format": "json",
    "company_code": "7203"
  }'
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼

#### 1. CDK Bootstrapæœªå®Ÿè¡Œ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
This stack uses assets, so the toolkit stack must be deployed to the environment
```

**è§£æ±ºæ–¹æ³•:**
```bash
cdk bootstrap aws://ACCOUNT-ID/REGION
```

#### 2. IAMæ¨©é™ä¸è¶³

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
User: arn:aws:iam::123456789012:user/username is not authorized to perform: cloudformation:CreateStack
```

**è§£æ±ºæ–¹æ³•:**
- AWSç®¡ç†è€…ã«ä»¥ä¸‹ã®æ¨©é™ã‚’ä¾é ¼:
  - `CloudFormationFullAccess`
  - `IAMFullAccess`
  - `LambdaFullAccess`
  - `DynamoDBFullAccess`
  - `S3FullAccess`

#### 3. ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
The bucket you tried to delete is not empty
```

**è§£æ±ºæ–¹æ³•:**
```bash
# S3ãƒã‚±ãƒƒãƒˆã‚’ç©ºã«ã™ã‚‹
aws s3 rm s3://tdnet-pdfs-prod/ --recursive

# ã‚¹ã‚¿ãƒƒã‚¯ã‚’å‰Šé™¤
cdk destroy
```

### Lambdaå®Ÿè¡Œã‚¨ãƒ©ãƒ¼

#### 1. ç’°å¢ƒå¤‰æ•°æœªè¨­å®š

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Environment variable S3_BUCKET_NAME is not set
```

**è§£æ±ºæ–¹æ³•:**
- Lambdaé–¢æ•°ã®ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªãƒ»è¨­å®š:
  ```bash
  aws lambda update-function-configuration \
    --function-name tdnet-collector \
    --environment Variables={S3_BUCKET_NAME=tdnet-pdfs-prod,DYNAMODB_TABLE_NAME=tdnet-disclosures}
  ```

#### 2. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Task timed out after 15.00 seconds
```

**è§£æ±ºæ–¹æ³•:**
- Lambdaé–¢æ•°ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·:
  ```bash
  aws lambda update-function-configuration \
    --function-name tdnet-collector \
    --timeout 900
  ```

#### 3. ãƒ¡ãƒ¢ãƒªä¸è¶³

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Runtime exited with error: signal: killed
```

**è§£æ±ºæ–¹æ³•:**
- Lambdaé–¢æ•°ã®ãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã™:
  ```bash
  aws lambda update-function-configuration \
    --function-name tdnet-collector \
    --memory-size 1024
  ```

### DynamoDBã‚¨ãƒ©ãƒ¼

#### 1. ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
ProvisionedThroughputExceededException
```

**è§£æ±ºæ–¹æ³•:**
- ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª²é‡‘ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´ï¼ˆæ¨å¥¨ï¼‰
- ã¾ãŸã¯ã€ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¸ˆã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’å¢—ã‚„ã™

#### 2. ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
User is not authorized to perform: dynamodb:PutItem
```

**è§£æ±ºæ–¹æ³•:**
- Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«DynamoDBæ¨©é™ã‚’è¿½åŠ :
  ```json
  {
    "Effect": "Allow",
    "Action": [
      "dynamodb:PutItem",
      "dynamodb:GetItem",
      "dynamodb:Query",
      "dynamodb:Scan"
    ],
    "Resource": "arn:aws:dynamodb:REGION:ACCOUNT-ID:table/tdnet-disclosures"
  }
  ```

### S3ã‚¨ãƒ©ãƒ¼

#### 1. ãƒã‚±ãƒƒãƒˆæœªä½œæˆ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
The specified bucket does not exist
```

**è§£æ±ºæ–¹æ³•:**
```bash
# S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
aws s3 mb s3://tdnet-pdfs-prod --region ap-northeast-1
```

#### 2. ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Access Denied
```

**è§£æ±ºæ–¹æ³•:**
- Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«S3æ¨©é™ã‚’è¿½åŠ :
  ```json
  {
    "Effect": "Allow",
    "Action": [
      "s3:PutObject",
      "s3:GetObject"
    ],
    "Resource": "arn:aws:s3:::tdnet-pdfs-prod/*"
  }
  ```

### ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼

#### 1. TDnetã‚µã‚¤ãƒˆå¤‰æ›´

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Failed to parse HTML: selector not found
```

**è§£æ±ºæ–¹æ³•:**
1. TDnetã‚µã‚¤ãƒˆã®HTMLæ§‹é€ ã‚’ç¢ºèª
2. `src/scraper/html-parser.ts` ã®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ›´æ–°
3. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèª

#### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
ECONNRESET: Connection reset by peer
```

**è§£æ±ºæ–¹æ³•:**
- å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ãŒè‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ï¼ˆæœ€å¤§3å›ï¼‰
- ãã‚Œã§ã‚‚å¤±æ•—ã™ã‚‹å ´åˆã¯ã€TDnetã‚µã‚¤ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèª

#### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Too many requests
```

**è§£æ±ºæ–¹æ³•:**
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨­å®šã‚’ç¢ºèªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ï¼‰
- å¿…è¦ã«å¿œã˜ã¦ `src/utils/rate-limiter.ts` ã®è¨­å®šã‚’èª¿æ•´

### API Gatewayã‚¨ãƒ©ãƒ¼

#### 1. CORSã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Access to fetch at 'https://api.example.com/disclosures' from origin 'https://dashboard.example.com' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

**åŸå› :**
- API Gatewayã®CORSè¨­å®šãŒä¸è¶³ã—ã¦ã„ã‚‹
- Lambdaé–¢æ•°ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«CORSãƒ˜ãƒƒãƒ€ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•:**
1. API Gatewayã®CORSè¨­å®šã‚’ç¢ºèª:
   ```bash
   aws apigateway get-resource \
     --rest-api-id YOUR_API_ID \
     --resource-id YOUR_RESOURCE_ID
   ```
2. Lambdaé–¢æ•°ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ :
   ```typescript
   return {
     statusCode: 200,
     headers: {
       'Access-Control-Allow-Origin': '*',
       'Access-Control-Allow-Headers': 'Content-Type,X-Api-Key',
       'Access-Control-Allow-Methods': 'GET,POST,OPTIONS'
     },
     body: JSON.stringify(data)
   };
   ```

#### 2. èªè¨¼ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
{"message":"Forbidden"}
```

**åŸå› :**
- APIã‚­ãƒ¼ãŒä¸æ­£ã¾ãŸã¯æœŸé™åˆ‡ã‚Œ
- APIã‚­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ¬ è½ã—ã¦ã„ã‚‹
- Secrets Managerã‹ã‚‰ã®ã‚­ãƒ¼å–å¾—ã«å¤±æ•—

**è§£æ±ºæ–¹æ³•:**
1. APIã‚­ãƒ¼ã®ç¢ºèª:
   ```bash
   aws apigateway get-api-keys --include-values
   ```
2. APIã‚­ãƒ¼ã®å†ç”Ÿæˆ:
   ```bash
   .\scripts\register-api-key.ps1 -Environment prod -Action rotate
   ```
3. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«APIã‚­ãƒ¼ã‚’å«ã‚ã‚‹:
   ```bash
   curl -H "x-api-key: YOUR_API_KEY" https://api.example.com/disclosures
   ```

#### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
{"message":"Too Many Requests"}
```

**åŸå› :**
- API Gatewayã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°åˆ¶é™ã‚’è¶…éï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ã€5,000ãƒãƒ¼ã‚¹ãƒˆï¼‰
- ä½¿ç”¨é‡ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã‚’è¶…é

**è§£æ±ºæ–¹æ³•:**
1. ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°è¨­å®šã‚’ç¢ºèª:
   ```bash
   aws apigateway get-stage \
     --rest-api-id YOUR_API_ID \
     --stage-name prod
   ```
2. ä½¿ç”¨é‡ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã‚’ç¢ºèª:
   ```bash
   aws apigateway get-usage-plan --usage-plan-id YOUR_PLAN_ID
   ```
3. ãƒªã‚¯ã‚¨ã‚¹ãƒˆé »åº¦ã‚’èª¿æ•´ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ï¼‰

#### 4. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
{"message":"Endpoint request timed out"}
```

**åŸå› :**
- Lambdaé–¢æ•°ã®å®Ÿè¡Œæ™‚é–“ãŒAPI Gatewayã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ29ç§’ï¼‰ã‚’è¶…é
- Lambdaé–¢æ•°å†…ã§ã®å¤–éƒ¨APIå‘¼ã³å‡ºã—ãŒé…å»¶

**è§£æ±ºæ–¹æ³•:**
1. Lambdaé–¢æ•°ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç¢ºèª:
   ```bash
   aws lambda get-function-configuration --function-name YOUR_FUNCTION_NAME
   ```
2. Lambdaé–¢æ•°ã®å‡¦ç†ã‚’æœ€é©åŒ–ï¼ˆéåŒæœŸå‡¦ç†ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰
3. API Gatewayã®çµ±åˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç¢ºèªï¼ˆæœ€å¤§29ç§’ï¼‰

### CloudFrontã‚¨ãƒ©ãƒ¼

#### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
å¤ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆæ›´æ–°ãŒåæ˜ ã•ã‚Œãªã„ï¼‰
```

**åŸå› :**
- CloudFrontã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTLãŒé•·ã™ãã‚‹
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼ˆInvalidationï¼‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•:**
1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ‰‹å‹•ã§ç„¡åŠ¹åŒ–:
   ```bash
   aws cloudfront create-invalidation \
     --distribution-id YOUR_DISTRIBUTION_ID \
     --paths "/*"
   ```
2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã®çŠ¶æ…‹ã‚’ç¢ºèª:
   ```bash
   aws cloudfront get-invalidation \
     --distribution-id YOUR_DISTRIBUTION_ID \
     --id YOUR_INVALIDATION_ID
   ```
3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒªã‚·ãƒ¼ã‚’èª¿æ•´ï¼ˆTTLã‚’çŸ­ç¸®ã€ã¾ãŸã¯Cache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ï¼‰

#### 2. SSLè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
NET::ERR_CERT_DATE_INVALID
Your connection is not private
```

**åŸå› :**
- SSLè¨¼æ˜æ›¸ã®æœŸé™åˆ‡ã‚Œ
- è¨¼æ˜æ›¸ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³åã®ä¸ä¸€è‡´
- è¨¼æ˜æ›¸ãŒus-east-1ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«å­˜åœ¨ã—ãªã„ï¼ˆCloudFrontã®è¦ä»¶ï¼‰

**è§£æ±ºæ–¹æ³•:**
1. è¨¼æ˜æ›¸ã®çŠ¶æ…‹ã‚’ç¢ºèª:
   ```bash
   aws acm list-certificates --region us-east-1
   aws acm describe-certificate \
     --certificate-arn YOUR_CERT_ARN \
     --region us-east-1
   ```
2. è¨¼æ˜æ›¸ã‚’æ›´æ–°ã¾ãŸã¯å†ç™ºè¡Œï¼ˆACMã®è‡ªå‹•æ›´æ–°ã‚’æœ‰åŠ¹åŒ–ï¼‰
3. CloudFrontãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨¼æ˜æ›¸è¨­å®šã‚’ç¢ºèª:
   ```bash
   aws cloudfront get-distribution-config --id YOUR_DISTRIBUTION_ID
   ```

#### 3. ã‚ªãƒªã‚¸ãƒ³ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
502 Bad Gateway
503 Service Unavailable
```

**åŸå› :**
- ã‚ªãƒªã‚¸ãƒ³ï¼ˆS3ãƒã‚±ãƒƒãƒˆã¾ãŸã¯API Gatewayï¼‰ãŒå¿œç­”ã—ã¦ã„ãªã„
- ã‚ªãƒªã‚¸ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹
- ã‚ªãƒªã‚¸ãƒ³ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šãŒçŸ­ã™ãã‚‹

**è§£æ±ºæ–¹æ³•:**
1. ã‚ªãƒªã‚¸ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª:
   ```bash
   # S3ãƒã‚±ãƒƒãƒˆã®å ´åˆ
   aws s3 ls s3://YOUR_BUCKET_NAME/
   
   # API Gatewayã®å ´åˆ
   curl -I https://YOUR_API_ENDPOINT/
   ```
2. CloudFrontã®ã‚ªãƒªã‚¸ãƒ³è¨­å®šã‚’ç¢ºèª:
   ```bash
   aws cloudfront get-distribution-config --id YOUR_DISTRIBUTION_ID
   ```
3. ã‚ªãƒªã‚¸ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆOAIï¼‰ã®æ¨©é™ã‚’ç¢ºèªï¼ˆS3ã®å ´åˆï¼‰
4. CloudWatch Logsã§ã‚ªãƒªã‚¸ãƒ³ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª

### Secrets Managerã‚¨ãƒ©ãƒ¼

#### 1. ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
AccessDeniedException: User is not authorized to perform: secretsmanager:GetSecretValue
```

**åŸå› :**
- Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«Secrets Managerã®æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•:**
1. Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«æ¨©é™ã‚’è¿½åŠ :
   ```json
   {
     "Effect": "Allow",
     "Action": [
       "secretsmanager:GetSecretValue",
       "secretsmanager:DescribeSecret"
     ],
     "Resource": "arn:aws:secretsmanager:REGION:ACCOUNT-ID:secret:tdnet-api-key-*"
   }
   ```
2. IAMãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ç¢ºèª:
   ```bash
   aws iam get-role-policy \
     --role-name YOUR_LAMBDA_ROLE \
     --policy-name YOUR_POLICY_NAME
   ```

#### 2. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæœªä½œæˆ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
ResourceNotFoundException: Secrets Manager can't find the specified secret.
```

**åŸå› :**
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ãªã„
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåãŒé–“é•ã£ã¦ã„ã‚‹
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•:**
1. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å­˜åœ¨ã‚’ç¢ºèª:
   ```bash
   aws secretsmanager list-secrets
   ```
2. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆ:
   ```bash
   .\scripts\register-api-key.ps1 -Environment prod -Action create
   ```
3. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåã‚’ç¢ºèªï¼ˆç’°å¢ƒå¤‰æ•° `API_KEY_SECRET_NAME` ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ï¼‰

#### 3. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå€¤ã®å–å¾—å¤±æ•—

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
DecryptionFailure: Secrets Manager can't decrypt the protected secret text using the provided KMS key.
```

**åŸå› :**
- KMSã‚­ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹
- KMSã‚­ãƒ¼ãŒç„¡åŠ¹åŒ–ã¾ãŸã¯å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•:**
1. KMSã‚­ãƒ¼ã®çŠ¶æ…‹ã‚’ç¢ºèª:
   ```bash
   aws kms describe-key --key-id YOUR_KEY_ID
   ```
2. Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«KMSæ¨©é™ã‚’è¿½åŠ :
   ```json
   {
     "Effect": "Allow",
     "Action": [
       "kms:Decrypt",
       "kms:DescribeKey"
     ],
     "Resource": "arn:aws:kms:REGION:ACCOUNT-ID:key/YOUR_KEY_ID"
   }
   ```
3. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®æš—å·åŒ–è¨­å®šã‚’ç¢ºèª:
   ```bash
   aws secretsmanager describe-secret --secret-id tdnet-api-key
   ```

### ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•

```bash
# Lambdaé–¢æ•°ã®ãƒ­ã‚°ã‚’ç¢ºèª
aws logs tail /aws/lambda/tdnet-collector --follow

# ç‰¹å®šã®æœŸé–“ã®ãƒ­ã‚°ã‚’ç¢ºèª
aws logs filter-log-events \
  --log-group-name /aws/lambda/tdnet-collector \
  --start-time $(date -d '1 hour ago' +%s)000 \
  --end-time $(date +%s)000
```

---

## ã‚³ã‚¹ãƒˆæƒ…å ±

### æœˆé–“ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

è©³ç´°ãªã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šã¯ [ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](docs/cost-estimation.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**æ¦‚ç®—ï¼ˆAWSç„¡æ–™æ é©ç”¨å¾Œï¼‰:**
- **é–‹ç™ºç’°å¢ƒ**: ç´„$0.02/æœˆ
- **æœ¬ç•ªç’°å¢ƒ**: ç´„$11.12/æœˆ

**ä¸»ãªã‚³ã‚¹ãƒˆè¦å› :**
1. AWS WAF: $8.00/æœˆï¼ˆ72%ï¼‰
2. CloudWatch ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹: $2.70/æœˆï¼ˆ24%ï¼‰
3. Secrets Manager: $0.40/æœˆï¼ˆ4%ï¼‰

### AWSç„¡æ–™æ ã®æ´»ç”¨

ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã§AWSç„¡æ–™æ ã‚’æ´»ç”¨ã—ã¦ã„ã¾ã™:

| ã‚µãƒ¼ãƒ“ã‚¹ | ç„¡æ–™æ  | ä½¿ç”¨é‡ |
|---------|--------|--------|
| Lambda | 100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ | ç´„11,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ |
| DynamoDB | 25GBã€25 RCUã€25 WCU | ç´„50MBã€2,700 WRUã€110,000 RRU |
| S3 | 5GBï¼ˆ12ãƒ¶æœˆé–“ï¼‰ | ç´„12GB |
| API Gateway | 100ä¸‡APIã‚³ãƒ¼ãƒ«/æœˆï¼ˆ12ãƒ¶æœˆé–“ï¼‰ | ç´„11,600ã‚³ãƒ¼ãƒ«/æœˆ |
| CloudWatch | 10ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€10ã‚¢ãƒ©ãƒ¼ãƒ  | 19ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€10ã‚¢ãƒ©ãƒ¼ãƒ  |

### ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒ’ãƒ³ãƒˆ

1. **WAFã®æœ€é©åŒ–**
   - é–‹ç™ºç’°å¢ƒã§ã¯WAFã‚’ç„¡åŠ¹åŒ–ï¼ˆ$8.00å‰Šæ¸›ï¼‰
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’API Gatewayã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°æ©Ÿèƒ½ã§ä»£æ›¿

2. **CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å‰Šæ¸›**
   - é‡è¦ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ã¿ã«çµã‚‹ï¼ˆ10å€‹ä»¥å†…ã§$2.70å‰Šæ¸›ï¼‰
   - Lambda Insightsã‚’æ´»ç”¨

3. **Secrets Managerã®ä»£æ›¿**
   - Systems Manager Parameter Storeã«ç§»è¡Œï¼ˆ$0.40å‰Šæ¸›ï¼‰

4. **S3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼**
   - 90æ—¥å¾Œã«Standard-IAã«ç§»è¡Œ
   - 365æ—¥å¾Œã«Glacierã«ç§»è¡Œ

è©³ç´°ã¯ [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚¬ã‚¤ãƒ‰](.kiro/steering/infrastructure/performance-optimization.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## CI/CD

### GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™:

#### 1. Test Workflow (`.github/workflows/test.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥

**å®Ÿè¡Œå†…å®¹:**
- Lintï¼ˆESLintï¼‰
- å‹ãƒã‚§ãƒƒã‚¯ï¼ˆTypeScriptï¼‰
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆ80%ä»¥ä¸Šå¿…é ˆï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼ˆnpm auditï¼‰

#### 2. Deploy Workflow (`.github/workflows/deploy.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸

**å®Ÿè¡Œå†…å®¹:**
- CDK Diffå®Ÿè¡Œ
- CDK Deployå®Ÿè¡Œ
- ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- Slacké€šçŸ¥

#### 3. Dependency Update Workflow (`.github/workflows/dependency-update.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**: æ¯é€±æœˆæ›œæ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰

**å®Ÿè¡Œå†…å®¹:**
- ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ï¼ˆnpm updateï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼ˆnpm auditï¼‰
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶

ä»¥ä¸‹ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¶­æŒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

- **Statements**: 80%ä»¥ä¸Š
- **Branches**: 75%ä»¥ä¸Š
- **Functions**: 80%ä»¥ä¸Š
- **Lines**: 80%ä»¥ä¸Š

ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç›®æ¨™å€¤æœªæº€ã®å ´åˆã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯å¤±æ•—ã—ã¾ã™ã€‚

è©³ç´°ã¯ [CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](docs/ci-cd-pipeline.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ä»•æ§˜æ›¸

- [è¦ä»¶å®šç¾©æ›¸](.kiro/specs/tdnet-data-collector/docs/01-requirements/requirements.md) - ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã¨æ©Ÿèƒ½ä»•æ§˜
- [è¨­è¨ˆæ›¸](.kiro/specs/tdnet-data-collector/docs/01-requirements/design.md) - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è¨­è¨ˆåˆ¤æ–­
- [ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ](.kiro/specs/tdnet-data-collector/tasks-phase1-4.md) - é–‹ç™ºã‚¿ã‚¹ã‚¯ã¨é€²æ—

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±ã¯ [è¨­è¨ˆæ›¸](.kiro/specs/tdnet-data-collector/docs/01-requirements/design.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å®Ÿè£…ã‚¬ã‚¤ãƒ‰

å®Ÿè£…ã®è©³ç´°ã¯ [Steeringãƒ•ã‚¡ã‚¤ãƒ«](.kiro/steering/) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Steeringãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰

#### åŸºæœ¬ãƒ«ãƒ¼ãƒ«ï¼ˆå¸¸æ™‚èª­ã¿è¾¼ã¿ï¼‰

- [å®Ÿè£…ãƒ«ãƒ¼ãƒ«](.kiro/steering/core/tdnet-implementation-rules.md) - åŸºæœ¬çš„ãªå®Ÿè£…åŸå‰‡
- [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³](.kiro/steering/core/error-handling-patterns.md) - ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨åŸºæœ¬åŸå‰‡
- [ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ«ãƒ¼ãƒ«](.kiro/steering/core/tdnet-data-collector.md) - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—

#### é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](.kiro/steering/development/testing-strategy.md) - ãƒ¦ãƒ‹ãƒƒãƒˆã€çµ±åˆã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³](.kiro/steering/development/data-validation.md) - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
- [TDnetã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³](.kiro/steering/development/tdnet-scraping-patterns.md) - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…](.kiro/steering/development/error-handling-implementation.md) - è©³ç´°ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- [Lambdaå®Ÿè£…ã‚¬ã‚¤ãƒ‰](.kiro/steering/development/lambda-implementation.md) - Lambdaé–¢æ•°ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

- [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](.kiro/steering/infrastructure/deployment-checklist.md) - ãƒ‡ãƒ—ãƒ­ã‚¤å‰å¾Œã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ç’°å¢ƒå¤‰æ•°](.kiro/steering/infrastructure/environment-variables.md) - ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ã¨ç®¡ç†æ–¹æ³•
- [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](.kiro/steering/infrastructure/performance-optimization.md) - ã‚³ã‚¹ãƒˆå‰Šæ¸›ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- [ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ](.kiro/steering/infrastructure/monitoring-alerts.md) - CloudWatchè¨­å®š

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](.kiro/steering/security/security-best-practices.md) - IAMã€æš—å·åŒ–ã€ç›£æŸ»

#### APIè¨­è¨ˆï¼ˆPhase 2ä»¥é™ï¼‰

- [APIè¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](.kiro/steering/api/api-design-guidelines.md) - RESTful APIè¨­è¨ˆ
- [ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰](.kiro/steering/api/error-codes.md) - APIã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¨™æº–

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EventBridge (Scheduler)                      â”‚
â”‚                  æ¯æ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰ã«ãƒˆãƒªã‚¬ãƒ¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Lambda Collector                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. TDnetã‹ã‚‰é–‹ç¤ºæƒ…å ±ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰        â”‚   â”‚
â”‚  â”‚  2. å„é–‹ç¤ºæƒ…å ±ã‚’ä¸¦åˆ—å‡¦ç†ï¼ˆä¸¦åˆ—åº¦5ï¼‰                       â”‚   â”‚
â”‚  â”‚     â”œâ”€â†’ PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ S3ã«ä¿å­˜                    â”‚   â”‚
â”‚  â”‚     â””â”€â†’ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’DynamoDBã«ä¿å­˜                      â”‚   â”‚
â”‚  â”‚  3. å®Ÿè¡ŒçŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆé€²æ—ç‡ã€æˆåŠŸ/å¤±æ•—ä»¶æ•°ï¼‰               â”‚   â”‚
â”‚  â”‚  4. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’CloudWatchã«é€ä¿¡                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â†“                    â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ TDnet  â”‚          â”‚   S3    â”‚         â”‚ DynamoDB â”‚
    â”‚  Web   â”‚          â”‚ Bucket  â”‚         â”‚  Tables  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### DynamoDB: Disclosures ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§å | å‹ | èª¬æ˜ |
|--------|---|------|
| `disclosure_id` (PK) | String | é–‹ç¤ºIDï¼ˆä¾‹: TD202401151234001ï¼‰ |
| `company_code` | String | ä¼æ¥­ã‚³ãƒ¼ãƒ‰ï¼ˆ4æ¡ï¼‰ |
| `company_name` | String | ä¼æ¥­å |
| `disclosure_type` | String | é–‹ç¤ºç¨®åˆ¥ |
| `title` | String | é–‹ç¤ºã‚¿ã‚¤ãƒˆãƒ« |
| `disclosed_at` | String | é–‹ç¤ºæ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰ |
| `date_partition` (GSI PK) | String | æ—¥ä»˜ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ï¼ˆYYYY-MMå½¢å¼ã€JSTåŸºæº–ï¼‰ |
| `pdf_url` | String | PDF URL |
| `s3_key` | String | S3ã‚­ãƒ¼ |
| `collected_at` | String | åé›†æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰ |

#### DynamoDB: Executions ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§å | å‹ | èª¬æ˜ |
|--------|---|------|
| `execution_id` (PK) | String | å®Ÿè¡ŒID |
| `status` | String | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆpending/running/completed/failedï¼‰ |
| `progress` | Number | é€²æ—ç‡ï¼ˆ0-100ï¼‰ |
| `collected_count` | Number | åé›†æˆåŠŸä»¶æ•° |
| `failed_count` | Number | åé›†å¤±æ•—ä»¶æ•° |
| `started_at` | String | é–‹å§‹æ—¥æ™‚ |
| `updated_at` | String | æ›´æ–°æ—¥æ™‚ |
| `completed_at` | String | å®Œäº†æ—¥æ™‚ï¼ˆcompleted/failedã®å ´åˆã®ã¿ï¼‰ |
| `ttl` | Number | TTLï¼ˆ30æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰ |

è©³ç´°ã¯ [è¨­è¨ˆæ›¸](.kiro/specs/tdnet-data-collector/docs/01-requirements/design.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒªã‚¹ã‚¯ç®¡ç†

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

#### 1. TDnetã®HTMLæ§‹é€ å¤‰æ›´ãƒªã‚¹ã‚¯

**ãƒªã‚¹ã‚¯**: TDnetã®Webã‚µã‚¤ãƒˆãŒãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã•ã‚Œã€HTMLæ§‹é€ ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å½±éŸ¿**:
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ãŒå‹•ä½œã—ãªããªã‚‹
- ãƒ‡ãƒ¼ã‚¿åé›†ãŒåœæ­¢ã™ã‚‹
- é–‹ç¤ºæƒ…å ±ã®å–å¾—æ¼ã‚ŒãŒç™ºç”Ÿã™ã‚‹

**å¯¾ç­–**:
- **æŸ”è»Ÿãªã‚»ãƒ¬ã‚¯ã‚¿è¨­è¨ˆ**: è¤‡æ•°ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”¨æ„ã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…
- **æ§‹é€ åŒ–ãƒ­ã‚°**: HTMLè§£æã‚¨ãƒ©ãƒ¼ã‚’è©³ç´°ã«ãƒ­ã‚°è¨˜éŒ²ã—ã€æ—©æœŸæ¤œçŸ¥
- **ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ**: 
  - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æˆåŠŸç‡ã‚’ç›£è¦–ï¼ˆ95%æœªæº€ã§ã‚¢ãƒ©ãƒ¼ãƒˆï¼‰
  - é€£ç¶šå¤±æ•—æ™‚ã«SNSé€šçŸ¥ï¼ˆPhase 5ã§å®Ÿè£…äºˆå®šï¼‰
- **å®šæœŸçš„ãªå‹•ä½œç¢ºèª**: é€±æ¬¡ã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®å‹•ä½œç¢ºèª
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: HTMLæ§‹é€ ã®å¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã€è¿…é€Ÿãªå¯¾å¿œã‚’å¯èƒ½ã«ã™ã‚‹

**å®Ÿè£…ç®‡æ‰€**:
- `src/scraper/html-parser.ts` - æŸ”è»Ÿãªã‚»ãƒ¬ã‚¯ã‚¿è¨­è¨ˆ
- `src/utils/logger.ts` - æ§‹é€ åŒ–ãƒ­ã‚°
- `.kiro/steering/development/tdnet-scraping-patterns.md` - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¬ã‚¤ãƒ‰

#### 2. AWS Lambdaå®Ÿè¡Œæ™‚é–“åˆ¶é™ãƒªã‚¹ã‚¯

**ãƒªã‚¹ã‚¯**: Lambdaé–¢æ•°ã®æœ€å¤§å®Ÿè¡Œæ™‚é–“ï¼ˆ15åˆ†ï¼‰ã‚’è¶…ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å½±éŸ¿**:
- å¤§é‡ã®é–‹ç¤ºæƒ…å ±ãŒã‚ã‚‹æ—¥ï¼ˆæ±ºç®—ç™ºè¡¨æ—¥ãªã©ï¼‰ã«å‡¦ç†ãŒå®Œäº†ã—ãªã„
- éƒ¨åˆ†çš„ãªãƒ‡ãƒ¼ã‚¿åé›†ã®ã¿ã§å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹

**å¯¾ç­–**:
- **é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**: 
  - Collector Lambda: 15åˆ†ï¼ˆæœ€å¤§å€¤ï¼‰
  - PDF Download: 5åˆ†
  - Metadata Save: 3åˆ†
- **ãƒãƒƒãƒå‡¦ç†ã®åˆ†å‰²**: 
  - 100ä»¶ã”ã¨ã«ãƒãƒƒãƒã‚’åˆ†å‰²
  - ä¸¦åˆ—åº¦ã‚’5ã«åˆ¶é™ã—ã¦ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å›é¿
- **éƒ¨åˆ†çš„å¤±æ•—ã®è¨±å®¹**: 
  - æˆåŠŸã—ãŸåˆ†ã¯ã‚³ãƒŸãƒƒãƒˆ
  - å¤±æ•—ã—ãŸåˆ†ã¯DLQã«é€ä¿¡ã—ã¦å¾Œã§å†å‡¦ç†
- **å®Ÿè¡ŒçŠ¶æ…‹ã®è¿½è·¡**: 
  - DynamoDB Executionsãƒ†ãƒ¼ãƒ–ãƒ«ã§é€²æ—ã‚’è¨˜éŒ²
  - ä¸­æ–­ã•ã‚ŒãŸå‡¦ç†ã‚’å†é–‹å¯èƒ½ã«ã™ã‚‹
- **CloudWatchã‚¢ãƒ©ãƒ¼ãƒ **: 
  - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç™ºç”Ÿæ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
  - å®Ÿè¡Œæ™‚é–“ãŒ10åˆ†ã‚’è¶…ãˆãŸå ´åˆã«è­¦å‘Š

**å®Ÿè£…ç®‡æ‰€**:
- `src/lambda/collector/handler.ts` - ãƒãƒƒãƒå‡¦ç†ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç®¡ç†
- `src/lambda/collector/update-execution-status.ts` - å®Ÿè¡ŒçŠ¶æ…‹è¿½è·¡
- `cdk/lib/constructs/lambda-construct.ts` - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- `.kiro/steering/development/lambda-implementation.md` - Lambdaå®Ÿè£…ã‚¬ã‚¤ãƒ‰

#### 3. DynamoDBã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ãƒªã‚¹ã‚¯

**ãƒªã‚¹ã‚¯**: å¤§é‡ã®æ›¸ãè¾¼ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã‚ŠDynamoDBãŒã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å½±éŸ¿**:
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã®å¤±æ•—
- Lambdaé–¢æ•°ã®å®Ÿè¡Œæ™‚é–“å¢—åŠ 
- ã‚³ã‚¹ãƒˆã®å¢—åŠ ï¼ˆå†è©¦è¡Œã«ã‚ˆã‚‹è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰

**å¯¾ç­–**:
- **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª²é‡‘ãƒ¢ãƒ¼ãƒ‰**: 
  - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®æ€¥å¢—ã«è‡ªå‹•å¯¾å¿œ
  - ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ä¸è¦ã§é‹ç”¨ãŒç°¡å˜
- **æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å†è©¦è¡Œ**: 
  - AWS SDKã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨
  - æœ€å¤§3å›ã¾ã§å†è©¦è¡Œ
  - å†è©¦è¡Œé–“éš”: 2ç§’ â†’ 4ç§’ â†’ 8ç§’
- **ãƒãƒƒãƒæ›¸ãè¾¼ã¿ã®æœ€é©åŒ–**: 
  - `batchWriteItem` ã‚’ä½¿ç”¨ã—ã¦åŠ¹ç‡åŒ–
  - 25ä»¶ã”ã¨ã«ãƒãƒƒãƒåŒ–ï¼ˆDynamoDBã®åˆ¶é™ï¼‰
- **æ›¸ãè¾¼ã¿ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã®ç›£è¦–**: 
  - CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç›£è¦–
  - ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ç™ºç”Ÿæ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
- **TTLè¨­å®š**: 
  - å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å‰Šé™¤ã—ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›
  - Executionsãƒ†ãƒ¼ãƒ–ãƒ«: 30æ—¥å¾Œã«å‰Šé™¤

**å®Ÿè£…ç®‡æ‰€**:
- `src/lambda/collector/save-metadata.ts` - ãƒãƒƒãƒæ›¸ãè¾¼ã¿
- `src/utils/retry.ts` - å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
- `cdk/lib/constructs/dynamodb-construct.ts` - ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰è¨­å®š
- `.kiro/steering/infrastructure/performance-optimization.md` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚¬ã‚¤ãƒ‰

### å¤–éƒ¨ä¾å­˜ãƒªã‚¹ã‚¯

#### TDnet Webã‚µã‚¤ãƒˆã®å¯ç”¨æ€§

**ãƒªã‚¹ã‚¯**: TDnetã®Webã‚µã‚¤ãƒˆãŒãƒ€ã‚¦ãƒ³ã¾ãŸã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**ç›£è¦–æ–¹æ³•**:
- **CloudWatch Synthetics Canary**: 
  - 5åˆ†ã”ã¨ã«TDnetãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
  - 15åˆ†ã”ã¨ã«é–‹ç¤ºæƒ…å ±ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
  - å¯ç”¨æ€§ãŒ95%æœªæº€ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
- **Lambdaé–¢æ•°å†…ã§ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨˜éŒ²**: 
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆæˆåŠŸç‡ã‚’è¨˜éŒ²
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’è¨˜éŒ²
  - ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥ã«é›†è¨ˆ
- **CloudWatchãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: 
  - TDnetå¯ç”¨æ€§ã®å¯è¦–åŒ–
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
  - ã‚¨ãƒ©ãƒ¼ç‡ã®ç›£è¦–

**å¯¾å¿œãƒ•ãƒ­ãƒ¼**:
1. **ã‚¢ãƒ©ãƒ¼ãƒˆå—ä¿¡**: SNSçµŒç”±ã§ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
2. **çŠ¶æ³ç¢ºèª**: CloudWatch Logsã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
3. **å¯¾å¿œç­–ã®å®Ÿæ–½**: 
   - TDnetãŒå®Œå…¨ã«ãƒ€ã‚¦ãƒ³ â†’ åé›†å‡¦ç†ã‚’ä¸€æ™‚åœæ­¢ã€å¾©æ—§ã‚’å¾…ã¤
   - éƒ¨åˆ†çš„ãªéšœå®³ â†’ å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ãŒè‡ªå‹•å¯¾å¿œ
   - HTMLæ§‹é€ å¤‰æ›´ â†’ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£
4. **äº‹å¾Œå¯¾å¿œ**: ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆä½œæˆã€å†ç™ºé˜²æ­¢ç­–ã®æ¤œè¨

**è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [å¤–éƒ¨ä¾å­˜ç›£è¦–ã‚¬ã‚¤ãƒ‰](docs/external-dependency-monitoring.md) - ç›£è¦–è¨­å®šã¨å¯¾å¿œãƒ•ãƒ­ãƒ¼
- [TDnetã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³](.kiro/steering/development/tdnet-scraping-patterns.md) - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚³ã‚¹ãƒˆç®¡ç†

#### AWSç„¡æ–™æ è¶…éãƒªã‚¹ã‚¯

**ãƒªã‚¹ã‚¯**: æƒ³å®šä»¥ä¸Šã®ä½¿ç”¨é‡ã«ã‚ˆã‚Šã€AWSç„¡æ–™æ ã‚’è¶…éã—ã¦ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å¯¾ç­–**:
- **AWS Budgetsè¨­å®š**: 
  - æœˆæ¬¡äºˆç®—: $5.00ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰ã€$10.00ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
  - ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤: 50%ã€80%ã€100%
  - SNSé€šçŸ¥ã«ã‚ˆã‚‹æ—©æœŸè­¦å‘Š
- **ã‚³ã‚¹ãƒˆç›£è¦–**: 
  - Cost Explorerã§æ—¥æ¬¡ã‚³ã‚¹ãƒˆã‚’ç¢ºèª
  - ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ã‚³ã‚¹ãƒˆã®å¯è¦–åŒ–
  - ç•°å¸¸ãªã‚³ã‚¹ãƒˆå¢—åŠ ã®æ—©æœŸæ¤œçŸ¥
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: 
  - Lambda: ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºã®æœ€é©åŒ–ã€ä¸è¦ãªãƒ­ã‚°ã®å‰Šæ¸›
  - DynamoDB: TTLè¨­å®šã€ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰
  - S3: ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã€Intelligent-Tiering
  - CloudWatch: ãƒ­ã‚°ä¿æŒæœŸé–“ã®è¨­å®šï¼ˆ30æ—¥ï¼‰

**è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [AWS Budgetsè¨­å®šæ‰‹é †æ›¸](docs/aws-budgets-setup.md) - äºˆç®—è¨­å®šã¨ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ã‚³ã‚¹ãƒˆç›£è¦–ã‚¬ã‚¤ãƒ‰](docs/cost-monitoring.md) - ã‚³ã‚¹ãƒˆç›£è¦–ã¨æœ€é©åŒ–

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯

#### 1. èªè¨¼æƒ…å ±ã®æ¼æ´©ãƒªã‚¹ã‚¯

**å¯¾ç­–**:
- Secrets Managerã§ã®å®‰å…¨ãªç®¡ç†
- IAMãƒ­ãƒ¼ãƒ«ã®æœ€å°æ¨©é™åŸå‰‡
- CloudTrailã«ã‚ˆã‚‹ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

#### 2. ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚¹ã‚¯

**å¯¾ç­–**:
- AWS WAFã«ã‚ˆã‚‹ä¿è­·ï¼ˆPhase 4ã§å®Ÿè£…æ¸ˆã¿ï¼‰
- API Gatewayã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
- CloudWatch Logsã§ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨˜éŒ²

**è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](.kiro/steering/security/security-best-practices.md) - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

Copyright (c) 2024 TDnet Data Collector Project

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
