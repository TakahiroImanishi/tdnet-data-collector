# TDnet Data Collector - コスト見積もり

**最終更新日**: 2026-02-12  
**対象環境**: 本番環境（prod）  
**見積もり期間**: 月間（30日）

## 概要

TDnet Data Collectorは、AWS無料枠を最大限活用し、月間コストを$20以下に抑えることを目標としています。

## 前提条件

### 想定ワークロード

| 項目 | 想定値 | 備考 |
|------|--------|------|
| 日次開示情報件数 | 100件/日 | 平日のみ（月20日） |
| 月間開示情報件数 | 2,000件/月 | 100件/日 × 20日 |
| PDF平均サイズ | 500KB | 開示資料のPDFファイル |
| API呼び出し回数 | 10,000回/月 | 検索・エクスポートAPI |
| エクスポート回数 | 100回/月 | CSV/JSONエクスポート |

### AWS無料枠（12ヶ月間）

| サービス | 無料枠 | 備考 |
|---------|--------|------|
| Lambda | 100万リクエスト/月、400,000 GB-秒/月 | 常時無料 |
| DynamoDB | 25GB ストレージ、25 RCU、25 WCU | 常時無料 |
| S3 | 5GB ストレージ、20,000 GETリクエスト、2,000 PUTリクエスト | 12ヶ月間 |
| CloudWatch | 10カスタムメトリクス、10アラーム | 常時無料 |
| API Gateway | 100万APIコール/月 | 12ヶ月間 |
| Secrets Manager | 30日間無料トライアル | その後$0.40/シークレット/月 |

## サービス別コスト見積もり

### 1. AWS Lambda

#### 1.1 Collector Lambda（スクレイピング）

**設定:**
- メモリ: 512MB
- タイムアウト: 15分（900秒）
- 実行回数: 20回/月（日次バッチ）
- 平均実行時間: 5分（300秒）

**計算:**
```
リクエスト料金:
  20回/月 × $0.20 / 100万リクエスト = $0.000004

実行時間料金:
  GB-秒 = 0.512GB × 300秒 × 20回 = 3,072 GB-秒
  料金 = 3,072 GB-秒 × $0.0000166667 = $0.051

合計: $0.051
```

**無料枠適用後: $0.00**（400,000 GB-秒/月の無料枠内）

#### 1.2 Query Lambda（検索API）

**設定:**
- メモリ: 256MB
- タイムアウト: 30秒
- 実行回数: 10,000回/月
- 平均実行時間: 2秒

**計算:**
```
リクエスト料金:
  10,000回/月 × $0.20 / 100万リクエスト = $0.002

実行時間料金:
  GB-秒 = 0.256GB × 2秒 × 10,000回 = 5,120 GB-秒
  料金 = 5,120 GB-秒 × $0.0000166667 = $0.085

合計: $0.087
```

**無料枠適用後: $0.00**（100万リクエスト/月、400,000 GB-秒/月の無料枠内）

#### 1.3 Export Lambda（エクスポート）

**設定:**
- メモリ: 1024MB
- タイムアウト: 5分（300秒）
- 実行回数: 100回/月
- 平均実行時間: 30秒

**計算:**
```
リクエスト料金:
  100回/月 × $0.20 / 100万リクエスト = $0.00002

実行時間料金:
  GB-秒 = 1.024GB × 30秒 × 100回 = 3,072 GB-秒
  料金 = 3,072 GB-秒 × $0.0000166667 = $0.051

合計: $0.051
```

**無料枠適用後: $0.00**（400,000 GB-秒/月の無料枠内）

#### 1.4 その他Lambda関数

**設定:**
- Collect, Stats, Health, DLQ Processor, API Key Rotation
- 合計実行回数: 1,000回/月
- 平均メモリ: 256MB
- 平均実行時間: 1秒

**計算:**
```
リクエスト料金:
  1,000回/月 × $0.20 / 100万リクエスト = $0.0002

実行時間料金:
  GB-秒 = 0.256GB × 1秒 × 1,000回 = 256 GB-秒
  料金 = 256 GB-秒 × $0.0000166667 = $0.004

合計: $0.004
```

**無料枠適用後: $0.00**

#### Lambda合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| Collector | $0.051 | $0.00 |
| Query | $0.087 | $0.00 |
| Export | $0.051 | $0.00 |
| その他 | $0.004 | $0.00 |
| **合計** | **$0.193** | **$0.00** |

### 2. Amazon DynamoDB

#### 2.1 ストレージ

**データ量:**
- 開示情報メタデータ: 2,000件/月 × 2KB/件 = 4MB/月
- 累積データ（12ヶ月）: 4MB × 12 = 48MB
- 実行状態テーブル（TTL 30日）: 20件 × 1KB = 20KB
- エクスポート状態テーブル（TTL 30日）: 100件 × 1KB = 100KB

**合計ストレージ: 約50MB**

**料金:**
```
50MB × $0.25 / GB = $0.0125
```

**無料枠適用後: $0.00**（25GBの無料枠内）

#### 2.2 読み取り・書き込み（オンデマンド）

**書き込み:**
- 開示情報: 2,000件/月 × 1 WRU = 2,000 WRU
- 実行状態: 20件/月 × 10回更新 = 200 WRU
- エクスポート状態: 100件/月 × 5回更新 = 500 WRU
- 合計: 2,700 WRU/月

**読み取り:**
- API検索: 10,000回/月 × 10件平均 = 100,000 RRU
- エクスポート: 100回/月 × 100件平均 = 10,000 RRU
- 合計: 110,000 RRU/月

**料金:**
```
書き込み: 2,700 WRU × $1.25 / 100万 WRU = $0.003
読み取り: 110,000 RRU × $0.25 / 100万 RRU = $0.028

合計: $0.031
```

**無料枠適用後: $0.00**（25 WCU、25 RCUの無料枠内）

#### DynamoDB合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| ストレージ | $0.0125 | $0.00 |
| 読み取り・書き込み | $0.031 | $0.00 |
| **合計** | **$0.044** | **$0.00** |

### 3. Amazon S3

#### 3.1 ストレージ

**データ量:**
- PDFファイル: 2,000件/月 × 500KB = 1GB/月
- 累積データ（12ヶ月）: 1GB × 12 = 12GB
- エクスポートファイル（7日保持）: 100件 × 100KB = 10MB
- ダッシュボード静的ファイル: 50MB

**合計ストレージ: 約12.06GB**

**ストレージクラス別:**
- Standard（90日以内）: 3GB
- Standard-IA（90日～365日）: 9GB
- Glacier（365日以降）: 0.06GB

**料金:**
```
Standard: 3GB × $0.023 / GB = $0.069
Standard-IA: 9GB × $0.0125 / GB = $0.113
Glacier: 0.06GB × $0.004 / GB = $0.0002

合計: $0.182
```

**無料枠適用後: $0.00**（5GBの無料枠内、最初の12ヶ月）

#### 3.2 リクエスト

**PUT/POST:**
- PDF保存: 2,000件/月
- エクスポート保存: 100件/月
- 合計: 2,100件/月

**GET:**
- PDF取得（署名付きURL）: 1,000件/月
- エクスポート取得: 100件/月
- ダッシュボード: 5,000件/月
- 合計: 6,100件/月

**料金:**
```
PUT: 2,100件 × $0.005 / 1,000件 = $0.011
GET: 6,100件 × $0.0004 / 1,000件 = $0.002

合計: $0.013
```

**無料枠適用後: $0.00**（2,000 PUT、20,000 GETの無料枠内）

#### 3.3 データ転送

**転送量:**
- PDF取得: 1,000件 × 500KB = 500MB
- エクスポート取得: 100件 × 100KB = 10MB
- ダッシュボード: 5,000件 × 10KB = 50MB
- 合計: 560MB/月

**料金:**
```
最初の1GBは無料
560MB × $0.00 = $0.00
```

**無料枠適用後: $0.00**

#### S3合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| ストレージ | $0.182 | $0.00 |
| リクエスト | $0.013 | $0.00 |
| データ転送 | $0.00 | $0.00 |
| **合計** | **$0.195** | **$0.00** |

### 4. Amazon API Gateway

#### 4.1 REST API

**リクエスト数:**
- 検索API: 10,000回/月
- エクスポートAPI: 100回/月
- 統計API: 500回/月
- ヘルスチェック: 1,000回/月
- 合計: 11,600回/月

**料金:**
```
11,600回 × $3.50 / 100万回 = $0.041
```

**無料枠適用後: $0.00**（100万APIコール/月の無料枠内、最初の12ヶ月）

#### 4.2 データ転送

**転送量:**
- レスポンスデータ: 11,600回 × 10KB平均 = 116MB

**料金:**
```
最初の1GBは無料
116MB × $0.00 = $0.00
```

**無料枠適用後: $0.00**

#### API Gateway合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| APIコール | $0.041 | $0.00 |
| データ転送 | $0.00 | $0.00 |
| **合計** | **$0.041** | **$0.00** |

### 5. AWS Secrets Manager

#### 5.1 シークレット保存

**シークレット数:**
- APIキー: 1個

**料金:**
```
1個 × $0.40 / シークレット/月 = $0.40
```

**無料枠適用後: $0.40**（30日間無料トライアル後）

#### 5.2 API呼び出し

**呼び出し回数:**
- Lambda関数からの取得（キャッシュ5分）: 約500回/月

**料金:**
```
500回 × $0.05 / 10,000回 = $0.0025
```

**無料枠適用後: $0.0025**

#### Secrets Manager合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| シークレット保存 | $0.40 | $0.40 |
| API呼び出し | $0.0025 | $0.0025 |
| **合計** | **$0.4025** | **$0.4025** |

### 6. Amazon CloudWatch

#### 6.1 カスタムメトリクス

**メトリクス数:**
- Lambda実行時間: 6個（各Lambda関数）
- エラー率: 6個
- DynamoDB読み書き: 2個
- カスタムメトリクス: 5個
- 合計: 19個

**料金:**
```
最初の10個は無料
超過分: 9個 × $0.30 / メトリクス/月 = $2.70
```

**無料枠適用後: $2.70**

#### 6.2 アラーム

**アラーム数:**
- Lambda エラー率: 6個
- DynamoDB スロットリング: 2個
- API Gateway 5xxエラー: 1個
- DLQ メッセージ数: 1個
- 合計: 10個

**料金:**
```
最初の10個は無料
10個 × $0.00 = $0.00
```

**無料枠適用後: $0.00**

#### 6.3 ログ保存

**ログ量:**
- Lambda ログ: 500MB/月
- API Gateway ログ: 100MB/月
- 合計: 600MB/月

**料金:**
```
600MB × $0.50 / GB = $0.30
```

**無料枠適用後: $0.30**（5GBの無料枠内）

#### CloudWatch合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| カスタムメトリクス | $2.70 | $2.70 |
| アラーム | $0.00 | $0.00 |
| ログ保存 | $0.30 | $0.00 |
| **合計** | **$3.00** | **$2.70** |

### 7. AWS WAF

#### 7.1 Web ACL

**Web ACL数:** 1個

**料金:**
```
1個 × $5.00 / Web ACL/月 = $5.00
```

**無料枠適用後: $5.00**

#### 7.2 ルール

**ルール数:**
- レート制限ルール: 1個
- AWSマネージドルール: 2個
- 合計: 3個

**料金:**
```
3個 × $1.00 / ルール/月 = $3.00
```

**無料枠適用後: $3.00**

#### 7.3 リクエスト

**リクエスト数:** 11,600回/月

**料金:**
```
11,600回 × $0.60 / 100万回 = $0.007
```

**無料枠適用後: $0.007**

#### WAF合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| Web ACL | $5.00 | $5.00 |
| ルール | $3.00 | $3.00 |
| リクエスト | $0.007 | $0.007 |
| **合計** | **$8.007** | **$8.007** |

### 8. Amazon CloudFront

#### 8.1 データ転送

**転送量:**
- ダッシュボード配信: 5,000回 × 10KB = 50MB

**料金:**
```
最初の10TBは$0.085 / GB
50MB × $0.085 / GB = $0.004
```

**無料枠適用後: $0.004**

#### 8.2 HTTPSリクエスト

**リクエスト数:** 5,000回/月

**料金:**
```
5,000回 × $0.01 / 10,000回 = $0.005
```

**無料枠適用後: $0.005**

#### CloudFront合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| データ転送 | $0.004 | $0.004 |
| HTTPSリクエスト | $0.005 | $0.005 |
| **合計** | **$0.009** | **$0.009** |

### 9. Amazon SNS

#### 9.1 トピック

**トピック数:** 1個（アラート通知用）

**料金:** 無料

#### 9.2 通知

**通知数:**
- アラート通知: 10回/月（想定）

**料金:**
```
10回 × $0.50 / 100万回 = $0.000005
```

**無料枠適用後: $0.00**（100万通知/月の無料枠内）

#### SNS合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| トピック | $0.00 | $0.00 |
| 通知 | $0.000005 | $0.00 |
| **合計** | **$0.000005** | **$0.00** |

### 10. Amazon SQS（DLQ）

#### 10.1 リクエスト

**リクエスト数:**
- DLQへのメッセージ送信: 10回/月（想定）
- DLQプロセッサーによる取得: 10回/月

**料金:**
```
20回 × $0.40 / 100万回 = $0.000008
```

**無料枠適用後: $0.00**（100万リクエスト/月の無料枠内）

#### SQS合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| リクエスト | $0.000008 | $0.00 |
| **合計** | **$0.000008** | **$0.00** |

### 11. AWS CloudTrail

#### 11.1 証跡

**証跡数:** 1個

**料金:**
```
最初の証跡は無料
1個 × $0.00 = $0.00
```

**無料枠適用後: $0.00**

#### 11.2 イベント記録

**イベント数:** 約10,000イベント/月

**料金:**
```
最初の100,000イベントは無料
10,000イベント × $0.00 = $0.00
```

**無料枠適用後: $0.00**

#### CloudTrail合計コスト

| 項目 | 月間コスト | 無料枠適用後 |
|------|-----------|------------|
| 証跡 | $0.00 | $0.00 |
| イベント記録 | $0.00 | $0.00 |
| **合計** | **$0.00** | **$0.00** |

## 総コスト見積もり

### 月間コスト（無料枠適用前）

| サービス | 月間コスト |
|---------|-----------|
| Lambda | $0.193 |
| DynamoDB | $0.044 |
| S3 | $0.195 |
| API Gateway | $0.041 |
| Secrets Manager | $0.4025 |
| CloudWatch | $3.00 |
| WAF | $8.007 |
| CloudFront | $0.009 |
| SNS | $0.000005 |
| SQS | $0.000008 |
| CloudTrail | $0.00 |
| **合計** | **$11.89** |

### 月間コスト（無料枠適用後）

| サービス | 無料枠適用後コスト |
|---------|------------------|
| Lambda | $0.00 |
| DynamoDB | $0.00 |
| S3 | $0.00 |
| API Gateway | $0.00 |
| Secrets Manager | $0.4025 |
| CloudWatch | $2.70 |
| WAF | $8.007 |
| CloudFront | $0.009 |
| SNS | $0.00 |
| SQS | $0.00 |
| CloudTrail | $0.00 |
| **合計** | **$11.12** |

## コスト最適化の提案

### 1. WAFの最適化（$8.00削減可能）

**現状:** WAFで$8.00/月のコスト

**最適化案:**
- 開発環境ではWAFを無効化
- 本番環境のみWAFを有効化
- レート制限をAPI Gatewayのスロットリング機能で代替（無料）

**削減後コスト:** $0.00（開発環境）、$8.00（本番環境のみ）

### 2. CloudWatchメトリクスの最適化（$2.70削減可能）

**現状:** カスタムメトリクス19個で$2.70/月

**最適化案:**
- 重要なメトリクスのみに絞る（10個以内）
- Lambda Insightsを使用（無料枠内）
- CloudWatch Logs Insightsでメトリクスを代替

**削減後コスト:** $0.00

### 3. Secrets Managerの最適化（$0.40削減可能）

**現状:** APIキー1個で$0.40/月

**最適化案:**
- Systems Manager Parameter Store（無料）に移行
- 暗号化パラメータとして保存

**削減後コスト:** $0.00

## 最適化後の月間コスト

| 最適化項目 | 削減額 |
|-----------|--------|
| WAF無効化（開発環境） | $8.00 |
| CloudWatchメトリクス削減 | $2.70 |
| Secrets Manager → Parameter Store | $0.40 |
| **合計削減額** | **$11.10** |

### 最終月間コスト

**開発環境:** $0.02（CloudFront + その他）  
**本番環境:** $8.02（WAF + CloudFront + その他）

## 結論

### ✅ 目標達成状況

| 項目 | 目標 | 実績 | 達成 |
|------|------|------|------|
| 月間コスト | $20以下 | $11.12 | ✅ |
| AWS無料枠活用 | 最大限活用 | Lambda、DynamoDB、S3、API Gateway、CloudWatch（一部）で活用 | ✅ |

### 📊 コスト内訳（無料枠適用後）

1. **WAF**: $8.007（72%）← 最大のコスト要因
2. **CloudWatch**: $2.70（24%）← カスタムメトリクス
3. **Secrets Manager**: $0.4025（4%）
4. **その他**: $0.011（<1%）

### 🎯 推奨事項

1. **開発環境ではWAFを無効化**して、コストを$8削減
2. **CloudWatchメトリクスを10個以内に削減**して、コストを$2.70削減
3. **Secrets ManagerをParameter Storeに移行**して、コストを$0.40削減

これらの最適化により、**月間コストを$0.02（開発環境）または$8.02（本番環境）に削減可能**です。

### 📈 スケーラビリティ

現在の設計は、以下のスケールまで無料枠内で運用可能です:

- Lambda: 100万リクエスト/月まで
- DynamoDB: 25GBストレージ、25 RCU、25 WCUまで
- S3: 5GBストレージまで（最初の12ヶ月）
- API Gateway: 100万APIコール/月まで（最初の12ヶ月）

ワークロードが増加した場合でも、段階的にコストが増加するため、予算管理が容易です。
