{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\__tests__\\metrics.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\__tests__\\metrics.test.ts"],"sourcesContent":["/**\r\n * CloudWatchメトリクスヘルパーのユニットテスト\r\n *\r\n * メトリクス送信機能の動作を検証します。\r\n * Lambda実装チェックリストの「エラーメトリクス送信」に対応。\r\n *\r\n * Requirements: 要件6.4（エラーメトリクス）\r\n */\r\n\r\nimport {\r\n  sendMetric,\r\n  sendErrorMetric,\r\n  sendSuccessMetric,\r\n  sendExecutionTimeMetric,\r\n  sendBatchResultMetrics,\r\n  sendDisclosuresCollectedMetric,\r\n  sendDisclosuresFailedMetric,\r\n  sendCollectionSuccessRateMetric,\r\n} from '../metrics';\r\nimport { ValidationError, RetryableError } from '../../errors';\r\n\r\n// AWS SDK v3のモック\r\njest.mock('@aws-sdk/client-cloudwatch', () => {\r\n  const mockSend = jest.fn().mockResolvedValue({});\r\n  \r\n  return {\r\n    CloudWatchClient: jest.fn(() => ({\r\n      send: mockSend,\r\n    })),\r\n    PutMetricDataCommand: jest.fn((params) => params),\r\n  };\r\n});\r\n\r\ndescribe('CloudWatch Metrics', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('sendMetric', () => {\r\n    it('should send metric with default options', async () => {\r\n      await sendMetric('TestMetric', 1);\r\n\r\n      const { CloudWatchClient, PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      \r\n      expect(mockClient.send).toHaveBeenCalledTimes(1);\r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          Namespace: 'TDnetDataCollector',\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'TestMetric',\r\n              Value: 1,\r\n              Unit: 'Count',\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send metric with custom namespace', async () => {\r\n      await sendMetric('TestMetric', 1, {\r\n        namespace: 'CustomNamespace',\r\n      });\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          Namespace: 'CustomNamespace',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send metric with dimensions', async () => {\r\n      await sendMetric('TestMetric', 1, {\r\n        dimensions: [\r\n          { Name: 'ErrorType', Value: 'ValidationError' },\r\n          { Name: 'FunctionName', Value: 'TestFunction' },\r\n        ],\r\n      });\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Dimensions: [\r\n                { Name: 'ErrorType', Value: 'ValidationError' },\r\n                { Name: 'FunctionName', Value: 'TestFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send metric with custom unit', async () => {\r\n      await sendMetric('ExecutionTime', 1234, {\r\n        unit: 'Milliseconds',\r\n      });\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Unit: 'Milliseconds',\r\n              Value: 1234,\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should not throw error on metric send failure', async () => {\r\n      const { CloudWatchClient } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      mockClient.send.mockRejectedValueOnce(new Error('Network error'));\r\n\r\n      // メトリクス送信失敗でもエラーをスローしない\r\n      await expect(sendMetric('TestMetric', 1)).resolves.not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('sendErrorMetric', () => {\r\n    it('should send error metric with error type', async () => {\r\n      const error = new ValidationError('Invalid input');\r\n      \r\n      await sendErrorMetric(error);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'LambdaError',\r\n              Value: 1,\r\n              Dimensions: [\r\n                { Name: 'ErrorType', Value: 'ValidationError' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send error metric with function name', async () => {\r\n      const error = new RetryableError('Network error');\r\n      \r\n      await sendErrorMetric(error, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Dimensions: [\r\n                { Name: 'ErrorType', Value: 'RetryableError' },\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle standard Error objects', async () => {\r\n      const error = new Error('Standard error');\r\n      \r\n      await sendErrorMetric(error);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Dimensions: [\r\n                { Name: 'ErrorType', Value: 'Error' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('sendSuccessMetric', () => {\r\n    it('should send success metric without function name', async () => {\r\n      await sendSuccessMetric();\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'LambdaSuccess',\r\n              Value: 1,\r\n              Dimensions: [],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send success metric with function name', async () => {\r\n      await sendSuccessMetric('CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Dimensions: [\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('sendExecutionTimeMetric', () => {\r\n    it('should send execution time metric', async () => {\r\n      await sendExecutionTimeMetric(1234);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'ExecutionTime',\r\n              Value: 1234,\r\n              Unit: 'Milliseconds',\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send execution time metric with function name', async () => {\r\n      await sendExecutionTimeMetric(1234, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Dimensions: [\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('sendBatchResultMetrics', () => {\r\n    it('should send batch success and failed metrics', async () => {\r\n      await sendBatchResultMetrics(95, 5);\r\n\r\n      const { CloudWatchClient } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      \r\n      // 2回呼ばれる（success + failed）\r\n      expect(mockClient.send).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('should send batch metrics with function name', async () => {\r\n      await sendBatchResultMetrics(95, 5, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      // BatchSuccessとBatchFailedの両方が送信される\r\n      const calls = PutMetricDataCommand.mock.calls;\r\n      expect(calls.length).toBe(2);\r\n      \r\n      // 各呼び出しにFunctionNameディメンションが含まれる\r\n      calls.forEach((call: any) => {\r\n        expect(call[0].MetricData[0].Dimensions).toContainEqual({\r\n          Name: 'FunctionName',\r\n          Value: 'CollectorFunction',\r\n        });\r\n      });\r\n    });\r\n\r\n    it('should send correct values for success and failed', async () => {\r\n      await sendBatchResultMetrics(95, 5);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      const calls = PutMetricDataCommand.mock.calls;\r\n      \r\n      // BatchSuccessメトリクス\r\n      const successCall = calls.find(\r\n        (call: any) => call[0].MetricData[0].MetricName === 'BatchSuccess'\r\n      );\r\n      expect(successCall[0].MetricData[0].Value).toBe(95);\r\n      \r\n      // BatchFailedメトリクス\r\n      const failedCall = calls.find(\r\n        (call: any) => call[0].MetricData[0].MetricName === 'BatchFailed'\r\n      );\r\n      expect(failedCall[0].MetricData[0].Value).toBe(5);\r\n    });\r\n  });\r\n\r\n  describe('Lambda Integration Example', () => {\r\n    it('should demonstrate complete Lambda error handling with metrics', async () => {\r\n      // Lambda実装チェックリストに準拠した実装例\r\n      const mockHandler = async (_event: any, context: any) => {\r\n        const startTime = Date.now();\r\n        \r\n        try {\r\n          // メイン処理（成功）\r\n          await Promise.resolve({ success: true });\r\n          \r\n          // 成功メトリクス送信\r\n          await sendSuccessMetric(context.functionName);\r\n          \r\n          // 実行時間メトリクス送信\r\n          const executionTime = Date.now() - startTime;\r\n          await sendExecutionTimeMetric(executionTime, context.functionName);\r\n          \r\n          return { statusCode: 200, body: JSON.stringify({ success: true }) };\r\n        } catch (error) {\r\n          // エラーメトリクス送信\r\n          await sendErrorMetric(error as Error, context.functionName);\r\n          throw error;\r\n        }\r\n      };\r\n\r\n      const mockContext = {\r\n        functionName: 'TestFunction',\r\n        requestId: 'test-request-id',\r\n      };\r\n\r\n      await mockHandler({}, mockContext);\r\n\r\n      const { CloudWatchClient } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      \r\n      // 成功メトリクスと実行時間メトリクスが送信される\r\n      expect(mockClient.send).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('should demonstrate batch processing with metrics', async () => {\r\n      const items = Array.from({ length: 100 }, (_, i) => ({ id: i }));\r\n      let success = 0;\r\n      let failed = 0;\r\n\r\n      for (const _item of items) {\r\n        try {\r\n          // 5%の確率で失敗\r\n          if (Math.random() < 0.05) {\r\n            throw new Error('Random failure');\r\n          }\r\n          success++;\r\n        } catch (error) {\r\n          failed++;\r\n        }\r\n      }\r\n\r\n      // バッチ結果メトリクス送信\r\n      await sendBatchResultMetrics(success, failed, 'BatchFunction');\r\n\r\n      const { CloudWatchClient } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      \r\n      expect(mockClient.send).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n\r\n  describe('sendDisclosuresCollectedMetric', () => {\r\n    it('should send disclosures collected metric without function name', async () => {\r\n      await sendDisclosuresCollectedMetric(150);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'DisclosuresCollected',\r\n              Value: 150,\r\n              Dimensions: [],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send disclosures collected metric with function name', async () => {\r\n      await sendDisclosuresCollectedMetric(150, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'DisclosuresCollected',\r\n              Value: 150,\r\n              Dimensions: [\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('sendDisclosuresFailedMetric', () => {\r\n    it('should send disclosures failed metric without function name', async () => {\r\n      await sendDisclosuresFailedMetric(5);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'DisclosuresFailed',\r\n              Value: 5,\r\n              Dimensions: [],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send disclosures failed metric with function name', async () => {\r\n      await sendDisclosuresFailedMetric(5, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'DisclosuresFailed',\r\n              Value: 5,\r\n              Dimensions: [\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('sendCollectionSuccessRateMetric', () => {\r\n    it('should send collection success rate metric without function name', async () => {\r\n      await sendCollectionSuccessRateMetric(96.77);\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'CollectionSuccessRate',\r\n              Value: 96.77,\r\n              Unit: 'Count',\r\n              Dimensions: [],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should send collection success rate metric with function name', async () => {\r\n      await sendCollectionSuccessRateMetric(96.77, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              MetricName: 'CollectionSuccessRate',\r\n              Value: 96.77,\r\n              Unit: 'Count',\r\n              Dimensions: [\r\n                { Name: 'FunctionName', Value: 'CollectorFunction' },\r\n              ],\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle 100% success rate', async () => {\r\n      await sendCollectionSuccessRateMetric(100, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Value: 100,\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle 0% success rate', async () => {\r\n      await sendCollectionSuccessRateMetric(0, 'CollectorFunction');\r\n\r\n      const { PutMetricDataCommand } = require('@aws-sdk/client-cloudwatch');\r\n      \r\n      expect(PutMetricDataCommand).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          MetricData: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              Value: 0,\r\n            }),\r\n          ]),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Custom Metrics Integration Example', () => {\r\n    it('should demonstrate complete collection metrics workflow', async () => {\r\n      // 収集結果のシミュレーション\r\n      const collectedCount = 150;\r\n      const failedCount = 5;\r\n      const totalCount = collectedCount + failedCount;\r\n      const successRate = (collectedCount / totalCount) * 100;\r\n\r\n      // カスタムメトリクスを送信\r\n      await Promise.all([\r\n        sendDisclosuresCollectedMetric(collectedCount, 'CollectorFunction'),\r\n        sendDisclosuresFailedMetric(failedCount, 'CollectorFunction'),\r\n        sendCollectionSuccessRateMetric(successRate, 'CollectorFunction'),\r\n      ]);\r\n\r\n      const { CloudWatchClient } = require('@aws-sdk/client-cloudwatch');\r\n      const mockClient = new CloudWatchClient();\r\n      \r\n      // 3つのメトリクスが送信される\r\n      expect(mockClient.send).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('should calculate success rate correctly', async () => {\r\n      const testCases = [\r\n        { collected: 100, failed: 0, expectedRate: 100 },\r\n        { collected: 95, failed: 5, expectedRate: 95 },\r\n        { collected: 150, failed: 5, expectedRate: 96.77419354838710 },\r\n        { collected: 0, failed: 10, expectedRate: 0 },\r\n      ];\r\n\r\n      for (const testCase of testCases) {\r\n        const totalCount = testCase.collected + testCase.failed;\r\n        const successRate = totalCount > 0 \r\n          ? (testCase.collected / totalCount) * 100 \r\n          : 0;\r\n\r\n        expect(successRate).toBeCloseTo(testCase.expectedRate, 2);\r\n      }\r\n    });\r\n  });\r\n});\r\n"],"version":3}