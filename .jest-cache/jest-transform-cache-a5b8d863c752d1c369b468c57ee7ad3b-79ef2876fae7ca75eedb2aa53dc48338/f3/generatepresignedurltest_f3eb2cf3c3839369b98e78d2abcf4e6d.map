{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\generate-presigned-url.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\generate-presigned-url.test.ts"],"sourcesContent":["/**\r\n * Generate Presigned URL Unit Tests\r\n *\r\n * Requirements: 要件4.4（PDFダウンロード）、要件14.1（ユニットテスト）\r\n */\r\n\r\n// モック設定（importより前に定義）\r\njest.mock('@aws-sdk/s3-request-presigner', () => ({\r\n  getSignedUrl: jest.fn(),\r\n}));\r\n\r\njest.mock('@aws-sdk/client-s3', () => {\r\n  const actualModule = jest.requireActual('@aws-sdk/client-s3');\r\n  return {\r\n    ...actualModule,\r\n    S3Client: jest.fn().mockImplementation(() => ({})),\r\n  };\r\n});\r\n\r\njest.mock('../../../utils/logger');\r\n\r\nimport { generatePresignedUrl, generatePresignedUrls } from '../generate-presigned-url';\r\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\r\nimport { GetObjectCommand } from '@aws-sdk/client-s3';\r\n\r\nconst mockGetSignedUrl = getSignedUrl as jest.MockedFunction<typeof getSignedUrl>;\r\n\r\ndescribe('generatePresignedUrl', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('S3署名付きURLを生成できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expectedUrl =\r\n        'https://test-pdfs-bucket.s3.amazonaws.com/2024/01/15/TD20240115001.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      const url = await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      expect(url).toBe(expectedUrl);\r\n      expect(mockGetSignedUrl).toHaveBeenCalledTimes(1);\r\n      expect(mockGetSignedUrl).toHaveBeenCalledWith(\r\n        expect.anything(),\r\n        expect.any(GetObjectCommand),\r\n        { expiresIn: 3600 }\r\n      );\r\n    });\r\n\r\n    it('GetObjectCommandに正しいパラメータが設定される', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      const command = mockGetSignedUrl.mock.calls[0][1] as GetObjectCommand;\r\n      expect(command.input.Bucket).toBe('test-pdfs-bucket');\r\n      expect(command.input.Key).toBe(s3Key);\r\n    });\r\n\r\n    it('カスタム有効期限を指定できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expiresIn = 7200; // 2時間\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key, expiresIn);\r\n\r\n      // Assert\r\n      expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {\r\n        expiresIn: 7200,\r\n      });\r\n    });\r\n\r\n    it('デフォルト有効期限は3600秒（1時間）', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {\r\n        expiresIn: 3600,\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('異常系', () => {\r\n    it('S3エラーで失敗する', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const s3Error = new Error('NoSuchKey');\r\n      s3Error.name = 'NoSuchKey';\r\n\r\n      mockGetSignedUrl.mockRejectedValue(s3Error);\r\n\r\n      // Act & Assert\r\n      await expect(generatePresignedUrl(s3Key)).rejects.toThrow('NoSuchKey');\r\n    });\r\n\r\n    it('AccessDeniedエラーで失敗する', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const accessDeniedError = new Error('AccessDenied');\r\n      accessDeniedError.name = 'AccessDenied';\r\n\r\n      mockGetSignedUrl.mockRejectedValue(accessDeniedError);\r\n\r\n      // Act & Assert\r\n      await expect(generatePresignedUrl(s3Key)).rejects.toThrow('AccessDenied');\r\n    });\r\n\r\n    it('ネットワークエラーで失敗する', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const networkError = new Error('Network error');\r\n\r\n      mockGetSignedUrl.mockRejectedValue(networkError);\r\n\r\n      // Act & Assert\r\n      await expect(generatePresignedUrl(s3Key)).rejects.toThrow('Network error');\r\n    });\r\n  });\r\n\r\n  describe('エッジケース', () => {\r\n    it('環境変数S3_BUCKET_NAMEが設定されている', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      const command = mockGetSignedUrl.mock.calls[0][1] as GetObjectCommand;\r\n      expect(command.input.Bucket).toBe('test-pdfs-bucket');\r\n    });\r\n\r\n    it('S3キーに日本語が含まれる場合も処理できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/決算短信_TD20240115001.pdf';\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      const url = await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      expect(url).toBe(expectedUrl);\r\n      const command = mockGetSignedUrl.mock.calls[0][1] as GetObjectCommand;\r\n      expect(command.input.Key).toBe(s3Key);\r\n    });\r\n\r\n    it('S3キーにスペースが含まれる場合も処理できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD 20240115 001.pdf';\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      const url = await generatePresignedUrl(s3Key);\r\n\r\n      // Assert\r\n      expect(url).toBe(expectedUrl);\r\n      const command = mockGetSignedUrl.mock.calls[0][1] as GetObjectCommand;\r\n      expect(command.input.Key).toBe(s3Key);\r\n    });\r\n\r\n    it('有効期限が0秒の場合も処理できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expiresIn = 0;\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key, expiresIn);\r\n\r\n      // Assert\r\n      expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {\r\n        expiresIn: 0,\r\n      });\r\n    });\r\n\r\n    it('有効期限が最大値（604800秒=7日）の場合も処理できる', async () => {\r\n      // Arrange\r\n      const s3Key = '2024/01/15/TD20240115001.pdf';\r\n      const expiresIn = 604800; // 7日\r\n      const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';\r\n\r\n      mockGetSignedUrl.mockResolvedValue(expectedUrl);\r\n\r\n      // Act\r\n      await generatePresignedUrl(s3Key, expiresIn);\r\n\r\n      // Assert\r\n      expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {\r\n        expiresIn: 604800,\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('generatePresignedUrls', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('複数のS3署名付きURLを一括生成できる', async () => {\r\n      // Arrange\r\n      const s3Keys = [\r\n        '2024/01/15/TD20240115001.pdf',\r\n        '2024/01/15/TD20240115002.pdf',\r\n        '2024/01/16/TD20240116001.pdf',\r\n      ];\r\n\r\n      mockGetSignedUrl.mockImplementation(async (client, command) => {\r\n        const key = (command as GetObjectCommand).input.Key;\r\n        return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;\r\n      });\r\n\r\n      // Act\r\n      const urlMap = await generatePresignedUrls(s3Keys);\r\n\r\n      // Assert\r\n      expect(urlMap.size).toBe(3);\r\n      expect(urlMap.get(s3Keys[0])).toContain(s3Keys[0]);\r\n      expect(urlMap.get(s3Keys[1])).toContain(s3Keys[1]);\r\n      expect(urlMap.get(s3Keys[2])).toContain(s3Keys[2]);\r\n      expect(mockGetSignedUrl).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('空配列の場合、空のMapを返す', async () => {\r\n      // Arrange\r\n      const s3Keys: string[] = [];\r\n\r\n      // Act\r\n      const urlMap = await generatePresignedUrls(s3Keys);\r\n\r\n      // Assert\r\n      expect(urlMap.size).toBe(0);\r\n      expect(mockGetSignedUrl).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('カスタム有効期限を指定できる', async () => {\r\n      // Arrange\r\n      const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];\r\n      const expiresIn = 7200; // 2時間\r\n\r\n      mockGetSignedUrl.mockImplementation(async (client, command) => {\r\n        const key = (command as GetObjectCommand).input.Key;\r\n        return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;\r\n      });\r\n\r\n      // Act\r\n      await generatePresignedUrls(s3Keys, expiresIn);\r\n\r\n      // Assert\r\n      expect(mockGetSignedUrl).toHaveBeenCalledTimes(2);\r\n      mockGetSignedUrl.mock.calls.forEach((call) => {\r\n        expect(call[2]).toEqual({ expiresIn: 7200 });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('部分的失敗', () => {\r\n    it('一部のURLが失敗しても、成功したURLは返す', async () => {\r\n      // Arrange\r\n      const s3Keys = [\r\n        '2024/01/15/TD20240115001.pdf',\r\n        '2024/01/15/TD20240115002.pdf',\r\n        '2024/01/16/TD20240116001.pdf',\r\n      ];\r\n\r\n      mockGetSignedUrl.mockImplementation(async (client, command) => {\r\n        const key = (command as GetObjectCommand).input.Key;\r\n        if (key === s3Keys[1]) {\r\n          throw new Error('NoSuchKey');\r\n        }\r\n        return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;\r\n      });\r\n\r\n      // Act\r\n      const urlMap = await generatePresignedUrls(s3Keys);\r\n\r\n      // Assert\r\n      expect(urlMap.size).toBe(2);\r\n      expect(urlMap.has(s3Keys[0])).toBe(true);\r\n      expect(urlMap.has(s3Keys[1])).toBe(false); // 失敗したキーは含まれない\r\n      expect(urlMap.has(s3Keys[2])).toBe(true);\r\n    });\r\n\r\n    it('全てのURLが失敗した場合、空のMapを返す', async () => {\r\n      // Arrange\r\n      const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];\r\n\r\n      mockGetSignedUrl.mockRejectedValue(new Error('AccessDenied'));\r\n\r\n      // Act\r\n      const urlMap = await generatePresignedUrls(s3Keys);\r\n\r\n      // Assert\r\n      expect(urlMap.size).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('並行処理', () => {\r\n    it('複数のURLを並行生成する', async () => {\r\n      // Arrange\r\n      const s3Keys = [\r\n        '2024/01/15/TD20240115001.pdf',\r\n        '2024/01/15/TD20240115002.pdf',\r\n        '2024/01/16/TD20240116001.pdf',\r\n        '2024/01/16/TD20240116002.pdf',\r\n        '2024/01/17/TD20240117001.pdf',\r\n      ];\r\n\r\n      let concurrentCalls = 0;\r\n      let maxConcurrentCalls = 0;\r\n\r\n      mockGetSignedUrl.mockImplementation(async (client, command) => {\r\n        concurrentCalls++;\r\n        maxConcurrentCalls = Math.max(maxConcurrentCalls, concurrentCalls);\r\n\r\n        // 非同期処理をシミュレート\r\n        await new Promise((resolve) => setTimeout(resolve, 10));\r\n\r\n        concurrentCalls--;\r\n        const key = (command as GetObjectCommand).input.Key;\r\n        return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;\r\n      });\r\n\r\n      // Act\r\n      await generatePresignedUrls(s3Keys);\r\n\r\n      // Assert\r\n      expect(maxConcurrentCalls).toBeGreaterThan(1); // 並行実行されている\r\n    });\r\n  });\r\n});\r\n"],"version":3}