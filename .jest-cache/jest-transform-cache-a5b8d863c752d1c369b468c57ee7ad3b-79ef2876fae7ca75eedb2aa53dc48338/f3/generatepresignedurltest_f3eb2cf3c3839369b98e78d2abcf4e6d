c095cf753b7e3fa34a4160a017e3d92a
"use strict";
/**
 * Generate Presigned URL Unit Tests
 *
 * Requirements: 要件4.4（PDFダウンロード）、要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック設定（importより前に定義）
jest.mock('@aws-sdk/s3-request-presigner', () => ({
    getSignedUrl: jest.fn(),
}));
jest.mock('@aws-sdk/client-s3', () => {
    const actualModule = jest.requireActual('@aws-sdk/client-s3');
    return {
        ...actualModule,
        S3Client: jest.fn().mockImplementation(() => ({})),
    };
});
jest.mock('../../../utils/logger');
const generate_presigned_url_1 = require("../generate-presigned-url");
const s3_request_presigner_1 = require("@aws-sdk/s3-request-presigner");
const client_s3_1 = require("@aws-sdk/client-s3");
const mockGetSignedUrl = s3_request_presigner_1.getSignedUrl;
describe('generatePresignedUrl', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('正常系', () => {
        it('S3署名付きURLを生成できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/2024/01/15/TD20240115001.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(1);
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.any(client_s3_1.GetObjectCommand), { expiresIn: 3600 });
        });
        it('GetObjectCommandに正しいパラメータが設定される', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Bucket).toBe('test-pdfs-bucket');
            expect(command.input.Key).toBe(s3Key);
        });
        it('カスタム有効期限を指定できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 7200; // 2時間
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 7200,
            });
        });
        it('デフォルト有効期限は3600秒（1時間）', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 3600,
            });
        });
    });
    describe('異常系', () => {
        it('S3エラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const s3Error = new Error('NoSuchKey');
            s3Error.name = 'NoSuchKey';
            mockGetSignedUrl.mockRejectedValue(s3Error);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('NoSuchKey');
        });
        it('AccessDeniedエラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const accessDeniedError = new Error('AccessDenied');
            accessDeniedError.name = 'AccessDenied';
            mockGetSignedUrl.mockRejectedValue(accessDeniedError);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('AccessDenied');
        });
        it('ネットワークエラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const networkError = new Error('Network error');
            mockGetSignedUrl.mockRejectedValue(networkError);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('Network error');
        });
    });
    describe('エッジケース', () => {
        it('環境変数S3_BUCKET_NAMEが設定されている', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Bucket).toBe('test-pdfs-bucket');
        });
        it('S3キーに日本語が含まれる場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/決算短信_TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Key).toBe(s3Key);
        });
        it('S3キーにスペースが含まれる場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD 20240115 001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Key).toBe(s3Key);
        });
        it('有効期限が0秒の場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 0;
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 0,
            });
        });
        it('有効期限が最大値（604800秒=7日）の場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 604800; // 7日
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 604800,
            });
        });
    });
});
describe('generatePresignedUrls', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('正常系', () => {
        it('複数のS3署名付きURLを一括生成できる', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
            ];
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(3);
            expect(urlMap.get(s3Keys[0])).toContain(s3Keys[0]);
            expect(urlMap.get(s3Keys[1])).toContain(s3Keys[1]);
            expect(urlMap.get(s3Keys[2])).toContain(s3Keys[2]);
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(3);
        });
        it('空配列の場合、空のMapを返す', async () => {
            // Arrange
            const s3Keys = [];
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(0);
            expect(mockGetSignedUrl).not.toHaveBeenCalled();
        });
        it('カスタム有効期限を指定できる', async () => {
            // Arrange
            const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];
            const expiresIn = 7200; // 2時間
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(2);
            mockGetSignedUrl.mock.calls.forEach((call) => {
                expect(call[2]).toEqual({ expiresIn: 7200 });
            });
        });
    });
    describe('部分的失敗', () => {
        it('一部のURLが失敗しても、成功したURLは返す', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
            ];
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                if (key === s3Keys[1]) {
                    throw new Error('NoSuchKey');
                }
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(2);
            expect(urlMap.has(s3Keys[0])).toBe(true);
            expect(urlMap.has(s3Keys[1])).toBe(false); // 失敗したキーは含まれない
            expect(urlMap.has(s3Keys[2])).toBe(true);
        });
        it('全てのURLが失敗した場合、空のMapを返す', async () => {
            // Arrange
            const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];
            mockGetSignedUrl.mockRejectedValue(new Error('AccessDenied'));
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(0);
        });
    });
    describe('並行処理', () => {
        it('複数のURLを並行生成する', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
                '2024/01/16/TD20240116002.pdf',
                '2024/01/17/TD20240117001.pdf',
            ];
            let concurrentCalls = 0;
            let maxConcurrentCalls = 0;
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                concurrentCalls++;
                maxConcurrentCalls = Math.max(maxConcurrentCalls, concurrentCalls);
                // 非同期処理をシミュレート
                await new Promise((resolve) => setTimeout(resolve, 10));
                concurrentCalls--;
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(maxConcurrentCalls).toBeGreaterThan(1); // 並行実行されている
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXHF1ZXJ5XFxfX3Rlc3RzX19cXGdlbmVyYXRlLXByZXNpZ25lZC11cmwudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFFSCxzQkFBc0I7QUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3hCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbkMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzlELE9BQU87UUFDTCxHQUFHLFlBQVk7UUFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDbkQsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRW5DLHNFQUF3RjtBQUN4Rix3RUFBNkQ7QUFDN0Qsa0RBQXNEO0FBRXRELE1BQU0sZ0JBQWdCLEdBQUcsbUNBQXdELENBQUM7QUFFbEYsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLGtCQUFrQixDQUFDO1FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLGdCQUFnQixDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLGlCQUFpQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9CLFVBQVU7WUFDVixNQUFNLEtBQUssR0FBRyw4QkFBOEIsQ0FBQztZQUM3QyxNQUFNLFdBQVcsR0FDZiw4SEFBOEgsQ0FBQztZQUVqSSxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVoRCxNQUFNO1lBQ04sTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFBLDZDQUFvQixFQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTlDLFNBQVM7WUFDVCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUMzQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsNEJBQWdCLENBQUMsRUFDNUIsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQ3BCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxXQUFXLEdBQUcsK0NBQStDLENBQUM7WUFFcEUsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFaEQsTUFBTTtZQUNOLE1BQU0sSUFBQSw2Q0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUVsQyxTQUFTO1lBQ1QsTUFBTSxPQUFPLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQXFCLENBQUM7WUFDdEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdCQUFnQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlCLFVBQVU7WUFDVixNQUFNLEtBQUssR0FBRyw4QkFBOEIsQ0FBQztZQUM3QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyxNQUFNO1lBQzlCLE1BQU0sV0FBVyxHQUFHLCtDQUErQyxDQUFDO1lBRXBFLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRWhELE1BQU07WUFDTixNQUFNLElBQUEsNkNBQW9CLEVBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRTdDLFNBQVM7WUFDVCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUNsRixTQUFTLEVBQUUsSUFBSTthQUNoQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwQyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxXQUFXLEdBQUcsK0NBQStDLENBQUM7WUFFcEUsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFaEQsTUFBTTtZQUNOLE1BQU0sSUFBQSw2Q0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUVsQyxTQUFTO1lBQ1QsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sQ0FBQyxRQUFRLEVBQUUsRUFBRTtnQkFDbEYsU0FBUyxFQUFFLElBQUk7YUFDaEIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFO1FBQ25CLEVBQUUsQ0FBQyxZQUFZLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUIsVUFBVTtZQUNWLE1BQU0sS0FBSyxHQUFHLDhCQUE4QixDQUFDO1lBQzdDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDO1lBRTNCLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTVDLGVBQWU7WUFDZixNQUFNLE1BQU0sQ0FBQyxJQUFBLDZDQUFvQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN6RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwQyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUNwRCxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsY0FBYyxDQUFDO1lBRXhDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFFdEQsZUFBZTtZQUNmLE1BQU0sTUFBTSxDQUFDLElBQUEsNkNBQW9CLEVBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdCQUFnQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlCLFVBQVU7WUFDVixNQUFNLEtBQUssR0FBRyw4QkFBOEIsQ0FBQztZQUM3QyxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUVoRCxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUVqRCxlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQUMsSUFBQSw2Q0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDN0UsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxQyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxXQUFXLEdBQUcsK0NBQStDLENBQUM7WUFFcEUsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFaEQsTUFBTTtZQUNOLE1BQU0sSUFBQSw2Q0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUVsQyxTQUFTO1lBQ1QsTUFBTSxPQUFPLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQXFCLENBQUM7WUFDdEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckMsVUFBVTtZQUNWLE1BQU0sS0FBSyxHQUFHLG1DQUFtQyxDQUFDO1lBQ2xELE1BQU0sV0FBVyxHQUFHLCtDQUErQyxDQUFDO1lBRXBFLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRWhELE1BQU07WUFDTixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUEsNkNBQW9CLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFFOUMsU0FBUztZQUNULE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDOUIsTUFBTSxPQUFPLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQXFCLENBQUM7WUFDdEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdCQUF3QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RDLFVBQVU7WUFDVixNQUFNLEtBQUssR0FBRyxnQ0FBZ0MsQ0FBQztZQUMvQyxNQUFNLFdBQVcsR0FBRywrQ0FBK0MsQ0FBQztZQUVwRSxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVoRCxNQUFNO1lBQ04sTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFBLDZDQUFvQixFQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTlDLFNBQVM7WUFDVCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sT0FBTyxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFxQixDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoQyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLE1BQU0sV0FBVyxHQUFHLCtDQUErQyxDQUFDO1lBRXBFLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRWhELE1BQU07WUFDTixNQUFNLElBQUEsNkNBQW9CLEVBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRTdDLFNBQVM7WUFDVCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUNsRixTQUFTLEVBQUUsQ0FBQzthQUNiLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLFVBQVU7WUFDVixNQUFNLEtBQUssR0FBRyw4QkFBOEIsQ0FBQztZQUM3QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsQ0FBQyxLQUFLO1lBQy9CLE1BQU0sV0FBVyxHQUFHLCtDQUErQyxDQUFDO1lBRXBFLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRWhELE1BQU07WUFDTixNQUFNLElBQUEsNkNBQW9CLEVBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRTdDLFNBQVM7WUFDVCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUNsRixTQUFTLEVBQUUsTUFBTTthQUNsQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsa0JBQWtCLENBQUM7UUFDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsZ0JBQWdCLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRTtRQUNuQixFQUFFLENBQUMsc0JBQXNCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDcEMsVUFBVTtZQUNWLE1BQU0sTUFBTSxHQUFHO2dCQUNiLDhCQUE4QjtnQkFDOUIsOEJBQThCO2dCQUM5Qiw4QkFBOEI7YUFDL0IsQ0FBQztZQUVGLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQzVELE1BQU0sR0FBRyxHQUFJLE9BQTRCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDcEQsT0FBTyw2Q0FBNkMsR0FBRyxZQUFZLENBQUM7WUFDdEUsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDhDQUFxQixFQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRW5ELFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQixVQUFVO1lBQ1YsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO1lBRTVCLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsOENBQXFCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFbkQsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdCQUFnQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlCLFVBQVU7WUFDVixNQUFNLE1BQU0sR0FBRyxDQUFDLDhCQUE4QixFQUFFLDhCQUE4QixDQUFDLENBQUM7WUFDaEYsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsTUFBTTtZQUU5QixnQkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFO2dCQUM1RCxNQUFNLEdBQUcsR0FBSSxPQUE0QixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7Z0JBQ3BELE9BQU8sNkNBQTZDLEdBQUcsWUFBWSxDQUFDO1lBQ3RFLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTTtZQUNOLE1BQU0sSUFBQSw4Q0FBcUIsRUFBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFL0MsU0FBUztZQUNULE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUMvQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUNyQixFQUFFLENBQUMseUJBQXlCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkMsVUFBVTtZQUNWLE1BQU0sTUFBTSxHQUFHO2dCQUNiLDhCQUE4QjtnQkFDOUIsOEJBQThCO2dCQUM5Qiw4QkFBOEI7YUFDL0IsQ0FBQztZQUVGLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQzVELE1BQU0sR0FBRyxHQUFJLE9BQTRCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDcEQsSUFBSSxHQUFHLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQ0QsT0FBTyw2Q0FBNkMsR0FBRyxZQUFZLENBQUM7WUFDdEUsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDhDQUFxQixFQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRW5ELFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGVBQWU7WUFDMUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0JBQXdCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEMsVUFBVTtZQUNWLE1BQU0sTUFBTSxHQUFHLENBQUMsOEJBQThCLEVBQUUsOEJBQThCLENBQUMsQ0FBQztZQUVoRixnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1lBRTlELE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsOENBQXFCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFbkQsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtRQUNwQixFQUFFLENBQUMsZUFBZSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdCLFVBQVU7WUFDVixNQUFNLE1BQU0sR0FBRztnQkFDYiw4QkFBOEI7Z0JBQzlCLDhCQUE4QjtnQkFDOUIsOEJBQThCO2dCQUM5Qiw4QkFBOEI7Z0JBQzlCLDhCQUE4QjthQUMvQixDQUFDO1lBRUYsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDO1lBQ3hCLElBQUksa0JBQWtCLEdBQUcsQ0FBQyxDQUFDO1lBRTNCLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQzVELGVBQWUsRUFBRSxDQUFDO2dCQUNsQixrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLGVBQWUsQ0FBQyxDQUFDO2dCQUVuRSxlQUFlO2dCQUNmLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFeEQsZUFBZSxFQUFFLENBQUM7Z0JBQ2xCLE1BQU0sR0FBRyxHQUFJLE9BQTRCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDcEQsT0FBTyw2Q0FBNkMsR0FBRyxZQUFZLENBQUM7WUFDdEUsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNO1lBQ04sTUFBTSxJQUFBLDhDQUFxQixFQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRXBDLFNBQVM7WUFDVCxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZO1FBQzdELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxccXVlcnlcXF9fdGVzdHNfX1xcZ2VuZXJhdGUtcHJlc2lnbmVkLXVybC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBHZW5lcmF0ZSBQcmVzaWduZWQgVVJMIFVuaXQgVGVzdHNcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7Y0LjTvvIhQREbjg4Djgqbjg7Pjg63jg7zjg4nvvInjgIHopoHku7YxNC4x77yI44Om44OL44OD44OI44OG44K544OI77yJXHJcbiAqL1xyXG5cclxuLy8g44Oi44OD44Kv6Kit5a6a77yIaW1wb3J044KI44KK5YmN44Gr5a6a576p77yJXHJcbmplc3QubW9jaygnQGF3cy1zZGsvczMtcmVxdWVzdC1wcmVzaWduZXInLCAoKSA9PiAoe1xyXG4gIGdldFNpZ25lZFVybDogamVzdC5mbigpLFxyXG59KSk7XHJcblxyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1zMycsICgpID0+IHtcclxuICBjb25zdCBhY3R1YWxNb2R1bGUgPSBqZXN0LnJlcXVpcmVBY3R1YWwoJ0Bhd3Mtc2RrL2NsaWVudC1zMycpO1xyXG4gIHJldHVybiB7XHJcbiAgICAuLi5hY3R1YWxNb2R1bGUsXHJcbiAgICBTM0NsaWVudDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe30pKSxcclxuICB9O1xyXG59KTtcclxuXHJcbmplc3QubW9jaygnLi4vLi4vLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG5pbXBvcnQgeyBnZW5lcmF0ZVByZXNpZ25lZFVybCwgZ2VuZXJhdGVQcmVzaWduZWRVcmxzIH0gZnJvbSAnLi4vZ2VuZXJhdGUtcHJlc2lnbmVkLXVybCc7XHJcbmltcG9ydCB7IGdldFNpZ25lZFVybCB9IGZyb20gJ0Bhd3Mtc2RrL3MzLXJlcXVlc3QtcHJlc2lnbmVyJztcclxuaW1wb3J0IHsgR2V0T2JqZWN0Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcblxyXG5jb25zdCBtb2NrR2V0U2lnbmVkVXJsID0gZ2V0U2lnbmVkVXJsIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGdldFNpZ25lZFVybD47XHJcblxyXG5kZXNjcmliZSgnZ2VuZXJhdGVQcmVzaWduZWRVcmwnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIHByb2Nlc3MuZW52LlMzX0JVQ0tFVF9OQU1FID0gJ3Rlc3QtcGRmcy1idWNrZXQnO1xyXG4gICAgcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiA9ICdhcC1ub3J0aGVhc3QtMSc7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfmraPluLjns7snLCAoKSA9PiB7XHJcbiAgICBpdCgnUzPnvbLlkI3ku5jjgY1VUkzjgpLnlJ/miJDjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID1cclxuICAgICAgICAnaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZj9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPS4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCB1cmwgPSBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHVybCkudG9CZShleHBlY3RlZFVybCk7XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKSxcclxuICAgICAgICBleHBlY3QuYW55KEdldE9iamVjdENvbW1hbmQpLFxyXG4gICAgICAgIHsgZXhwaXJlc0luOiAzNjAwIH1cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdHZXRPYmplY3RDb21tYW5k44Gr5q2j44GX44GE44OR44Op44Oh44O844K/44GM6Kit5a6a44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXkpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrR2V0U2lnbmVkVXJsLm1vY2suY2FsbHNbMF1bMV0gYXMgR2V0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuQnVja2V0KS50b0JlKCd0ZXN0LXBkZnMtYnVja2V0Jyk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LktleSkudG9CZShzM0tleSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44Kr44K544K/44Og5pyJ5Yq55pyf6ZmQ44KS5oyH5a6a44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBpcmVzSW4gPSA3MjAwOyAvLyAy5pmC6ZaTXHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gJ2h0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLy4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSwgZXhwaXJlc0luKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0dldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueXRoaW5nKCksIGV4cGVjdC5hbnl0aGluZygpLCB7XHJcbiAgICAgICAgZXhwaXJlc0luOiA3MjAwLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjg4fjg5Xjgqnjg6vjg4jmnInlirnmnJ/pmZDjga8zNjAw56eS77yIMeaZgumWk++8iScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleSA9ICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPSAnaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vLi4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0dldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueXRoaW5nKCksIGV4cGVjdC5hbnl0aGluZygpLCB7XHJcbiAgICAgICAgZXhwaXJlc0luOiAzNjAwLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn55Ww5bi457O7JywgKCkgPT4ge1xyXG4gICAgaXQoJ1Mz44Ko44Op44O844Gn5aSx5pWX44GZ44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBzM0Vycm9yID0gbmV3IEVycm9yKCdOb1N1Y2hLZXknKTtcclxuICAgICAgczNFcnJvci5uYW1lID0gJ05vU3VjaEtleSc7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZWplY3RlZFZhbHVlKHMzRXJyb3IpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSkpLnJlamVjdHMudG9UaHJvdygnTm9TdWNoS2V5Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnQWNjZXNzRGVuaWVk44Ko44Op44O844Gn5aSx5pWX44GZ44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBhY2Nlc3NEZW5pZWRFcnJvciA9IG5ldyBFcnJvcignQWNjZXNzRGVuaWVkJyk7XHJcbiAgICAgIGFjY2Vzc0RlbmllZEVycm9yLm5hbWUgPSAnQWNjZXNzRGVuaWVkJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1JlamVjdGVkVmFsdWUoYWNjZXNzRGVuaWVkRXJyb3IpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSkpLnJlamVjdHMudG9UaHJvdygnQWNjZXNzRGVuaWVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44ON44OD44OI44Ov44O844Kv44Ko44Op44O844Gn5aSx5pWX44GZ44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBuZXcgRXJyb3IoJ05ldHdvcmsgZXJyb3InKTtcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1JlamVjdGVkVmFsdWUobmV0d29ya0Vycm9yKTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3QoZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXkpKS5yZWplY3RzLnRvVGhyb3coJ05ldHdvcmsgZXJyb3InKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn44Ko44OD44K444Kx44O844K5JywgKCkgPT4ge1xyXG4gICAgaXQoJ+eSsOWig+WkieaVsFMzX0JVQ0tFVF9OQU1F44GM6Kit5a6a44GV44KM44Gm44GE44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXkpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrR2V0U2lnbmVkVXJsLm1vY2suY2FsbHNbMF1bMV0gYXMgR2V0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuQnVja2V0KS50b0JlKCd0ZXN0LXBkZnMtYnVja2V0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnUzPjgq3jg7zjgavml6XmnKzoqp7jgYzlkKvjgb7jgozjgovloLTlkIjjgoLlh6bnkIbjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS/msbrnrpfnn63kv6FfVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgdXJsID0gYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXkpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdCh1cmwpLnRvQmUoZXhwZWN0ZWRVcmwpO1xyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja0dldFNpZ25lZFVybC5tb2NrLmNhbGxzWzBdWzFdIGFzIEdldE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LktleSkudG9CZShzM0tleSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnUzPjgq3jg7zjgavjgrnjg5rjg7zjgrnjgYzlkKvjgb7jgozjgovloLTlkIjjgoLlh6bnkIbjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URCAyMDI0MDExNSAwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPSAnaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vLi4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsKS50b0JlKGV4cGVjdGVkVXJsKTtcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tHZXRTaWduZWRVcmwubW9jay5jYWxsc1swXVsxXSBhcyBHZXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5LZXkpLnRvQmUoczNLZXkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+acieWKueacn+mZkOOBjDDnp5Ljga7loLTlkIjjgoLlh6bnkIbjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IDA7XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gJ2h0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLy4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSwgZXhwaXJlc0luKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0dldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueXRoaW5nKCksIGV4cGVjdC5hbnl0aGluZygpLCB7XHJcbiAgICAgICAgZXhwaXJlc0luOiAwLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmnInlirnmnJ/pmZDjgYzmnIDlpKflgKTvvIg2MDQ4MDDnp5I9N+aXpe+8ieOBruWgtOWQiOOCguWHpueQhuOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleSA9ICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwaXJlc0luID0gNjA0ODAwOyAvLyA35pelXHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gJ2h0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLy4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSwgZXhwaXJlc0luKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0dldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueXRoaW5nKCksIGV4cGVjdC5hbnl0aGluZygpLCB7XHJcbiAgICAgICAgZXhwaXJlc0luOiA2MDQ4MDAsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ2dlbmVyYXRlUHJlc2lnbmVkVXJscycsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgcHJvY2Vzcy5lbnYuUzNfQlVDS0VUX05BTUUgPSAndGVzdC1wZGZzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+ato+W4uOezuycsICgpID0+IHtcclxuICAgIGl0KCfopIfmlbDjga5TM+e9suWQjeS7mOOBjVVSTOOCkuS4gOaLrOeUn+aIkOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleXMgPSBbXHJcbiAgICAgICAgJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnLFxyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNi9URDIwMjQwMTE2MDAxLnBkZicsXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2xpZW50LCBjb21tYW5kKSA9PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gKGNvbW1hbmQgYXMgR2V0T2JqZWN0Q29tbWFuZCkuaW5wdXQuS2V5O1xyXG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vJHtrZXl9P1gtQW16LS4uLmA7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybE1hcCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJscyhzM0tleXMpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuc2l6ZSkudG9CZSgzKTtcclxuICAgICAgZXhwZWN0KHVybE1hcC5nZXQoczNLZXlzWzBdKSkudG9Db250YWluKHMzS2V5c1swXSk7XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuZ2V0KHMzS2V5c1sxXSkpLnRvQ29udGFpbihzM0tleXNbMV0pO1xyXG4gICAgICBleHBlY3QodXJsTWFwLmdldChzM0tleXNbMl0pKS50b0NvbnRhaW4oczNLZXlzWzJdKTtcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfnqbrphY3liJfjga7loLTlkIjjgIHnqbrjga5NYXDjgpLov5TjgZknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXlzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybE1hcCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJscyhzM0tleXMpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuc2l6ZSkudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44Kr44K544K/44Og5pyJ5Yq55pyf6ZmQ44KS5oyH5a6a44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5cyA9IFsnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZicsICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJ107XHJcbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IDcyMDA7IC8vIDLmmYLplpNcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjbGllbnQsIGNvbW1hbmQpID0+IHtcclxuICAgICAgICBjb25zdCBrZXkgPSAoY29tbWFuZCBhcyBHZXRPYmplY3RDb21tYW5kKS5pbnB1dC5LZXk7XHJcbiAgICAgICAgcmV0dXJuIGBodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8ke2tleX0/WC1BbXotLi4uYDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmxzKHMzS2V5cywgZXhwaXJlc0luKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0dldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2suY2FsbHMuZm9yRWFjaCgoY2FsbCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChjYWxsWzJdKS50b0VxdWFsKHsgZXhwaXJlc0luOiA3MjAwIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn6YOo5YiG55qE5aSx5pWXJywgKCkgPT4ge1xyXG4gICAgaXQoJ+S4gOmDqOOBrlVSTOOBjOWkseaVl+OBl+OBpuOCguOAgeaIkOWKn+OBl+OBn1VSTOOBr+i/lOOBmScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleXMgPSBbXHJcbiAgICAgICAgJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnLFxyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNi9URDIwMjQwMTE2MDAxLnBkZicsXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2xpZW50LCBjb21tYW5kKSA9PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gKGNvbW1hbmQgYXMgR2V0T2JqZWN0Q29tbWFuZCkuaW5wdXQuS2V5O1xyXG4gICAgICAgIGlmIChrZXkgPT09IHMzS2V5c1sxXSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb1N1Y2hLZXknKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGBodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8ke2tleX0/WC1BbXotLi4uYDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgdXJsTWFwID0gYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmxzKHMzS2V5cyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHVybE1hcC5zaXplKS50b0JlKDIpO1xyXG4gICAgICBleHBlY3QodXJsTWFwLmhhcyhzM0tleXNbMF0pKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QodXJsTWFwLmhhcyhzM0tleXNbMV0pKS50b0JlKGZhbHNlKTsgLy8g5aSx5pWX44GX44Gf44Kt44O844Gv5ZCr44G+44KM44Gq44GEXHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuaGFzKHMzS2V5c1syXSkpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5YWo44Gm44GuVVJM44GM5aSx5pWX44GX44Gf5aC05ZCI44CB56m644GuTWFw44KS6L+U44GZJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5cyA9IFsnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZicsICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJ107XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQWNjZXNzRGVuaWVkJykpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybE1hcCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJscyhzM0tleXMpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuc2l6ZSkudG9CZSgwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn5Lim6KGM5Yem55CGJywgKCkgPT4ge1xyXG4gICAgaXQoJ+ikh+aVsOOBrlVSTOOCkuS4puihjOeUn+aIkOOBmeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleXMgPSBbXHJcbiAgICAgICAgJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnLFxyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNi9URDIwMjQwMTE2MDAxLnBkZicsXHJcbiAgICAgICAgJzIwMjQvMDEvMTYvVEQyMDI0MDExNjAwMi5wZGYnLFxyXG4gICAgICAgICcyMDI0LzAxLzE3L1REMjAyNDAxMTcwMDEucGRmJyxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGxldCBjb25jdXJyZW50Q2FsbHMgPSAwO1xyXG4gICAgICBsZXQgbWF4Q29uY3VycmVudENhbGxzID0gMDtcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjbGllbnQsIGNvbW1hbmQpID0+IHtcclxuICAgICAgICBjb25jdXJyZW50Q2FsbHMrKztcclxuICAgICAgICBtYXhDb25jdXJyZW50Q2FsbHMgPSBNYXRoLm1heChtYXhDb25jdXJyZW50Q2FsbHMsIGNvbmN1cnJlbnRDYWxscyk7XHJcblxyXG4gICAgICAgIC8vIOmdnuWQjOacn+WHpueQhuOCkuOCt+ODn+ODpeODrOODvOODiFxyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwKSk7XHJcblxyXG4gICAgICAgIGNvbmN1cnJlbnRDYWxscy0tO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IChjb21tYW5kIGFzIEdldE9iamVjdENvbW1hbmQpLmlucHV0LktleTtcclxuICAgICAgICByZXR1cm4gYGh0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLyR7a2V5fT9YLUFtei0uLi5gO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybHMoczNLZXlzKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobWF4Q29uY3VycmVudENhbGxzKS50b0JlR3JlYXRlclRoYW4oMSk7IC8vIOS4puihjOWun+ihjOOBleOCjOOBpuOBhOOCi1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=