{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\tdnet-data-collector-stack.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\tdnet-data-collector-stack.ts"],"sourcesContent":["import * as cdk from 'aws-cdk-lib';\r\nimport * as dynamodb from 'aws-cdk-lib/aws-dynamodb';\r\nimport * as s3 from 'aws-cdk-lib/aws-s3';\r\nimport * as lambda from 'aws-cdk-lib/aws-lambda';\r\nimport * as apigateway from 'aws-cdk-lib/aws-apigateway';\r\nimport * as wafv2 from 'aws-cdk-lib/aws-wafv2';\r\nimport * as secretsmanager from 'aws-cdk-lib/aws-secretsmanager';\r\nimport { Construct } from 'constructs';\r\nimport { Environment, getEnvironmentConfig } from './config/environment-config';\r\n\r\n/**\r\n * Stack properties with environment configuration\r\n */\r\nexport interface TdnetDataCollectorStackProps extends cdk.StackProps {\r\n  /**\r\n   * Environment configuration (optional, defaults to 'dev')\r\n   */\r\n  environmentConfig?: {\r\n    environment: Environment;\r\n  };\r\n}\r\n\r\nexport class TdnetDataCollectorStack extends cdk.Stack {\r\n  // Public properties for cross-stack references\r\n  public readonly disclosuresTable: dynamodb.Table;\r\n  public readonly executionsTable: dynamodb.Table;\r\n  public readonly exportStatusTable: dynamodb.Table;\r\n  public readonly pdfsBucket: s3.Bucket;\r\n  public readonly exportsBucket: s3.Bucket;\r\n  public readonly dashboardBucket: s3.Bucket;\r\n  public readonly cloudtrailLogsBucket: s3.Bucket;\r\n  public readonly api: apigateway.RestApi;\r\n  public readonly apiKey: apigateway.ApiKey;\r\n  public readonly webAcl: wafv2.CfnWebACL;\r\n\r\n  // Environment configuration (renamed to avoid conflict with base class)\r\n  private readonly deploymentEnvironment: Environment;\r\n\r\n  constructor(scope: Construct, id: string, props?: TdnetDataCollectorStackProps) {\r\n    super(scope, id, props);\r\n\r\n    // Extract environment configuration (default to 'dev')\r\n    this.deploymentEnvironment = props?.environmentConfig?.environment ?? 'dev';\r\n\r\n    // Get environment-specific Lambda configurations\r\n    const envConfig = getEnvironmentConfig(this.deploymentEnvironment);\r\n\r\n    // Helper function to generate environment-specific resource names\r\n    const getResourceName = (baseName: string): string => {\r\n      return `${baseName}_${this.environment}`;\r\n    };\r\n\r\n    // Helper function to generate environment-specific bucket names\r\n    const getBucketName = (baseName: string): string => {\r\n      return `${baseName}-${this.environment}-${cdk.Aws.ACCOUNT_ID}`;\r\n    };\r\n\r\n    // ========================================\r\n    // Phase 1: DynamoDB Tables\r\n    // ========================================\r\n\r\n    // 1. tdnet_disclosures - 開示情報メタデータテーブル\r\n    this.disclosuresTable = new dynamodb.Table(this, 'DisclosuresTable', {\r\n      tableName: getResourceName('tdnet_disclosures'),\r\n      partitionKey: {\r\n        name: 'disclosure_id',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      billingMode: dynamodb.BillingMode.PAY_PER_REQUEST, // オンデマンドモード\r\n      encryption: dynamodb.TableEncryption.AWS_MANAGED, // AWS管理キーで暗号化\r\n      pointInTimeRecovery: true, // ポイントインタイムリカバリ有効化\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護\r\n    });\r\n\r\n    // GSI: CompanyCode_DiscloseDate - 企業コードと開示日時でクエリ\r\n    this.disclosuresTable.addGlobalSecondaryIndex({\r\n      indexName: 'GSI_CompanyCode_DiscloseDate',\r\n      partitionKey: {\r\n        name: 'company_code',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      sortKey: {\r\n        name: 'disclosed_at',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      projectionType: dynamodb.ProjectionType.ALL, // すべての属性を投影\r\n    });\r\n\r\n    // GSI: DatePartition - 月単位の効率的なクエリ（YYYY-MM形式）\r\n    this.disclosuresTable.addGlobalSecondaryIndex({\r\n      indexName: 'GSI_DatePartition',\r\n      partitionKey: {\r\n        name: 'date_partition',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      sortKey: {\r\n        name: 'disclosed_at',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      projectionType: dynamodb.ProjectionType.ALL,\r\n    });\r\n\r\n    // 2. tdnet_executions - 実行状態管理テーブル\r\n    this.executionsTable = new dynamodb.Table(this, 'ExecutionsTable', {\r\n      tableName: getResourceName('tdnet_executions'),\r\n      partitionKey: {\r\n        name: 'execution_id',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      billingMode: dynamodb.BillingMode.PAY_PER_REQUEST, // オンデマンドモード\r\n      encryption: dynamodb.TableEncryption.AWS_MANAGED, // AWS管理キーで暗号化\r\n      timeToLiveAttribute: 'ttl', // TTL有効化（30日後に自動削除）\r\n      pointInTimeRecovery: true, // ポイントインタイムリカバリ有効化\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護\r\n    });\r\n\r\n    // GSI: Status_StartedAt - 実行状態と開始日時でクエリ\r\n    this.executionsTable.addGlobalSecondaryIndex({\r\n      indexName: 'GSI_Status_StartedAt',\r\n      partitionKey: {\r\n        name: 'status',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      sortKey: {\r\n        name: 'started_at',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      projectionType: dynamodb.ProjectionType.ALL,\r\n    });\r\n\r\n    // 3. tdnet_export_status - エクスポート状態管理テーブル\r\n    this.exportStatusTable = new dynamodb.Table(this, 'ExportStatusTable', {\r\n      tableName: getResourceName('tdnet_export_status'),\r\n      partitionKey: {\r\n        name: 'export_id',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      billingMode: dynamodb.BillingMode.PAY_PER_REQUEST, // オンデマンドモード\r\n      encryption: dynamodb.TableEncryption.AWS_MANAGED, // AWS管理キーで暗号化\r\n      timeToLiveAttribute: 'ttl', // TTL有効化（30日後に自動削除）\r\n      pointInTimeRecovery: true, // ポイントインタイムリカバリ有効化\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護\r\n    });\r\n\r\n    // GSI: Status_RequestedAt - エクスポート状態とリクエスト日時でクエリ\r\n    this.exportStatusTable.addGlobalSecondaryIndex({\r\n      indexName: 'GSI_Status_RequestedAt',\r\n      partitionKey: {\r\n        name: 'status',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      sortKey: {\r\n        name: 'requested_at',\r\n        type: dynamodb.AttributeType.STRING,\r\n      },\r\n      projectionType: dynamodb.ProjectionType.ALL,\r\n    });\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'DisclosuresTableName', {\r\n      value: this.disclosuresTable.tableName,\r\n      description: 'DynamoDB table name for disclosures',\r\n      exportName: 'TdnetDisclosuresTableName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ExecutionsTableName', {\r\n      value: this.executionsTable.tableName,\r\n      description: 'DynamoDB table name for executions',\r\n      exportName: 'TdnetExecutionsTableName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ExportStatusTableName', {\r\n      value: this.exportStatusTable.tableName,\r\n      description: 'DynamoDB table name for export status',\r\n      exportName: 'TdnetExportStatusTableName',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 1: S3 Buckets\r\n    // ========================================\r\n\r\n    // 1. PDFバケット - TDnetからダウンロードしたPDFファイルの長期保存\r\n    this.pdfsBucket = new s3.Bucket(this, 'PdfsBucket', {\r\n      bucketName: getBucketName('tdnet-data-collector-pdfs'),\r\n      encryption: s3.BucketEncryption.S3_MANAGED, // S3マネージドキーで暗号化\r\n      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL, // パブリックアクセスブロック\r\n      versioned: true, // バージョニング有効化\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護\r\n      autoDeleteObjects: false, // 自動削除無効\r\n      lifecycleRules: [\r\n        {\r\n          id: 'TransitionToStandardIA',\r\n          enabled: true,\r\n          transitions: [\r\n            {\r\n              storageClass: s3.StorageClass.INFREQUENT_ACCESS,\r\n              transitionAfter: cdk.Duration.days(90), // 90日後にStandard-IAに移行\r\n            },\r\n            {\r\n              storageClass: s3.StorageClass.GLACIER,\r\n              transitionAfter: cdk.Duration.days(365), // 365日後にGlacierに移行\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    });\r\n\r\n    // 2. エクスポートバケット - ユーザーがエクスポートしたCSV/JSONファイルの一時保存\r\n    this.exportsBucket = new s3.Bucket(this, 'ExportsBucket', {\r\n      bucketName: getBucketName('tdnet-data-collector-exports'),\r\n      encryption: s3.BucketEncryption.S3_MANAGED,\r\n      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,\r\n      versioned: true,\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN,\r\n      autoDeleteObjects: false,\r\n      lifecycleRules: [\r\n        {\r\n          id: 'DeleteAfter7Days',\r\n          enabled: true,\r\n          expiration: cdk.Duration.days(7), // 7日後に自動削除\r\n        },\r\n      ],\r\n    });\r\n\r\n    // 3. ダッシュボードバケット - Webダッシュボードの静的ファイルホスティング\r\n    this.dashboardBucket = new s3.Bucket(this, 'DashboardBucket', {\r\n      bucketName: getBucketName('tdnet-dashboard'),\r\n      encryption: s3.BucketEncryption.S3_MANAGED,\r\n      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL, // CloudFront OAI経由でのみアクセス\r\n      versioned: true,\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN,\r\n      autoDeleteObjects: false,\r\n      // ライフサイクルポリシーなし（静的ファイルは永続保存）\r\n    });\r\n\r\n    // 4. CloudTrailログバケット - 監査ログの長期保存\r\n    this.cloudtrailLogsBucket = new s3.Bucket(this, 'CloudTrailLogsBucket', {\r\n      bucketName: `tdnet-cloudtrail-logs-${this.account}`,\r\n      encryption: s3.BucketEncryption.S3_MANAGED,\r\n      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,\r\n      versioned: true,\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN,\r\n      autoDeleteObjects: false,\r\n      lifecycleRules: [\r\n        {\r\n          id: 'ArchiveAndDelete',\r\n          enabled: true,\r\n          transitions: [\r\n            {\r\n              storageClass: s3.StorageClass.GLACIER,\r\n              transitionAfter: cdk.Duration.days(90), // 90日後にGlacierに移行\r\n            },\r\n          ],\r\n          expiration: cdk.Duration.days(2555), // 7年後に自動削除（コンプライアンス要件）\r\n        },\r\n      ],\r\n    });\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'PdfsBucketName', {\r\n      value: this.pdfsBucket.bucketName,\r\n      description: 'S3 bucket name for PDF files',\r\n      exportName: 'TdnetPdfsBucketName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ExportsBucketName', {\r\n      value: this.exportsBucket.bucketName,\r\n      description: 'S3 bucket name for export files',\r\n      exportName: 'TdnetExportsBucketName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'DashboardBucketName', {\r\n      value: this.dashboardBucket.bucketName,\r\n      description: 'S3 bucket name for dashboard',\r\n      exportName: 'TdnetDashboardBucketName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'CloudTrailLogsBucketName', {\r\n      value: this.cloudtrailLogsBucket.bucketName,\r\n      description: 'S3 bucket name for CloudTrail logs',\r\n      exportName: 'TdnetCloudTrailLogsBucketName',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: Secrets Manager（Lambda関数より前に初期化）\r\n    // ========================================\r\n\r\n    // IMPORTANT: apiKeyValueはLambda関数の環境変数で使用されるため、\r\n    // Lambda関数定義より前に初期化する必要があります\r\n    const apiKeyValue = secretsmanager.Secret.fromSecretNameV2(\r\n      this,\r\n      'ApiKeySecret',\r\n      '/tdnet/api-key'\r\n    );\r\n\r\n    // ========================================\r\n    // Phase 1: Lambda Functions\r\n    // ========================================\r\n\r\n    // Lambda Collector Function\r\n    const collectorFunction = new lambda.Function(this, 'CollectorFunction', {\r\n      functionName: 'tdnet-collector',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/collector'),\r\n      timeout: cdk.Duration.seconds(envConfig.collector.timeout),\r\n      memorySize: envConfig.collector.memorySize,\r\n      environment: {\r\n        DYNAMODB_TABLE: this.disclosuresTable.tableName,\r\n        DYNAMODB_EXECUTIONS_TABLE: this.executionsTable.tableName,\r\n        S3_BUCKET: this.pdfsBucket.bucketName,\r\n        LOG_LEVEL: envConfig.collector.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n      reservedConcurrentExecutions: 1, // 同時実行数を1に制限（レート制限のため）\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: 両テーブルへの読み書き権限\r\n    this.disclosuresTable.grantReadWriteData(collectorFunction);\r\n    this.executionsTable.grantReadWriteData(collectorFunction);\r\n\r\n    // S3: PDFバケットへの書き込み権限\r\n    this.pdfsBucket.grantPut(collectorFunction);\r\n    this.pdfsBucket.grantRead(collectorFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    collectorFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'CollectorFunctionName', {\r\n      value: collectorFunction.functionName,\r\n      description: 'Lambda Collector function name',\r\n      exportName: 'TdnetCollectorFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'CollectorFunctionArn', {\r\n      value: collectorFunction.functionArn,\r\n      description: 'Lambda Collector function ARN',\r\n      exportName: 'TdnetCollectorFunctionArn',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: Lambda Query Function\r\n    // ========================================\r\n\r\n    // Lambda Query Function\r\n    const queryFunction = new lambda.Function(this, 'QueryFunction', {\r\n      functionName: 'tdnet-query',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/query'),\r\n      timeout: cdk.Duration.seconds(envConfig.query.timeout),\r\n      memorySize: envConfig.query.memorySize,\r\n      environment: {\r\n        DYNAMODB_TABLE_NAME: this.disclosuresTable.tableName,\r\n        S3_BUCKET_NAME: this.pdfsBucket.bucketName,\r\n        API_KEY_SECRET_ARN: apiKeyValue.secretArn, // ARNのみを環境変数に設定\r\n        LOG_LEVEL: envConfig.query.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: disclosuresテーブルへの読み取り権限\r\n    this.disclosuresTable.grantReadData(queryFunction);\r\n\r\n    // S3: PDFバケットへの読み取り権限（署名付きURL生成用）\r\n    this.pdfsBucket.grantRead(queryFunction);\r\n\r\n    // Secrets Manager: APIキー読み取り権限\r\n    apiKeyValue.grantRead(queryFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    queryFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'QueryFunctionName', {\r\n      value: queryFunction.functionName,\r\n      description: 'Lambda Query function name',\r\n      exportName: 'TdnetQueryFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'QueryFunctionArn', {\r\n      value: queryFunction.functionArn,\r\n      description: 'Lambda Query function ARN',\r\n      exportName: 'TdnetQueryFunctionArn',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: Lambda Export Function\r\n    // ========================================\r\n\r\n    // Lambda Export Function\r\n    const exportFunction = new lambda.Function(this, 'ExportFunction', {\r\n      functionName: 'tdnet-export',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/export'),\r\n      timeout: cdk.Duration.seconds(envConfig.export.timeout),\r\n      memorySize: envConfig.export.memorySize,\r\n      environment: {\r\n        DYNAMODB_TABLE_NAME: this.disclosuresTable.tableName,\r\n        EXPORT_STATUS_TABLE_NAME: this.exportStatusTable.tableName,\r\n        EXPORT_BUCKET_NAME: this.exportsBucket.bucketName,\r\n        API_KEY_SECRET_ARN: apiKeyValue.secretArn, // ARNのみを環境変数に設定\r\n        LOG_LEVEL: envConfig.export.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n        // AWS_REGION is automatically set by Lambda runtime\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: disclosuresテーブルへの読み取り権限\r\n    this.disclosuresTable.grantReadData(exportFunction);\r\n\r\n    // DynamoDB: exportStatusテーブルへの読み書き権限\r\n    this.exportStatusTable.grantReadWriteData(exportFunction);\r\n\r\n    // S3: exportsバケットへの書き込み権限\r\n    this.exportsBucket.grantPut(exportFunction);\r\n    this.exportsBucket.grantRead(exportFunction);\r\n\r\n    // Secrets Manager: APIキー読み取り権限\r\n    apiKeyValue.grantRead(exportFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    exportFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'ExportFunctionName', {\r\n      value: exportFunction.functionName,\r\n      description: 'Lambda Export function name',\r\n      exportName: 'TdnetExportFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ExportFunctionArn', {\r\n      value: exportFunction.functionArn,\r\n      description: 'Lambda Export function ARN',\r\n      exportName: 'TdnetExportFunctionArn',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: API Gateway + WAF\r\n    // ========================================\r\n\r\n    // 1. API Gateway REST API\r\n    this.api = new apigateway.RestApi(this, 'TdnetApi', {\r\n      restApiName: 'tdnet-data-collector-api',\r\n      description: 'TDnet Data Collector REST API',\r\n      deployOptions: {\r\n        stageName: 'prod',\r\n        throttlingRateLimit: 100, // リクエスト/秒\r\n        throttlingBurstLimit: 200, // バーストリクエスト数\r\n        loggingLevel: apigateway.MethodLoggingLevel.INFO,\r\n        dataTraceEnabled: true,\r\n        metricsEnabled: true,\r\n      },\r\n      defaultCorsPreflightOptions: {\r\n        allowOrigins: apigateway.Cors.ALL_ORIGINS, // 本番環境では特定のオリジンに制限\r\n        allowMethods: apigateway.Cors.ALL_METHODS,\r\n        allowHeaders: [\r\n          'Content-Type',\r\n          'X-Amz-Date',\r\n          'Authorization',\r\n          'X-Api-Key',\r\n          'X-Amz-Security-Token',\r\n        ],\r\n        allowCredentials: true,\r\n      },\r\n      cloudWatchRole: true, // CloudWatch Logsへのログ出力を有効化\r\n    });\r\n\r\n    // 2. API Key生成\r\n    // Note: apiKeyValueは既にファイル先頭で初期化済み\r\n    this.apiKey = new apigateway.ApiKey(this, 'TdnetApiKey', {\r\n      apiKeyName: 'tdnet-api-key',\r\n      description: 'API Key for TDnet Data Collector',\r\n      enabled: true,\r\n      value: apiKeyValue.secretValue.unsafeUnwrap(), // Secrets Managerから取得\r\n    });\r\n\r\n    // 3. Usage Plan設定\r\n    const usagePlan = this.api.addUsagePlan('TdnetUsagePlan', {\r\n      name: 'tdnet-usage-plan',\r\n      description: 'Usage plan for TDnet Data Collector API',\r\n      throttle: {\r\n        rateLimit: 100, // リクエスト/秒\r\n        burstLimit: 200, // バーストリクエスト数\r\n      },\r\n      quota: {\r\n        limit: 10000, // 月間リクエスト数上限\r\n        period: apigateway.Period.MONTH,\r\n      },\r\n    });\r\n\r\n    usagePlan.addApiKey(this.apiKey);\r\n    usagePlan.addApiStage({\r\n      stage: this.api.deploymentStage,\r\n    });\r\n\r\n    // 4. AWS WAF Web ACL設定\r\n    this.webAcl = new wafv2.CfnWebACL(this, 'TdnetWebAcl', {\r\n      name: 'tdnet-web-acl',\r\n      scope: 'REGIONAL', // API Gatewayは REGIONAL\r\n      defaultAction: { allow: {} },\r\n      description: 'Web ACL for TDnet Data Collector API',\r\n      visibilityConfig: {\r\n        sampledRequestsEnabled: true,\r\n        cloudWatchMetricsEnabled: true,\r\n        metricName: 'TdnetWebAcl',\r\n      },\r\n      rules: [\r\n        // ルール1: レート制限（2000リクエスト/5分）\r\n        {\r\n          name: 'RateLimitRule',\r\n          priority: 1,\r\n          statement: {\r\n            rateBasedStatement: {\r\n              limit: 2000, // 5分間のリクエスト数上限\r\n              aggregateKeyType: 'IP',\r\n            },\r\n          },\r\n          action: {\r\n            block: {\r\n              customResponse: {\r\n                responseCode: 429,\r\n                customResponseBodyKey: 'RateLimitExceeded',\r\n              },\r\n            },\r\n          },\r\n          visibilityConfig: {\r\n            sampledRequestsEnabled: true,\r\n            cloudWatchMetricsEnabled: true,\r\n            metricName: 'RateLimitRule',\r\n          },\r\n        },\r\n        // ルール2: AWSマネージドルール - Common Rule Set\r\n        {\r\n          name: 'AWSManagedRulesCommonRuleSet',\r\n          priority: 2,\r\n          statement: {\r\n            managedRuleGroupStatement: {\r\n              vendorName: 'AWS',\r\n              name: 'AWSManagedRulesCommonRuleSet',\r\n            },\r\n          },\r\n          overrideAction: { none: {} },\r\n          visibilityConfig: {\r\n            sampledRequestsEnabled: true,\r\n            cloudWatchMetricsEnabled: true,\r\n            metricName: 'AWSManagedRulesCommonRuleSet',\r\n          },\r\n        },\r\n        // ルール3: AWSマネージドルール - Known Bad Inputs\r\n        {\r\n          name: 'AWSManagedRulesKnownBadInputsRuleSet',\r\n          priority: 3,\r\n          statement: {\r\n            managedRuleGroupStatement: {\r\n              vendorName: 'AWS',\r\n              name: 'AWSManagedRulesKnownBadInputsRuleSet',\r\n            },\r\n          },\r\n          overrideAction: { none: {} },\r\n          visibilityConfig: {\r\n            sampledRequestsEnabled: true,\r\n            cloudWatchMetricsEnabled: true,\r\n            metricName: 'AWSManagedRulesKnownBadInputsRuleSet',\r\n          },\r\n        },\r\n      ],\r\n      customResponseBodies: {\r\n        RateLimitExceeded: {\r\n          contentType: 'APPLICATION_JSON',\r\n          content: JSON.stringify({\r\n            error_code: 'RATE_LIMIT_EXCEEDED',\r\n            message: 'Too many requests. Please try again later.',\r\n          }),\r\n        },\r\n      },\r\n    });\r\n\r\n    // 5. WAFとAPI Gatewayの関連付け\r\n    new wafv2.CfnWebACLAssociation(this, 'TdnetWebAclAssociation', {\r\n      resourceArn: this.api.deploymentStage.stageArn,\r\n      webAclArn: this.webAcl.attrArn,\r\n    });\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'ApiEndpoint', {\r\n      value: this.api.url,\r\n      description: 'API Gateway endpoint URL',\r\n      exportName: 'TdnetApiEndpoint',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ApiKeyId', {\r\n      value: this.apiKey.keyId,\r\n      description: 'API Key ID',\r\n      exportName: 'TdnetApiKeyId',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'WebAclArn', {\r\n      value: this.webAcl.attrArn,\r\n      description: 'WAF Web ACL ARN',\r\n      exportName: 'TdnetWebAclArn',\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: API Gateway Integrations\r\n    // ========================================\r\n\r\n    // 1. GET /disclosures エンドポイント\r\n    const disclosuresResource = this.api.root.addResource('disclosures');\r\n    const disclosuresIntegration = new apigateway.LambdaIntegration(queryFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '200', // Success\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n            'method.response.header.Content-Type': \"'application/json'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400', // Bad Request\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    disclosuresResource.addMethod('GET', disclosuresIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      requestParameters: {\r\n        'method.request.querystring.company_code': false,\r\n        'method.request.querystring.start_date': false,\r\n        'method.request.querystring.end_date': false,\r\n        'method.request.querystring.disclosure_type': false,\r\n        'method.request.querystring.format': false,\r\n        'method.request.querystring.limit': false,\r\n        'method.request.querystring.offset': false,\r\n      },\r\n      methodResponses: [\r\n        {\r\n          statusCode: '200',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n            'method.response.header.Content-Type': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // 2. POST /exports エンドポイント\r\n    const exportsResource = this.api.root.addResource('exports');\r\n    const exportsIntegration = new apigateway.LambdaIntegration(exportFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '202', // Accepted\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400', // Bad Request\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    exportsResource.addMethod('POST', exportsIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      methodResponses: [\r\n        {\r\n          statusCode: '202',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: Lambda Collect Functions\r\n    // ========================================\r\n\r\n    // Lambda Collect Function (POST /collect)\r\n    const collectFunction = new lambda.Function(this, 'CollectFunction', {\r\n      functionName: 'tdnet-collect',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/collect'),\r\n      timeout: cdk.Duration.seconds(envConfig.collect.timeout),\r\n      memorySize: envConfig.collect.memorySize,\r\n      environment: {\r\n        COLLECTOR_FUNCTION_NAME: collectorFunction.functionName,\r\n        LOG_LEVEL: envConfig.collect.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // Lambda Collectorを呼び出す権限\r\n    collectorFunction.grantInvoke(collectFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    collectFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // Lambda Collect Status Function (GET /collect/{execution_id})\r\n    const collectStatusFunction = new lambda.Function(this, 'CollectStatusFunction', {\r\n      functionName: 'tdnet-collect-status',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/collect-status'),\r\n      timeout: cdk.Duration.seconds(envConfig.collectStatus.timeout),\r\n      memorySize: envConfig.collectStatus.memorySize,\r\n      environment: {\r\n        DYNAMODB_EXECUTIONS_TABLE: this.executionsTable.tableName,\r\n        LOG_LEVEL: envConfig.collectStatus.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: executionsテーブルへの読み取り権限\r\n    this.executionsTable.grantReadData(collectStatusFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    collectStatusFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // ========================================\r\n    // Phase 2: /collect API Gateway Integrations\r\n    // ========================================\r\n\r\n    // 1. /collect エンドポイント\r\n    const collectResource = this.api.root.addResource('collect');\r\n\r\n    // POST /collect\r\n    const collectIntegration = new apigateway.LambdaIntegration(collectFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '200', // Success\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400', // Bad Request\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    collectResource.addMethod('POST', collectIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      methodResponses: [\r\n        {\r\n          statusCode: '200',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // 2. /collect/{execution_id} エンドポイント\r\n    const collectStatusResource = collectResource.addResource('{execution_id}');\r\n\r\n    // GET /collect/{execution_id}\r\n    const collectStatusIntegration = new apigateway.LambdaIntegration(collectStatusFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '200', // Success\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404', // Not Found\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    collectStatusResource.addMethod('GET', collectStatusIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      methodResponses: [\r\n        {\r\n          statusCode: '200',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // ========================================\r\n    // Phase 2: Export Status & PDF Download Lambda Functions\r\n    // ========================================\r\n\r\n    // Lambda Export Status Function (GET /exports/{export_id})\r\n    const exportStatusFunction = new lambda.Function(this, 'ExportStatusFunction', {\r\n      functionName: 'tdnet-export-status',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/api/export-status'),\r\n      timeout: cdk.Duration.seconds(envConfig.exportStatus.timeout),\r\n      memorySize: envConfig.exportStatus.memorySize,\r\n      environment: {\r\n        EXPORT_STATUS_TABLE_NAME: this.exportStatusTable.tableName,\r\n        API_KEY: apiKeyValue.secretValue.unsafeUnwrap(),\r\n        LOG_LEVEL: envConfig.exportStatus.logLevel,\r\n        ENVIRONMENT: this.deploymentEnvironment,\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: exportStatusテーブルへの読み取り権限\r\n    this.exportStatusTable.grantReadData(exportStatusFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    exportStatusFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // Lambda PDF Download Function (GET /disclosures/{disclosure_id}/pdf)\r\n    const pdfDownloadFunction = new lambda.Function(this, 'PdfDownloadFunction', {\r\n      functionName: 'tdnet-pdf-download',\r\n      runtime: lambda.Runtime.NODEJS_20_X,\r\n      handler: 'index.handler',\r\n      code: lambda.Code.fromAsset('dist/src/lambda/api/pdf-download'),\r\n      timeout: cdk.Duration.seconds(30),\r\n      memorySize: 256,\r\n      environment: {\r\n        DYNAMODB_TABLE_NAME: this.disclosuresTable.tableName,\r\n        S3_BUCKET_NAME: this.pdfsBucket.bucketName,\r\n        API_KEY: apiKeyValue.secretValue.unsafeUnwrap(),\r\n        LOG_LEVEL: 'info',\r\n        NODE_OPTIONS: '--enable-source-maps',\r\n      },\r\n    });\r\n\r\n    // IAM権限の付与\r\n    // DynamoDB: disclosuresテーブルへの読み取り権限\r\n    this.disclosuresTable.grantReadData(pdfDownloadFunction);\r\n\r\n    // S3: PDFバケットへの読み取り権限（署名付きURL生成用）\r\n    this.pdfsBucket.grantRead(pdfDownloadFunction);\r\n\r\n    // CloudWatch Metrics: カスタムメトリクス送信権限\r\n    pdfDownloadFunction.addToRolePolicy(\r\n      new cdk.aws_iam.PolicyStatement({\r\n        effect: cdk.aws_iam.Effect.ALLOW,\r\n        actions: ['cloudwatch:PutMetricData'],\r\n        resources: ['*'],\r\n      })\r\n    );\r\n\r\n    // ========================================\r\n    // Phase 2: Export Status & PDF Download API Gateway Integrations\r\n    // ========================================\r\n\r\n    // 1. GET /exports/{export_id} エンドポイント\r\n    const exportIdResource = exportsResource.addResource('{export_id}');\r\n\r\n    const exportStatusIntegration = new apigateway.LambdaIntegration(exportStatusFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '200', // Success\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400', // Bad Request\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404', // Not Found\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    exportIdResource.addMethod('GET', exportStatusIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      methodResponses: [\r\n        {\r\n          statusCode: '200',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // 2. GET /disclosures/{disclosure_id}/pdf エンドポイント\r\n    const disclosureIdResource = disclosuresResource.addResource('{disclosure_id}');\r\n    const pdfResource = disclosureIdResource.addResource('pdf');\r\n\r\n    const pdfDownloadIntegration = new apigateway.LambdaIntegration(pdfDownloadFunction, {\r\n      proxy: true,\r\n      integrationResponses: [\r\n        {\r\n          statusCode: '200', // Success\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400', // Bad Request\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401', // Unauthorized\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404', // Not Found\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500', // Internal Server Error\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': \"'*'\",\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    pdfResource.addMethod('GET', pdfDownloadIntegration, {\r\n      apiKeyRequired: true, // APIキー認証必須\r\n      requestParameters: {\r\n        'method.request.querystring.expiration': false,\r\n      },\r\n      methodResponses: [\r\n        {\r\n          statusCode: '200',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '400',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '401',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '404',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n        {\r\n          statusCode: '500',\r\n          responseParameters: {\r\n            'method.response.header.Access-Control-Allow-Origin': true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // CloudFormation Outputs\r\n    new cdk.CfnOutput(this, 'ExportStatusFunctionName', {\r\n      value: exportStatusFunction.functionName,\r\n      description: 'Lambda Export Status function name',\r\n      exportName: 'TdnetExportStatusFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'PdfDownloadFunctionName', {\r\n      value: pdfDownloadFunction.functionName,\r\n      description: 'Lambda PDF Download function name',\r\n      exportName: 'TdnetPdfDownloadFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'CollectFunctionName', {\r\n      value: collectFunction.functionName,\r\n      description: 'Lambda Collect function name',\r\n      exportName: 'TdnetCollectFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'CollectStatusFunctionName', {\r\n      value: collectStatusFunction.functionName,\r\n      description: 'Lambda Collect Status function name',\r\n      exportName: 'TdnetCollectStatusFunctionName',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'DisclosuresEndpoint', {\r\n      value: `${this.api.url}disclosures`,\r\n      description: 'Disclosures query API endpoint URL',\r\n      exportName: 'TdnetDisclosuresEndpoint',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'ExportsEndpoint', {\r\n      value: `${this.api.url}exports`,\r\n      description: 'Export API endpoint URL',\r\n      exportName: 'TdnetExportsEndpoint',\r\n    });\r\n\r\n    new cdk.CfnOutput(this, 'CollectEndpoint', {\r\n      value: `${this.api.url}collect`,\r\n      description: 'Collect API endpoint URL',\r\n      exportName: 'TdnetCollectEndpoint',\r\n    });\r\n  }\r\n}\r\n"],"version":3}