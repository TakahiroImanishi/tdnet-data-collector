eb1f07b95ec269a561d7f87b2f8fb934
"use strict";
/**
 * Export to S3 Unit Tests
 *
 * Requirements: 要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック
jest.mock('@aws-sdk/client-s3');
jest.mock('../../../utils/logger');
const export_to_s3_1 = require("../export-to-s3");
const client_s3_1 = require("@aws-sdk/client-s3");
describe('exportToS3', () => {
    const mockDisclosures = [
        {
            disclosure_id: '20240115_1234_001',
            company_code: '1234',
            company_name: 'テスト株式会社',
            disclosure_type: '決算短信',
            title: '2024年3月期 第3四半期決算短信',
            disclosed_at: '2024-01-15T10:30:00Z',
            pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
            collected_at: '2024-01-15T10:35:00Z',
            date_partition: '2024-01',
        },
        {
            disclosure_id: '20240115_5678_001',
            company_code: '5678',
            company_name: 'サンプル株式会社',
            disclosure_type: '有価証券報告書',
            title: '第50期有価証券報告書',
            disclosed_at: '2024-01-15T11:00:00Z',
            pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',
            collected_at: '2024-01-15T11:05:00Z',
            date_partition: '2024-01',
        },
    ];
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
        // S3Client.send のモック - コマンドインスタンスを受け取る
        client_s3_1.S3Client.prototype.send = jest.fn().mockImplementation((command) => {
            // PutObjectCommandの場合、inputプロパティを持つオブジェクトを返す
            if (command instanceof client_s3_1.PutObjectCommand) {
                return Promise.resolve({
                    $metadata: { httpStatusCode: 200 },
                    ETag: '"mock-etag"',
                });
            }
            return Promise.resolve({});
        });
    });
    describe('JSON形式のエクスポート', () => {
        it('JSON形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
            expect(client_s3_1.S3Client.prototype.send).toHaveBeenCalledWith(expect.objectContaining({
                input: expect.objectContaining({
                    Bucket: 'test-exports-bucket',
                    Key: s3_key,
                    ContentType: 'application/json',
                    Tagging: 'auto-delete=true',
                }),
            }));
        });
        it('JSONに件数とデータが含まれる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const parsed = JSON.parse(body);
            expect(parsed).toHaveProperty('count', 2);
            expect(parsed).toHaveProperty('disclosures');
            expect(parsed.disclosures).toHaveLength(2);
            expect(parsed.disclosures[0]).toEqual(mockDisclosures[0]);
        });
    });
    describe('CSV形式のエクスポート', () => {
        it('CSV形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.csv$/);
            expect(client_s3_1.S3Client.prototype.send).toHaveBeenCalledWith(expect.objectContaining({
                input: expect.objectContaining({
                    Bucket: 'test-exports-bucket',
                    Key: s3_key,
                    ContentType: 'text/csv',
                    Tagging: 'auto-delete=true',
                }),
            }));
        });
        it('CSVヘッダーが正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const lines = body.split('\n');
            expect(lines[0]).toBe('disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,s3_key,collected_at,date_partition');
        });
        it('CSVデータ行が正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const lines = body.split('\n');
            expect(lines[1]).toBe('20240115_1234_001,1234,テスト株式会社,決算短信,2024年3月期 第3四半期決算短信,2024-01-15T10:30:00Z,https://example.com/pdf/20240115_1234_001.pdf,pdfs/2024/01/15/20240115_1234_001.pdf,2024-01-15T10:35:00Z,2024-01');
            expect(lines[2]).toBe('20240115_5678_001,5678,サンプル株式会社,有価証券報告書,第50期有価証券報告書,2024-01-15T11:00:00Z,https://example.com/pdf/20240115_5678_001.pdf,pdfs/2024/01/15/20240115_5678_001.pdf,2024-01-15T11:05:00Z,2024-01');
        });
        it('カンマを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithComma = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル, カンマ含む',
                },
            ];
            const export_id = 'export_1705305600000_ghi789_11111111';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithComma, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル, カンマ含む"');
        });
        it('ダブルクォートを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithQuote = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル"引用符"含む',
                },
            ];
            const export_id = 'export_1705305600000_jkl012_22222222';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithQuote, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル""引用符""含む"');
        });
        it('改行を含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithNewline = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル\n改行含む',
                },
            ];
            const export_id = 'export_1705305600000_mno345_33333333';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithNewline, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input?.Body || '';
            const lines = body.split('\n');
            // 改行を含む値はダブルクォートで囲まれる
            expect(lines[1]).toContain('"タイトル\n改行含む"');
        });
    });
    describe('S3キー生成', () => {
        it('S3キーが正しいフォーマットで生成される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            // フォーマット: exports/YYYY/MM/DD/export_id.format
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
        });
    });
    describe('ライフサイクルポリシー', () => {
        it('auto-deleteタグが設定される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            expect(sendCall.input?.Tagging).toBe('auto-delete=true');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFNSCxNQUFNO0FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQU5uQyxrREFBNkM7QUFFN0Msa0RBQWdFO0FBTWhFLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLE1BQU0sZUFBZSxHQUFpQjtRQUNwQztZQUNFLGFBQWEsRUFBRSxtQkFBbUI7WUFDbEMsWUFBWSxFQUFFLE1BQU07WUFDcEIsWUFBWSxFQUFFLFNBQVM7WUFDdkIsZUFBZSxFQUFFLE1BQU07WUFDdkIsS0FBSyxFQUFFLG9CQUFvQjtZQUMzQixZQUFZLEVBQUUsc0JBQXNCO1lBQ3BDLE9BQU8sRUFBRSwrQ0FBK0M7WUFDeEQsTUFBTSxFQUFFLHVDQUF1QztZQUMvQyxZQUFZLEVBQUUsc0JBQXNCO1lBQ3BDLGNBQWMsRUFBRSxTQUFTO1NBQzFCO1FBQ0Q7WUFDRSxhQUFhLEVBQUUsbUJBQW1CO1lBQ2xDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLFlBQVksRUFBRSxVQUFVO1lBQ3hCLGVBQWUsRUFBRSxTQUFTO1lBQzFCLEtBQUssRUFBRSxhQUFhO1lBQ3BCLFlBQVksRUFBRSxzQkFBc0I7WUFDcEMsT0FBTyxFQUFFLCtDQUErQztZQUN4RCxNQUFNLEVBQUUsdUNBQXVDO1lBQy9DLFlBQVksRUFBRSxzQkFBc0I7WUFDcEMsY0FBYyxFQUFFLFNBQVM7U0FDMUI7S0FDRixDQUFDO0lBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDO1FBQ3ZELE9B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ekQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBRXRCLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEseUJBQVUsRUFBQyxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXBFLFNBQVM7WUFDVCw4Q0FBOEM7WUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzRUFBc0UsQ0FBQyxDQUFDO1FBQ2pHLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMscUJBQXFCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkMsVUFBVTtZQUNWLE1BQU0sU0FBUyxHQUFHLHNDQUFzQyxDQUFDO1lBQ3pELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUV0QixNQUFNO1lBQ04sTUFBTSxJQUFBLHlCQUFVLEVBQUMsU0FBUyxFQUFFLGVBQWUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVyRCxTQUFTO1lBQ1QsTUFBTSxRQUFRLEdBQUksb0JBQVEsQ0FBQyxTQUFTLENBQUMsSUFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcZXhwb3J0XFxfX3Rlc3RzX19cXGV4cG9ydC10by1zMy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBFeHBvcnQgdG8gUzMgVW5pdCBUZXN0c1xyXG4gKlxyXG4gKiBSZXF1aXJlbWVudHM6IOimgeS7tjE0LjHvvIjjg6bjg4vjg4Pjg4jjg4bjgrnjg4jvvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBleHBvcnRUb1MzIH0gZnJvbSAnLi4vZXhwb3J0LXRvLXMzJztcclxuaW1wb3J0IHsgRGlzY2xvc3VyZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJztcclxuaW1wb3J0IHsgUzNDbGllbnQsIFB1dE9iamVjdENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xyXG5cclxuLy8g44Oi44OD44KvXHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LXMzJyk7XHJcbmplc3QubW9jaygnLi4vLi4vLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG5kZXNjcmliZSgnZXhwb3J0VG9TMycsICgpID0+IHtcclxuICBjb25zdCBtb2NrRGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgIHtcclxuICAgICAgZGlzY2xvc3VyZV9pZDogJzIwMjQwMTE1XzEyMzRfMDAxJyxcclxuICAgICAgY29tcGFueV9jb2RlOiAnMTIzNCcsXHJcbiAgICAgIGNvbXBhbnlfbmFtZTogJ+ODhuOCueODiOagquW8j+S8muekvicsXHJcbiAgICAgIGRpc2Nsb3N1cmVfdHlwZTogJ+axuueul+efreS/oScsXHJcbiAgICAgIHRpdGxlOiAnMjAyNOW5tDPmnIjmnJ8g56ysM+Wbm+WNiuacn+axuueul+efreS/oScsXHJcbiAgICAgIGRpc2Nsb3NlZF9hdDogJzIwMjQtMDEtMTVUMTA6MzA6MDBaJyxcclxuICAgICAgcGRmX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgIHMzX2tleTogJ3BkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV8xMjM0XzAwMS5wZGYnLFxyXG4gICAgICBjb2xsZWN0ZWRfYXQ6ICcyMDI0LTAxLTE1VDEwOjM1OjAwWicsXHJcbiAgICAgIGRhdGVfcGFydGl0aW9uOiAnMjAyNC0wMScsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBkaXNjbG9zdXJlX2lkOiAnMjAyNDAxMTVfNTY3OF8wMDEnLFxyXG4gICAgICBjb21wYW55X2NvZGU6ICc1Njc4JyxcclxuICAgICAgY29tcGFueV9uYW1lOiAn44K144Oz44OX44Or5qCq5byP5Lya56S+JyxcclxuICAgICAgZGlzY2xvc3VyZV90eXBlOiAn5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JyxcclxuICAgICAgdGl0bGU6ICfnrKw1MOacn+acieS+oeiovOWIuOWgseWRiuabuCcsXHJcbiAgICAgIGRpc2Nsb3NlZF9hdDogJzIwMjQtMDEtMTVUMTE6MDA6MDBaJyxcclxuICAgICAgcGRmX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzU2NzhfMDAxLnBkZicsXHJcbiAgICAgIHMzX2tleTogJ3BkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV81Njc4XzAwMS5wZGYnLFxyXG4gICAgICBjb2xsZWN0ZWRfYXQ6ICcyMDI0LTAxLTE1VDExOjA1OjAwWicsXHJcbiAgICAgIGRhdGVfcGFydGl0aW9uOiAnMjAyNC0wMScsXHJcbiAgICB9LFxyXG4gIF07XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBwcm9jZXNzLmVudi5FWFBPUlRfQlVDS0VUX05BTUUgPSAndGVzdC1leHBvcnRzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuXHJcbiAgICAvLyBTM0NsaWVudC5zZW5kIOOBruODouODg+OCryAtIOOCs+ODnuODs+ODieOCpOODs+OCueOCv+ODs+OCueOCkuWPl+OBkeWPluOCi1xyXG4gICAgKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChjb21tYW5kKSA9PiB7XHJcbiAgICAgIC8vIFB1dE9iamVjdENvbW1hbmTjga7loLTlkIjjgIFpbnB1dOODl+ODreODkeODhuOCo+OCkuaMgeOBpOOCquODluOCuOOCp+OCr+ODiOOCkui/lOOBmVxyXG4gICAgICBpZiAoY29tbWFuZCBpbnN0YW5jZW9mIFB1dE9iamVjdENvbW1hbmQpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcclxuICAgICAgICAgICRtZXRhZGF0YTogeyBodHRwU3RhdHVzQ29kZTogMjAwIH0sXHJcbiAgICAgICAgICBFVGFnOiAnXCJtb2NrLWV0YWdcIicsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0pTT07lvaLlvI/jga7jgqjjgq/jgrnjg53jg7zjg4gnLCAoKSA9PiB7XHJcbiAgICBpdCgnSlNPTuW9ouW8j+OBp1Mz44Gr44Ko44Kv44K544Od44O844OI44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgICBleHBlY3QoUzNDbGllbnQucHJvdG90eXBlLnNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIGlucHV0OiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIEJ1Y2tldDogJ3Rlc3QtZXhwb3J0cy1idWNrZXQnLFxyXG4gICAgICAgICAgICBLZXk6IHMzX2tleSxcclxuICAgICAgICAgICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgVGFnZ2luZzogJ2F1dG8tZGVsZXRlPXRydWUnLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdKU09O44Gr5Lu25pWw44Go44OH44O844K/44GM5ZCr44G+44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBzZW5kQ2FsbCA9IChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBzZW5kQ2FsbC5pbnB1dD8uQm9keSB8fCAnJztcclxuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShib2R5KTtcclxuXHJcbiAgICAgIGV4cGVjdChwYXJzZWQpLnRvSGF2ZVByb3BlcnR5KCdjb3VudCcsIDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkKS50b0hhdmVQcm9wZXJ0eSgnZGlzY2xvc3VyZXMnKTtcclxuICAgICAgZXhwZWN0KHBhcnNlZC5kaXNjbG9zdXJlcykudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkLmRpc2Nsb3N1cmVzWzBdKS50b0VxdWFsKG1vY2tEaXNjbG9zdXJlc1swXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NTVuW9ouW8j+OBruOCqOOCr+OCueODneODvOODiCcsICgpID0+IHtcclxuICAgIGl0KCdDU1blvaLlvI/jgadTM+OBq+OCqOOCr+OCueODneODvOODiOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5jc3YkLyk7XHJcbiAgICAgIGV4cGVjdChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgaW5wdXQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgQnVja2V0OiAndGVzdC1leHBvcnRzLWJ1Y2tldCcsXHJcbiAgICAgICAgICAgIEtleTogczNfa2V5LFxyXG4gICAgICAgICAgICBDb250ZW50VHlwZTogJ3RleHQvY3N2JyxcclxuICAgICAgICAgICAgVGFnZ2luZzogJ2F1dG8tZGVsZXRlPXRydWUnLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdDU1bjg5jjg4Pjg4Djg7zjgYzmraPjgZfjgY/lh7rlipvjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2RlZjQ1Nl84NzY1NDMyMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQ/LkJvZHkgfHwgJyc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMF0pLnRvQmUoXHJcbiAgICAgICAgJ2Rpc2Nsb3N1cmVfaWQsY29tcGFueV9jb2RlLGNvbXBhbnlfbmFtZSxkaXNjbG9zdXJlX3R5cGUsdGl0bGUsZGlzY2xvc2VkX2F0LHBkZl91cmwsczNfa2V5LGNvbGxlY3RlZF9hdCxkYXRlX3BhcnRpdGlvbidcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdDU1bjg4fjg7zjgr/ooYzjgYzmraPjgZfjgY/lh7rlipvjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2RlZjQ1Nl84NzY1NDMyMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQ/LkJvZHkgfHwgJyc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQmUoXHJcbiAgICAgICAgJzIwMjQwMTE1XzEyMzRfMDAxLDEyMzQs44OG44K544OI5qCq5byP5Lya56S+LOaxuueul+efreS/oSwyMDI05bm0M+aciOacnyDnrKwz5Zub5Y2K5pyf5rG6566X55+t5L+hLDIwMjQtMDEtMTVUMTA6MzA6MDBaLGh0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzEyMzRfMDAxLnBkZixwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfMTIzNF8wMDEucGRmLDIwMjQtMDEtMTVUMTA6MzU6MDBaLDIwMjQtMDEnXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChsaW5lc1syXSkudG9CZShcclxuICAgICAgICAnMjAyNDAxMTVfNTY3OF8wMDEsNTY3OCzjgrXjg7Pjg5fjg6vmoKrlvI/kvJrnpL4s5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4LOesrDUw5pyf5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4LDIwMjQtMDEtMTVUMTE6MDA6MDBaLGh0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzU2NzhfMDAxLnBkZixwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfNTY3OF8wMDEucGRmLDIwMjQtMDEtMTVUMTE6MDU6MDBaLDIwMjQtMDEnXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44Kr44Oz44Oe44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVzV2l0aENvbW1hOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubW9ja0Rpc2Nsb3N1cmVzWzBdLFxyXG4gICAgICAgICAgdGl0bGU6ICfjgr/jgqTjg4jjg6ssIOOCq+ODs+ODnuWQq+OCgCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2doaTc4OV8xMTExMTExMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBkaXNjbG9zdXJlc1dpdGhDb21tYSwgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBzZW5kQ2FsbCA9IChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBzZW5kQ2FsbC5pbnB1dD8uQm9keSB8fCAnJztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODqywg44Kr44Oz44Oe5ZCr44KAXCInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjg4Djg5bjg6vjgq/jgqnjg7zjg4jjgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoUXVvdGU6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5tb2NrRGlzY2xvc3VyZXNbMF0sXHJcbiAgICAgICAgICB0aXRsZTogJ+OCv+OCpOODiOODq1wi5byV55So56ymXCLlkKvjgoAnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9qa2wwMTJfMjIyMjIyMjInO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgZGlzY2xvc3VyZXNXaXRoUXVvdGUsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQ/LkJvZHkgfHwgJyc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6tcIlwi5byV55So56ymXCJcIuWQq+OCgFwiJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5pS56KGM44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVzV2l0aE5ld2xpbmU6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5tb2NrRGlzY2xvc3VyZXNbMF0sXHJcbiAgICAgICAgICB0aXRsZTogJ+OCv+OCpOODiOODq1xcbuaUueihjOWQq+OCgCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX21ubzM0NV8zMzMzMzMzMyc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBkaXNjbG9zdXJlc1dpdGhOZXdsaW5lLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IHNlbmRDYWxsID0gKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgY29uc3QgYm9keSA9IHNlbmRDYWxsLmlucHV0Py5Cb2R5IHx8ICcnO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgLy8g5pS56KGM44KS5ZCr44KA5YCk44Gv44OA44OW44Or44Kv44Kp44O844OI44Gn5Zuy44G+44KM44KLXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODq1xcbuaUueihjOWQq+OCgFwiJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1Mz44Kt44O855Sf5oiQJywgKCkgPT4ge1xyXG4gICAgaXQoJ1Mz44Kt44O844GM5q2j44GX44GE44OV44Kp44O844Oe44OD44OI44Gn55Sf5oiQ44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICAvLyDjg5Xjgqnjg7zjg57jg4Pjg4g6IGV4cG9ydHMvWVlZWS9NTS9ERC9leHBvcnRfaWQuZm9ybWF0XHJcbiAgICAgIGV4cGVjdChzM19rZXkpLnRvTWF0Y2goL15leHBvcnRzXFwvXFxkezR9XFwvXFxkezJ9XFwvXFxkezJ9XFwvZXhwb3J0X1xcZCtfW2EtejAtOV0rX1thLXowLTldK1xcLmpzb24kLyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+ODqeOCpOODleOCteOCpOOCr+ODq+ODneODquOCt+ODvCcsICgpID0+IHtcclxuICAgIGl0KCdhdXRvLWRlbGV0ZeOCv+OCsOOBjOioreWumuOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3Qoc2VuZENhbGwuaW5wdXQ/LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9