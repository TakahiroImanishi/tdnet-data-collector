{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\dependencies.ts","mappings":";AAAA;;;;;;GAMG;;AAiCH,8DAyBC;AAiBD,0CAKC;AASD,0CAEC;AAOD,8CAEC;AAlGD,8DAA0D;AAC1D,wDAA+D;AAC/D,kDAA8C;AAC9C,kEAA8D;AAC9D,2DAAuD;AAmBvD;;;;;;;GAOG;AACH,SAAgB,yBAAyB;IACvC,kBAAkB;IAClB,MAAM,YAAY,GAAG,IAAI,gCAAc,CAAC,EAAE,MAAM,EAAE,gBAAgB,EAAE,CAAC,CAAC;IACtE,MAAM,SAAS,GAAG,qCAAsB,CAAC,IAAI,CAAC,YAAY,EAAE;QAC1D,eAAe,EAAE;YACf,qBAAqB,EAAE,IAAI;YAC3B,yBAAyB,EAAE,IAAI;SAChC;KACF,CAAC,CAAC;IAEH,YAAY;IACZ,MAAM,QAAQ,GAAG,IAAI,oBAAQ,CAAC,EAAE,MAAM,EAAE,gBAAgB,EAAE,CAAC,CAAC;IAE5D,oBAAoB;IACpB,MAAM,gBAAgB,GAAG,IAAI,oCAAgB,CAAC,EAAE,MAAM,EAAE,gBAAgB,EAAE,CAAC,CAAC;IAE5E,uBAAuB;IACvB,MAAM,WAAW,GAAG,IAAI,0BAAW,CAAC,IAAI,CAAC,CAAC;IAE1C,OAAO;QACL,YAAY,EAAE,SAAS;QACvB,QAAQ;QACR,gBAAgB;QAChB,WAAW;KACZ,CAAC;AACJ,CAAC;AAED;;;;GAIG;AACH,IAAI,YAAY,GAAiC,IAAI,CAAC;AAEtD;;;;;;;GAOG;AACH,SAAgB,eAAe;IAC7B,IAAI,CAAC,YAAY,EAAE,CAAC;QAClB,YAAY,GAAG,yBAAyB,EAAE,CAAC;IAC7C,CAAC;IACD,OAAO,YAAY,CAAC;AACtB,CAAC;AAED;;;;;;GAMG;AACH,SAAgB,eAAe,CAAC,IAA2B;IACzD,YAAY,GAAG,IAAI,CAAC;AACtB,CAAC;AAED;;;;GAIG;AACH,SAAgB,iBAAiB;IAC/B,YAAY,GAAG,IAAI,CAAC;AACtB,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\dependencies.ts"],"sourcesContent":["/**\r\n * Lambda Collector Dependencies\r\n *\r\n * 依存関係の注入（DI）パターンを実装し、テスト時にモックを注入可能にする。\r\n *\r\n * Requirements: テスト環境の整備（Task 9.4）\r\n */\r\n\r\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\r\nimport { DynamoDBDocumentClient } from '@aws-sdk/lib-dynamodb';\r\nimport { S3Client } from '@aws-sdk/client-s3';\r\nimport { CloudWatchClient } from '@aws-sdk/client-cloudwatch';\r\nimport { RateLimiter } from '../../utils/rate-limiter';\r\n\r\n/**\r\n * Lambda Collector依存関係\r\n */\r\nexport interface CollectorDependencies {\r\n  /** DynamoDB Document Client */\r\n  dynamoClient: DynamoDBDocumentClient;\r\n\r\n  /** S3 Client */\r\n  s3Client: S3Client;\r\n\r\n  /** CloudWatch Client */\r\n  cloudWatchClient: CloudWatchClient;\r\n\r\n  /** Rate Limiter */\r\n  rateLimiter: RateLimiter;\r\n}\r\n\r\n/**\r\n * デフォルトの依存関係を作成\r\n *\r\n * 本番環境では、この関数で作成した依存関係を使用する。\r\n * テスト環境では、モックを注入する。\r\n *\r\n * @returns CollectorDependencies\r\n */\r\nexport function createDefaultDependencies(): CollectorDependencies {\r\n  // DynamoDB Client\r\n  const dynamoClient = new DynamoDBClient({ region: 'ap-northeast-1' });\r\n  const docClient = DynamoDBDocumentClient.from(dynamoClient, {\r\n    marshallOptions: {\r\n      removeUndefinedValues: true,\r\n      convertClassInstanceToMap: true,\r\n    },\r\n  });\r\n\r\n  // S3 Client\r\n  const s3Client = new S3Client({ region: 'ap-northeast-1' });\r\n\r\n  // CloudWatch Client\r\n  const cloudWatchClient = new CloudWatchClient({ region: 'ap-northeast-1' });\r\n\r\n  // Rate Limiter（最小遅延2秒）\r\n  const rateLimiter = new RateLimiter(2000);\r\n\r\n  return {\r\n    dynamoClient: docClient,\r\n    s3Client,\r\n    cloudWatchClient,\r\n    rateLimiter,\r\n  };\r\n}\r\n\r\n/**\r\n * グローバルスコープで依存関係を初期化（Lambda実行間で再利用）\r\n *\r\n * テスト環境では、setDependencies()でモックを注入できる。\r\n */\r\nlet dependencies: CollectorDependencies | null = null;\r\n\r\n/**\r\n * 依存関係を取得\r\n *\r\n * 初回呼び出し時にデフォルトの依存関係を作成し、以降は再利用する。\r\n * テスト環境では、setDependencies()で事前にモックを注入できる。\r\n *\r\n * @returns CollectorDependencies\r\n */\r\nexport function getDependencies(): CollectorDependencies {\r\n  if (!dependencies) {\r\n    dependencies = createDefaultDependencies();\r\n  }\r\n  return dependencies;\r\n}\r\n\r\n/**\r\n * 依存関係を設定（テスト用）\r\n *\r\n * テスト環境でモックを注入するために使用する。\r\n *\r\n * @param deps CollectorDependencies\r\n */\r\nexport function setDependencies(deps: CollectorDependencies): void {\r\n  dependencies = deps;\r\n}\r\n\r\n/**\r\n * 依存関係をリセット（テスト用）\r\n *\r\n * テスト終了後にクリーンアップするために使用する。\r\n */\r\nexport function resetDependencies(): void {\r\n  dependencies = null;\r\n}\r\n"],"version":3}