{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\dynamodb-tables.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\dynamodb-tables.test.ts"],"sourcesContent":["/**\r\n * DynamoDB Table Structure Verification Test\r\n *\r\n * Task 3.2: DynamoDBテーブル構造の検証テスト\r\n * Requirements: 要件2.5, 13.3（データベース、暗号化）\r\n *\r\n * このテストは、CDKで定義されたDynamoDBテーブルが設計通りに構成されていることを検証します。\r\n */\r\n\r\nimport * as cdk from 'aws-cdk-lib';\r\nimport { Template, Match } from 'aws-cdk-lib/assertions';\r\nimport { TdnetDataCollectorStack } from '../lib/tdnet-data-collector-stack';\r\n\r\ndescribe('DynamoDB Tables', () => {\r\n  let template: Template;\r\n\r\n  beforeAll(() => {\r\n    const app = new cdk.App();\r\n    const stack = new TdnetDataCollectorStack(app, 'TestStack', {\r\n      env: { account: '123456789012', region: 'ap-northeast-1' },\r\n    });\r\n    template = Template.fromStack(stack);\r\n  });\r\n\r\n  describe('tdnet_disclosures table', () => {\r\n    it('should be created with correct configuration', () => {\r\n      // テーブルが存在することを確認\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures',\r\n        BillingMode: 'PAY_PER_REQUEST', // オンデマンドモード\r\n        SSESpecification: {\r\n          SSEEnabled: true, // 暗号化有効化\r\n        },\r\n        PointInTimeRecoverySpecification: {\r\n          PointInTimeRecoveryEnabled: true, // ポイントインタイムリカバリ有効化\r\n        },\r\n      });\r\n    });\r\n\r\n    it('should have correct partition key', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures',\r\n        KeySchema: [\r\n          {\r\n            AttributeName: 'disclosure_id',\r\n            KeyType: 'HASH', // パーティションキー\r\n          },\r\n        ],\r\n        AttributeDefinitions: Match.arrayWith([\r\n          {\r\n            AttributeName: 'disclosure_id',\r\n            AttributeType: 'S', // String型\r\n          },\r\n        ]),\r\n      });\r\n    });\r\n\r\n    it('should have GSI_CompanyCode_DiscloseDate index', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures',\r\n        GlobalSecondaryIndexes: Match.arrayWith([\r\n          {\r\n            IndexName: 'GSI_CompanyCode_DiscloseDate',\r\n            KeySchema: [\r\n              {\r\n                AttributeName: 'company_code',\r\n                KeyType: 'HASH', // パーティションキー\r\n              },\r\n              {\r\n                AttributeName: 'disclosed_at',\r\n                KeyType: 'RANGE', // ソートキー\r\n              },\r\n            ],\r\n            Projection: {\r\n              ProjectionType: 'ALL', // すべての属性を投影\r\n            },\r\n          },\r\n        ]),\r\n        AttributeDefinitions: Match.arrayWith([\r\n          {\r\n            AttributeName: 'company_code',\r\n            AttributeType: 'S',\r\n          },\r\n          {\r\n            AttributeName: 'disclosed_at',\r\n            AttributeType: 'S',\r\n          },\r\n        ]),\r\n      });\r\n    });\r\n\r\n    it('should have GSI_DatePartition index', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures',\r\n        GlobalSecondaryIndexes: Match.arrayWith([\r\n          {\r\n            IndexName: 'GSI_DatePartition',\r\n            KeySchema: [\r\n              {\r\n                AttributeName: 'date_partition',\r\n                KeyType: 'HASH', // パーティションキー\r\n              },\r\n              {\r\n                AttributeName: 'disclosed_at',\r\n                KeyType: 'RANGE', // ソートキー\r\n              },\r\n            ],\r\n            Projection: {\r\n              ProjectionType: 'ALL',\r\n            },\r\n          },\r\n        ]),\r\n        AttributeDefinitions: Match.arrayWith([\r\n          {\r\n            AttributeName: 'date_partition',\r\n            AttributeType: 'S',\r\n          },\r\n        ]),\r\n      });\r\n    });\r\n\r\n    it('should have exactly 2 GSIs', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures',\r\n        GlobalSecondaryIndexes: Match.arrayWith([\r\n          Match.objectLike({ IndexName: 'GSI_CompanyCode_DiscloseDate' }),\r\n          Match.objectLike({ IndexName: 'GSI_DatePartition' }),\r\n        ]),\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('tdnet_executions table', () => {\r\n    it('should be created with correct configuration', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_executions',\r\n        BillingMode: 'PAY_PER_REQUEST', // オンデマンドモード\r\n        SSESpecification: {\r\n          SSEEnabled: true, // 暗号化有効化\r\n        },\r\n        PointInTimeRecoverySpecification: {\r\n          PointInTimeRecoveryEnabled: true, // ポイントインタイムリカバリ有効化\r\n        },\r\n      });\r\n    });\r\n\r\n    it('should have correct partition key', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_executions',\r\n        KeySchema: [\r\n          {\r\n            AttributeName: 'execution_id',\r\n            KeyType: 'HASH', // パーティションキー\r\n          },\r\n        ],\r\n        AttributeDefinitions: Match.arrayWith([\r\n          {\r\n            AttributeName: 'execution_id',\r\n            AttributeType: 'S', // String型\r\n          },\r\n        ]),\r\n      });\r\n    });\r\n\r\n    it('should have TTL enabled', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_executions',\r\n        TimeToLiveSpecification: {\r\n          AttributeName: 'ttl',\r\n          Enabled: true, // TTL有効化\r\n        },\r\n      });\r\n    });\r\n\r\n    it('should have GSI_Status_StartedAt index', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_executions',\r\n        GlobalSecondaryIndexes: Match.arrayWith([\r\n          {\r\n            IndexName: 'GSI_Status_StartedAt',\r\n            KeySchema: [\r\n              {\r\n                AttributeName: 'status',\r\n                KeyType: 'HASH', // パーティションキー\r\n              },\r\n              {\r\n                AttributeName: 'started_at',\r\n                KeyType: 'RANGE', // ソートキー\r\n              },\r\n            ],\r\n            Projection: {\r\n              ProjectionType: 'ALL',\r\n            },\r\n          },\r\n        ]),\r\n        AttributeDefinitions: Match.arrayWith([\r\n          {\r\n            AttributeName: 'status',\r\n            AttributeType: 'S',\r\n          },\r\n          {\r\n            AttributeName: 'started_at',\r\n            AttributeType: 'S',\r\n          },\r\n        ]),\r\n      });\r\n    });\r\n\r\n    it('should have exactly 1 GSI', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_executions',\r\n        GlobalSecondaryIndexes: [\r\n          Match.objectLike({ IndexName: 'GSI_Status_StartedAt' }),\r\n        ],\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('CloudFormation Outputs', () => {\r\n    it('should export DisclosuresTableName', () => {\r\n      template.hasOutput('DisclosuresTableName', {\r\n        Value: {\r\n          Ref: Match.stringLikeRegexp('DisclosuresTable'),\r\n        },\r\n        Export: {\r\n          Name: 'TdnetDisclosuresTableName',\r\n        },\r\n      });\r\n    });\r\n\r\n    it('should export ExecutionsTableName', () => {\r\n      template.hasOutput('ExecutionsTableName', {\r\n        Value: {\r\n          Ref: Match.stringLikeRegexp('ExecutionsTable'),\r\n        },\r\n        Export: {\r\n          Name: 'TdnetExecutionsTableName',\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Security and Compliance', () => {\r\n    it('should have encryption enabled on all tables', () => {\r\n      // すべてのDynamoDBテーブルで暗号化が有効化されていることを確認\r\n      const tables = template.findResources('AWS::DynamoDB::Table');\r\n      const tableKeys = Object.keys(tables);\r\n\r\n      expect(tableKeys.length).toBeGreaterThanOrEqual(2);\r\n\r\n      tableKeys.forEach((key) => {\r\n        const table = tables[key];\r\n        expect(table.Properties.SSESpecification).toBeDefined();\r\n        expect(table.Properties.SSESpecification.SSEEnabled).toBe(true);\r\n      });\r\n    });\r\n\r\n    it('should have point-in-time recovery enabled on all tables', () => {\r\n      // すべてのDynamoDBテーブルでポイントインタイムリカバリが有効化されていることを確認\r\n      const tables = template.findResources('AWS::DynamoDB::Table');\r\n      const tableKeys = Object.keys(tables);\r\n\r\n      tableKeys.forEach((key) => {\r\n        const table = tables[key];\r\n        expect(\r\n          table.Properties.PointInTimeRecoverySpecification\r\n        ).toBeDefined();\r\n        expect(\r\n          table.Properties.PointInTimeRecoverySpecification\r\n            .PointInTimeRecoveryEnabled\r\n        ).toBe(true);\r\n      });\r\n    });\r\n\r\n    it('should use on-demand billing mode for cost optimization', () => {\r\n      // すべてのDynamoDBテーブルでオンデマンドモードが使用されていることを確認\r\n      const tables = template.findResources('AWS::DynamoDB::Table');\r\n      const tableKeys = Object.keys(tables);\r\n\r\n      tableKeys.forEach((key) => {\r\n        const table = tables[key];\r\n        expect(table.Properties.BillingMode).toBe('PAY_PER_REQUEST');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Table Count', () => {\r\n    it('should have exactly 3 DynamoDB tables', () => {\r\n      // DynamoDBテーブルが正確に3つ存在することを確認\r\n      // 1. tdnet_disclosures\r\n      // 2. tdnet_executions\r\n      // 3. tdnet_export_status\r\n      template.resourceCountIs('AWS::DynamoDB::Table', 3);\r\n    });\r\n  });\r\n});\r\n"],"version":3}