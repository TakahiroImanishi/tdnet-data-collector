b7285545c4c2cdfc7ae87f55f432ce0b
"use strict";
/**
 * 重複収集の冪等性テスト
 *
 * Property 5: 重複収集の冪等性
 * Validates: Requirements 2.4
 *
 * 同じ開示情報を複数回保存しても、DynamoDBには1件のみ保存されることを検証します。
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const aws_sdk_client_mock_1 = require("aws-sdk-client-mock");
const fc = __importStar(require("fast-check"));
const save_metadata_1 = require("../save-metadata");
const logger_1 = require("../../../utils/logger");
const dynamoMock = (0, aws_sdk_client_mock_1.mockClient)(client_dynamodb_1.DynamoDBClient);
describe('Property 5: 重複収集の冪等性', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        dynamoMock.reset();
        process.env.DYNAMODB_TABLE = 'test-table';
        // logger.warnのモック
        jest.spyOn(logger_1.logger, 'warn').mockImplementation();
        jest.spyOn(logger_1.logger, 'info').mockImplementation();
        jest.spyOn(logger_1.logger, 'error').mockImplementation();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('ユニットテスト', () => {
        it('同じ開示情報を2回保存しても1件のみ保存される', async () => {
            // Arrange
            const disclosure = {
                disclosure_id: 'TD20240115001',
                company_code: '1234',
                company_name: '株式会社サンプル',
                disclosure_type: '決算短信',
                title: '2024年3月期 第3四半期決算短信',
                disclosed_at: '2024-01-15T10:30:00Z',
                pdf_url: 'https://www.release.tdnet.info/inbs/140120240115001.pdf',
                s3_key: '',
                collected_at: '',
                date_partition: '',
            };
            const s3_key = '2024/01/15/TD20240115001.pdf';
            // 1回目は成功
            dynamoMock.on(client_dynamodb_1.PutItemCommand).resolvesOnce({});
            // 2回目は重複エラー
            const conditionalCheckError = new Error('ConditionalCheckFailedException');
            conditionalCheckError.name = 'ConditionalCheckFailedException';
            dynamoMock.on(client_dynamodb_1.PutItemCommand).rejectsOnce(conditionalCheckError);
            // Act
            await (0, save_metadata_1.saveMetadata)(disclosure, s3_key); // 1回目
            await (0, save_metadata_1.saveMetadata)(disclosure, s3_key); // 2回目（重複）
            // Assert
            expect(dynamoMock.calls()).toHaveLength(2);
            // 両方とも正常終了（2回目は警告ログのみ）
        });
        it('重複時に警告ログが出力される', async () => {
            // Arrange
            const disclosure = {
                disclosure_id: 'TD20240115001',
                company_code: '1234',
                company_name: '株式会社サンプル',
                disclosure_type: '決算短信',
                title: '2024年3月期 第3四半期決算短信',
                disclosed_at: '2024-01-15T10:30:00Z',
                pdf_url: 'https://www.release.tdnet.info/inbs/140120240115001.pdf',
                s3_key: '',
                collected_at: '',
                date_partition: '',
            };
            const s3_key = '2024/01/15/TD20240115001.pdf';
            const conditionalCheckError = new Error('ConditionalCheckFailedException');
            conditionalCheckError.name = 'ConditionalCheckFailedException';
            dynamoMock.on(client_dynamodb_1.PutItemCommand).rejects(conditionalCheckError);
            // Act
            await (0, save_metadata_1.saveMetadata)(disclosure, s3_key);
            // Assert
            expect(logger_1.logger.warn).toHaveBeenCalledWith('Duplicate disclosure detected', {
                disclosure_id: 'TD20240115001',
                s3_key: '2024/01/15/TD20240115001.pdf',
            });
        });
        it('異なる開示IDは両方とも保存される', async () => {
            // Arrange
            const disclosure1 = {
                disclosure_id: 'TD20240115001',
                company_code: '1234',
                company_name: '株式会社サンプル',
                disclosure_type: '決算短信',
                title: '2024年3月期 第3四半期決算短信',
                disclosed_at: '2024-01-15T10:30:00Z',
                pdf_url: 'https://www.release.tdnet.info/inbs/140120240115001.pdf',
                s3_key: '',
                collected_at: '',
                date_partition: '',
            };
            const disclosure2 = {
                disclosure_id: 'TD20240115002', // 異なるID
                company_code: '5678',
                company_name: '株式会社別会社',
                disclosure_type: '有価証券報告書',
                title: '2024年3月期 有価証券報告書',
                disclosed_at: '2024-01-15T11:00:00Z',
                pdf_url: 'https://www.release.tdnet.info/inbs/140120240115002.pdf',
                s3_key: '',
                collected_at: '',
                date_partition: '',
            };
            dynamoMock.on(client_dynamodb_1.PutItemCommand).resolves({});
            // Act
            await (0, save_metadata_1.saveMetadata)(disclosure1, '2024/01/15/TD20240115001.pdf');
            await (0, save_metadata_1.saveMetadata)(disclosure2, '2024/01/15/TD20240115002.pdf');
            // Assert
            expect(dynamoMock.calls()).toHaveLength(2);
            // 両方とも成功
        });
    });
    describe('プロパティベーステスト', () => {
        it('任意の開示情報を2回保存しても冪等性が保たれる', async () => {
            await fc.assert(fc.asyncProperty(fc.record({
                disclosure_id: fc.string({ minLength: 10, maxLength: 20 }),
                company_code: fc.string({ minLength: 4, maxLength: 4 }),
                company_name: fc.string({ minLength: 1, maxLength: 100 }),
                disclosure_type: fc.constantFrom('決算短信', '有価証券報告書', '適時開示'),
                title: fc.string({ minLength: 1, maxLength: 200 }),
                disclosed_at: fc
                    .date({ min: new Date('2020-01-01'), max: new Date() })
                    .map((d) => d.toISOString()),
                pdf_url: fc.webUrl(),
            }), async (disclosureData) => {
                // Arrange
                dynamoMock.reset();
                const disclosure = {
                    ...disclosureData,
                    s3_key: '',
                    collected_at: '',
                    date_partition: '',
                };
                const s3_key = `2024/01/15/${disclosure.disclosure_id}.pdf`;
                // 1回目は成功
                dynamoMock.on(client_dynamodb_1.PutItemCommand).resolvesOnce({});
                // 2回目は重複エラー
                const conditionalCheckError = new Error('ConditionalCheckFailedException');
                conditionalCheckError.name = 'ConditionalCheckFailedException';
                dynamoMock.on(client_dynamodb_1.PutItemCommand).rejectsOnce(conditionalCheckError);
                // Act & Assert
                await expect((0, save_metadata_1.saveMetadata)(disclosure, s3_key)).resolves.toBeUndefined();
                await expect((0, save_metadata_1.saveMetadata)(disclosure, s3_key)).resolves.toBeUndefined();
                // 両方とも正常終了（エラーをスローしない）
                expect(dynamoMock.calls()).toHaveLength(2);
            }), { numRuns: 100 } // 100回反復
            );
        });
        it('複数の異なる開示情報を保存しても、それぞれ1件のみ保存される', async () => {
            await fc.assert(fc.asyncProperty(fc.array(fc.record({
                disclosure_id: fc.string({ minLength: 10, maxLength: 20 }),
                company_code: fc.string({ minLength: 4, maxLength: 4 }),
                company_name: fc.string({ minLength: 1, maxLength: 100 }),
                disclosure_type: fc.constantFrom('決算短信', '有価証券報告書', '適時開示'),
                title: fc.string({ minLength: 1, maxLength: 200 }),
                disclosed_at: fc
                    .date({ min: new Date('2020-01-01'), max: new Date() })
                    .map((d) => d.toISOString()),
                pdf_url: fc.webUrl(),
            }), { minLength: 1, maxLength: 10 }), async (disclosuresData) => {
                // Arrange
                dynamoMock.reset();
                dynamoMock.on(client_dynamodb_1.PutItemCommand).resolves({});
                // Act
                for (const disclosureData of disclosuresData) {
                    const disclosure = {
                        ...disclosureData,
                        s3_key: '',
                        collected_at: '',
                        date_partition: '',
                    };
                    const s3_key = `2024/01/15/${disclosure.disclosure_id}.pdf`;
                    await (0, save_metadata_1.saveMetadata)(disclosure, s3_key);
                }
                // Assert
                expect(dynamoMock.calls()).toHaveLength(disclosuresData.length);
            }), { numRuns: 100 } // 100回反復
            );
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3RvclxcX190ZXN0c19fXFxzYXZlLW1ldGFkYXRhLmlkZW1wb3RlbmN5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsOERBQTBFO0FBQzFFLDZEQUFpRDtBQUNqRCwrQ0FBaUM7QUFDakMsb0RBQWdEO0FBRWhELGtEQUErQztBQUUvQyxNQUFNLFVBQVUsR0FBRyxJQUFBLGdDQUFVLEVBQUMsZ0NBQWMsQ0FBQyxDQUFDO0FBRTlDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsWUFBWSxDQUFDO1FBRTFDLGtCQUFrQjtRQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLGVBQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQ2hELElBQUksQ0FBQyxLQUFLLENBQUMsZUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDaEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUNuRCxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtRQUN2QixFQUFFLENBQUMseUJBQXlCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkMsVUFBVTtZQUNWLE1BQU0sVUFBVSxHQUFlO2dC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Q2xFLENBQUMsQ0FDRixFQUNELEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFNBQVM7YUFDM0IsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcY29sbGVjdG9yXFxfX3Rlc3RzX19cXHNhdmUtbWV0YWRhdGEuaWRlbXBvdGVuY3kudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog6YeN6KSH5Y+O6ZuG44Gu5Yaq562J5oCn44OG44K544OIXHJcbiAqXHJcbiAqIFByb3BlcnR5IDU6IOmHjeikh+WPjumbhuOBruWGquetieaAp1xyXG4gKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyAyLjRcclxuICpcclxuICog5ZCM44GY6ZaL56S65oOF5aCx44KS6KSH5pWw5Zue5L+d5a2Y44GX44Gm44KC44CBRHluYW1vRELjgavjga8x5Lu244Gu44G/5L+d5a2Y44GV44KM44KL44GT44Go44KS5qSc6Ki844GX44G+44GZ44CCXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgRHluYW1vREJDbGllbnQsIFB1dEl0ZW1Db21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJztcclxuaW1wb3J0IHsgbW9ja0NsaWVudCB9IGZyb20gJ2F3cy1zZGstY2xpZW50LW1vY2snO1xyXG5pbXBvcnQgKiBhcyBmYyBmcm9tICdmYXN0LWNoZWNrJztcclxuaW1wb3J0IHsgc2F2ZU1ldGFkYXRhIH0gZnJvbSAnLi4vc2F2ZS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IERpc2Nsb3N1cmUgfSBmcm9tICcuLi8uLi8uLi90eXBlcyc7XHJcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZ2dlcic7XHJcblxyXG5jb25zdCBkeW5hbW9Nb2NrID0gbW9ja0NsaWVudChEeW5hbW9EQkNsaWVudCk7XHJcblxyXG5kZXNjcmliZSgnUHJvcGVydHkgNTog6YeN6KSH5Y+O6ZuG44Gu5Yaq562J5oCnJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBkeW5hbW9Nb2NrLnJlc2V0KCk7XHJcbiAgICBwcm9jZXNzLmVudi5EWU5BTU9EQl9UQUJMRSA9ICd0ZXN0LXRhYmxlJztcclxuICAgIFxyXG4gICAgLy8gbG9nZ2VyLndhcm7jga7jg6Ljg4Pjgq9cclxuICAgIGplc3Quc3B5T24obG9nZ2VyLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG4gICAgamVzdC5zcHlPbihsb2dnZXIsICdpbmZvJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcbiAgICBqZXN0LnNweU9uKGxvZ2dlciwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn44Om44OL44OD44OI44OG44K544OIJywgKCkgPT4ge1xyXG4gICAgaXQoJ+WQjOOBmOmWi+ekuuaDheWgseOCkjLlm57kv53lrZjjgZfjgabjgoIx5Lu244Gu44G/5L+d5a2Y44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmU6IERpc2Nsb3N1cmUgPSB7XHJcbiAgICAgICAgZGlzY2xvc3VyZV9pZDogJ1REMjAyNDAxMTUwMDEnLFxyXG4gICAgICAgIGNvbXBhbnlfY29kZTogJzEyMzQnLFxyXG4gICAgICAgIGNvbXBhbnlfbmFtZTogJ+agquW8j+S8muekvuOCteODs+ODl+ODqycsXHJcbiAgICAgICAgZGlzY2xvc3VyZV90eXBlOiAn5rG6566X55+t5L+hJyxcclxuICAgICAgICB0aXRsZTogJzIwMjTlubQz5pyI5pyfIOesrDPlm5vljYrmnJ/msbrnrpfnn63kv6EnLFxyXG4gICAgICAgIGRpc2Nsb3NlZF9hdDogJzIwMjQtMDEtMTVUMTA6MzA6MDBaJyxcclxuICAgICAgICBwZGZfdXJsOiAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjQwMTE1MDAxLnBkZicsXHJcbiAgICAgICAgczNfa2V5OiAnJyxcclxuICAgICAgICBjb2xsZWN0ZWRfYXQ6ICcnLFxyXG4gICAgICAgIGRhdGVfcGFydGl0aW9uOiAnJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgczNfa2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG5cclxuICAgICAgLy8gMeWbnuebruOBr+aIkOWKn1xyXG4gICAgICBkeW5hbW9Nb2NrLm9uKFB1dEl0ZW1Db21tYW5kKS5yZXNvbHZlc09uY2Uoe30pO1xyXG5cclxuICAgICAgLy8gMuWbnuebruOBr+mHjeikh+OCqOODqeODvFxyXG4gICAgICBjb25zdCBjb25kaXRpb25hbENoZWNrRXJyb3IgPSBuZXcgRXJyb3IoJ0NvbmRpdGlvbmFsQ2hlY2tGYWlsZWRFeGNlcHRpb24nKTtcclxuICAgICAgY29uZGl0aW9uYWxDaGVja0Vycm9yLm5hbWUgPSAnQ29uZGl0aW9uYWxDaGVja0ZhaWxlZEV4Y2VwdGlvbic7XHJcbiAgICAgIGR5bmFtb01vY2sub24oUHV0SXRlbUNvbW1hbmQpLnJlamVjdHNPbmNlKGNvbmRpdGlvbmFsQ2hlY2tFcnJvcik7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgc2F2ZU1ldGFkYXRhKGRpc2Nsb3N1cmUsIHMzX2tleSk7IC8vIDHlm57nm65cclxuICAgICAgYXdhaXQgc2F2ZU1ldGFkYXRhKGRpc2Nsb3N1cmUsIHMzX2tleSk7IC8vIDLlm57nm67vvIjph43opIfvvIlcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoZHluYW1vTW9jay5jYWxscygpKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICAgIC8vIOS4oeaWueOBqOOCguato+W4uOe1guS6hu+8iDLlm57nm67jga/orablkYrjg63jgrDjga7jgb/vvIlcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfph43opIfmmYLjgavorablkYrjg63jgrDjgYzlh7rlipvjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZTogRGlzY2xvc3VyZSA9IHtcclxuICAgICAgICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMScsXHJcbiAgICAgICAgY29tcGFueV9jb2RlOiAnMTIzNCcsXHJcbiAgICAgICAgY29tcGFueV9uYW1lOiAn5qCq5byP5Lya56S+44K144Oz44OX44OrJyxcclxuICAgICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmsbrnrpfnn63kv6EnLFxyXG4gICAgICAgIHRpdGxlOiAnMjAyNOW5tDPmnIjmnJ8g56ysM+Wbm+WNiuacn+axuueul+efreS/oScsXHJcbiAgICAgICAgZGlzY2xvc2VkX2F0OiAnMjAyNC0wMS0xNVQxMDozMDowMFonLFxyXG4gICAgICAgIHBkZl91cmw6ICdodHRwczovL3d3dy5yZWxlYXNlLnRkbmV0LmluZm8vaW5icy8xNDAxMjAyNDAxMTUwMDEucGRmJyxcclxuICAgICAgICBzM19rZXk6ICcnLFxyXG4gICAgICAgIGNvbGxlY3RlZF9hdDogJycsXHJcbiAgICAgICAgZGF0ZV9wYXJ0aXRpb246ICcnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBzM19rZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcblxyXG4gICAgICBjb25zdCBjb25kaXRpb25hbENoZWNrRXJyb3IgPSBuZXcgRXJyb3IoJ0NvbmRpdGlvbmFsQ2hlY2tGYWlsZWRFeGNlcHRpb24nKTtcclxuICAgICAgY29uZGl0aW9uYWxDaGVja0Vycm9yLm5hbWUgPSAnQ29uZGl0aW9uYWxDaGVja0ZhaWxlZEV4Y2VwdGlvbic7XHJcbiAgICAgIGR5bmFtb01vY2sub24oUHV0SXRlbUNvbW1hbmQpLnJlamVjdHMoY29uZGl0aW9uYWxDaGVja0Vycm9yKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBzYXZlTWV0YWRhdGEoZGlzY2xvc3VyZSwgczNfa2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdEdXBsaWNhdGUgZGlzY2xvc3VyZSBkZXRlY3RlZCcsIHtcclxuICAgICAgICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMScsXHJcbiAgICAgICAgczNfa2V5OiAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZicsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+eVsOOBquOCi+mWi+ekuklE44Gv5Lih5pa544Go44KC5L+d5a2Y44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmUxOiBEaXNjbG9zdXJlID0ge1xyXG4gICAgICAgIGRpc2Nsb3N1cmVfaWQ6ICdURDIwMjQwMTE1MDAxJyxcclxuICAgICAgICBjb21wYW55X2NvZGU6ICcxMjM0JyxcclxuICAgICAgICBjb21wYW55X25hbWU6ICfmoKrlvI/kvJrnpL7jgrXjg7Pjg5fjg6snLFxyXG4gICAgICAgIGRpc2Nsb3N1cmVfdHlwZTogJ+axuueul+efreS/oScsXHJcbiAgICAgICAgdGl0bGU6ICcyMDI05bm0M+aciOacnyDnrKwz5Zub5Y2K5pyf5rG6566X55+t5L+hJyxcclxuICAgICAgICBkaXNjbG9zZWRfYXQ6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsXHJcbiAgICAgICAgcGRmX3VybDogJ2h0dHBzOi8vd3d3LnJlbGVhc2UudGRuZXQuaW5mby9pbmJzLzE0MDEyMDI0MDExNTAwMS5wZGYnLFxyXG4gICAgICAgIHMzX2tleTogJycsXHJcbiAgICAgICAgY29sbGVjdGVkX2F0OiAnJyxcclxuICAgICAgICBkYXRlX3BhcnRpdGlvbjogJycsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlMjogRGlzY2xvc3VyZSA9IHtcclxuICAgICAgICBkaXNjbG9zdXJlX2lkOiAnVEQyMDI0MDExNTAwMicsIC8vIOeVsOOBquOCi0lEXHJcbiAgICAgICAgY29tcGFueV9jb2RlOiAnNTY3OCcsXHJcbiAgICAgICAgY29tcGFueV9uYW1lOiAn5qCq5byP5Lya56S+5Yil5Lya56S+JyxcclxuICAgICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmnInkvqHoqLzliLjloLHlkYrmm7gnLFxyXG4gICAgICAgIHRpdGxlOiAnMjAyNOW5tDPmnIjmnJ8g5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JyxcclxuICAgICAgICBkaXNjbG9zZWRfYXQ6ICcyMDI0LTAxLTE1VDExOjAwOjAwWicsXHJcbiAgICAgICAgcGRmX3VybDogJ2h0dHBzOi8vd3d3LnJlbGVhc2UudGRuZXQuaW5mby9pbmJzLzE0MDEyMDI0MDExNTAwMi5wZGYnLFxyXG4gICAgICAgIHMzX2tleTogJycsXHJcbiAgICAgICAgY29sbGVjdGVkX2F0OiAnJyxcclxuICAgICAgICBkYXRlX3BhcnRpdGlvbjogJycsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBkeW5hbW9Nb2NrLm9uKFB1dEl0ZW1Db21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgc2F2ZU1ldGFkYXRhKGRpc2Nsb3N1cmUxLCAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZicpO1xyXG4gICAgICBhd2FpdCBzYXZlTWV0YWRhdGEoZGlzY2xvc3VyZTIsICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDIucGRmJyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KGR5bmFtb01vY2suY2FsbHMoKSkudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgICAvLyDkuKHmlrnjgajjgoLmiJDlip9cclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn44OX44Ot44OR44OG44Kj44OZ44O844K544OG44K544OIJywgKCkgPT4ge1xyXG4gICAgaXQoJ+S7u+aEj+OBrumWi+ekuuaDheWgseOCkjLlm57kv53lrZjjgZfjgabjgoLlhqrnrYnmgKfjgYzkv53jgZ/jgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IGZjLmFzc2VydChcclxuICAgICAgICBmYy5hc3luY1Byb3BlcnR5KFxyXG4gICAgICAgICAgZmMucmVjb3JkKHtcclxuICAgICAgICAgICAgZGlzY2xvc3VyZV9pZDogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiAyMCB9KSxcclxuICAgICAgICAgICAgY29tcGFueV9jb2RlOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDQsIG1heExlbmd0aDogNCB9KSxcclxuICAgICAgICAgICAgY29tcGFueV9uYW1lOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAwIH0pLFxyXG4gICAgICAgICAgICBkaXNjbG9zdXJlX3R5cGU6IGZjLmNvbnN0YW50RnJvbSgn5rG6566X55+t5L+hJywgJ+acieS+oeiovOWIuOWgseWRiuabuCcsICfpganmmYLplovnpLonKSxcclxuICAgICAgICAgICAgdGl0bGU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAyMDAgfSksXHJcbiAgICAgICAgICAgIGRpc2Nsb3NlZF9hdDogZmNcclxuICAgICAgICAgICAgICAuZGF0ZSh7IG1pbjogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSwgbWF4OiBuZXcgRGF0ZSgpIH0pXHJcbiAgICAgICAgICAgICAgLm1hcCgoZCkgPT4gZC50b0lTT1N0cmluZygpKSxcclxuICAgICAgICAgICAgcGRmX3VybDogZmMud2ViVXJsKCksXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGFzeW5jIChkaXNjbG9zdXJlRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBBcnJhbmdlXHJcbiAgICAgICAgICAgIGR5bmFtb01vY2sucmVzZXQoKTtcclxuICAgICAgICAgICAgY29uc3QgZGlzY2xvc3VyZTogRGlzY2xvc3VyZSA9IHtcclxuICAgICAgICAgICAgICAuLi5kaXNjbG9zdXJlRGF0YSxcclxuICAgICAgICAgICAgICBzM19rZXk6ICcnLFxyXG4gICAgICAgICAgICAgIGNvbGxlY3RlZF9hdDogJycsXHJcbiAgICAgICAgICAgICAgZGF0ZV9wYXJ0aXRpb246ICcnLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBzM19rZXkgPSBgMjAyNC8wMS8xNS8ke2Rpc2Nsb3N1cmUuZGlzY2xvc3VyZV9pZH0ucGRmYDtcclxuXHJcbiAgICAgICAgICAgIC8vIDHlm57nm67jga/miJDlip9cclxuICAgICAgICAgICAgZHluYW1vTW9jay5vbihQdXRJdGVtQ29tbWFuZCkucmVzb2x2ZXNPbmNlKHt9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIDLlm57nm67jga/ph43opIfjgqjjg6njg7xcclxuICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uYWxDaGVja0Vycm9yID0gbmV3IEVycm9yKCdDb25kaXRpb25hbENoZWNrRmFpbGVkRXhjZXB0aW9uJyk7XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbmFsQ2hlY2tFcnJvci5uYW1lID0gJ0NvbmRpdGlvbmFsQ2hlY2tGYWlsZWRFeGNlcHRpb24nO1xyXG4gICAgICAgICAgICBkeW5hbW9Nb2NrLm9uKFB1dEl0ZW1Db21tYW5kKS5yZWplY3RzT25jZShjb25kaXRpb25hbENoZWNrRXJyb3IpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChzYXZlTWV0YWRhdGEoZGlzY2xvc3VyZSwgczNfa2V5KSkucmVzb2x2ZXMudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3Qoc2F2ZU1ldGFkYXRhKGRpc2Nsb3N1cmUsIHMzX2tleSkpLnJlc29sdmVzLnRvQmVVbmRlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIOS4oeaWueOBqOOCguato+W4uOe1guS6hu+8iOOCqOODqeODvOOCkuOCueODreODvOOBl+OBquOBhO+8iVxyXG4gICAgICAgICAgICBleHBlY3QoZHluYW1vTW9jay5jYWxscygpKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICB7IG51bVJ1bnM6IDEwMCB9IC8vIDEwMOWbnuWPjeW+qVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+ikh+aVsOOBrueVsOOBquOCi+mWi+ekuuaDheWgseOCkuS/neWtmOOBl+OBpuOCguOAgeOBneOCjOOBnuOCjDHku7bjga7jgb/kv53lrZjjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IGZjLmFzc2VydChcclxuICAgICAgICBmYy5hc3luY1Byb3BlcnR5KFxyXG4gICAgICAgICAgZmMuYXJyYXkoXHJcbiAgICAgICAgICAgIGZjLnJlY29yZCh7XHJcbiAgICAgICAgICAgICAgZGlzY2xvc3VyZV9pZDogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiAyMCB9KSxcclxuICAgICAgICAgICAgICBjb21wYW55X2NvZGU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogNCwgbWF4TGVuZ3RoOiA0IH0pLFxyXG4gICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDEwMCB9KSxcclxuICAgICAgICAgICAgICBkaXNjbG9zdXJlX3R5cGU6IGZjLmNvbnN0YW50RnJvbSgn5rG6566X55+t5L+hJywgJ+acieS+oeiovOWIuOWgseWRiuabuCcsICfpganmmYLplovnpLonKSxcclxuICAgICAgICAgICAgICB0aXRsZTogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDIwMCB9KSxcclxuICAgICAgICAgICAgICBkaXNjbG9zZWRfYXQ6IGZjXHJcbiAgICAgICAgICAgICAgICAuZGF0ZSh7IG1pbjogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSwgbWF4OiBuZXcgRGF0ZSgpIH0pXHJcbiAgICAgICAgICAgICAgICAubWFwKChkKSA9PiBkLnRvSVNPU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgIHBkZl91cmw6IGZjLndlYlVybCgpLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAgfVxyXG4gICAgICAgICAgKSxcclxuICAgICAgICAgIGFzeW5jIChkaXNjbG9zdXJlc0RhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICAgICAgICBkeW5hbW9Nb2NrLnJlc2V0KCk7XHJcbiAgICAgICAgICAgIGR5bmFtb01vY2sub24oUHV0SXRlbUNvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFjdFxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRpc2Nsb3N1cmVEYXRhIG9mIGRpc2Nsb3N1cmVzRGF0YSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGRpc2Nsb3N1cmU6IERpc2Nsb3N1cmUgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi5kaXNjbG9zdXJlRGF0YSxcclxuICAgICAgICAgICAgICAgIHMzX2tleTogJycsXHJcbiAgICAgICAgICAgICAgICBjb2xsZWN0ZWRfYXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgZGF0ZV9wYXJ0aXRpb246ICcnLFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgY29uc3QgczNfa2V5ID0gYDIwMjQvMDEvMTUvJHtkaXNjbG9zdXJlLmRpc2Nsb3N1cmVfaWR9LnBkZmA7XHJcbiAgICAgICAgICAgICAgYXdhaXQgc2F2ZU1ldGFkYXRhKGRpc2Nsb3N1cmUsIHMzX2tleSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEFzc2VydFxyXG4gICAgICAgICAgICBleHBlY3QoZHluYW1vTW9jay5jYWxscygpKS50b0hhdmVMZW5ndGgoZGlzY2xvc3VyZXNEYXRhLmxlbmd0aCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICB7IG51bVJ1bnM6IDEwMCB9IC8vIDEwMOWbnuWPjeW+qVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=