{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\query-disclosures.test.ts","mappings":";AAAA;;;;GAIG;;AAKH,IAAI,CAAC,IAAI,CAAC,0BAA0B,EAAE,GAAG,EAAE;IACzC,MAAM,YAAY,GAAG,IAAI,CAAC,aAAa,CAAC,0BAA0B,CAAC,CAAC;IACpE,OAAO;QACL,GAAG,YAAY;QACf,cAAc,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,CAAC;YAClD,IAAI,EAAE,QAAQ;SACf,CAAC,CAAC;KACJ,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;AACnC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE,CAAC,CAAC;IACvC,gBAAgB,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,aAAa;CACvD,CAAC,CAAC,CAAC;AAhBJ,sBAAsB;AACtB,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;AAiB3B,4DAAqE;AAErE,0DAAkD;AAGlD,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;IAChC,MAAM,eAAe,GAAiB;QACpC;YACE,aAAa,EAAE,mBAAmB;YAClC,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,SAAS;YACvB,eAAe,EAAE,MAAM;YACvB,KAAK,EAAE,oBAAoB;YAC3B,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,+CAA+C;YACxD,MAAM,EAAE,uCAAuC;YAC/C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B;QACD;YACE,aAAa,EAAE,mBAAmB;YAClC,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,SAAS;YACvB,eAAe,EAAE,SAAS;YAC1B,KAAK,EAAE,aAAa;YACpB,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,+CAA+C;YACxD,MAAM,EAAE,uCAAuC;YAC/C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B;QACD;YACE,aAAa,EAAE,mBAAmB;YAClC,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,UAAU;YACxB,eAAe,EAAE,MAAM;YACvB,KAAK,EAAE,oBAAoB;YAC3B,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,+CAA+C;YACxD,MAAM,EAAE,uCAAuC;YAC/C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B;KACF,CAAC;IAEF,UAAU,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,QAAQ,CAAC,SAAS,EAAE,CAAC;QACrB,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,wBAAwB,CAAC;QAC3D,OAAO,CAAC,GAAG,CAAC,UAAU,GAAG,gBAAgB,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,2CAA2C,EAAE,GAAG,EAAE;QACzD,EAAE,CAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;YAChC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACxD,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACxD,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE7B,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;YACrE,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;QACpF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;YAC/B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,UAAU,EAAE,YAAY;gBACxB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,SAAS,CAAC,6BAA6B,CAAC,CAAC;QACxF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;YAC/B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,QAAQ,EAAE,YAAY;gBACtB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,SAAS,CAAC,2BAA2B,CAAC,CAAC;QACtF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;YAChC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,UAAU,EAAE,YAAY;gBACxB,QAAQ,EAAE,YAAY;gBACtB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,SAAS,CACpD,gDAAgD,CACjD,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,+BAA+B,EAAE,GAAG,EAAE;QAC7C,EAAE,CAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;YAC/B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,UAAU,EAAE,YAAY;gBACxB,QAAQ,EAAE,YAAY;gBACtB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE7B,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0BAA0B,EAAE,KAAK,IAAI,EAAE;YACxC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,UAAU,EAAE,YAAY;gBACxB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACrD,MAAM,CAAC,QAAQ,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oBAAoB,EAAE,KAAK,IAAI,EAAE;YAClC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,UAAU,EAAE,YAAY;gBACxB,QAAQ,EAAE,YAAY;gBACtB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,qBAAqB;YAChE,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC3D,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC3D,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,yBAAyB,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACnF,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,yBAAyB,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACrF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,gBAAgB,EAAE,KAAK,IAAI,EAAE;YAC9B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE7B,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAgB,CAAC;YACzD,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACjE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,EAAE,CAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;YAC/B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,eAAe,EAAE,MAAM;gBACvB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,eAAe,KAAK,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,eAAe,EAAE,MAAM;gBACvB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACxD,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE;QACnB,EAAE,CAAC,eAAe,EAAE,KAAK,IAAI,EAAE;YAC7B,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;YACxE,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;YACxE,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,UAAU,EAAE,GAAG,EAAE;QACxB,EAAE,CAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;YAChC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;YACjC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC9B,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC/C,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,oCAAoC,EAAE,GAAG,EAAE;QAClD,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,YAAY;YACZ,QAAQ,CAAC,qBAAqB,CAAC;gBAC7B,KAAK,EAAE,CAAC,IAAA,wBAAQ,EAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrC,gBAAgB,EAAE,EAAE,aAAa,EAAE,EAAE,CAAC,EAAE,mBAAmB,EAAE,EAAE;aAChE,CAAC,CAAC;YAEH,YAAY;YACZ,QAAQ,CAAC,qBAAqB,CAAC;gBAC7B,KAAK,EAAE,CAAC,IAAA,wBAAQ,EAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;aACtC,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,WAAW,EAAE,GAAG,EAAE;QACzB,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,MAAM,eAAe,GAAG,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YACzD,eAAe,CAAC,IAAI,GAAG,qBAAqB,CAAC;YAE7C,8BAA8B;YAC9B,MAAM,EAAE,gBAAgB,EAAE,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;YAC5D,gBAA8B,CAAC,sBAAsB,CAAC,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE;gBAC3E,kBAAkB;gBAClB,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACxD,oBAAoB;gBACpB,MAAM,eAAe,CAAC;YACxB,CAAC,CAAC,CAAC;YAEH,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE;YACrE,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,MAAM,eAAe,GAAG,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;YAC5E,eAAe,CAAC,IAAI,GAAG,wCAAwC,CAAC;YAEhE,8BAA8B;YAC9B,MAAM,EAAE,gBAAgB,EAAE,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;YAC5D,gBAA8B,CAAC,sBAAsB,CAAC,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE;gBAC3E,kBAAkB;gBAClB,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACxD,oBAAoB;gBACpB,MAAM,eAAe,CAAC;YACxB,CAAC,CAAC,CAAC;YAEH,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CACpD,wCAAwC,CACzC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,MAAM,eAAe,GAAG,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YACzD,eAAe,CAAC,IAAI,GAAG,qBAAqB,CAAC;YAE7C,QAAQ,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;YAE5C,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE;QACtB,EAAE,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;YACjC,UAAU;YACV,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,EAAE;aACV,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE9C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,UAAU;YACV,OAAO,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC;YACvC,MAAM,MAAM,GAAgB;gBAC1B,YAAY,EAAE,MAAM;gBACpB,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,CAAC;aACV,CAAC;YAEF,QAAQ,CAAC,iBAAiB,CAAC;gBACzB,KAAK,EAAE,eAAe;qBACnB,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,MAAM,CAAC;qBACxC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,wBAAQ,EAAC,CAAC,CAAC,CAAC;aAC3B,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,IAAA,oCAAgB,EAAC,MAAM,CAAC,CAAC;YAE/B,SAAS;YACT,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAiB,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\__tests__\\query-disclosures.test.ts"],"sourcesContent":["/**\r\n * Query Disclosures Unit Tests\r\n *\r\n * Requirements: 要件4.1（検索API）、要件14.1（ユニットテスト）\r\n */\r\n\r\n// モック設定（importより前に定義）\r\nconst mockSend = jest.fn();\r\n\r\njest.mock('@aws-sdk/client-dynamodb', () => {\r\n  const actualModule = jest.requireActual('@aws-sdk/client-dynamodb');\r\n  return {\r\n    ...actualModule,\r\n    DynamoDBClient: jest.fn().mockImplementation(() => ({\r\n      send: mockSend,\r\n    })),\r\n  };\r\n});\r\n\r\njest.mock('../../../utils/logger');\r\njest.mock('../../../utils/retry', () => ({\r\n  retryWithBackoff: jest.fn((fn) => fn()), // retryをバイパス\r\n}));\r\n\r\nimport { queryDisclosures, QueryParams } from '../query-disclosures';\r\nimport { QueryCommand, ScanCommand } from '@aws-sdk/client-dynamodb';\r\nimport { marshall } from '@aws-sdk/util-dynamodb';\r\nimport { Disclosure } from '../../../types';\r\n\r\ndescribe('queryDisclosures', () => {\r\n  const mockDisclosures: Disclosure[] = [\r\n    {\r\n      disclosure_id: '20240115_1234_001',\r\n      company_code: '1234',\r\n      company_name: 'テスト株式会社',\r\n      disclosure_type: '決算短信',\r\n      title: '2024年3月期 第3四半期決算短信',\r\n      disclosed_at: '2024-01-15T10:30:00Z',\r\n      pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',\r\n      s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',\r\n      collected_at: '2024-01-15T10:35:00Z',\r\n      date_partition: '2024-01',\r\n    },\r\n    {\r\n      disclosure_id: '20240115_1234_002',\r\n      company_code: '1234',\r\n      company_name: 'テスト株式会社',\r\n      disclosure_type: '有価証券報告書',\r\n      title: '第50期有価証券報告書',\r\n      disclosed_at: '2024-01-15T11:00:00Z',\r\n      pdf_url: 'https://example.com/pdf/20240115_1234_002.pdf',\r\n      s3_key: 'pdfs/2024/01/15/20240115_1234_002.pdf',\r\n      collected_at: '2024-01-15T11:05:00Z',\r\n      date_partition: '2024-01',\r\n    },\r\n    {\r\n      disclosure_id: '20240116_5678_001',\r\n      company_code: '5678',\r\n      company_name: 'サンプル株式会社',\r\n      disclosure_type: '決算短信',\r\n      title: '2024年3月期 第3四半期決算短信',\r\n      disclosed_at: '2024-01-16T09:00:00Z',\r\n      pdf_url: 'https://example.com/pdf/20240116_5678_001.pdf',\r\n      s3_key: 'pdfs/2024/01/16/20240116_5678_001.pdf',\r\n      collected_at: '2024-01-16T09:05:00Z',\r\n      date_partition: '2024-01',\r\n    },\r\n  ];\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    mockSend.mockClear();\r\n    process.env.DYNAMODB_TABLE_NAME = 'test-disclosures-table';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n  });\r\n\r\n  describe('企業コードでクエリ（GSI_CompanyCode_DiscloseDate使用）', () => {\r\n    it('企業コードで開示情報を検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(result.disclosures[0].company_code).toBe('1234');\r\n      expect(result.disclosures[1].company_code).toBe('1234');\r\n      expect(result.total).toBe(2);\r\n      expect(result.count).toBe(2);\r\n\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.IndexName).toBe('GSI_CompanyCode_DiscloseDate');\r\n      expect(command.input.KeyConditionExpression).toBe('company_code = :company_code');\r\n    });\r\n\r\n    it('企業コードと開始日で検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        start_date: '2024-01-15',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.KeyConditionExpression).toContain('disclosed_at >= :start_date');\r\n    });\r\n\r\n    it('企業コードと終了日で検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        end_date: '2024-01-15',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.KeyConditionExpression).toContain('disclosed_at <= :end_date');\r\n    });\r\n\r\n    it('企業コードと日付範囲で検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.KeyConditionExpression).toContain(\r\n        'disclosed_at BETWEEN :start_date AND :end_date'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('日付範囲でクエリ（GSI_DatePartition使用）', () => {\r\n    it('日付範囲で開示情報を検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-16',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(3);\r\n      expect(result.total).toBe(3);\r\n\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.IndexName).toBe('GSI_DatePartition');\r\n      expect(command.input.KeyConditionExpression).toBe('date_partition = :partition');\r\n    });\r\n\r\n    it('開始日のみ指定した場合、今日までの範囲で検索する', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        start_date: '2024-01-15',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures.length).toBeGreaterThan(0);\r\n      expect(mockSend).toHaveBeenCalled();\r\n    });\r\n\r\n    it('複数月にまたがる日付範囲で検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-02-15',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(mockSend).toHaveBeenCalledTimes(2); // 2024-01と2024-02の2回\r\n      const command1 = mockSend.mock.calls[0][0] as QueryCommand;\r\n      const command2 = mockSend.mock.calls[1][0] as QueryCommand;\r\n      expect(command1.input.ExpressionAttributeValues?.[':partition'].S).toBe('2024-01');\r\n      expect(command2.input.ExpressionAttributeValues?.[':partition'].S).toBe('2024-02');\r\n    });\r\n  });\r\n\r\n  describe('フィルタなしクエリ（Scan使用）', () => {\r\n    it('フィルタなしで全件検索できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(3);\r\n      expect(result.total).toBe(3);\r\n\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n      const command = mockSend.mock.calls[0][0] as ScanCommand;\r\n      expect(command.input.TableName).toBe('test-disclosures-table');\r\n    });\r\n  });\r\n\r\n  describe('開示種類フィルタリング', () => {\r\n    it('開示種類でフィルタリングできる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        disclosure_type: '決算短信',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(result.disclosures.every((d) => d.disclosure_type === '決算短信')).toBe(true);\r\n    });\r\n\r\n    it('企業コードと開示種類で複合フィルタリングできる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        disclosure_type: '決算短信',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(1);\r\n      expect(result.disclosures[0].company_code).toBe('1234');\r\n      expect(result.disclosures[0].disclosure_type).toBe('決算短信');\r\n    });\r\n  });\r\n\r\n  describe('ソート', () => {\r\n    it('開示日時で降順ソートされる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(3);\r\n      expect(result.disclosures[0].disclosed_at).toBe('2024-01-16T09:00:00Z');\r\n      expect(result.disclosures[1].disclosed_at).toBe('2024-01-15T11:00:00Z');\r\n      expect(result.disclosures[2].disclosed_at).toBe('2024-01-15T10:30:00Z');\r\n    });\r\n  });\r\n\r\n  describe('ページネーション', () => {\r\n    it('limitで取得件数を制限できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        format: 'json',\r\n        limit: 2,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(result.count).toBe(2);\r\n      expect(result.total).toBe(3);\r\n      expect(result.limit).toBe(2);\r\n      expect(result.offset).toBe(0);\r\n    });\r\n\r\n    it('offsetで開始位置を指定できる', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        format: 'json',\r\n        limit: 2,\r\n        offset: 1,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(result.count).toBe(2);\r\n      expect(result.total).toBe(3);\r\n      expect(result.offset).toBe(1);\r\n      expect(result.disclosures[0].disclosed_at).toBe('2024-01-15T11:00:00Z');\r\n    });\r\n\r\n    it('offsetが全件数を超える場合、空配列を返す', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 10,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures.map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(0);\r\n      expect(result.count).toBe(0);\r\n      expect(result.total).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('DynamoDBページネーション（LastEvaluatedKey）', () => {\r\n    it('LastEvaluatedKeyがある場合、複数回クエリする', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      // 1回目のレスポンス\r\n      mockSend.mockResolvedValueOnce({\r\n        Items: [marshall(mockDisclosures[0])],\r\n        LastEvaluatedKey: { disclosure_id: { S: '20240115_1234_001' } },\r\n      });\r\n\r\n      // 2回目のレスポンス\r\n      mockSend.mockResolvedValueOnce({\r\n        Items: [marshall(mockDisclosures[1])],\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(2);\r\n      expect(mockSend).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n\r\n  describe('エラーハンドリング', () => {\r\n    it('DynamoDB ThrottlingExceptionで再試行する', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      const throttlingError = new Error('ThrottlingException');\r\n      throttlingError.name = 'ThrottlingException';\r\n\r\n      // retryWithBackoffのモックを一時的に変更\r\n      const { retryWithBackoff } = require('../../../utils/retry');\r\n      (retryWithBackoff as jest.Mock).mockImplementationOnce(async (fn, options) => {\r\n        // shouldRetryをテスト\r\n        expect(options.shouldRetry(throttlingError)).toBe(true);\r\n        // 実際には再試行せず、エラーをスロー\r\n        throw throttlingError;\r\n      });\r\n\r\n      // Act & Assert\r\n      await expect(queryDisclosures(params)).rejects.toThrow('ThrottlingException');\r\n    });\r\n\r\n    it('DynamoDB ProvisionedThroughputExceededExceptionで再試行する', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      const throughputError = new Error('ProvisionedThroughputExceededException');\r\n      throughputError.name = 'ProvisionedThroughputExceededException';\r\n\r\n      // retryWithBackoffのモックを一時的に変更\r\n      const { retryWithBackoff } = require('../../../utils/retry');\r\n      (retryWithBackoff as jest.Mock).mockImplementationOnce(async (fn, options) => {\r\n        // shouldRetryをテスト\r\n        expect(options.shouldRetry(throughputError)).toBe(true);\r\n        // 実際には再試行せず、エラーをスロー\r\n        throw throughputError;\r\n      });\r\n\r\n      // Act & Assert\r\n      await expect(queryDisclosures(params)).rejects.toThrow(\r\n        'ProvisionedThroughputExceededException'\r\n      );\r\n    });\r\n\r\n    it('その他のDynamoDBエラーで即座に失敗する', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      const validationError = new Error('ValidationException');\r\n      validationError.name = 'ValidationException';\r\n\r\n      mockSend.mockRejectedValue(validationError);\r\n\r\n      // Act & Assert\r\n      await expect(queryDisclosures(params)).rejects.toThrow('ValidationException');\r\n    });\r\n  });\r\n\r\n  describe('エッジケース', () => {\r\n    it('検索結果が0件の場合、空配列を返す', async () => {\r\n      // Arrange\r\n      const params: QueryParams = {\r\n        company_code: '9999',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: [],\r\n      });\r\n\r\n      // Act\r\n      const result = await queryDisclosures(params);\r\n\r\n      // Assert\r\n      expect(result.disclosures).toHaveLength(0);\r\n      expect(result.total).toBe(0);\r\n      expect(result.count).toBe(0);\r\n    });\r\n\r\n    it('環境変数DYNAMODB_TABLE_NAMEが未設定の場合、デフォルト値を使用する', async () => {\r\n      // Arrange\r\n      delete process.env.DYNAMODB_TABLE_NAME;\r\n      const params: QueryParams = {\r\n        company_code: '1234',\r\n        format: 'json',\r\n        limit: 10,\r\n        offset: 0,\r\n      };\r\n\r\n      mockSend.mockResolvedValue({\r\n        Items: mockDisclosures\r\n          .filter((d) => d.company_code === '1234')\r\n          .map((d) => marshall(d)),\r\n      });\r\n\r\n      // Act\r\n      await queryDisclosures(params);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as QueryCommand;\r\n      expect(command.input.TableName).toBe('tdnet_disclosures');\r\n    });\r\n  });\r\n});\r\n"],"version":3}