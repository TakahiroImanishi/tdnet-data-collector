be1d4b7e64d9ca415b0dc9dd4b3eea02
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudWatchAlarms = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const cloudwatch = __importStar(require("aws-cdk-lib/aws-cloudwatch"));
const cloudwatch_actions = __importStar(require("aws-cdk-lib/aws-cloudwatch-actions"));
const sns = __importStar(require("aws-cdk-lib/aws-sns"));
const subscriptions = __importStar(require("aws-cdk-lib/aws-sns-subscriptions"));
const constructs_1 = require("constructs");
/**
 * CloudWatch Alarms Construct
 *
 * Lambda関数とシステム全体の監視アラームを設定します。
 *
 * 設定されるアラーム:
 * - Lambda Error Rate > 10% → Critical
 * - Lambda Duration > 14分 → Warning
 * - CollectionSuccessRate < 95% → Warning
 * - SNS Topicへの通知設定
 */
class CloudWatchAlarms extends constructs_1.Construct {
    /**
     * SNS Topic（アラート通知用）
     */
    alertTopic;
    /**
     * 作成されたアラームのリスト
     */
    alarms = [];
    constructor(scope, id, props) {
        super(scope, id);
        // デフォルト値の設定
        const errorRateThreshold = props.errorRateThreshold ?? 10; // 10%
        const durationThreshold = props.durationThreshold ?? 840; // 14分 = 840秒
        const collectionSuccessRateThreshold = props.collectionSuccessRateThreshold ?? 95; // 95%
        // ========================================
        // SNS Topic作成（アラート通知用）
        // ========================================
        this.alertTopic = new sns.Topic(this, 'AlertTopic', {
            topicName: `tdnet-alerts-${props.environment}`,
            displayName: `TDnet Data Collector Alerts (${props.environment})`,
        });
        // メール通知の追加（オプション）
        if (props.alertEmail) {
            this.alertTopic.addSubscription(new subscriptions.EmailSubscription(props.alertEmail));
        }
        // ========================================
        // Lambda関数ごとのアラーム設定
        // ========================================
        for (const lambdaFunction of props.lambdaFunctions) {
            const functionName = lambdaFunction.functionName;
            // 1. Lambda Error Rate アラーム（Critical）
            const errorRateAlarm = new cloudwatch.Alarm(this, `${functionName}-ErrorRateAlarm`, {
                alarmName: `${functionName}-error-rate-${props.environment}`,
                alarmDescription: `Lambda関数 ${functionName} のエラー率が ${errorRateThreshold}% を超えました`,
                metric: this.createErrorRateMetric(lambdaFunction),
                threshold: errorRateThreshold,
                evaluationPeriods: 1,
                comparisonOperator: cloudwatch.ComparisonOperator.GREATER_THAN_THRESHOLD,
                treatMissingData: cloudwatch.TreatMissingData.NOT_BREACHING,
            });
            errorRateAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
            this.alarms.push(errorRateAlarm);
            // 2. Lambda Duration アラーム（Warning）
            const durationAlarm = new cloudwatch.Alarm(this, `${functionName}-DurationAlarm`, {
                alarmName: `${functionName}-duration-${props.environment}`,
                alarmDescription: `Lambda関数 ${functionName} の実行時間が ${durationThreshold} 秒を超えました`,
                metric: lambdaFunction.metricDuration({
                    statistic: 'Average',
                    period: cdk.Duration.minutes(5),
                }),
                threshold: durationThreshold * 1000, // ミリ秒に変換
                evaluationPeriods: 2,
                comparisonOperator: cloudwatch.ComparisonOperator.GREATER_THAN_THRESHOLD,
                treatMissingData: cloudwatch.TreatMissingData.NOT_BREACHING,
            });
            durationAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
            this.alarms.push(durationAlarm);
            // 3. Lambda Throttles アラーム（Critical）
            const throttleAlarm = new cloudwatch.Alarm(this, `${functionName}-ThrottleAlarm`, {
                alarmName: `${functionName}-throttles-${props.environment}`,
                alarmDescription: `Lambda関数 ${functionName} でスロットリングが発生しました`,
                metric: lambdaFunction.metricThrottles({
                    statistic: 'Sum',
                    period: cdk.Duration.minutes(5),
                }),
                threshold: 1,
                evaluationPeriods: 1,
                comparisonOperator: cloudwatch.ComparisonOperator.GREATER_THAN_OR_EQUAL_TO_THRESHOLD,
                treatMissingData: cloudwatch.TreatMissingData.NOT_BREACHING,
            });
            throttleAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
            this.alarms.push(throttleAlarm);
        }
        // ========================================
        // カスタムメトリクスのアラーム
        // ========================================
        // 4. CollectionSuccessRate アラーム（Warning）
        const collectionSuccessRateAlarm = new cloudwatch.Alarm(this, 'CollectionSuccessRateAlarm', {
            alarmName: `tdnet-collection-success-rate-${props.environment}`,
            alarmDescription: `収集成功率が ${collectionSuccessRateThreshold}% を下回りました`,
            metric: this.createCollectionSuccessRateMetric(props.environment),
            threshold: collectionSuccessRateThreshold,
            evaluationPeriods: 1,
            comparisonOperator: cloudwatch.ComparisonOperator.LESS_THAN_THRESHOLD,
            treatMissingData: cloudwatch.TreatMissingData.NOT_BREACHING,
        });
        collectionSuccessRateAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
        this.alarms.push(collectionSuccessRateAlarm);
        // 5. データ収集停止アラーム（Critical）
        const noDataAlarm = new cloudwatch.Alarm(this, 'NoDataCollectedAlarm', {
            alarmName: `tdnet-no-data-collected-${props.environment}`,
            alarmDescription: '24時間データ収集がありません',
            metric: new cloudwatch.Metric({
                namespace: 'TDnet/Collector',
                metricName: 'DisclosuresCollected',
                statistic: 'Sum',
                period: cdk.Duration.hours(24),
                dimensionsMap: {
                    Environment: props.environment,
                },
            }),
            threshold: 1,
            evaluationPeriods: 1,
            comparisonOperator: cloudwatch.ComparisonOperator.LESS_THAN_THRESHOLD,
            treatMissingData: cloudwatch.TreatMissingData.BREACHING,
        });
        noDataAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
        this.alarms.push(noDataAlarm);
        // 6. 収集失敗アラーム（Warning）
        const collectionFailureAlarm = new cloudwatch.Alarm(this, 'CollectionFailureAlarm', {
            alarmName: `tdnet-collection-failures-${props.environment}`,
            alarmDescription: '24時間で10件以上の収集失敗が発生しました',
            metric: new cloudwatch.Metric({
                namespace: 'TDnet/Collector',
                metricName: 'DisclosuresFailed',
                statistic: 'Sum',
                period: cdk.Duration.hours(24),
                dimensionsMap: {
                    Environment: props.environment,
                },
            }),
            threshold: 10,
            evaluationPeriods: 1,
            comparisonOperator: cloudwatch.ComparisonOperator.GREATER_THAN_THRESHOLD,
            treatMissingData: cloudwatch.TreatMissingData.NOT_BREACHING,
        });
        collectionFailureAlarm.addAlarmAction(new cloudwatch_actions.SnsAction(this.alertTopic));
        this.alarms.push(collectionFailureAlarm);
        // ========================================
        // CloudFormation Outputs
        // ========================================
        new cdk.CfnOutput(this, 'AlertTopicArn', {
            value: this.alertTopic.topicArn,
            description: 'SNS Topic ARN for alerts',
            exportName: `TdnetAlertTopicArn-${props.environment}`,
        });
        new cdk.CfnOutput(this, 'AlarmCount', {
            value: this.alarms.length.toString(),
            description: 'Number of CloudWatch Alarms created',
        });
    }
    /**
     * Lambda Error Rateメトリクスを作成
     *
     * Error Rate = (Errors / Invocations) * 100
     */
    createErrorRateMetric(lambdaFunction) {
        const errors = lambdaFunction.metricErrors({
            statistic: 'Sum',
            period: cdk.Duration.minutes(5),
        });
        const invocations = lambdaFunction.metricInvocations({
            statistic: 'Sum',
            period: cdk.Duration.minutes(5),
        });
        // Error Rate = (Errors / Invocations) * 100
        return new cloudwatch.MathExpression({
            expression: '(errors / invocations) * 100',
            usingMetrics: {
                errors,
                invocations,
            },
            label: 'Error Rate (%)',
            period: cdk.Duration.minutes(5),
        });
    }
    /**
     * CollectionSuccessRateメトリクスを作成
     *
     * Success Rate = (DisclosuresCollected / (DisclosuresCollected + DisclosuresFailed)) * 100
     */
    createCollectionSuccessRateMetric(environment) {
        const collected = new cloudwatch.Metric({
            namespace: 'TDnet/Collector',
            metricName: 'DisclosuresCollected',
            statistic: 'Sum',
            period: cdk.Duration.hours(1),
            dimensionsMap: {
                Environment: environment,
            },
        });
        const failed = new cloudwatch.Metric({
            namespace: 'TDnet/Collector',
            metricName: 'DisclosuresFailed',
            statistic: 'Sum',
            period: cdk.Duration.hours(1),
            dimensionsMap: {
                Environment: environment,
            },
        });
        // Success Rate = (Collected / (Collected + Failed)) * 100
        return new cloudwatch.MathExpression({
            expression: '(collected / (collected + failed)) * 100',
            usingMetrics: {
                collected,
                failed,
            },
            label: 'Collection Success Rate (%)',
            period: cdk.Duration.hours(1),
        });
    }
}
exports.CloudWatchAlarms = CloudWatchAlarms;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxsaWJcXGNvbnN0cnVjdHNcXGNsb3Vkd2F0Y2gtYWxhcm1zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGlEQUFtQztBQUNuQyx1RUFBeUQ7QUFDekQsdUZBQXlFO0FBQ3pFLHlEQUEyQztBQUMzQyxpRkFBbUU7QUFFbkUsMkNBQXVDO0FBcUN2Qzs7Ozs7Ozs7OztHQVVHO0FBQ0gsTUFBYSxnQkFBaUIsU0FBUSxzQkFBUztJQUM3Qzs7T0FFRztJQUNhLFVBQVUsQ0FBWTtJQUV0Qzs7T0FFRztJQUNhLE1BQU0sR0FBdUIsRUFBRSxDQUFDO0lBRWhELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBNEI7UUFDcEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixZQUFZO1FBQ1osTUFBTSxrQkFBa0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTTtRQUNqRSxNQUFNLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUMsQ0FBQyxhQUFhO1FBQ3ZFLE1BQU0sOEJBQThCLEdBQUcsS0FBSyxDQUFDLDhCQUE4QixJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU07UUFFekYsMkNBQTJDO1FBQzNDLHVCQUF1QjtRQUN2QiwyQ0FBMkM7UUFDM0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUNsRCxTQUFTLEVBQUUsZ0JBQWdCLEtBQUssQ0FBQyxXQUFXLEVBQUU7WUFDOUMsV0FBVyxFQUFFLGdDQUFnQyxLQUFLLENBQUMsV0FBVyxHQUFHO1NBQ2xFLENBQUMsQ0FBQztRQUVILGtCQUFrQjtRQUNsQixJQUFJLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsVUFB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Q0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUM5QixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUE3T0QsNENBNk9DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXGNka1xcbGliXFxjb25zdHJ1Y3RzXFxjbG91ZHdhdGNoLWFsYXJtcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgKiBhcyBjbG91ZHdhdGNoIGZyb20gJ2F3cy1jZGstbGliL2F3cy1jbG91ZHdhdGNoJztcclxuaW1wb3J0ICogYXMgY2xvdWR3YXRjaF9hY3Rpb25zIGZyb20gJ2F3cy1jZGstbGliL2F3cy1jbG91ZHdhdGNoLWFjdGlvbnMnO1xyXG5pbXBvcnQgKiBhcyBzbnMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNucyc7XHJcbmltcG9ydCAqIGFzIHN1YnNjcmlwdGlvbnMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNucy1zdWJzY3JpcHRpb25zJztcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcclxuXHJcbi8qKlxyXG4gKiBDbG91ZFdhdGNoIEFsYXJtcyBDb25zdHJ1Y3QgUHJvcGVydGllc1xyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBDbG91ZFdhdGNoQWxhcm1zUHJvcHMge1xyXG4gIC8qKlxyXG4gICAqIExhbWJkYemWouaVsOOBruODquOCueODiO+8iOebo+imluWvvuixoe+8iVxyXG4gICAqL1xyXG4gIGxhbWJkYUZ1bmN0aW9uczogbGFtYmRhLklGdW5jdGlvbltdO1xyXG5cclxuICAvKipcclxuICAgKiDnkrDlooPlkI3vvIhkZXYsIHN0YWdpbmcsIHByb2TvvIlcclxuICAgKi9cclxuICBlbnZpcm9ubWVudDogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDjgqLjg6njg7zjg4jpgJrnn6XlhYjjg6Hjg7zjg6vjgqLjg4njg6zjgrnvvIjjgqrjg5fjgrfjg6fjg7PvvIlcclxuICAgKi9cclxuICBhbGVydEVtYWlsPzogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBMYW1iZGEgRXJyb3IgUmF0ZemWvuWApO+8iOODh+ODleOCqeODq+ODiDogMTAl77yJXHJcbiAgICovXHJcbiAgZXJyb3JSYXRlVGhyZXNob2xkPzogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBMYW1iZGEgRHVyYXRpb27plr7lgKTvvIjnp5LjgIHjg4fjg5Xjgqnjg6vjg4g6IDg0MOenkiA9IDE05YiG77yJXHJcbiAgICovXHJcbiAgZHVyYXRpb25UaHJlc2hvbGQ/OiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbGxlY3Rpb25TdWNjZXNzUmF0ZemWvuWApO+8iOODh+ODleOCqeODq+ODiDogOTUl77yJXHJcbiAgICovXHJcbiAgY29sbGVjdGlvblN1Y2Nlc3NSYXRlVGhyZXNob2xkPzogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogQ2xvdWRXYXRjaCBBbGFybXMgQ29uc3RydWN0XHJcbiAqIFxyXG4gKiBMYW1iZGHplqLmlbDjgajjgrfjgrnjg4bjg6DlhajkvZPjga7nm6PoppbjgqLjg6njg7zjg6DjgpLoqK3lrprjgZfjgb7jgZnjgIJcclxuICogXHJcbiAqIOioreWumuOBleOCjOOCi+OCouODqeODvOODoDpcclxuICogLSBMYW1iZGEgRXJyb3IgUmF0ZSA+IDEwJSDihpIgQ3JpdGljYWxcclxuICogLSBMYW1iZGEgRHVyYXRpb24gPiAxNOWIhiDihpIgV2FybmluZ1xyXG4gKiAtIENvbGxlY3Rpb25TdWNjZXNzUmF0ZSA8IDk1JSDihpIgV2FybmluZ1xyXG4gKiAtIFNOUyBUb3BpY+OBuOOBrumAmuefpeioreWumlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENsb3VkV2F0Y2hBbGFybXMgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xyXG4gIC8qKlxyXG4gICAqIFNOUyBUb3BpY++8iOOCouODqeODvOODiOmAmuefpeeUqO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkb25seSBhbGVydFRvcGljOiBzbnMuVG9waWM7XHJcblxyXG4gIC8qKlxyXG4gICAqIOS9nOaIkOOBleOCjOOBn+OCouODqeODvOODoOOBruODquOCueODiFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkb25seSBhbGFybXM6IGNsb3Vkd2F0Y2guQWxhcm1bXSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQ2xvdWRXYXRjaEFsYXJtc1Byb3BzKSB7XHJcbiAgICBzdXBlcihzY29wZSwgaWQpO1xyXG5cclxuICAgIC8vIOODh+ODleOCqeODq+ODiOWApOOBruioreWumlxyXG4gICAgY29uc3QgZXJyb3JSYXRlVGhyZXNob2xkID0gcHJvcHMuZXJyb3JSYXRlVGhyZXNob2xkID8/IDEwOyAvLyAxMCVcclxuICAgIGNvbnN0IGR1cmF0aW9uVGhyZXNob2xkID0gcHJvcHMuZHVyYXRpb25UaHJlc2hvbGQgPz8gODQwOyAvLyAxNOWIhiA9IDg0MOenklxyXG4gICAgY29uc3QgY29sbGVjdGlvblN1Y2Nlc3NSYXRlVGhyZXNob2xkID0gcHJvcHMuY29sbGVjdGlvblN1Y2Nlc3NSYXRlVGhyZXNob2xkID8/IDk1OyAvLyA5NSVcclxuXHJcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgICAvLyBTTlMgVG9waWPkvZzmiJDvvIjjgqLjg6njg7zjg4jpgJrnn6XnlKjvvIlcclxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgIHRoaXMuYWxlcnRUb3BpYyA9IG5ldyBzbnMuVG9waWModGhpcywgJ0FsZXJ0VG9waWMnLCB7XHJcbiAgICAgIHRvcGljTmFtZTogYHRkbmV0LWFsZXJ0cy0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICAgIGRpc3BsYXlOYW1lOiBgVERuZXQgRGF0YSBDb2xsZWN0b3IgQWxlcnRzICgke3Byb3BzLmVudmlyb25tZW50fSlgLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g44Oh44O844Or6YCa55+l44Gu6L+95Yqg77yI44Kq44OX44K344On44Oz77yJXHJcbiAgICBpZiAocHJvcHMuYWxlcnRFbWFpbCkge1xyXG4gICAgICB0aGlzLmFsZXJ0VG9waWMuYWRkU3Vic2NyaXB0aW9uKFxyXG4gICAgICAgIG5ldyBzdWJzY3JpcHRpb25zLkVtYWlsU3Vic2NyaXB0aW9uKHByb3BzLmFsZXJ0RW1haWwpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgLy8gTGFtYmRh6Zai5pWw44GU44Go44Gu44Ki44Op44O844Og6Kit5a6aXHJcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgICBmb3IgKGNvbnN0IGxhbWJkYUZ1bmN0aW9uIG9mIHByb3BzLmxhbWJkYUZ1bmN0aW9ucykge1xyXG4gICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSBsYW1iZGFGdW5jdGlvbi5mdW5jdGlvbk5hbWU7XHJcblxyXG4gICAgICAvLyAxLiBMYW1iZGEgRXJyb3IgUmF0ZSDjgqLjg6njg7zjg6DvvIhDcml0aWNhbO+8iVxyXG4gICAgICBjb25zdCBlcnJvclJhdGVBbGFybSA9IG5ldyBjbG91ZHdhdGNoLkFsYXJtKHRoaXMsIGAke2Z1bmN0aW9uTmFtZX0tRXJyb3JSYXRlQWxhcm1gLCB7XHJcbiAgICAgICAgYWxhcm1OYW1lOiBgJHtmdW5jdGlvbk5hbWV9LWVycm9yLXJhdGUtJHtwcm9wcy5lbnZpcm9ubWVudH1gLFxyXG4gICAgICAgIGFsYXJtRGVzY3JpcHRpb246IGBMYW1iZGHplqLmlbAgJHtmdW5jdGlvbk5hbWV9IOOBruOCqOODqeODvOeOh+OBjCAke2Vycm9yUmF0ZVRocmVzaG9sZH0lIOOCkui2heOBiOOBvuOBl+OBn2AsXHJcbiAgICAgICAgbWV0cmljOiB0aGlzLmNyZWF0ZUVycm9yUmF0ZU1ldHJpYyhsYW1iZGFGdW5jdGlvbiksXHJcbiAgICAgICAgdGhyZXNob2xkOiBlcnJvclJhdGVUaHJlc2hvbGQsXHJcbiAgICAgICAgZXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBjbG91ZHdhdGNoLkNvbXBhcmlzb25PcGVyYXRvci5HUkVBVEVSX1RIQU5fVEhSRVNIT0xELFxyXG4gICAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5OT1RfQlJFQUNISU5HLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGVycm9yUmF0ZUFsYXJtLmFkZEFsYXJtQWN0aW9uKG5ldyBjbG91ZHdhdGNoX2FjdGlvbnMuU25zQWN0aW9uKHRoaXMuYWxlcnRUb3BpYykpO1xyXG4gICAgICB0aGlzLmFsYXJtcy5wdXNoKGVycm9yUmF0ZUFsYXJtKTtcclxuXHJcbiAgICAgIC8vIDIuIExhbWJkYSBEdXJhdGlvbiDjgqLjg6njg7zjg6DvvIhXYXJuaW5n77yJXHJcbiAgICAgIGNvbnN0IGR1cmF0aW9uQWxhcm0gPSBuZXcgY2xvdWR3YXRjaC5BbGFybSh0aGlzLCBgJHtmdW5jdGlvbk5hbWV9LUR1cmF0aW9uQWxhcm1gLCB7XHJcbiAgICAgICAgYWxhcm1OYW1lOiBgJHtmdW5jdGlvbk5hbWV9LWR1cmF0aW9uLSR7cHJvcHMuZW52aXJvbm1lbnR9YCxcclxuICAgICAgICBhbGFybURlc2NyaXB0aW9uOiBgTGFtYmRh6Zai5pWwICR7ZnVuY3Rpb25OYW1lfSDjga7lrp/ooYzmmYLplpPjgYwgJHtkdXJhdGlvblRocmVzaG9sZH0g56eS44KS6LaF44GI44G+44GX44GfYCxcclxuICAgICAgICBtZXRyaWM6IGxhbWJkYUZ1bmN0aW9uLm1ldHJpY0R1cmF0aW9uKHtcclxuICAgICAgICAgIHN0YXRpc3RpYzogJ0F2ZXJhZ2UnLFxyXG4gICAgICAgICAgcGVyaW9kOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcclxuICAgICAgICB9KSxcclxuICAgICAgICB0aHJlc2hvbGQ6IGR1cmF0aW9uVGhyZXNob2xkICogMTAwMCwgLy8g44Of44Oq56eS44Gr5aSJ5o+bXHJcbiAgICAgICAgZXZhbHVhdGlvblBlcmlvZHM6IDIsXHJcbiAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBjbG91ZHdhdGNoLkNvbXBhcmlzb25PcGVyYXRvci5HUkVBVEVSX1RIQU5fVEhSRVNIT0xELFxyXG4gICAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5OT1RfQlJFQUNISU5HLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGR1cmF0aW9uQWxhcm0uYWRkQWxhcm1BY3Rpb24obmV3IGNsb3Vkd2F0Y2hfYWN0aW9ucy5TbnNBY3Rpb24odGhpcy5hbGVydFRvcGljKSk7XHJcbiAgICAgIHRoaXMuYWxhcm1zLnB1c2goZHVyYXRpb25BbGFybSk7XHJcblxyXG4gICAgICAvLyAzLiBMYW1iZGEgVGhyb3R0bGVzIOOCouODqeODvOODoO+8iENyaXRpY2Fs77yJXHJcbiAgICAgIGNvbnN0IHRocm90dGxlQWxhcm0gPSBuZXcgY2xvdWR3YXRjaC5BbGFybSh0aGlzLCBgJHtmdW5jdGlvbk5hbWV9LVRocm90dGxlQWxhcm1gLCB7XHJcbiAgICAgICAgYWxhcm1OYW1lOiBgJHtmdW5jdGlvbk5hbWV9LXRocm90dGxlcy0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICAgICAgYWxhcm1EZXNjcmlwdGlvbjogYExhbWJkYemWouaVsCAke2Z1bmN0aW9uTmFtZX0g44Gn44K544Ot44OD44OI44Oq44Oz44Kw44GM55m655Sf44GX44G+44GX44GfYCxcclxuICAgICAgICBtZXRyaWM6IGxhbWJkYUZ1bmN0aW9uLm1ldHJpY1Rocm90dGxlcyh7XHJcbiAgICAgICAgICBzdGF0aXN0aWM6ICdTdW0nLFxyXG4gICAgICAgICAgcGVyaW9kOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcclxuICAgICAgICB9KSxcclxuICAgICAgICB0aHJlc2hvbGQ6IDEsXHJcbiAgICAgICAgZXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBjbG91ZHdhdGNoLkNvbXBhcmlzb25PcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUxfVE9fVEhSRVNIT0xELFxyXG4gICAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5OT1RfQlJFQUNISU5HLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRocm90dGxlQWxhcm0uYWRkQWxhcm1BY3Rpb24obmV3IGNsb3Vkd2F0Y2hfYWN0aW9ucy5TbnNBY3Rpb24odGhpcy5hbGVydFRvcGljKSk7XHJcbiAgICAgIHRoaXMuYWxhcm1zLnB1c2godGhyb3R0bGVBbGFybSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgLy8g44Kr44K544K/44Og44Oh44OI44Oq44Kv44K544Gu44Ki44Op44O844OgXHJcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgLy8gNC4gQ29sbGVjdGlvblN1Y2Nlc3NSYXRlIOOCouODqeODvOODoO+8iFdhcm5pbmfvvIlcclxuICAgIGNvbnN0IGNvbGxlY3Rpb25TdWNjZXNzUmF0ZUFsYXJtID0gbmV3IGNsb3Vkd2F0Y2guQWxhcm0oXHJcbiAgICAgIHRoaXMsXHJcbiAgICAgICdDb2xsZWN0aW9uU3VjY2Vzc1JhdGVBbGFybScsXHJcbiAgICAgIHtcclxuICAgICAgICBhbGFybU5hbWU6IGB0ZG5ldC1jb2xsZWN0aW9uLXN1Y2Nlc3MtcmF0ZS0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICAgICAgYWxhcm1EZXNjcmlwdGlvbjogYOWPjumbhuaIkOWKn+eOh+OBjCAke2NvbGxlY3Rpb25TdWNjZXNzUmF0ZVRocmVzaG9sZH0lIOOCkuS4i+WbnuOCiuOBvuOBl+OBn2AsXHJcbiAgICAgICAgbWV0cmljOiB0aGlzLmNyZWF0ZUNvbGxlY3Rpb25TdWNjZXNzUmF0ZU1ldHJpYyhwcm9wcy5lbnZpcm9ubWVudCksXHJcbiAgICAgICAgdGhyZXNob2xkOiBjb2xsZWN0aW9uU3VjY2Vzc1JhdGVUaHJlc2hvbGQsXHJcbiAgICAgICAgZXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBjbG91ZHdhdGNoLkNvbXBhcmlzb25PcGVyYXRvci5MRVNTX1RIQU5fVEhSRVNIT0xELFxyXG4gICAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5OT1RfQlJFQUNISU5HLFxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIGNvbGxlY3Rpb25TdWNjZXNzUmF0ZUFsYXJtLmFkZEFsYXJtQWN0aW9uKFxyXG4gICAgICBuZXcgY2xvdWR3YXRjaF9hY3Rpb25zLlNuc0FjdGlvbih0aGlzLmFsZXJ0VG9waWMpXHJcbiAgICApO1xyXG4gICAgdGhpcy5hbGFybXMucHVzaChjb2xsZWN0aW9uU3VjY2Vzc1JhdGVBbGFybSk7XHJcblxyXG4gICAgLy8gNS4g44OH44O844K/5Y+O6ZuG5YGc5q2i44Ki44Op44O844Og77yIQ3JpdGljYWzvvIlcclxuICAgIGNvbnN0IG5vRGF0YUFsYXJtID0gbmV3IGNsb3Vkd2F0Y2guQWxhcm0odGhpcywgJ05vRGF0YUNvbGxlY3RlZEFsYXJtJywge1xyXG4gICAgICBhbGFybU5hbWU6IGB0ZG5ldC1uby1kYXRhLWNvbGxlY3RlZC0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICAgIGFsYXJtRGVzY3JpcHRpb246ICcyNOaZgumWk+ODh+ODvOOCv+WPjumbhuOBjOOBguOCiuOBvuOBm+OCkycsXHJcbiAgICAgIG1ldHJpYzogbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcclxuICAgICAgICBuYW1lc3BhY2U6ICdURG5ldC9Db2xsZWN0b3InLFxyXG4gICAgICAgIG1ldHJpY05hbWU6ICdEaXNjbG9zdXJlc0NvbGxlY3RlZCcsXHJcbiAgICAgICAgc3RhdGlzdGljOiAnU3VtJyxcclxuICAgICAgICBwZXJpb2Q6IGNkay5EdXJhdGlvbi5ob3VycygyNCksXHJcbiAgICAgICAgZGltZW5zaW9uc01hcDoge1xyXG4gICAgICAgICAgRW52aXJvbm1lbnQ6IHByb3BzLmVudmlyb25tZW50LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pLFxyXG4gICAgICB0aHJlc2hvbGQ6IDEsXHJcbiAgICAgIGV2YWx1YXRpb25QZXJpb2RzOiAxLFxyXG4gICAgICBjb21wYXJpc29uT3BlcmF0b3I6IGNsb3Vkd2F0Y2guQ29tcGFyaXNvbk9wZXJhdG9yLkxFU1NfVEhBTl9USFJFU0hPTEQsXHJcbiAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5CUkVBQ0hJTkcsXHJcbiAgICB9KTtcclxuXHJcbiAgICBub0RhdGFBbGFybS5hZGRBbGFybUFjdGlvbihuZXcgY2xvdWR3YXRjaF9hY3Rpb25zLlNuc0FjdGlvbih0aGlzLmFsZXJ0VG9waWMpKTtcclxuICAgIHRoaXMuYWxhcm1zLnB1c2gobm9EYXRhQWxhcm0pO1xyXG5cclxuICAgIC8vIDYuIOWPjumbhuWkseaVl+OCouODqeODvOODoO+8iFdhcm5pbmfvvIlcclxuICAgIGNvbnN0IGNvbGxlY3Rpb25GYWlsdXJlQWxhcm0gPSBuZXcgY2xvdWR3YXRjaC5BbGFybSh0aGlzLCAnQ29sbGVjdGlvbkZhaWx1cmVBbGFybScsIHtcclxuICAgICAgYWxhcm1OYW1lOiBgdGRuZXQtY29sbGVjdGlvbi1mYWlsdXJlcy0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICAgIGFsYXJtRGVzY3JpcHRpb246ICcyNOaZgumWk+OBpzEw5Lu25Lul5LiK44Gu5Y+O6ZuG5aSx5pWX44GM55m655Sf44GX44G+44GX44GfJyxcclxuICAgICAgbWV0cmljOiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xyXG4gICAgICAgIG5hbWVzcGFjZTogJ1REbmV0L0NvbGxlY3RvcicsXHJcbiAgICAgICAgbWV0cmljTmFtZTogJ0Rpc2Nsb3N1cmVzRmFpbGVkJyxcclxuICAgICAgICBzdGF0aXN0aWM6ICdTdW0nLFxyXG4gICAgICAgIHBlcmlvZDogY2RrLkR1cmF0aW9uLmhvdXJzKDI0KSxcclxuICAgICAgICBkaW1lbnNpb25zTWFwOiB7XHJcbiAgICAgICAgICBFbnZpcm9ubWVudDogcHJvcHMuZW52aXJvbm1lbnQsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSksXHJcbiAgICAgIHRocmVzaG9sZDogMTAsXHJcbiAgICAgIGV2YWx1YXRpb25QZXJpb2RzOiAxLFxyXG4gICAgICBjb21wYXJpc29uT3BlcmF0b3I6IGNsb3Vkd2F0Y2guQ29tcGFyaXNvbk9wZXJhdG9yLkdSRUFURVJfVEhBTl9USFJFU0hPTEQsXHJcbiAgICAgIHRyZWF0TWlzc2luZ0RhdGE6IGNsb3Vkd2F0Y2guVHJlYXRNaXNzaW5nRGF0YS5OT1RfQlJFQUNISU5HLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29sbGVjdGlvbkZhaWx1cmVBbGFybS5hZGRBbGFybUFjdGlvbihuZXcgY2xvdWR3YXRjaF9hY3Rpb25zLlNuc0FjdGlvbih0aGlzLmFsZXJ0VG9waWMpKTtcclxuICAgIHRoaXMuYWxhcm1zLnB1c2goY29sbGVjdGlvbkZhaWx1cmVBbGFybSk7XHJcblxyXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgLy8gQ2xvdWRGb3JtYXRpb24gT3V0cHV0c1xyXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0FsZXJ0VG9waWNBcm4nLCB7XHJcbiAgICAgIHZhbHVlOiB0aGlzLmFsZXJ0VG9waWMudG9waWNBcm4sXHJcbiAgICAgIGRlc2NyaXB0aW9uOiAnU05TIFRvcGljIEFSTiBmb3IgYWxlcnRzJyxcclxuICAgICAgZXhwb3J0TmFtZTogYFRkbmV0QWxlcnRUb3BpY0Fybi0ke3Byb3BzLmVudmlyb25tZW50fWAsXHJcbiAgICB9KTtcclxuXHJcbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQWxhcm1Db3VudCcsIHtcclxuICAgICAgdmFsdWU6IHRoaXMuYWxhcm1zLmxlbmd0aC50b1N0cmluZygpLFxyXG4gICAgICBkZXNjcmlwdGlvbjogJ051bWJlciBvZiBDbG91ZFdhdGNoIEFsYXJtcyBjcmVhdGVkJyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTGFtYmRhIEVycm9yIFJhdGXjg6Hjg4jjg6rjgq/jgrnjgpLkvZzmiJBcclxuICAgKiBcclxuICAgKiBFcnJvciBSYXRlID0gKEVycm9ycyAvIEludm9jYXRpb25zKSAqIDEwMFxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlRXJyb3JSYXRlTWV0cmljKGxhbWJkYUZ1bmN0aW9uOiBsYW1iZGEuSUZ1bmN0aW9uKTogY2xvdWR3YXRjaC5JTWV0cmljIHtcclxuICAgIGNvbnN0IGVycm9ycyA9IGxhbWJkYUZ1bmN0aW9uLm1ldHJpY0Vycm9ycyh7XHJcbiAgICAgIHN0YXRpc3RpYzogJ1N1bScsXHJcbiAgICAgIHBlcmlvZDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoNSksXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBpbnZvY2F0aW9ucyA9IGxhbWJkYUZ1bmN0aW9uLm1ldHJpY0ludm9jYXRpb25zKHtcclxuICAgICAgc3RhdGlzdGljOiAnU3VtJyxcclxuICAgICAgcGVyaW9kOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEVycm9yIFJhdGUgPSAoRXJyb3JzIC8gSW52b2NhdGlvbnMpICogMTAwXHJcbiAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWF0aEV4cHJlc3Npb24oe1xyXG4gICAgICBleHByZXNzaW9uOiAnKGVycm9ycyAvIGludm9jYXRpb25zKSAqIDEwMCcsXHJcbiAgICAgIHVzaW5nTWV0cmljczoge1xyXG4gICAgICAgIGVycm9ycyxcclxuICAgICAgICBpbnZvY2F0aW9ucyxcclxuICAgICAgfSxcclxuICAgICAgbGFiZWw6ICdFcnJvciBSYXRlICglKScsXHJcbiAgICAgIHBlcmlvZDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoNSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbGxlY3Rpb25TdWNjZXNzUmF0ZeODoeODiOODquOCr+OCueOCkuS9nOaIkFxyXG4gICAqIFxyXG4gICAqIFN1Y2Nlc3MgUmF0ZSA9IChEaXNjbG9zdXJlc0NvbGxlY3RlZCAvIChEaXNjbG9zdXJlc0NvbGxlY3RlZCArIERpc2Nsb3N1cmVzRmFpbGVkKSkgKiAxMDBcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUNvbGxlY3Rpb25TdWNjZXNzUmF0ZU1ldHJpYyhlbnZpcm9ubWVudDogc3RyaW5nKTogY2xvdWR3YXRjaC5JTWV0cmljIHtcclxuICAgIGNvbnN0IGNvbGxlY3RlZCA9IG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XHJcbiAgICAgIG5hbWVzcGFjZTogJ1REbmV0L0NvbGxlY3RvcicsXHJcbiAgICAgIG1ldHJpY05hbWU6ICdEaXNjbG9zdXJlc0NvbGxlY3RlZCcsXHJcbiAgICAgIHN0YXRpc3RpYzogJ1N1bScsXHJcbiAgICAgIHBlcmlvZDogY2RrLkR1cmF0aW9uLmhvdXJzKDEpLFxyXG4gICAgICBkaW1lbnNpb25zTWFwOiB7XHJcbiAgICAgICAgRW52aXJvbm1lbnQ6IGVudmlyb25tZW50LFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZmFpbGVkID0gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcclxuICAgICAgbmFtZXNwYWNlOiAnVERuZXQvQ29sbGVjdG9yJyxcclxuICAgICAgbWV0cmljTmFtZTogJ0Rpc2Nsb3N1cmVzRmFpbGVkJyxcclxuICAgICAgc3RhdGlzdGljOiAnU3VtJyxcclxuICAgICAgcGVyaW9kOiBjZGsuRHVyYXRpb24uaG91cnMoMSksXHJcbiAgICAgIGRpbWVuc2lvbnNNYXA6IHtcclxuICAgICAgICBFbnZpcm9ubWVudDogZW52aXJvbm1lbnQsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBTdWNjZXNzIFJhdGUgPSAoQ29sbGVjdGVkIC8gKENvbGxlY3RlZCArIEZhaWxlZCkpICogMTAwXHJcbiAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWF0aEV4cHJlc3Npb24oe1xyXG4gICAgICBleHByZXNzaW9uOiAnKGNvbGxlY3RlZCAvIChjb2xsZWN0ZWQgKyBmYWlsZWQpKSAqIDEwMCcsXHJcbiAgICAgIHVzaW5nTWV0cmljczoge1xyXG4gICAgICAgIGNvbGxlY3RlZCxcclxuICAgICAgICBmYWlsZWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIGxhYmVsOiAnQ29sbGVjdGlvbiBTdWNjZXNzIFJhdGUgKCUpJyxcclxuICAgICAgcGVyaW9kOiBjZGsuRHVyYXRpb24uaG91cnMoMSksXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9