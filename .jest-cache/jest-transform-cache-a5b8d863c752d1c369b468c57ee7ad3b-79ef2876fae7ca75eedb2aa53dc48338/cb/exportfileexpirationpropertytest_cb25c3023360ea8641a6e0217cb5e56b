8d5c729b7705e6d56aeaa07fbd27de3a
"use strict";
/**
 * Property 10: エクスポートファイルの有効期限
 *
 * Validates: Requirements 7.2, 12.4
 * エクスポートファイルに7日後の自動削除ライフサイクルポリシーが適用されることを確認
 *
 * Requirements: 要件14.2（プロパティテスト）
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// モック
jest.mock('@aws-sdk/client-s3');
jest.mock('../../utils/logger');
const fc = __importStar(require("fast-check"));
const export_to_s3_1 = require("../export-to-s3");
const client_s3_1 = require("@aws-sdk/client-s3");
describe('Property 10: エクスポートファイルの有効期限', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
        // S3Client.send のモック
        client_s3_1.S3Client.prototype.send = jest.fn().mockResolvedValue({});
    });
    /**
     * Property: すべてのエクスポートファイルに auto-delete タグが設定される
     *
     * このプロパティは、エクスポートファイルがS3にアップロードされる際に、
     * 必ず auto-delete=true タグが設定されることを検証します。
     * このタグは、S3ライフサイクルポリシーによって7日後に自動削除されるために使用されます。
     */
    it('Property: すべてのエクスポートファイルに auto-delete タグが設定される', async () => {
        await fc.assert(fc.asyncProperty(
        // Arbitrary: エクスポートID
        fc.string({ minLength: 10, maxLength: 50 }), 
        // Arbitrary: フォーマット（json または csv）
        fc.constantFrom('json', 'csv'), 
        // Arbitrary: 開示情報のリスト（0〜100件）
        fc.array(fc.record({
            disclosure_id: fc.string({ minLength: 10, maxLength: 20 }),
            company_code: fc.stringOf(fc.integer({ min: 0, max: 9 }), { minLength: 4, maxLength: 4 }),
            company_name: fc.string({ minLength: 1, maxLength: 100 }),
            disclosure_type: fc.constantFrom('決算短信', '有価証券報告書', '適時開示'),
            title: fc.string({ minLength: 1, maxLength: 200 }),
            disclosed_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            pdf_url: fc.webUrl(),
            s3_key: fc.string({ minLength: 10, maxLength: 100 }),
            collected_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            date_partition: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            }),
        }), { minLength: 0, maxLength: 100 }), async (export_id, format, disclosures) => {
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const tagging = sendCall.input.Tagging;
            // Property: auto-delete=true タグが設定されている
            expect(tagging).toBe('auto-delete=true');
        }), {
            numRuns: 100, // 100回のランダムテストを実行
            verbose: true,
        });
    });
    /**
     * Property: S3キーが正しいフォーマットで生成される
     *
     * このプロパティは、エクスポートファイルのS3キーが常に正しいフォーマット
     * （exports/YYYY/MM/DD/export_id.format）で生成されることを検証します。
     */
    it('Property: S3キーが正しいフォーマットで生成される', async () => {
        await fc.assert(fc.asyncProperty(
        // Arbitrary: エクスポートID
        fc.string({ minLength: 10, maxLength: 50 }), 
        // Arbitrary: フォーマット（json または csv）
        fc.constantFrom('json', 'csv'), 
        // Arbitrary: 開示情報のリスト（0〜10件、パフォーマンスのため少なめ）
        fc.array(fc.record({
            disclosure_id: fc.string({ minLength: 10, maxLength: 20 }),
            company_code: fc.stringOf(fc.integer({ min: 0, max: 9 }), { minLength: 4, maxLength: 4 }),
            company_name: fc.string({ minLength: 1, maxLength: 100 }),
            disclosure_type: fc.constantFrom('決算短信', '有価証券報告書', '適時開示'),
            title: fc.string({ minLength: 1, maxLength: 200 }),
            disclosed_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            pdf_url: fc.webUrl(),
            s3_key: fc.string({ minLength: 10, maxLength: 100 }),
            collected_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            date_partition: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            }),
        }), { minLength: 0, maxLength: 10 }), async (export_id, format, disclosures) => {
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, disclosures, format);
            // Assert
            // Property: S3キーが正しいフォーマット（exports/YYYY/MM/DD/export_id.format）
            const s3KeyRegex = new RegExp(`^exports/\\d{4}/\\d{2}/\\d{2}/[^/]+\\.${format}$`);
            expect(s3_key).toMatch(s3KeyRegex);
        }), {
            numRuns: 100,
            verbose: true,
        });
    });
    /**
     * Property: ContentTypeが正しく設定される
     *
     * このプロパティは、エクスポートファイルのContentTypeが
     * フォーマットに応じて正しく設定されることを検証します。
     * - JSON: application/json
     * - CSV: text/csv
     */
    it('Property: ContentTypeが正しく設定される', async () => {
        await fc.assert(fc.asyncProperty(
        // Arbitrary: エクスポートID
        fc.string({ minLength: 10, maxLength: 50 }), 
        // Arbitrary: フォーマット（json または csv）
        fc.constantFrom('json', 'csv'), 
        // Arbitrary: 開示情報のリスト（0〜10件）
        fc.array(fc.record({
            disclosure_id: fc.string({ minLength: 10, maxLength: 20 }),
            company_code: fc.stringOf(fc.integer({ min: 0, max: 9 }), { minLength: 4, maxLength: 4 }),
            company_name: fc.string({ minLength: 1, maxLength: 100 }),
            disclosure_type: fc.constantFrom('決算短信', '有価証券報告書', '適時開示'),
            title: fc.string({ minLength: 1, maxLength: 200 }),
            disclosed_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            pdf_url: fc.webUrl(),
            s3_key: fc.string({ minLength: 10, maxLength: 100 }),
            collected_at: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => d.toISOString()),
            date_partition: fc
                .date({ min: new Date('2020-01-01'), max: new Date('2025-12-31') })
                .map((d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            }),
        }), { minLength: 0, maxLength: 10 }), async (export_id, format, disclosures) => {
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const contentType = sendCall.input.ContentType;
            // Property: ContentTypeが正しく設定されている
            const expectedContentType = format === 'json' ? 'application/json' : 'text/csv';
            expect(contentType).toBe(expectedContentType);
        }), {
            numRuns: 100,
            verbose: true,
        });
    });
    /**
     * Property: CSV形式の場合、カンマを含む値が正しくエスケープされる
     *
     * このプロパティは、CSV形式でエクスポートする際に、
     * カンマを含む値が正しくダブルクォートで囲まれることを検証します。
     */
    it('Property: CSV形式の場合、カンマを含む値が正しくエスケープされる', async () => {
        await fc.assert(fc.asyncProperty(
        // Arbitrary: エクスポートID
        fc.string({ minLength: 10, maxLength: 50 }), 
        // Arbitrary: カンマを含むタイトル
        fc.string({ minLength: 1, maxLength: 50 }).map((s) => `${s}, カンマ含む`), async (export_id, titleWithComma) => {
            // Arrange
            const disclosures = [
                {
                    disclosure_id: '20240115_1234_001',
                    company_code: '1234',
                    company_name: 'テスト株式会社',
                    disclosure_type: '決算短信',
                    title: titleWithComma,
                    disclosed_at: '2024-01-15T10:30:00Z',
                    pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
                    s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
                    collected_at: '2024-01-15T10:35:00Z',
                    date_partition: '2024-01',
                },
            ];
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosures, 'csv');
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            // Property: カンマを含む値がダブルクォートで囲まれている
            expect(lines[1]).toContain(`"${titleWithComma}"`);
        }), {
            numRuns: 50,
            verbose: true,
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtZmlsZS1leHBpcmF0aW9uLnByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBT0gsTUFBTTtBQUNOLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFQaEMsK0NBQWlDO0FBQ2pDLGtEQUE2QztBQUU3QyxrREFBOEM7QUFNOUMsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtJQUM1QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEdBQUcscUJBQXFCLENBQUM7UUFDdkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsZ0JBQWdCLENBQUM7UUFFMUMscUJBQXFCO1FBQ3BCLG9CQUFRLENBQUMsU0FBUyxDQUFDLElBQWtCLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNFLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7OztPQU1HO0lBQ0gsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzlELE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FDYixFQUFFLENBQUMsYUFBYTtRQUNkLHNCQUFzQjtRQUN0QixFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDM0Msa0NBQWtDO1FBQ2xDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBZSxFQUFFLEtBQWMsQ0FBQztRQUNoRCw4QkFB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QUFDO1lBQ3pFLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ2pDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFL0IsbUNBQW1DO1lBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FDRixFQUNEO1lBQ0UsT0FBTyxFQUFFLEVBQUU7WUFDWCxPQUFPLEVBQUUsSUFBSTtTQUNkLENBQ0YsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtZmlsZS1leHBpcmF0aW9uLnByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFByb3BlcnR5IDEwOiDjgqjjgq/jgrnjg53jg7zjg4jjg5XjgqHjgqTjg6vjga7mnInlirnmnJ/pmZBcclxuICpcclxuICogVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgNy4yLCAxMi40XHJcbiAqIOOCqOOCr+OCueODneODvOODiOODleOCoeOCpOODq+OBqzfml6Xlvozjga7oh6rli5XliYrpmaTjg6njgqTjg5XjgrXjgqTjgq/jg6vjg53jg6rjgrfjg7zjgYzpgannlKjjgZXjgozjgovjgZPjgajjgpLnorroqo1cclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7YxNC4y77yI44OX44Ot44OR44OG44Kj44OG44K544OI77yJXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgZmMgZnJvbSAnZmFzdC1jaGVjayc7XHJcbmltcG9ydCB7IGV4cG9ydFRvUzMgfSBmcm9tICcuLi9leHBvcnQtdG8tczMnO1xyXG5pbXBvcnQgeyBEaXNjbG9zdXJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBTM0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcblxyXG4vLyDjg6Ljg4Pjgq9cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnKTtcclxuamVzdC5tb2NrKCcuLi8uLi91dGlscy9sb2dnZXInKTtcclxuXHJcbmRlc2NyaWJlKCdQcm9wZXJ0eSAxMDog44Ko44Kv44K544Od44O844OI44OV44Kh44Kk44Or44Gu5pyJ5Yq55pyf6ZmQJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBwcm9jZXNzLmVudi5FWFBPUlRfQlVDS0VUX05BTUUgPSAndGVzdC1leHBvcnRzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuXHJcbiAgICAvLyBTM0NsaWVudC5zZW5kIOOBruODouODg+OCr1xyXG4gICAgKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiBQcm9wZXJ0eTog44GZ44G544Gm44Gu44Ko44Kv44K544Od44O844OI44OV44Kh44Kk44Or44GrIGF1dG8tZGVsZXRlIOOCv+OCsOOBjOioreWumuOBleOCjOOCi1xyXG4gICAqXHJcbiAgICog44GT44Gu44OX44Ot44OR44OG44Kj44Gv44CB44Ko44Kv44K544Od44O844OI44OV44Kh44Kk44Or44GMUzPjgavjgqLjg4Pjg5fjg63jg7zjg4njgZXjgozjgovpmpvjgavjgIFcclxuICAgKiDlv4XjgZogYXV0by1kZWxldGU9dHJ1ZSDjgr/jgrDjgYzoqK3lrprjgZXjgozjgovjgZPjgajjgpLmpJzoqLzjgZfjgb7jgZnjgIJcclxuICAgKiDjgZPjga7jgr/jgrDjga/jgIFTM+ODqeOCpOODleOCteOCpOOCr+ODq+ODneODquOCt+ODvOOBq+OCiOOBo+OBpjfml6Xlvozjgavoh6rli5XliYrpmaTjgZXjgozjgovjgZ/jgoHjgavkvb/nlKjjgZXjgozjgb7jgZnjgIJcclxuICAgKi9cclxuICBpdCgnUHJvcGVydHk6IOOBmeOBueOBpuOBruOCqOOCr+OCueODneODvOODiOODleOCoeOCpOODq+OBqyBhdXRvLWRlbGV0ZSDjgr/jgrDjgYzoqK3lrprjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBhd2FpdCBmYy5hc3NlcnQoXHJcbiAgICAgIGZjLmFzeW5jUHJvcGVydHkoXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDjgqjjgq/jgrnjg53jg7zjg4hJRFxyXG4gICAgICAgIGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogNTAgfSksXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDjg5Xjgqnjg7zjg57jg4Pjg4jvvIhqc29uIOOBvuOBn+OBryBjc3bvvIlcclxuICAgICAgICBmYy5jb25zdGFudEZyb20oJ2pzb24nIGFzIGNvbnN0LCAnY3N2JyBhcyBjb25zdCksXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDplovnpLrmg4XloLHjga7jg6rjgrnjg4jvvIgw44CcMTAw5Lu277yJXHJcbiAgICAgICAgZmMuYXJyYXkoXHJcbiAgICAgICAgICBmYy5yZWNvcmQoe1xyXG4gICAgICAgICAgICBkaXNjbG9zdXJlX2lkOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEwLCBtYXhMZW5ndGg6IDIwIH0pLFxyXG4gICAgICAgICAgICBjb21wYW55X2NvZGU6IGZjLnN0cmluZ09mKGZjLmludGVnZXIoeyBtaW46IDAsIG1heDogOSB9KSwgeyBtaW5MZW5ndGg6IDQsIG1heExlbmd0aDogNCB9KSxcclxuICAgICAgICAgICAgY29tcGFueV9uYW1lOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAwIH0pLFxyXG4gICAgICAgICAgICBkaXNjbG9zdXJlX3R5cGU6IGZjLmNvbnN0YW50RnJvbSgn5rG6566X55+t5L+hJywgJ+acieS+oeiovOWIuOWgseWRiuabuCcsICfpganmmYLplovnpLonKSxcclxuICAgICAgICAgICAgdGl0bGU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAyMDAgfSksXHJcbiAgICAgICAgICAgIGRpc2Nsb3NlZF9hdDogZmNcclxuICAgICAgICAgICAgICAuZGF0ZSh7IG1pbjogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSwgbWF4OiBuZXcgRGF0ZSgnMjAyNS0xMi0zMScpIH0pXHJcbiAgICAgICAgICAgICAgLm1hcCgoZCkgPT4gZC50b0lTT1N0cmluZygpKSxcclxuICAgICAgICAgICAgcGRmX3VybDogZmMud2ViVXJsKCksXHJcbiAgICAgICAgICAgIHMzX2tleTogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiAxMDAgfSksXHJcbiAgICAgICAgICAgIGNvbGxlY3RlZF9hdDogZmNcclxuICAgICAgICAgICAgICAuZGF0ZSh7IG1pbjogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSwgbWF4OiBuZXcgRGF0ZSgnMjAyNS0xMi0zMScpIH0pXHJcbiAgICAgICAgICAgICAgLm1hcCgoZCkgPT4gZC50b0lTT1N0cmluZygpKSxcclxuICAgICAgICAgICAgZGF0ZV9wYXJ0aXRpb246IGZjXHJcbiAgICAgICAgICAgICAgLmRhdGUoeyBtaW46IG5ldyBEYXRlKCcyMDIwLTAxLTAxJyksIG1heDogbmV3IERhdGUoJzIwMjUtMTItMzEnKSB9KVxyXG4gICAgICAgICAgICAgIC5tYXAoKGQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHllYXIgPSBkLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtb250aCA9IFN0cmluZyhkLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9YDtcclxuICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgeyBtaW5MZW5ndGg6IDAsIG1heExlbmd0aDogMTAwIH1cclxuICAgICAgICApLFxyXG4gICAgICAgIGFzeW5jIChleHBvcnRfaWQsIGZvcm1hdCwgZGlzY2xvc3VyZXMpID0+IHtcclxuICAgICAgICAgIC8vIEFjdFxyXG4gICAgICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzIGFzIERpc2Nsb3N1cmVbXSwgZm9ybWF0KTtcclxuXHJcbiAgICAgICAgICAvLyBBc3NlcnRcclxuICAgICAgICAgIGNvbnN0IHNlbmRDYWxsID0gKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgICAgIGNvbnN0IHRhZ2dpbmcgPSBzZW5kQ2FsbC5pbnB1dC5UYWdnaW5nO1xyXG5cclxuICAgICAgICAgIC8vIFByb3BlcnR5OiBhdXRvLWRlbGV0ZT10cnVlIOOCv+OCsOOBjOioreWumuOBleOCjOOBpuOBhOOCi1xyXG4gICAgICAgICAgZXhwZWN0KHRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICksXHJcbiAgICAgIHtcclxuICAgICAgICBudW1SdW5zOiAxMDAsIC8vIDEwMOWbnuOBruODqeODs+ODgOODoOODhuOCueODiOOCkuWun+ihjFxyXG4gICAgICAgIHZlcmJvc2U6IHRydWUsXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfSk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb3BlcnR5OiBTM+OCreODvOOBjOato+OBl+OBhOODleOCqeODvOODnuODg+ODiOOBp+eUn+aIkOOBleOCjOOCi1xyXG4gICAqXHJcbiAgICog44GT44Gu44OX44Ot44OR44OG44Kj44Gv44CB44Ko44Kv44K544Od44O844OI44OV44Kh44Kk44Or44GuUzPjgq3jg7zjgYzluLjjgavmraPjgZfjgYTjg5Xjgqnjg7zjg57jg4Pjg4hcclxuICAgKiDvvIhleHBvcnRzL1lZWVkvTU0vREQvZXhwb3J0X2lkLmZvcm1hdO+8ieOBp+eUn+aIkOOBleOCjOOCi+OBk+OBqOOCkuaknOiovOOBl+OBvuOBmeOAglxyXG4gICAqL1xyXG4gIGl0KCdQcm9wZXJ0eTogUzPjgq3jg7zjgYzmraPjgZfjgYTjg5Xjgqnjg7zjg57jg4Pjg4jjgafnlJ/miJDjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBhd2FpdCBmYy5hc3NlcnQoXHJcbiAgICAgIGZjLmFzeW5jUHJvcGVydHkoXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDjgqjjgq/jgrnjg53jg7zjg4hJRFxyXG4gICAgICAgIGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogNTAgfSksXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDjg5Xjgqnjg7zjg57jg4Pjg4jvvIhqc29uIOOBvuOBn+OBryBjc3bvvIlcclxuICAgICAgICBmYy5jb25zdGFudEZyb20oJ2pzb24nIGFzIGNvbnN0LCAnY3N2JyBhcyBjb25zdCksXHJcbiAgICAgICAgLy8gQXJiaXRyYXJ5OiDplovnpLrmg4XloLHjga7jg6rjgrnjg4jvvIgw44CcMTDku7bjgIHjg5Hjg5Xjgqnjg7zjg57jg7Pjgrnjga7jgZ/jgoHlsJHjgarjgoHvvIlcclxuICAgICAgICBmYy5hcnJheShcclxuICAgICAgICAgIGZjLnJlY29yZCh7XHJcbiAgICAgICAgICAgIGRpc2Nsb3N1cmVfaWQ6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogMjAgfSksXHJcbiAgICAgICAgICAgIGNvbXBhbnlfY29kZTogZmMuc3RyaW5nT2YoZmMuaW50ZWdlcih7IG1pbjogMCwgbWF4OiA5IH0pLCB7IG1pbkxlbmd0aDogNCwgbWF4TGVuZ3RoOiA0IH0pLFxyXG4gICAgICAgICAgICBjb21wYW55X25hbWU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAxMDAgfSksXHJcbiAgICAgICAgICAgIGRpc2Nsb3N1cmVfdHlwZTogZmMuY29uc3RhbnRGcm9tKCfmsbrnrpfnn63kv6EnLCAn5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JywgJ+mBqeaZgumWi+ekuicpLFxyXG4gICAgICAgICAgICB0aXRsZTogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDIwMCB9KSxcclxuICAgICAgICAgICAgZGlzY2xvc2VkX2F0OiBmY1xyXG4gICAgICAgICAgICAgIC5kYXRlKHsgbWluOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMScpLCBtYXg6IG5ldyBEYXRlKCcyMDI1LTEyLTMxJykgfSlcclxuICAgICAgICAgICAgICAubWFwKChkKSA9PiBkLnRvSVNPU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICBwZGZfdXJsOiBmYy53ZWJVcmwoKSxcclxuICAgICAgICAgICAgczNfa2V5OiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEwLCBtYXhMZW5ndGg6IDEwMCB9KSxcclxuICAgICAgICAgICAgY29sbGVjdGVkX2F0OiBmY1xyXG4gICAgICAgICAgICAgIC5kYXRlKHsgbWluOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMScpLCBtYXg6IG5ldyBEYXRlKCcyMDI1LTEyLTMxJykgfSlcclxuICAgICAgICAgICAgICAubWFwKChkKSA9PiBkLnRvSVNPU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICBkYXRlX3BhcnRpdGlvbjogZmNcclxuICAgICAgICAgICAgICAuZGF0ZSh7IG1pbjogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSwgbWF4OiBuZXcgRGF0ZSgnMjAyNS0xMi0zMScpIH0pXHJcbiAgICAgICAgICAgICAgLm1hcCgoZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeWVhciA9IGQuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKGQuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7eWVhcn0tJHttb250aH1gO1xyXG4gICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICB7IG1pbkxlbmd0aDogMCwgbWF4TGVuZ3RoOiAxMCB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICBhc3luYyAoZXhwb3J0X2lkLCBmb3JtYXQsIGRpc2Nsb3N1cmVzKSA9PiB7XHJcbiAgICAgICAgICAvLyBBY3RcclxuICAgICAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBkaXNjbG9zdXJlcyBhcyBEaXNjbG9zdXJlW10sIGZvcm1hdCk7XHJcblxyXG4gICAgICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgICAgICAvLyBQcm9wZXJ0eTogUzPjgq3jg7zjgYzmraPjgZfjgYTjg5Xjgqnjg7zjg57jg4Pjg4jvvIhleHBvcnRzL1lZWVkvTU0vREQvZXhwb3J0X2lkLmZvcm1hdO+8iVxyXG4gICAgICAgICAgY29uc3QgczNLZXlSZWdleCA9IG5ldyBSZWdFeHAoXHJcbiAgICAgICAgICAgIGBeZXhwb3J0cy9cXFxcZHs0fS9cXFxcZHsyfS9cXFxcZHsyfS9bXi9dK1xcXFwuJHtmb3JtYXR9JGBcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKHMzS2V5UmVnZXgpO1xyXG4gICAgICAgIH1cclxuICAgICAgKSxcclxuICAgICAge1xyXG4gICAgICAgIG51bVJ1bnM6IDEwMCxcclxuICAgICAgICB2ZXJib3NlOiB0cnVlLFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiBQcm9wZXJ0eTogQ29udGVudFR5cGXjgYzmraPjgZfjgY/oqK3lrprjgZXjgozjgotcclxuICAgKlxyXG4gICAqIOOBk+OBruODl+ODreODkeODhuOCo+OBr+OAgeOCqOOCr+OCueODneODvOODiOODleOCoeOCpOODq+OBrkNvbnRlbnRUeXBl44GMXHJcbiAgICog44OV44Kp44O844Oe44OD44OI44Gr5b+c44GY44Gm5q2j44GX44GP6Kit5a6a44GV44KM44KL44GT44Go44KS5qSc6Ki844GX44G+44GZ44CCXHJcbiAgICogLSBKU09OOiBhcHBsaWNhdGlvbi9qc29uXHJcbiAgICogLSBDU1Y6IHRleHQvY3N2XHJcbiAgICovXHJcbiAgaXQoJ1Byb3BlcnR5OiBDb250ZW50VHlwZeOBjOato+OBl+OBj+ioreWumuOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgIGF3YWl0IGZjLmFzc2VydChcclxuICAgICAgZmMuYXN5bmNQcm9wZXJ0eShcclxuICAgICAgICAvLyBBcmJpdHJhcnk6IOOCqOOCr+OCueODneODvOODiElEXHJcbiAgICAgICAgZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiA1MCB9KSxcclxuICAgICAgICAvLyBBcmJpdHJhcnk6IOODleOCqeODvOODnuODg+ODiO+8iGpzb24g44G+44Gf44GvIGNzdu+8iVxyXG4gICAgICAgIGZjLmNvbnN0YW50RnJvbSgnanNvbicgYXMgY29uc3QsICdjc3YnIGFzIGNvbnN0KSxcclxuICAgICAgICAvLyBBcmJpdHJhcnk6IOmWi+ekuuaDheWgseOBruODquOCueODiO+8iDDjgJwxMOS7tu+8iVxyXG4gICAgICAgIGZjLmFycmF5KFxyXG4gICAgICAgICAgZmMucmVjb3JkKHtcclxuICAgICAgICAgICAgZGlzY2xvc3VyZV9pZDogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiAyMCB9KSxcclxuICAgICAgICAgICAgY29tcGFueV9jb2RlOiBmYy5zdHJpbmdPZihmYy5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IDkgfSksIHsgbWluTGVuZ3RoOiA0LCBtYXhMZW5ndGg6IDQgfSksXHJcbiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDEwMCB9KSxcclxuICAgICAgICAgICAgZGlzY2xvc3VyZV90eXBlOiBmYy5jb25zdGFudEZyb20oJ+axuueul+efreS/oScsICfmnInkvqHoqLzliLjloLHlkYrmm7gnLCAn6YGp5pmC6ZaL56S6JyksXHJcbiAgICAgICAgICAgIHRpdGxlOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMjAwIH0pLFxyXG4gICAgICAgICAgICBkaXNjbG9zZWRfYXQ6IGZjXHJcbiAgICAgICAgICAgICAgLmRhdGUoeyBtaW46IG5ldyBEYXRlKCcyMDIwLTAxLTAxJyksIG1heDogbmV3IERhdGUoJzIwMjUtMTItMzEnKSB9KVxyXG4gICAgICAgICAgICAgIC5tYXAoKGQpID0+IGQudG9JU09TdHJpbmcoKSksXHJcbiAgICAgICAgICAgIHBkZl91cmw6IGZjLndlYlVybCgpLFxyXG4gICAgICAgICAgICBzM19rZXk6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogMTAwIH0pLFxyXG4gICAgICAgICAgICBjb2xsZWN0ZWRfYXQ6IGZjXHJcbiAgICAgICAgICAgICAgLmRhdGUoeyBtaW46IG5ldyBEYXRlKCcyMDIwLTAxLTAxJyksIG1heDogbmV3IERhdGUoJzIwMjUtMTItMzEnKSB9KVxyXG4gICAgICAgICAgICAgIC5tYXAoKGQpID0+IGQudG9JU09TdHJpbmcoKSksXHJcbiAgICAgICAgICAgIGRhdGVfcGFydGl0aW9uOiBmY1xyXG4gICAgICAgICAgICAgIC5kYXRlKHsgbWluOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMScpLCBtYXg6IG5ldyBEYXRlKCcyMDI1LTEyLTMxJykgfSlcclxuICAgICAgICAgICAgICAubWFwKChkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gZC5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcoZC5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRofWA7XHJcbiAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIHsgbWluTGVuZ3RoOiAwLCBtYXhMZW5ndGg6IDEwIH1cclxuICAgICAgICApLFxyXG4gICAgICAgIGFzeW5jIChleHBvcnRfaWQsIGZvcm1hdCwgZGlzY2xvc3VyZXMpID0+IHtcclxuICAgICAgICAgIC8vIEFjdFxyXG4gICAgICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzIGFzIERpc2Nsb3N1cmVbXSwgZm9ybWF0KTtcclxuXHJcbiAgICAgICAgICAvLyBBc3NlcnRcclxuICAgICAgICAgIGNvbnN0IHNlbmRDYWxsID0gKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gc2VuZENhbGwuaW5wdXQuQ29udGVudFR5cGU7XHJcblxyXG4gICAgICAgICAgLy8gUHJvcGVydHk6IENvbnRlbnRUeXBl44GM5q2j44GX44GP6Kit5a6a44GV44KM44Gm44GE44KLXHJcbiAgICAgICAgICBjb25zdCBleHBlY3RlZENvbnRlbnRUeXBlID0gZm9ybWF0ID09PSAnanNvbicgPyAnYXBwbGljYXRpb24vanNvbicgOiAndGV4dC9jc3YnO1xyXG4gICAgICAgICAgZXhwZWN0KGNvbnRlbnRUeXBlKS50b0JlKGV4cGVjdGVkQ29udGVudFR5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgKSxcclxuICAgICAge1xyXG4gICAgICAgIG51bVJ1bnM6IDEwMCxcclxuICAgICAgICB2ZXJib3NlOiB0cnVlLFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiBQcm9wZXJ0eTogQ1NW5b2i5byP44Gu5aC05ZCI44CB44Kr44Oz44Oe44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLXHJcbiAgICpcclxuICAgKiDjgZPjga7jg5fjg63jg5Hjg4bjgqPjga/jgIFDU1blvaLlvI/jgafjgqjjgq/jgrnjg53jg7zjg4jjgZnjgovpmpvjgavjgIFcclxuICAgKiDjgqvjg7Pjg57jgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jg4Djg5bjg6vjgq/jgqnjg7zjg4jjgaflm7Ljgb7jgozjgovjgZPjgajjgpLmpJzoqLzjgZfjgb7jgZnjgIJcclxuICAgKi9cclxuICBpdCgnUHJvcGVydHk6IENTVuW9ouW8j+OBruWgtOWQiOOAgeOCq+ODs+ODnuOCkuWQq+OCgOWApOOBjOato+OBl+OBj+OCqOOCueOCseODvOODl+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgIGF3YWl0IGZjLmFzc2VydChcclxuICAgICAgZmMuYXN5bmNQcm9wZXJ0eShcclxuICAgICAgICAvLyBBcmJpdHJhcnk6IOOCqOOCr+OCueODneODvOODiElEXHJcbiAgICAgICAgZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxMCwgbWF4TGVuZ3RoOiA1MCB9KSxcclxuICAgICAgICAvLyBBcmJpdHJhcnk6IOOCq+ODs+ODnuOCkuWQq+OCgOOCv+OCpOODiOODq1xyXG4gICAgICAgIGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiA1MCB9KS5tYXAoKHMpID0+IGAke3N9LCDjgqvjg7Pjg57lkKvjgoBgKSxcclxuICAgICAgICBhc3luYyAoZXhwb3J0X2lkLCB0aXRsZVdpdGhDb21tYSkgPT4ge1xyXG4gICAgICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICAgICAgY29uc3QgZGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIGRpc2Nsb3N1cmVfaWQ6ICcyMDI0MDExNV8xMjM0XzAwMScsXHJcbiAgICAgICAgICAgICAgY29tcGFueV9jb2RlOiAnMTIzNCcsXHJcbiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiAn44OG44K544OI5qCq5byP5Lya56S+JyxcclxuICAgICAgICAgICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmsbrnrpfnn63kv6EnLFxyXG4gICAgICAgICAgICAgIHRpdGxlOiB0aXRsZVdpdGhDb21tYSxcclxuICAgICAgICAgICAgICBkaXNjbG9zZWRfYXQ6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsXHJcbiAgICAgICAgICAgICAgcGRmX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgICAgICAgICAgczNfa2V5OiAncGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgICAgICAgICAgY29sbGVjdGVkX2F0OiAnMjAyNC0wMS0xNVQxMDozNTowMFonLFxyXG4gICAgICAgICAgICAgIGRhdGVfcGFydGl0aW9uOiAnMjAyNC0wMScsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgIC8vIEFjdFxyXG4gICAgICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzLCAnY3N2Jyk7XHJcblxyXG4gICAgICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgICAgICBjb25zdCBzZW5kQ2FsbCA9IChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICAgICAgLy8gUHJvcGVydHk6IOOCq+ODs+ODnuOCkuWQq+OCgOWApOOBjOODgOODluODq+OCr+OCqeODvOODiOOBp+WbsuOBvuOCjOOBpuOBhOOCi1xyXG4gICAgICAgICAgZXhwZWN0KGxpbmVzWzFdKS50b0NvbnRhaW4oYFwiJHt0aXRsZVdpdGhDb21tYX1cImApO1xyXG4gICAgICAgIH1cclxuICAgICAgKSxcclxuICAgICAge1xyXG4gICAgICAgIG51bVJ1bnM6IDUwLFxyXG4gICAgICAgIHZlcmJvc2U6IHRydWUsXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=