{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\disclosure-id.ts","mappings":";AAAA;;;;;;;GAOG;;AAmBH,oDAiCC;AAlDD,sCAA4C;AAE5C;;;;;;;;;;;;;;GAcG;AACH,SAAgB,oBAAoB,CAClC,WAAmB,EACnB,WAAmB,EACnB,QAAgB;IAEhB,UAAU;IACV,IAAI,CAAC,WAAW,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QAC7D,MAAM,IAAI,wBAAe,CAAC,+BAA+B,WAAW,EAAE,CAAC,CAAC;IAC1E,CAAC;IAED,IAAI,CAAC,WAAW,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QACjD,MAAM,IAAI,wBAAe,CAAC,wBAAwB,WAAW,EAAE,CAAC,CAAC;IACnE,CAAC;IAED,IAAI,QAAQ,GAAG,CAAC,IAAI,QAAQ,GAAG,GAAG,EAAE,CAAC;QACnC,MAAM,IAAI,wBAAe,CAAC,qBAAqB,QAAQ,kBAAkB,CAAC,CAAC;IAC7E,CAAC;IAED,gCAAgC;IAChC,6BAA6B;IAC7B,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC;IACtC,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;IAEjE,mBAAmB;IACnB,MAAM,IAAI,GAAG,OAAO,CAAC,cAAc,EAAE,CAAC;IACtC,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IACjE,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAC1D,MAAM,IAAI,GAAG,GAAG,IAAI,GAAG,KAAK,GAAG,GAAG,EAAE,CAAC;IAErC,gBAAgB;IAChB,MAAM,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAE9C,OAAO,GAAG,IAAI,IAAI,WAAW,IAAI,GAAG,EAAE,CAAC;AACzC,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\disclosure-id.ts"],"sourcesContent":["/**\r\n * 開示ID生成ユーティリティ\r\n *\r\n * 開示情報の一意なIDを生成します。\r\n * フォーマット: 日付_企業コード_連番（例: \"20240115_1234_001\"）\r\n *\r\n * Requirements: 要件2.3（開示ID生成）\r\n */\r\n\r\nimport { ValidationError } from '../errors';\r\n\r\n/**\r\n * 開示IDを生成（日付_企業コード_連番形式）\r\n *\r\n * TDnetは日本の開示情報サービスであり、開示日時はJST（日本標準時）基準で管理されます。\r\n * UTC時刻をそのまま使用すると、月またぎのエッジケースで誤った日付になる可能性があります。\r\n * \r\n * 例: UTC 2024-01-31T15:30:00Z → JST 2024-02-01T00:30:00+09:00\r\n *     UTCのまま使用すると \"20240131\" になるが、正しくは \"20240201\" であるべき\r\n *\r\n * @param disclosedAt ISO 8601形式の日時文字列（UTC推奨）\r\n * @param companyCode 企業コード（4桁）\r\n * @param sequence 連番（同一日・同一企業の複数開示を区別）\r\n * @returns 開示ID（例: \"20240115_1234_001\"）\r\n * @throws ValidationError 不正な入力の場合\r\n */\r\nexport function generateDisclosureId(\r\n  disclosedAt: string,\r\n  companyCode: string,\r\n  sequence: number\r\n): string {\r\n  // バリデーション\r\n  if (!disclosedAt || !/^\\d{4}-\\d{2}-\\d{2}T/.test(disclosedAt)) {\r\n    throw new ValidationError(`Invalid disclosedAt format: ${disclosedAt}`);\r\n  }\r\n\r\n  if (!companyCode || !/^\\d{4}$/.test(companyCode)) {\r\n    throw new ValidationError(`Invalid companyCode: ${companyCode}`);\r\n  }\r\n\r\n  if (sequence < 1 || sequence > 999) {\r\n    throw new ValidationError(`Invalid sequence: ${sequence} (must be 1-999)`);\r\n  }\r\n\r\n  // UTCからJSTに変換（UTC+9時間）してから日付を抽出\r\n  // これにより、月またぎのエッジケースを正しく処理できる\r\n  const utcDate = new Date(disclosedAt);\r\n  const jstDate = new Date(utcDate.getTime() + 9 * 60 * 60 * 1000);\r\n  \r\n  // YYYYMMDD形式で日付を抽出\r\n  const year = jstDate.getUTCFullYear();\r\n  const month = String(jstDate.getUTCMonth() + 1).padStart(2, '0');\r\n  const day = String(jstDate.getUTCDate()).padStart(2, '0');\r\n  const date = `${year}${month}${day}`;\r\n\r\n  // 連番を3桁にゼロパディング\r\n  const seq = String(sequence).padStart(3, '0');\r\n\r\n  return `${date}_${companyCode}_${seq}`;\r\n}\r\n"],"version":3}