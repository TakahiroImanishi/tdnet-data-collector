{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\cloudfront.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\cloudfront.test.ts"],"sourcesContent":["import * as cdk from 'aws-cdk-lib';\r\nimport { Template, Match } from 'aws-cdk-lib/assertions';\r\nimport * as s3 from 'aws-cdk-lib/aws-s3';\r\nimport { DashboardCloudFront } from '../lib/constructs/cloudfront';\r\n\r\ndescribe('DashboardCloudFront Construct', () => {\r\n  let app: cdk.App;\r\n  let stack: cdk.Stack;\r\n  let dashboardBucket: s3.IBucket;\r\n\r\n  beforeEach(() => {\r\n    app = new cdk.App();\r\n    stack = new cdk.Stack(app, 'TestStack', {\r\n      env: {\r\n        account: '123456789012',\r\n        region: 'ap-northeast-1',\r\n      },\r\n    });\r\n\r\n    // テスト用のS3バケットを作成\r\n    dashboardBucket = new s3.Bucket(stack, 'TestDashboardBucket', {\r\n      bucketName: 'test-dashboard-bucket',\r\n      removalPolicy: cdk.RemovalPolicy.DESTROY,\r\n    });\r\n  });\r\n\r\n  test('CloudFront Distributionが作成される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.resourceCountIs('AWS::CloudFront::Distribution', 1);\r\n  });\r\n\r\n  test('Origin Access Identity (OAI) が作成される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.resourceCountIs('AWS::CloudFront::CloudFrontOriginAccessIdentity', 1);\r\n    \r\n    template.hasResourceProperties('AWS::CloudFront::CloudFrontOriginAccessIdentity', {\r\n      CloudFrontOriginAccessIdentityConfig: {\r\n        Comment: 'OAI for TDnet Dashboard (test)',\r\n      },\r\n    });\r\n  });\r\n\r\n  test('S3バケットポリシーにOAIからの読み取り権限が追加される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::S3::BucketPolicy', {\r\n      PolicyDocument: {\r\n        Statement: Match.arrayWith([\r\n          Match.objectLike({\r\n            Action: 's3:GetObject',\r\n            Effect: 'Allow',\r\n            Principal: {\r\n              CanonicalUser: Match.anyValue(),\r\n            },\r\n            Resource: Match.anyValue(),\r\n          }),\r\n        ]),\r\n      },\r\n    });\r\n  });\r\n\r\n  test('HTTPS強制が設定される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        DefaultCacheBehavior: {\r\n          ViewerProtocolPolicy: 'redirect-to-https',\r\n        },\r\n      },\r\n    });\r\n  });\r\n\r\n  test('index.html用のキャッシュポリシーが作成される（TTL: 60秒）', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::CachePolicy', {\r\n      CachePolicyConfig: {\r\n        Name: 'tdnet-dashboard-index-test',\r\n        DefaultTTL: 60,\r\n        MinTTL: 0,\r\n        MaxTTL: 60,\r\n      },\r\n    });\r\n  });\r\n\r\n  test('静的アセット用のキャッシュポリシーが作成される（TTL: 1日）', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::CachePolicy', {\r\n      CachePolicyConfig: {\r\n        Name: 'tdnet-dashboard-assets-test',\r\n        DefaultTTL: 86400, // 1日 = 86400秒\r\n        MinTTL: 0,\r\n        MaxTTL: 31536000, // 365日\r\n      },\r\n    });\r\n  });\r\n\r\n  test('静的アセット用の追加ビヘイビアが設定される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        CacheBehaviors: Match.arrayWith([\r\n          Match.objectLike({\r\n            PathPattern: '/static/*',\r\n            ViewerProtocolPolicy: 'redirect-to-https',\r\n          }),\r\n          Match.objectLike({\r\n            PathPattern: '*.js',\r\n            ViewerProtocolPolicy: 'redirect-to-https',\r\n          }),\r\n          Match.objectLike({\r\n            PathPattern: '*.css',\r\n            ViewerProtocolPolicy: 'redirect-to-https',\r\n          }),\r\n        ]),\r\n      },\r\n    });\r\n  });\r\n\r\n  test('SPA用エラーページ設定（404/403 → index.html）が設定される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        CustomErrorResponses: Match.arrayWith([\r\n          {\r\n            ErrorCode: 404,\r\n            ResponseCode: 200,\r\n            ResponsePagePath: '/index.html',\r\n            ErrorCachingMinTTL: 60,\r\n          },\r\n          {\r\n            ErrorCode: 403,\r\n            ResponseCode: 200,\r\n            ResponsePagePath: '/index.html',\r\n            ErrorCachingMinTTL: 60,\r\n          },\r\n        ]),\r\n      },\r\n    });\r\n  });\r\n\r\n  test('デフォルトルートオブジェクトがindex.htmlに設定される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        DefaultRootObject: 'index.html',\r\n      },\r\n    });\r\n  });\r\n\r\n  test('圧縮が有効化される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        DefaultCacheBehavior: {\r\n          Compress: true,\r\n        },\r\n      },\r\n    });\r\n  });\r\n\r\n  test('価格クラスがPRICE_CLASS_100に設定される（コスト最適化）', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        PriceClass: 'PriceClass_100',\r\n      },\r\n    });\r\n  });\r\n\r\n  test('HTTP/2とHTTP/3が有効化される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        HttpVersion: 'http2and3',\r\n      },\r\n    });\r\n  });\r\n\r\n  test('最小TLSバージョンがTLSv1.2に設定される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasResourceProperties('AWS::CloudFront::Distribution', {\r\n      DistributionConfig: {\r\n        ViewerCertificate: {\r\n          MinimumProtocolVersion: 'TLSv1.2_2021',\r\n        },\r\n      },\r\n    });\r\n  });\r\n\r\n  test('CloudFront Distribution URLがCfnOutputとして出力される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    template.hasOutput('TestCloudFrontDistributionDomainName*', {\r\n      Description: 'CloudFront Distribution Domain Name',\r\n      Export: {\r\n        Name: 'tdnet-dashboard-domain-test',\r\n      },\r\n    });\r\n\r\n    template.hasOutput('TestCloudFrontDistributionId*', {\r\n      Description: 'CloudFront Distribution ID',\r\n      Export: {\r\n        Name: 'tdnet-dashboard-distribution-id-test',\r\n      },\r\n    });\r\n\r\n    template.hasOutput('TestCloudFrontDashboardUrl*', {\r\n      Description: 'TDnet Dashboard URL',\r\n      Export: {\r\n        Name: 'tdnet-dashboard-url-test',\r\n      },\r\n    });\r\n  });\r\n\r\n  test('Gzip圧縮とBrotli圧縮が有効化される', () => {\r\n    // Arrange & Act\r\n    new DashboardCloudFront(stack, 'TestCloudFront', {\r\n      dashboardBucket,\r\n      environment: 'test',\r\n    });\r\n\r\n    // Assert\r\n    const template = Template.fromStack(stack);\r\n    \r\n    // キャッシュポリシーでGzipとBrotliが有効化されていることを確認\r\n    template.hasResourceProperties('AWS::CloudFront::CachePolicy', {\r\n      CachePolicyConfig: {\r\n        ParametersInCacheKeyAndForwardedToOrigin: {\r\n          EnableAcceptEncodingGzip: true,\r\n          EnableAcceptEncodingBrotli: true,\r\n        },\r\n      },\r\n    });\r\n  });\r\n});\r\n"],"version":3}