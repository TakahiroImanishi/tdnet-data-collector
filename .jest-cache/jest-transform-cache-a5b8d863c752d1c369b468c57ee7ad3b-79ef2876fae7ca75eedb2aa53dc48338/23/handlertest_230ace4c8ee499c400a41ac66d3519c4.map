{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\api\\pdf-download\\__tests__\\handler.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\api\\pdf-download\\__tests__\\handler.test.ts"],"sourcesContent":["/**\r\n * Lambda PDF Download Handler Unit Tests\r\n *\r\n * Requirements: 要件14.1（ユニットテスト）\r\n */\r\n\r\nimport { Context } from 'aws-lambda';\r\nimport { handler } from '../handler';\r\nimport { DynamoDBClient, GetItemCommand } from '@aws-sdk/client-dynamodb';\r\nimport { S3Client, HeadObjectCommand } from '@aws-sdk/client-s3';\r\nimport { SecretsManagerClient, GetSecretValueCommand } from '@aws-sdk/client-secrets-manager';\r\nimport { mockClient } from 'aws-sdk-client-mock';\r\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\r\n\r\n// モック\r\njest.mock('../../../../utils/logger');\r\njest.mock('../../../../utils/cloudwatch-metrics');\r\njest.mock('@aws-sdk/s3-request-presigner');\r\n\r\n// AWS SDKモック\r\nconst dynamoMock = mockClient(DynamoDBClient);\r\nconst s3Mock = mockClient(S3Client);\r\nconst secretsManagerMock = mockClient(SecretsManagerClient);\r\n\r\ndescribe('Lambda PDF Download Handler', () => {\r\n  const mockContext: Context = {\r\n    awsRequestId: 'test-request-id',\r\n    functionName: 'tdnet-pdf-download',\r\n    functionVersion: '1',\r\n    invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-pdf-download',\r\n    memoryLimitInMB: '512',\r\n    logGroupName: '/aws/lambda/tdnet-pdf-download',\r\n    logStreamName: '2024/01/15/[$LATEST]test',\r\n    callbackWaitsForEmptyEventLoop: true,\r\n    getRemainingTimeInMillis: () => 30000,\r\n    done: jest.fn(),\r\n    fail: jest.fn(),\r\n    succeed: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    // モックのリセット\r\n    dynamoMock.reset();\r\n    s3Mock.reset();\r\n    secretsManagerMock.reset();\r\n    jest.clearAllMocks();\r\n\r\n    // デフォルトのモック設定\r\n    process.env.API_KEY = 'test-api-key';\r\n    process.env.DYNAMODB_TABLE_NAME = 'tdnet_disclosures';\r\n    process.env.S3_BUCKET_NAME = 'tdnet-pdfs';\r\n\r\n    secretsManagerMock.on(GetSecretValueCommand).resolves({\r\n      SecretString: 'test-api-key',\r\n    });\r\n\r\n    (getSignedUrl as jest.Mock).mockResolvedValue('https://s3.amazonaws.com/signed-url');\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('PDF署名付きURLを正常に生成する', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: {\r\n          expiration: '3600',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('success');\r\n      expect(body.data.download_url).toBe('https://s3.amazonaws.com/signed-url');\r\n      expect(body.data.expires_at).toBeDefined();\r\n    });\r\n\r\n    it('デフォルトの有効期限（3600秒）を使用する', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: {},\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n    });\r\n  });\r\n\r\n  describe('異常系: APIキー認証', () => {\r\n    it('APIキーが未指定の場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {},\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('API key is required');\r\n    });\r\n\r\n    it('APIキーが不正な場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'invalid-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n    });\r\n  });\r\n\r\n  describe('異常系: バリデーション', () => {\r\n    it('disclosure_idが未指定の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {},\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('disclosure_id is required');\r\n    });\r\n\r\n    it('disclosure_idのフォーマットが不正な場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: 'invalid-format',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid disclosure_id format');\r\n    });\r\n\r\n    it('expirationが数値でない場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: {\r\n          expiration: 'invalid',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid expiration format');\r\n    });\r\n\r\n    it('expirationが範囲外の場合は400エラーを返す（最小値未満）', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: {\r\n          expiration: '30', // 60秒未満\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Expiration out of range');\r\n    });\r\n\r\n    it('expirationが範囲外の場合は400エラーを返す（最大値超過）', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: {\r\n          expiration: '90000', // 86400秒超過\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Expiration out of range');\r\n    });\r\n  });\r\n\r\n  describe('異常系: データ取得', () => {\r\n    it('開示情報が見つからない場合は404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: undefined,\r\n      });\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('Disclosure not found');\r\n    });\r\n\r\n    it('pdf_s3_keyが存在しない場合は404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          // pdf_s3_keyなし\r\n        },\r\n      });\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('PDF file not found');\r\n    });\r\n\r\n    it('S3オブジェクトが存在しない場合は404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      const notFoundError: any = new Error('NotFound');\r\n      notFoundError.name = 'NotFound';\r\n      notFoundError.$metadata = { httpStatusCode: 404 };\r\n      s3Mock.on(HeadObjectCommand).rejects(notFoundError);\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('PDF file not found in S3');\r\n    });\r\n  });\r\n\r\n  describe('CORS対応', () => {\r\n    it('レスポンスにCORSヘッダーが含まれる', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.headers).toEqual({\r\n        'Content-Type': 'application/json',\r\n        'Access-Control-Allow-Origin': '*',\r\n        'Access-Control-Allow-Headers': 'Content-Type,X-Api-Key',\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('エッジケース', () => {\r\n    it('X-Api-Key（大文字）ヘッダーでも認証できる', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'X-Api-Key': 'test-api-key', // 大文字\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n    });\r\n\r\n    it('queryStringParametersがnullの場合でもデフォルト有効期限を使用する', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        queryStringParameters: null, // null\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n    });\r\n\r\n    it('S3エラー（404以外）の場合は再試行後にエラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: {\r\n          disclosure_id: '20240115_7203_001',\r\n        },\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: 'pdfs/2024/01/20240115_7203_001.pdf' },\r\n        },\r\n      });\r\n\r\n      const serviceError: any = new Error('ServiceUnavailable');\r\n      serviceError.name = 'ServiceUnavailable';\r\n      serviceError.$metadata = { httpStatusCode: 503 };\r\n      s3Mock.on(HeadObjectCommand).rejects(serviceError);\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(500);\r\n    });\r\n\r\n    it('pathParametersがnullの場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: any = {\r\n        pathParameters: null, // null\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n    });\r\n  });\r\n});\r\n"],"version":3}