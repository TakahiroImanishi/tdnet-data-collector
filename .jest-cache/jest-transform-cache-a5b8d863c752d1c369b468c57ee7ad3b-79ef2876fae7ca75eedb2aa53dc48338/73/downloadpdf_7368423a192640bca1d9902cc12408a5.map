{"version":3,"names":["cov_2dl6tq9vk9","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","file","mappings","names","sources","sourcesContent","version","_coverageSchema","coverage","actualCoverage","exports","downloadPdf","axios_1","__importDefault","require","client_s3_1","pdf_downloader_1","rate_limiter_1","retry_1","logger_1","cloudwatch_metrics_1","errors_1","s3Client","S3Client","rateLimiter","RateLimiter","minDelayMs","getS3Bucket","process","env","S3_BUCKET","disclosure_id","pdf_url","disclosed_at","logger","info","waitIfNeeded","pdfBuffer","retryWithBackoff","response","default","get","responseType","timeout","headers","Buffer","from","data","error","isAxiosError","code","RetryableError","status","maxRetries","initialDelay","backoffMultiplier","jitter","validatePdfFile","s3Key","generateS3Key","send","PutObjectCommand","Bucket","Key","Body","ContentType","Metadata","uploaded_at","Date","toISOString","s3_key","size","length","sendSuccessMetric","DisclosureId","error_type","Error","constructor","error_message","message","String","sendErrorMetric","date","jstDate","getTime","year","getUTCFullYear","month","getUTCMonth","padStart","day","getUTCDate"],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\download-pdf.ts"],"sourcesContent":["/**\r\n * PDFダウンロード機能\r\n *\r\n * TDnetからPDFファイルをダウンロードし、S3に保存します。\r\n * ファイル整合性検証と再試行ロジックを含みます。\r\n *\r\n * Requirements: 要件1.3, 3.3, 6.1（PDFダウンロード、S3保存、エラーハンドリング）\r\n */\r\n\r\nimport axios from 'axios';\r\nimport { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\r\nimport { validatePdfFile } from '../../scraper/pdf-downloader';\r\nimport { RateLimiter } from '../../utils/rate-limiter';\r\nimport { retryWithBackoff } from '../../utils/retry';\r\nimport { logger } from '../../utils/logger';\r\nimport { sendErrorMetric, sendSuccessMetric } from '../../utils/cloudwatch-metrics';\r\nimport { RetryableError } from '../../errors';\r\n\r\n// S3クライアントはグローバルスコープで初期化（再利用される）\r\nconst s3Client = new S3Client({});\r\n\r\n// レート制限設定（PDFダウンロードも2秒間隔）\r\nconst rateLimiter = new RateLimiter({ minDelayMs: 2000 });\r\n\r\n// 環境変数は関数内で取得（テスト時の柔軟性のため）\r\nfunction getS3Bucket(): string {\r\n  return process.env.S3_BUCKET || 'tdnet-data-collector-pdfs';\r\n}\r\n\r\n/**\r\n * PDFファイルをダウンロードしてS3に保存\r\n *\r\n * @param disclosure_id - 開示ID\r\n * @param pdf_url - PDF URL\r\n * @param disclosed_at - 開示日時（ISO 8601形式）\r\n * @returns S3キー（保存先パス）\r\n * @throws RetryableError ネットワークエラー、サーバーエラー\r\n * @throws ValidationError PDFファイルが不正な場合\r\n *\r\n * @example\r\n * ```typescript\r\n * const s3Key = await downloadPdf(\r\n *   'TD20240115001',\r\n *   'https://www.release.tdnet.info/inbs/140120240115001.pdf',\r\n *   '2024-01-15T10:30:00Z'\r\n * );\r\n * console.log(`PDF saved to: ${s3Key}`);\r\n * // Output: PDF saved to: 2024/01/15/TD20240115001.pdf\r\n * ```\r\n */\r\nexport async function downloadPdf(\r\n  disclosure_id: string,\r\n  pdf_url: string,\r\n  disclosed_at: string\r\n): Promise<string> {\r\n  try {\r\n    logger.info('Downloading PDF', { disclosure_id, pdf_url });\r\n\r\n    // レート制限を適用\r\n    await rateLimiter.waitIfNeeded();\r\n\r\n    // PDFをダウンロード（再試行あり）\r\n    const pdfBuffer = await retryWithBackoff(\r\n      async () => {\r\n        try {\r\n          const response = await axios.get(pdf_url, {\r\n            responseType: 'arraybuffer',\r\n            timeout: 60000, // 60秒タイムアウト\r\n            headers: {\r\n              'User-Agent': 'TDnet-Data-Collector/1.0',\r\n            },\r\n          });\r\n          return Buffer.from(response.data);\r\n        } catch (error) {\r\n          if (axios.isAxiosError(error)) {\r\n            // タイムアウトエラー\r\n            if (error.code === 'ECONNABORTED' || error.code === 'ETIMEDOUT') {\r\n              throw new RetryableError(`Timeout downloading PDF: ${pdf_url}`, error);\r\n            }\r\n            // 5xxエラー\r\n            if (error.response && error.response.status >= 500) {\r\n              throw new RetryableError(\r\n                `Server error (${error.response.status}): ${pdf_url}`,\r\n                error\r\n              );\r\n            }\r\n            // 429 Too Many Requests\r\n            if (error.response && error.response.status === 429) {\r\n              throw new RetryableError(`Rate limit exceeded: ${pdf_url}`, error);\r\n            }\r\n          }\r\n          throw error;\r\n        }\r\n      },\r\n      {\r\n        maxRetries: 3,\r\n        initialDelay: 2000,\r\n        backoffMultiplier: 2,\r\n        jitter: true,\r\n      }\r\n    );\r\n\r\n    // PDFファイル整合性検証\r\n    validatePdfFile(pdfBuffer);\r\n\r\n    // S3パス生成（YYYY/MM/DD/disclosure_id.pdf）\r\n    const s3Key = generateS3Key(disclosure_id, disclosed_at);\r\n\r\n    // S3にアップロード\r\n    await s3Client.send(\r\n      new PutObjectCommand({\r\n        Bucket: getS3Bucket(),\r\n        Key: s3Key,\r\n        Body: pdfBuffer,\r\n        ContentType: 'application/pdf',\r\n        Metadata: {\r\n          disclosure_id,\r\n          disclosed_at,\r\n          uploaded_at: new Date().toISOString(),\r\n        },\r\n      })\r\n    );\r\n\r\n    logger.info('PDF uploaded to S3', {\r\n      disclosure_id,\r\n      s3_key: s3Key,\r\n      size: pdfBuffer.length,\r\n    });\r\n\r\n    // 成功メトリクス送信\r\n    await sendSuccessMetric(1, 'DownloadPdf', {\r\n      DisclosureId: disclosure_id,\r\n    });\r\n\r\n    return s3Key;\r\n  } catch (error) {\r\n    logger.error('Failed to download PDF', {\r\n      disclosure_id,\r\n      pdf_url,\r\n      error_type: error instanceof Error ? error.constructor.name : 'Unknown',\r\n      error_message: error instanceof Error ? error.message : String(error),\r\n    });\r\n\r\n    // エラーメトリクス送信\r\n    await sendErrorMetric(\r\n      error instanceof Error ? error.constructor.name : 'Unknown',\r\n      'DownloadPdf',\r\n      { DisclosureId: disclosure_id }\r\n    );\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * S3キーを生成（YYYY/MM/DD/disclosure_id.pdf形式）\r\n *\r\n * JSTに変換してYYYY/MM/DD形式を生成します。\r\n * TDnetは日本の開示情報サービスであり、開示時刻は日本時間（JST, UTC+9）で管理されます。\r\n *\r\n * @param disclosure_id - 開示ID\r\n * @param disclosed_at - 開示日時（ISO 8601形式）\r\n * @returns S3キー\r\n *\r\n * @example\r\n * ```typescript\r\n * // UTC: 2024-01-31T15:30:00Z → JST: 2024-02-01T00:30:00\r\n * const key = generateS3Key('TD20240131001', '2024-01-31T15:30:00Z');\r\n * console.log(key); // Output: 2024/02/01/TD20240131001.pdf\r\n * ```\r\n */\r\nfunction generateS3Key(disclosure_id: string, disclosed_at: string): string {\r\n  // UTCからJSTに変換（UTC+9時間）\r\n  const date = new Date(disclosed_at);\r\n  const jstDate = new Date(date.getTime() + 9 * 60 * 60 * 1000);\r\n\r\n  const year = jstDate.getUTCFullYear();\r\n  const month = String(jstDate.getUTCMonth() + 1).padStart(2, '0');\r\n  const day = String(jstDate.getUTCDate()).padStart(2, '0');\r\n\r\n  return `${year}/${month}/${day}/${disclosure_id}.pdf`;\r\n}\r\n"],"mappings":";;AAAA;;;;;;;;AAAA;AAAA,SAAAA,eAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,MAAA,OAAAC,QAAA;EAAA,IAAAC,GAAA;EAAA,IAAAC,YAAA;IAAAL,IAAA;IAAAM,YAAA;MAAA;QAAAC,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;IAAA;IAAAE,KAAA;MAAA;QAAAC,IAAA;QAAAC,IAAA;UAAAN,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAK,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAI,IAAA;QAAAC,IAAA;UAAAN,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAK,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAI,IAAA;QAAAC,IAAA;UAAAN,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAK,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAI,IAAA;QAAAC,IAAA;UAAAN,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAK,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAI,IAAA;QAAAC,IAAA;UAAAN,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAK,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;IAAA;IAAAO,SAAA;MAAA;QAAAD,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;UAAAR,GAAA;YAAAF,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;QAAA;QAAAV,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;UAAAR,GAAA;YAAAF,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;QAAA;QAAAV,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;UAAAR,GAAA;YAAAF,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;QAAA;QAAAV,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;UAAAR,GAAA;YAAAF,IAAA,EAAAU,SAAA;YAAAT,MAAA,EAAAS;UAAA;QAAA;QAAAV,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;MAAA;QAAAM,GAAA;UAAAP,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAO,IAAA;QAAAC,SAAA;UAAAV,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;UAAAF,KAAA;YAAAC,IAAA;YAAAC,MAAA;UAAA;UAAAC,GAAA;YAAAF,IAAA;YAAAC,MAAA;UAAA;QAAA;QAAAD,IAAA;MAAA;IAAA;IAAAW,CAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;IAAA;IAAAC,CAAA;MAAA;MAAA;MAAA;MAAA;MAAA;IAAA;IAAAC,CAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;IAAA;IAAAC,cAAA;MAAAC,IAAA;MAAAC,QAAA;MAAAC,KAAA;MAAAC,OAAA;MAAAC,cAAA;MAAAC,OAAA;IAAA;IAAAC,eAAA;IAAA5B,IAAA;EAAA;EAAA,IAAA6B,QAAA,GAAA5B,MAAA,CAAAE,GAAA,MAAAF,MAAA,CAAAE,GAAA;EAAA,KAAA0B,QAAA,CAAA9B,IAAA,KAAA8B,QAAA,CAAA9B,IAAA,EAAAC,IAAA,KAAAA,IAAA;IAAA6B,QAAA,CAAA9B,IAAA,IAAAK,YAAA;EAAA;EAAA,IAAA0B,cAAA,GAAAD,QAAA,CAAA9B,IAAA;EAAA;IAUA;IAAAD,cAAA,YAAAA,CAAA;MAAA,OAAAgC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAhC,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCAiC,OAAA,CAAAC,WAAA,GAAAA,WAAA;AAzCA,MAAAC,OAAA;AAAA;AAAA,CAAAnC,cAAA,GAAAoB,CAAA,OAAAgB,eAAA,CAAAC,OAAA;AACA,MAAAC,WAAA;AAAA;AAAA,CAAAtC,cAAA,GAAAoB,CAAA,OAAAiB,OAAA;AACA,MAAAE,gBAAA;AAAA;AAAA,CAAAvC,cAAA,GAAAoB,CAAA,OAAAiB,OAAA;AACA,MAAAG,cAAA;AAAA;AAAA,CAAAxC,cAAA,GAAAoB,CAAA,OAAAiB,OAAA;AACA,MAAAI,OAAA;AAAA;AAAA,CAAAzC,cAAA,GAAAoB,CAAA,OAAAiB,OAAA;AACA,MAAAK,QAAA;AAAA;AAAA,CAAA1C,cAAA,GAAAoB,CAAA,OAAAiB,OAAA;AACA,MAAAM,oBAAA;AAAA;AAAA,CAAA3C,cAAA,GAAAoB,CAAA,QAAAiB,OAAA;AACA,MAAAO,QAAA;AAAA;AAAA,CAAA5C,cAAA,GAAAoB,CAAA,QAAAiB,OAAA;AAEA;AACA,MAAMQ,QAAQ;AAAA;AAAA,CAAA7C,cAAA,GAAAoB,CAAA,QAAG,IAAIkB,WAAA,CAAAQ,QAAQ,CAAC,EAAE,CAAC;AAEjC;AACA,MAAMC,WAAW;AAAA;AAAA,CAAA/C,cAAA,GAAAoB,CAAA,QAAG,IAAIoB,cAAA,CAAAQ,WAAW,CAAC;EAAEC,UAAU,EAAE;AAAI,CAAE,CAAC;AAEzD;AACA,SAASC,WAAWA,CAAA;EAAA;EAAAlD,cAAA,GAAAqB,CAAA;EAAArB,cAAA,GAAAoB,CAAA;EAClB,OAAO,2BAAApB,cAAA,GAAAsB,CAAA,UAAA6B,OAAO,CAACC,GAAG,CAACC,SAAS;EAAA;EAAA,CAAArD,cAAA,GAAAsB,CAAA,UAAI,2BAA2B;AAC7D;AAEA;;;;;;;;;;;;;;;;;;;;;AAqBO,eAAeY,WAAWA,CAC/BoB,aAAqB,EACrBC,OAAe,EACfC,YAAoB;EAAA;EAAAxD,cAAA,GAAAqB,CAAA;EAAArB,cAAA,GAAAoB,CAAA;EAEpB,IAAI;IAAA;IAAApB,cAAA,GAAAoB,CAAA;IACFsB,QAAA,CAAAe,MAAM,CAACC,IAAI,CAAC,iBAAiB,EAAE;MAAEJ,aAAa;MAAEC;IAAO,CAAE,CAAC;IAE1D;IAAA;IAAAvD,cAAA,GAAAoB,CAAA;IACA,MAAM2B,WAAW,CAACY,YAAY,EAAE;IAEhC;IACA,MAAMC,SAAS;IAAA;IAAA,CAAA5D,cAAA,GAAAoB,CAAA,QAAG,MAAM,IAAAqB,OAAA,CAAAoB,gBAAgB,EACtC,YAAW;MAAA;MAAA7D,cAAA,GAAAqB,CAAA;MAAArB,cAAA,GAAAoB,CAAA;MACT,IAAI;QACF,MAAM0C,QAAQ;QAAA;QAAA,CAAA9D,cAAA,GAAAoB,CAAA,QAAG,MAAMe,OAAA,CAAA4B,OAAK,CAACC,GAAG,CAACT,OAAO,EAAE;UACxCU,YAAY,EAAE,aAAa;UAC3BC,OAAO,EAAE,KAAK;UAAE;UAChBC,OAAO,EAAE;YACP,YAAY,EAAE;;SAEjB,CAAC;QAAC;QAAAnE,cAAA,GAAAoB,CAAA;QACH,OAAOgD,MAAM,CAACC,IAAI,CAACP,QAAQ,CAACQ,IAAI,CAAC;MACnC,CAAC,CAAC,OAAOC,KAAK,EAAE;QAAA;QAAAvE,cAAA,GAAAoB,CAAA;QACd,IAAIe,OAAA,CAAA4B,OAAK,CAACS,YAAY,CAACD,KAAK,CAAC,EAAE;UAAA;UAAAvE,cAAA,GAAAsB,CAAA;UAAAtB,cAAA,GAAAoB,CAAA;UAC7B;UACA;UAAI;UAAA,CAAApB,cAAA,GAAAsB,CAAA,UAAAiD,KAAK,CAACE,IAAI,KAAK,cAAc;UAAA;UAAA,CAAAzE,cAAA,GAAAsB,CAAA,UAAIiD,KAAK,CAACE,IAAI,KAAK,WAAW,GAAE;YAAA;YAAAzE,cAAA,GAAAsB,CAAA;YAAAtB,cAAA,GAAAoB,CAAA;YAC/D,MAAM,IAAIwB,QAAA,CAAA8B,cAAc,CAAC,4BAA4BnB,OAAO,EAAE,EAAEgB,KAAK,CAAC;UACxE,CAAC;UAAA;UAAA;YAAAvE,cAAA,GAAAsB,CAAA;UAAA;UACD;UAAAtB,cAAA,GAAAoB,CAAA;UACA;UAAI;UAAA,CAAApB,cAAA,GAAAsB,CAAA,UAAAiD,KAAK,CAACT,QAAQ;UAAA;UAAA,CAAA9D,cAAA,GAAAsB,CAAA,UAAIiD,KAAK,CAACT,QAAQ,CAACa,MAAM,IAAI,GAAG,GAAE;YAAA;YAAA3E,cAAA,GAAAsB,CAAA;YAAAtB,cAAA,GAAAoB,CAAA;YAClD,MAAM,IAAIwB,QAAA,CAAA8B,cAAc,CACtB,iBAAiBH,KAAK,CAACT,QAAQ,CAACa,MAAM,MAAMpB,OAAO,EAAE,EACrDgB,KAAK,CACN;UACH,CAAC;UAAA;UAAA;YAAAvE,cAAA,GAAAsB,CAAA;UAAA;UACD;UAAAtB,cAAA,GAAAoB,CAAA;UACA;UAAI;UAAA,CAAApB,cAAA,GAAAsB,CAAA,WAAAiD,KAAK,CAACT,QAAQ;UAAA;UAAA,CAAA9D,cAAA,GAAAsB,CAAA,WAAIiD,KAAK,CAACT,QAAQ,CAACa,MAAM,KAAK,GAAG,GAAE;YAAA;YAAA3E,cAAA,GAAAsB,CAAA;YAAAtB,cAAA,GAAAoB,CAAA;YACnD,MAAM,IAAIwB,QAAA,CAAA8B,cAAc,CAAC,wBAAwBnB,OAAO,EAAE,EAAEgB,KAAK,CAAC;UACpE,CAAC;UAAA;UAAA;YAAAvE,cAAA,GAAAsB,CAAA;UAAA;QACH,CAAC;QAAA;QAAA;UAAAtB,cAAA,GAAAsB,CAAA;QAAA;QAAAtB,cAAA,GAAAoB,CAAA;QACD,MAAMmD,KAAK;MACb;IACF,CAAC,EACD;MACEK,UAAU,EAAE,CAAC;MACbC,YAAY,EAAE,IAAI;MAClBC,iBAAiB,EAAE,CAAC;MACpBC,MAAM,EAAE;KACT,CACF;IAED;IAAA;IAAA/E,cAAA,GAAAoB,CAAA;IACA,IAAAmB,gBAAA,CAAAyC,eAAe,EAACpB,SAAS,CAAC;IAE1B;IACA,MAAMqB,KAAK;IAAA;IAAA,CAAAjF,cAAA,GAAAoB,CAAA,QAAG8D,aAAa,CAAC5B,aAAa,EAAEE,YAAY,CAAC;IAExD;IAAA;IAAAxD,cAAA,GAAAoB,CAAA;IACA,MAAMyB,QAAQ,CAACsC,IAAI,CACjB,IAAI7C,WAAA,CAAA8C,gBAAgB,CAAC;MACnBC,MAAM,EAAEnC,WAAW,EAAE;MACrBoC,GAAG,EAAEL,KAAK;MACVM,IAAI,EAAE3B,SAAS;MACf4B,WAAW,EAAE,iBAAiB;MAC9BC,QAAQ,EAAE;QACRnC,aAAa;QACbE,YAAY;QACZkC,WAAW,EAAE,IAAIC,IAAI,EAAE,CAACC,WAAW;;KAEtC,CAAC,CACH;IAAC;IAAA5F,cAAA,GAAAoB,CAAA;IAEFsB,QAAA,CAAAe,MAAM,CAACC,IAAI,CAAC,oBAAoB,EAAE;MAChCJ,aAAa;MACbuC,MAAM,EAAEZ,KAAK;MACba,IAAI,EAAElC,SAAS,CAACmC;KACjB,CAAC;IAEF;IAAA;IAAA/F,cAAA,GAAAoB,CAAA;IACA,MAAM,IAAAuB,oBAAA,CAAAqD,iBAAiB,EAAC,CAAC,EAAE,aAAa,EAAE;MACxCC,YAAY,EAAE3C;KACf,CAAC;IAAC;IAAAtD,cAAA,GAAAoB,CAAA;IAEH,OAAO6D,KAAK;EACd,CAAC,CAAC,OAAOV,KAAK,EAAE;IAAA;IAAAvE,cAAA,GAAAoB,CAAA;IACdsB,QAAA,CAAAe,MAAM,CAACc,KAAK,CAAC,wBAAwB,EAAE;MACrCjB,aAAa;MACbC,OAAO;MACP2C,UAAU,EAAE3B,KAAK,YAAY4B,KAAK;MAAA;MAAA,CAAAnG,cAAA,GAAAsB,CAAA,WAAGiD,KAAK,CAAC6B,WAAW,CAACvF,IAAI;MAAA;MAAA,CAAAb,cAAA,GAAAsB,CAAA,WAAG,SAAS;MACvE+E,aAAa,EAAE9B,KAAK,YAAY4B,KAAK;MAAA;MAAA,CAAAnG,cAAA,GAAAsB,CAAA,WAAGiD,KAAK,CAAC+B,OAAO;MAAA;MAAA,CAAAtG,cAAA,GAAAsB,CAAA,WAAGiF,MAAM,CAAChC,KAAK,CAAC;KACtE,CAAC;IAEF;IAAA;IAAAvE,cAAA,GAAAoB,CAAA;IACA,MAAM,IAAAuB,oBAAA,CAAA6D,eAAe,EACnBjC,KAAK,YAAY4B,KAAK;IAAA;IAAA,CAAAnG,cAAA,GAAAsB,CAAA,WAAGiD,KAAK,CAAC6B,WAAW,CAACvF,IAAI;IAAA;IAAA,CAAAb,cAAA,GAAAsB,CAAA,WAAG,SAAS,GAC3D,aAAa,EACb;MAAE2E,YAAY,EAAE3C;IAAa,CAAE,CAChC;IAAC;IAAAtD,cAAA,GAAAoB,CAAA;IAEF,MAAMmD,KAAK;EACb;AACF;AAEA;;;;;;;;;;;;;;;;;AAiBA,SAASW,aAAaA,CAAC5B,aAAqB,EAAEE,YAAoB;EAAA;EAAAxD,cAAA,GAAAqB,CAAA;EAChE;EACA,MAAMoF,IAAI;EAAA;EAAA,CAAAzG,cAAA,GAAAoB,CAAA,QAAG,IAAIuE,IAAI,CAACnC,YAAY,CAAC;EACnC,MAAMkD,OAAO;EAAA;EAAA,CAAA1G,cAAA,GAAAoB,CAAA,QAAG,IAAIuE,IAAI,CAACc,IAAI,CAACE,OAAO,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;EAE7D,MAAMC,IAAI;EAAA;EAAA,CAAA5G,cAAA,GAAAoB,CAAA,QAAGsF,OAAO,CAACG,cAAc,EAAE;EACrC,MAAMC,KAAK;EAAA;EAAA,CAAA9G,cAAA,GAAAoB,CAAA,QAAGmF,MAAM,CAACG,OAAO,CAACK,WAAW,EAAE,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;EAChE,MAAMC,GAAG;EAAA;EAAA,CAAAjH,cAAA,GAAAoB,CAAA,QAAGmF,MAAM,CAACG,OAAO,CAACQ,UAAU,EAAE,CAAC,CAACF,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;EAAC;EAAAhH,cAAA,GAAAoB,CAAA;EAE1D,OAAO,GAAGwF,IAAI,IAAIE,KAAK,IAAIG,GAAG,IAAI3D,aAAa,MAAM;AACvD","ignoreList":[]}