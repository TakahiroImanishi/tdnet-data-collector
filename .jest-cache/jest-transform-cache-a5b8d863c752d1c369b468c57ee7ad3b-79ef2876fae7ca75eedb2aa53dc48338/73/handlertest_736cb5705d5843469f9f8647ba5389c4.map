{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\handler.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\handler.test.ts"],"sourcesContent":["/**\r\n * Lambda Export Handler Unit Tests\r\n *\r\n * Requirements: 要件14.1（ユニットテスト）\r\n */\r\n\r\nimport { Context } from 'aws-lambda';\r\nimport { handler } from '../handler';\r\nimport { ExportEvent } from '../types';\r\nimport * as createExportJob from '../create-export-job';\r\nimport * as processExport from '../process-export';\r\nimport { SecretsManagerClient, GetSecretValueCommand } from '@aws-sdk/client-secrets-manager';\r\nimport { mockClient } from 'aws-sdk-client-mock';\r\n\r\n// モック\r\njest.mock('../create-export-job');\r\njest.mock('../process-export');\r\njest.mock('../../../utils/logger');\r\njest.mock('../../../utils/cloudwatch-metrics');\r\n\r\n// Secrets Managerモック\r\nconst secretsManagerMock = mockClient(SecretsManagerClient);\r\n\r\ndescribe('Lambda Export Handler', () => {\r\n  const mockContext: Context = {\r\n    awsRequestId: 'test-request-id',\r\n    functionName: 'tdnet-export',\r\n    functionVersion: '1',\r\n    invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-export',\r\n    memoryLimitInMB: '512',\r\n    logGroupName: '/aws/lambda/tdnet-export',\r\n    logStreamName: '2024/01/15/[$LATEST]test',\r\n    callbackWaitsForEmptyEventLoop: true,\r\n    getRemainingTimeInMillis: () => 30000,\r\n    done: jest.fn(),\r\n    fail: jest.fn(),\r\n    succeed: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    // Secrets Managerモックのセットアップ\r\n    secretsManagerMock.reset();\r\n    secretsManagerMock.on(GetSecretValueCommand).resolves({\r\n      SecretString: 'test-api-key',\r\n    });\r\n\r\n    jest.clearAllMocks();\r\n    process.env.API_KEY = 'test-api-key';\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('JSON形式のエクスポートリクエストを受け付ける', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      const mockExportJob = {\r\n        export_id: 'export_1705305600000_abc123_12345678',\r\n        status: 'pending' as const,\r\n        requested_at: '2024-01-15T10:00:00Z',\r\n        progress: 0,\r\n        ttl: 1707897600,\r\n        format: 'json' as const,\r\n        filter: JSON.stringify({ start_date: '2024-01-15', end_date: '2024-01-20' }),\r\n      };\r\n\r\n      jest.spyOn(createExportJob, 'createExportJob').mockResolvedValue(mockExportJob);\r\n      jest.spyOn(processExport, 'processExport').mockResolvedValue(undefined);\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(202);\r\n      expect(JSON.parse(result.body)).toEqual({\r\n        export_id: mockExportJob.export_id,\r\n        status: 'pending',\r\n        message: 'Export job created successfully',\r\n        progress: 0,\r\n      });\r\n      expect(createExportJob.createExportJob).toHaveBeenCalledWith(\r\n        {\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        },\r\n        mockContext.awsRequestId\r\n      );\r\n    });\r\n\r\n    it('CSV形式のエクスポートリクエストを受け付ける', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'csv',\r\n          filter: {\r\n            company_code: '1234',\r\n            start_date: '2024-01-01',\r\n            end_date: '2024-01-31',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      const mockExportJob = {\r\n        export_id: 'export_1705305600000_def456_87654321',\r\n        status: 'pending' as const,\r\n        requested_at: '2024-01-15T10:00:00Z',\r\n        progress: 0,\r\n        ttl: 1707897600,\r\n        format: 'csv' as const,\r\n        filter: JSON.stringify({\r\n          company_code: '1234',\r\n          start_date: '2024-01-01',\r\n          end_date: '2024-01-31',\r\n        }),\r\n      };\r\n\r\n      jest.spyOn(createExportJob, 'createExportJob').mockResolvedValue(mockExportJob);\r\n      jest.spyOn(processExport, 'processExport').mockResolvedValue(undefined);\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(202);\r\n      expect(JSON.parse(result.body)).toEqual({\r\n        export_id: mockExportJob.export_id,\r\n        status: 'pending',\r\n        message: 'Export job created successfully',\r\n        progress: 0,\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('異常系: APIキー認証', () => {\r\n    it('APIキーが未指定の場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {},\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      expect(JSON.parse(result.body)).toEqual({\r\n        status: 'error',\r\n        error: {\r\n          code: 'UNAUTHORIZED',\r\n          message: 'API key is required',\r\n          details: {},\r\n        },\r\n        request_id: mockContext.awsRequestId,\r\n      });\r\n    });\r\n\r\n    it('APIキーが不正な場合は401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'invalid-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      expect(JSON.parse(result.body)).toEqual({\r\n        status: 'error',\r\n        error: {\r\n          code: 'UNAUTHORIZED',\r\n          message: 'Invalid API key',\r\n          details: {},\r\n        },\r\n        request_id: mockContext.awsRequestId,\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('異常系: バリデーション', () => {\r\n    it('リクエストボディが空の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: '',\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.code).toBe('VALIDATION_ERROR');\r\n    });\r\n\r\n    it('不正なJSON形式の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: 'invalid json',\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.code).toBe('VALIDATION_ERROR');\r\n    });\r\n\r\n    it('不正なフォーマットの場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'xml', // 不正なフォーマット\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid format');\r\n    });\r\n\r\n    it('不正な日付フォーマットの場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024/01/15', // 不正なフォーマット\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid start_date format');\r\n    });\r\n\r\n    it('開始日が終了日より後の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-20',\r\n            end_date: '2024-01-15', // 開始日より前\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain(\r\n        'start_date (2024-01-20) must be before or equal to end_date (2024-01-15)'\r\n      );\r\n    });\r\n\r\n    it('不正な企業コードの場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            company_code: '12345', // 5桁（不正）\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid company_code format');\r\n    });\r\n\r\n    it('フィルターが未指定の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          // filter未指定\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Filter is required');\r\n    });\r\n\r\n    it('フォーマットが未指定の場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          // format未指定\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid format');\r\n    });\r\n\r\n    it('存在しない日付の場合は400エラーを返す（start_date）', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-02-30', // 存在しない日付\r\n            end_date: '2024-03-01',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid start_date');\r\n    });\r\n\r\n    it('存在しない日付の場合は400エラーを返す（end_date）', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-01',\r\n            end_date: '2024-13-01', // 存在しない月\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid end_date');\r\n    });\r\n\r\n    it('end_dateのフォーマットが不正な場合は400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024/01/20', // 不正なフォーマット\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      expect(JSON.parse(result.body).error.message).toContain('Invalid end_date format');\r\n    });\r\n  });\r\n\r\n  describe('CORS対応', () => {\r\n    it('レスポンスにCORSヘッダーが含まれる', async () => {\r\n      // Arrange\r\n      const event: ExportEvent = {\r\n        headers: {\r\n          'x-api-key': 'test-api-key',\r\n        },\r\n        body: JSON.stringify({\r\n          format: 'json',\r\n          filter: {\r\n            start_date: '2024-01-15',\r\n            end_date: '2024-01-20',\r\n          },\r\n        }),\r\n      } as ExportEvent;\r\n\r\n      const mockExportJob = {\r\n        export_id: 'export_1705305600000_abc123_12345678',\r\n        status: 'pending' as const,\r\n        requested_at: '2024-01-15T10:00:00Z',\r\n        progress: 0,\r\n        ttl: 1707897600,\r\n        format: 'json' as const,\r\n        filter: JSON.stringify({ start_date: '2024-01-15', end_date: '2024-01-20' }),\r\n      };\r\n\r\n      jest.spyOn(createExportJob, 'createExportJob').mockResolvedValue(mockExportJob);\r\n      jest.spyOn(processExport, 'processExport').mockResolvedValue(undefined);\r\n\r\n      // Act\r\n      const result = await handler(event, mockContext);\r\n\r\n      // Assert\r\n      expect(result.headers).toEqual({\r\n        'Content-Type': 'application/json',\r\n        'Access-Control-Allow-Origin': '*',\r\n        'Access-Control-Allow-Headers': 'Content-Type,X-Api-Key',\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"version":3}