{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\__tests__\\retry.test.ts","mappings":";AAAA;;;;;GAKG;;AAEH,oCAA4E;AAC5E,yCAA8E;AAE9E,QAAQ,CAAC,UAAU,EAAE,GAAG,EAAE;IACxB,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,cAAc,EAAE,KAAK,IAAI,EAAE;YAC5B,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YAEzD,MAAM,MAAM,GAAG,MAAM,IAAA,wBAAgB,EAAC,SAAS,CAAC,CAAC;YAEjD,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,iBAAiB,CAAC,CAAC;iBAC5D,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,MAAM,GAAG,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC/C,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qBAAqB,EAAE,KAAK,IAAI,EAAE;YACnC,MAAM,KAAK,GAAG,IAAI,uBAAc,CAAC,kBAAkB,CAAC,CAAC;YACrD,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAErD,MAAM,MAAM,CACV,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC1B,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;YAEtC,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa;QAC3D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;YACjC,MAAM,KAAK,GAAG,IAAI,wBAAe,CAAC,eAAe,CAAC,CAAC;YACnD,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAErD,MAAM,MAAM,CACV,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC1B,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YAEnC,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ;QACtD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sBAAsB,EAAE,KAAK,IAAI,EAAE;YACpC,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;iBAC9C,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,MAAM,GAAG,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC/C,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;gBACb,WAAW,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAC;aAC7D,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YAC/C,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAErD,MAAM,MAAM,CACV,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC1B,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;gBACb,WAAW,EAAE,GAAG,EAAE,CAAC,KAAK;aACzB,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;YAEzC,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YACzC,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,SAAS,CAAC,CAAC;iBACpD,qBAAqB,CAAC,IAAI,uBAAc,CAAC,SAAS,CAAC,CAAC;iBACpD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAChC,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,GAAG;gBACjB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;YAE3C,qCAAqC;YACrC,MAAM,CAAC,WAAW,CAAC,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;YAChD,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,SAAS,CAAC,CAAC;iBACpD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAChC,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,GAAG;gBACjB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,IAAI;aACb,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;YAE3C,yBAAyB;YACzB,MAAM,CAAC,WAAW,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YAC9C,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,eAAe;YACtD,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;YACtC,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAE9D,MAAM,MAAM,CACV,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC1B,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;YAElC,qCAAqC;YACrC,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,eAAe,EAAE,KAAK,IAAI,EAAE;YAC7B,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,OAAO,CAAC,CAAC;iBAClD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,MAAM,GAAG,MAAM,IAAA,wBAAgB,EAAC,SAAS,CAAC,CAAC;YAEjD,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YACzC,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,OAAO,CAAC,CAAC;iBAClD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,MAAM,GAAG,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC/C,UAAU,EAAE,CAAC,EAAE,OAAO;gBACtB,cAAc;aACf,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;YAC3C,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,OAAO,CAAC,CAAC;iBAClD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAChC,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,GAAG;gBACjB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;YAE3C,iCAAiC;YACjC,MAAM,CAAC,WAAW,CAAC,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC;YAC/C,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;YAC3C,MAAM,SAAS,GAAG,IAAI;iBACnB,EAAE,EAAE;iBACJ,qBAAqB,CAAC,IAAI,uBAAc,CAAC,SAAS,CAAC,CAAC;iBACpD,qBAAqB,CAAC,IAAI,uBAAc,CAAC,SAAS,CAAC,CAAC;iBACpD,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEpC,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,MAAM,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAChC,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,GAAG;gBACjB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;YAE3C,+CAA+C;YAC/C,MAAM,CAAC,WAAW,CAAC,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;YAChD,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uBAAuB,EAAE,KAAK,IAAI,EAAE;YACrC,MAAM,KAAK,GAAG,IAAI,uBAAc,CAAC,OAAO,CAAC,CAAC;YAC1C,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAErD,MAAM,MAAM,CACV,IAAA,wBAAgB,EAAC,SAAS,EAAE;gBAC1B,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,EAAE;gBAChB,iBAAiB,EAAE,CAAC;gBACpB,MAAM,EAAE,KAAK;aACd,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YAE3B,MAAM,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,wBAAwB,EAAE,GAAG,EAAE;YAChC,MAAM,KAAK,GAAG,IAAI,uBAAc,CAAC,iBAAiB,CAAC,CAAC;YACpD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0BAA0B,EAAE,GAAG,EAAE;YAClC,MAAM,KAAK,GAAG,IAAI,wBAAe,CAAC,eAAe,CAAC,CAAC;YACnD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,GAAG,EAAE;YAChC,MAAM,KAAK,GAAG,IAAI,sBAAa,CAAC,oBAAoB,CAAC,CAAC;YACtD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uBAAuB,EAAE,GAAG,EAAE;YAC/B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;YACxD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sBAAsB,EAAE,GAAG,EAAE;YAC9B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;YAC3D,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sBAAsB,EAAE,GAAG,EAAE;YAC9B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;YACxD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,GAAG,EAAE;YACjC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;YAC5D,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uBAAuB,EAAE,GAAG,EAAE;YAC/B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;YACpD,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;YAC9D,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4BAA4B,EAAE,GAAG,EAAE;YACpC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;YAC/D,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,GAAG,EAAE;YAChC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,mCAAmC,CAAC,CAAC;YAC7D,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uBAAuB,EAAE,GAAG,EAAE;YAC/B,MAAM,CAAC,IAAA,wBAAgB,EAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACrD,MAAM,CAAC,IAAA,wBAAgB,EAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC1C,MAAM,CAAC,IAAA,wBAAgB,EAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC3C,MAAM,CAAC,IAAA,wBAAgB,EAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAChD,MAAM,CAAC,IAAA,wBAAgB,EAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mBAAmB,EAAE,GAAG,EAAE;YAC3B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YACzC,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qBAAqB,EAAE,GAAG,EAAE;YAC7B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;YAC5B,MAAM,CAAC,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\__tests__\\retry.test.ts"],"sourcesContent":["/**\r\n * retry.ts のテスト\r\n *\r\n * カバレッジ目標: 80%以上（ブランチカバレッジ）\r\n * 現状: 66.66% (10/15ブランチ) → 目標: 80%以上 (12/15ブランチ以上)\r\n */\r\n\r\nimport { retryWithBackoff, isRetryableError, RetryOptions } from '../retry';\r\nimport { RetryableError, ValidationError, NotFoundError } from '../../errors';\r\n\r\ndescribe('retry.ts', () => {\r\n  describe('retryWithBackoff()', () => {\r\n    it('成功時は即座に結果を返す', async () => {\r\n      const operation = jest.fn().mockResolvedValue('success');\r\n\r\n      const result = await retryWithBackoff(operation);\r\n\r\n      expect(result).toBe('success');\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('RetryableErrorの場合は再試行する', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Temporary error'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const result = await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 10,\r\n        backoffMultiplier: 2,\r\n        jitter: false,\r\n      });\r\n\r\n      expect(result).toBe('success');\r\n      expect(operation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('最大再試行回数に達したらエラーをスロー', async () => {\r\n      const error = new RetryableError('Persistent error');\r\n      const operation = jest.fn().mockRejectedValue(error);\r\n\r\n      await expect(\r\n        retryWithBackoff(operation, {\r\n          maxRetries: 2,\r\n          initialDelay: 10,\r\n          backoffMultiplier: 2,\r\n          jitter: false,\r\n        })\r\n      ).rejects.toThrow('Persistent error');\r\n\r\n      expect(operation).toHaveBeenCalledTimes(3); // 初回 + 2回再試行\r\n    });\r\n\r\n    it('再試行不可能なエラーは即座にスロー', async () => {\r\n      const error = new ValidationError('Invalid input');\r\n      const operation = jest.fn().mockRejectedValue(error);\r\n\r\n      await expect(\r\n        retryWithBackoff(operation, {\r\n          maxRetries: 3,\r\n          initialDelay: 10,\r\n          backoffMultiplier: 2,\r\n          jitter: false,\r\n        })\r\n      ).rejects.toThrow('Invalid input');\r\n\r\n      expect(operation).toHaveBeenCalledTimes(1); // 再試行なし\r\n    });\r\n\r\n    it('カスタムshouldRetry関数を使用', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new Error('ECONNRESET'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const result = await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 10,\r\n        backoffMultiplier: 2,\r\n        jitter: false,\r\n        shouldRetry: (error) => error.message.includes('ECONNRESET'),\r\n      });\r\n\r\n      expect(result).toBe('success');\r\n      expect(operation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('カスタムshouldRetryで再試行不可と判定されたら即座にスロー', async () => {\r\n      const error = new Error('Non-retryable error');\r\n      const operation = jest.fn().mockRejectedValue(error);\r\n\r\n      await expect(\r\n        retryWithBackoff(operation, {\r\n          maxRetries: 3,\r\n          initialDelay: 10,\r\n          backoffMultiplier: 2,\r\n          jitter: false,\r\n          shouldRetry: () => false,\r\n        })\r\n      ).rejects.toThrow('Non-retryable error');\r\n\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('指数バックオフで遅延時間が増加する（ジッターなし）', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error 1'))\r\n        .mockRejectedValueOnce(new RetryableError('Error 2'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const startTime = Date.now();\r\n\r\n      await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 100,\r\n        backoffMultiplier: 2,\r\n        jitter: false,\r\n      });\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // 1回目: 100ms, 2回目: 200ms = 合計300ms以上\r\n      expect(elapsedTime).toBeGreaterThanOrEqual(290);\r\n      expect(operation).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('ジッターありの場合、遅延時間がランダム化される', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error 1'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const startTime = Date.now();\r\n\r\n      await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 100,\r\n        backoffMultiplier: 2,\r\n        jitter: true,\r\n      });\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // ジッターにより0〜100msの範囲でランダム\r\n      expect(elapsedTime).toBeGreaterThanOrEqual(0);\r\n      expect(elapsedTime).toBeLessThan(150); // 100ms + マージン\r\n      expect(operation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('非Errorオブジェクトのエラーを適切に処理', async () => {\r\n      const operation = jest.fn().mockRejectedValue('String error');\r\n\r\n      await expect(\r\n        retryWithBackoff(operation, {\r\n          maxRetries: 1,\r\n          initialDelay: 10,\r\n          backoffMultiplier: 2,\r\n          jitter: false,\r\n        })\r\n      ).rejects.toThrow('String error');\r\n\r\n      // 非Errorオブジェクトは再試行不可能と判定されるため、1回のみ実行\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('デフォルトオプションを使用', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const result = await retryWithBackoff(operation);\r\n\r\n      expect(result).toBe('success');\r\n      expect(operation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('部分的なオプション指定でデフォルト値がマージされる', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const result = await retryWithBackoff(operation, {\r\n        maxRetries: 5, // カスタム\r\n        // 他はデフォルト値を使用\r\n      });\r\n\r\n      expect(result).toBe('success');\r\n      expect(operation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('attempt=0の場合の遅延時間計算（ジッターなし）', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const startTime = Date.now();\r\n\r\n      await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 100,\r\n        backoffMultiplier: 2,\r\n        jitter: false,\r\n      });\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // attempt=0: 100 * (2^0) = 100ms\r\n      expect(elapsedTime).toBeGreaterThanOrEqual(90);\r\n      expect(elapsedTime).toBeLessThan(150);\r\n    });\r\n\r\n    it('attempt=1の場合の遅延時間計算（ジッターなし）', async () => {\r\n      const operation = jest\r\n        .fn()\r\n        .mockRejectedValueOnce(new RetryableError('Error 1'))\r\n        .mockRejectedValueOnce(new RetryableError('Error 2'))\r\n        .mockResolvedValueOnce('success');\r\n\r\n      const startTime = Date.now();\r\n\r\n      await retryWithBackoff(operation, {\r\n        maxRetries: 3,\r\n        initialDelay: 100,\r\n        backoffMultiplier: 2,\r\n        jitter: false,\r\n      });\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // attempt=0: 100ms, attempt=1: 200ms = 合計300ms\r\n      expect(elapsedTime).toBeGreaterThanOrEqual(290);\r\n      expect(elapsedTime).toBeLessThan(350);\r\n    });\r\n\r\n    it('maxRetries=0の場合、再試行なし', async () => {\r\n      const error = new RetryableError('Error');\r\n      const operation = jest.fn().mockRejectedValue(error);\r\n\r\n      await expect(\r\n        retryWithBackoff(operation, {\r\n          maxRetries: 0,\r\n          initialDelay: 10,\r\n          backoffMultiplier: 2,\r\n          jitter: false,\r\n        })\r\n      ).rejects.toThrow('Error');\r\n\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('isRetryableError()', () => {\r\n    it('RetryableErrorの場合はtrue', () => {\r\n      const error = new RetryableError('Temporary error');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ValidationErrorの場合はfalse', () => {\r\n      const error = new ValidationError('Invalid input');\r\n      expect(isRetryableError(error)).toBe(false);\r\n    });\r\n\r\n    it('NotFoundErrorの場合はfalse', () => {\r\n      const error = new NotFoundError('Resource not found');\r\n      expect(isRetryableError(error)).toBe(false);\r\n    });\r\n\r\n    it('ECONNRESETエラーの場合はtrue', () => {\r\n      const error = new Error('Connection reset: ECONNRESET');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ETIMEDOUTエラーの場合はtrue', () => {\r\n      const error = new Error('Connection timed out: ETIMEDOUT');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ENOTFOUNDエラーの場合はtrue', () => {\r\n      const error = new Error('DNS lookup failed: ENOTFOUND');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ECONNREFUSEDエラーの場合はtrue', () => {\r\n      const error = new Error('Connection refused: ECONNREFUSED');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('timeoutを含むエラーの場合はtrue', () => {\r\n      const error = new Error('Request timeout occurred');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ThrottlingExceptionの場合はtrue', () => {\r\n      const error = new Error('ThrottlingException: Rate exceeded');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('ServiceUnavailableの場合はtrue', () => {\r\n      const error = new Error('ServiceUnavailable: Service is down');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('RequestTimeoutの場合はtrue', () => {\r\n      const error = new Error('RequestTimeout: Request timed out');\r\n      expect(isRetryableError(error)).toBe(true);\r\n    });\r\n\r\n    it('非Errorオブジェクトの場合はfalse', () => {\r\n      expect(isRetryableError('string error')).toBe(false);\r\n      expect(isRetryableError(123)).toBe(false);\r\n      expect(isRetryableError(null)).toBe(false);\r\n      expect(isRetryableError(undefined)).toBe(false);\r\n      expect(isRetryableError({})).toBe(false);\r\n    });\r\n\r\n    it('通常のErrorの場合はfalse', () => {\r\n      const error = new Error('Generic error');\r\n      expect(isRetryableError(error)).toBe(false);\r\n    });\r\n\r\n    it('空のエラーメッセージの場合はfalse', () => {\r\n      const error = new Error('');\r\n      expect(isRetryableError(error)).toBe(false);\r\n    });\r\n  });\r\n});\r\n"],"version":3}