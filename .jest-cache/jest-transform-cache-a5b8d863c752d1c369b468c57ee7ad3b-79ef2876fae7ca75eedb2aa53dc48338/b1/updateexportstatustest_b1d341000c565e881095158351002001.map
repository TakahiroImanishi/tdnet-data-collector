{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\update-export-status.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\update-export-status.test.ts"],"sourcesContent":["/**\r\n * Update Export Status Unit Tests\r\n *\r\n * Requirements: 要件14.1（ユニットテスト）\r\n */\r\n\r\n// モック設定（importより前に定義）\r\nconst mockSend = jest.fn();\r\n\r\njest.mock('@aws-sdk/client-dynamodb', () => {\r\n  const actualModule = jest.requireActual('@aws-sdk/client-dynamodb');\r\n  return {\r\n    ...actualModule,\r\n    DynamoDBClient: jest.fn().mockImplementation(() => ({\r\n      send: mockSend,\r\n    })),\r\n  };\r\n});\r\n\r\njest.mock('../../../utils/logger');\r\njest.mock('../../../utils/retry', () => ({\r\n  retryWithBackoff: jest.fn((fn) => fn()), // retryをバイパス\r\n}));\r\n\r\nimport { updateExportStatus } from '../update-export-status';\r\nimport { UpdateItemCommand } from '@aws-sdk/client-dynamodb';\r\n\r\ndescribe('updateExportStatus', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    mockSend.mockClear();\r\n    mockSend.mockResolvedValue({\r\n      $metadata: { httpStatusCode: 200 },\r\n      Attributes: {},\r\n    });\r\n\r\n    process.env.EXPORT_STATUS_TABLE_NAME = 'test-export-status-table';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n  });\r\n\r\n  describe('正常系: ステータス更新', () => {\r\n    it('pending → processing への更新が正常に実行される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_abc123_12345678';\r\n      const status = 'processing';\r\n      const progress = 10;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.TableName).toBe('test-export-status-table');\r\n      expect(command.input.Key).toEqual({\r\n        export_id: { S: export_id },\r\n      });\r\n\r\n      // UpdateExpressionの検証\r\n      expect(command.input.UpdateExpression).toContain('#status = :status');\r\n      expect(command.input.UpdateExpression).toContain('#progress = :progress');\r\n      expect(command.input.UpdateExpression).not.toContain('#completed_at');\r\n\r\n      // ExpressionAttributeValuesの検証\r\n      expect(command.input.ExpressionAttributeValues).toEqual({\r\n        ':status': { S: 'processing' },\r\n        ':progress': { N: '10' },\r\n      });\r\n    });\r\n\r\n    it('processing → completed への更新が正常に実行される（s3_key, download_url付き）', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_def456_87654321';\r\n      const status = 'completed';\r\n      const progress = 100;\r\n      const s3_key = 'exports/2024/01/15/export_1705305600000_def456_87654321.json';\r\n      const download_url = 'https://s3.amazonaws.com/signed-url?expires=...';\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress, s3_key, download_url);\r\n\r\n      // Assert\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n\r\n      // UpdateExpressionの検証\r\n      expect(command.input.UpdateExpression).toContain('#status = :status');\r\n      expect(command.input.UpdateExpression).toContain('#progress = :progress');\r\n      expect(command.input.UpdateExpression).toContain('#completed_at = :completed_at');\r\n      expect(command.input.UpdateExpression).toContain('#s3_key = :s3_key');\r\n      expect(command.input.UpdateExpression).toContain('#download_url = :download_url');\r\n\r\n      // ExpressionAttributeValuesの検証\r\n      expect(command.input.ExpressionAttributeValues?.[':status']).toEqual({ S: 'completed' });\r\n      expect(command.input.ExpressionAttributeValues?.[':progress']).toEqual({ N: '100' });\r\n      expect(command.input.ExpressionAttributeValues?.[':s3_key']).toEqual({ S: s3_key });\r\n      expect(command.input.ExpressionAttributeValues?.[':download_url']).toEqual({ S: download_url });\r\n      expect(command.input.ExpressionAttributeValues?.[':completed_at']).toBeDefined();\r\n      expect(command.input.ExpressionAttributeValues?.[':completed_at'].S).toMatch(\r\n        /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$/\r\n      );\r\n    });\r\n\r\n    it('processing → failed への更新が正常に実行される（error_message付き）', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_ghi789_11111111';\r\n      const status = 'failed';\r\n      const progress = 0;\r\n      const error_message = 'DynamoDB query failed';\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress, undefined, undefined, error_message);\r\n\r\n      // Assert\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n\r\n      // UpdateExpressionの検証\r\n      expect(command.input.UpdateExpression).toContain('#status = :status');\r\n      expect(command.input.UpdateExpression).toContain('#progress = :progress');\r\n      expect(command.input.UpdateExpression).toContain('#completed_at = :completed_at');\r\n      expect(command.input.UpdateExpression).toContain('#error_message = :error_message');\r\n\r\n      // ExpressionAttributeValuesの検証\r\n      expect(command.input.ExpressionAttributeValues?.[':status']).toEqual({ S: 'failed' });\r\n      expect(command.input.ExpressionAttributeValues?.[':progress']).toEqual({ N: '0' });\r\n      expect(command.input.ExpressionAttributeValues?.[':error_message']).toEqual({\r\n        S: 'DynamoDB query failed',\r\n      });\r\n      expect(command.input.ExpressionAttributeValues?.[':completed_at']).toBeDefined();\r\n    });\r\n\r\n    it('completed_at が completed 時に自動設定される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_jkl012_22222222';\r\n      const status = 'completed';\r\n      const progress = 100;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n\r\n      // completed_atが含まれることを確認\r\n      expect(command.input.UpdateExpression).toContain('#completed_at = :completed_at');\r\n      expect(command.input.ExpressionAttributeValues?.[':completed_at']).toBeDefined();\r\n\r\n      // ISO 8601形式であることを確認\r\n      const completedAt = command.input.ExpressionAttributeValues?.[':completed_at'].S;\r\n      expect(completedAt).toMatch(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$/);\r\n    });\r\n\r\n    it('completed_at が failed 時に自動設定される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_mno345_33333333';\r\n      const status = 'failed';\r\n      const progress = 0;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n\r\n      // completed_atが含まれることを確認\r\n      expect(command.input.UpdateExpression).toContain('#completed_at = :completed_at');\r\n      expect(command.input.ExpressionAttributeValues?.[':completed_at']).toBeDefined();\r\n    });\r\n\r\n    it('進捗率が正しく更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_pqr678_44444444';\r\n      const progressValues = [10, 25, 50, 75, 90, 100];\r\n\r\n      // Act & Assert\r\n      for (const progress of progressValues) {\r\n        mockSend.mockClear();\r\n        await updateExportStatus(export_id, 'processing', progress);\r\n\r\n        const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n        expect(command.input.ExpressionAttributeValues?.[':progress']).toEqual({\r\n          N: String(progress),\r\n        });\r\n      }\r\n    });\r\n\r\n    it('オプショナルフィールドが指定されない場合、UpdateExpressionに含まれない', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_stu901_55555555';\r\n      const status = 'processing';\r\n      const progress = 50;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n\r\n      // s3_key, download_url, error_messageが含まれないことを確認\r\n      expect(command.input.UpdateExpression).not.toContain('#s3_key');\r\n      expect(command.input.UpdateExpression).not.toContain('#download_url');\r\n      expect(command.input.UpdateExpression).not.toContain('#error_message');\r\n    });\r\n  });\r\n\r\n  describe('異常系: DynamoDB UpdateItem 失敗', () => {\r\n    it('DynamoDB UpdateItem 失敗時、エラーが伝播される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_vwx234_66666666';\r\n      const status = 'processing';\r\n      const progress = 10;\r\n\r\n      const error = new Error('DynamoDB UpdateItem failed');\r\n      error.name = 'InternalServerError';\r\n      mockSend.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(updateExportStatus(export_id, status, progress)).rejects.toThrow(\r\n        'DynamoDB UpdateItem failed'\r\n      );\r\n\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('ProvisionedThroughputExceededException 発生時、再試行される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_yza567_77777777';\r\n      const status = 'processing';\r\n      const progress = 10;\r\n\r\n      // retryWithBackoffのモックを実際の再試行ロジックに置き換え\r\n      const { retryWithBackoff } = jest.requireActual('../../../utils/retry');\r\n      jest.spyOn(require('../../../utils/retry'), 'retryWithBackoff').mockImplementation(retryWithBackoff);\r\n\r\n      const error = new Error('ProvisionedThroughputExceededException');\r\n      error.name = 'ProvisionedThroughputExceededException';\r\n\r\n      // 最初の2回は失敗、3回目は成功\r\n      mockSend\r\n        .mockRejectedValueOnce(error)\r\n        .mockRejectedValueOnce(error)\r\n        .mockResolvedValueOnce({\r\n          $metadata: { httpStatusCode: 200 },\r\n          Attributes: {},\r\n        });\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      // 再試行により3回呼ばれることを確認\r\n      expect(mockSend).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('ValidationException 発生時、即座にエラーが伝播される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_bcd890_88888888';\r\n      const status = 'processing';\r\n      const progress = 10;\r\n\r\n      const error = new Error('ValidationException: Invalid attribute value');\r\n      error.name = 'ValidationException';\r\n      mockSend.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(updateExportStatus(export_id, status, progress)).rejects.toThrow(\r\n        'ValidationException: Invalid attribute value'\r\n      );\r\n\r\n      expect(mockSend).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('異常系: 環境変数未設定', () => {\r\n    it('EXPORT_STATUS_TABLE_NAME が未設定の場合、デフォルト値が使用される', async () => {\r\n      // Arrange\r\n      delete process.env.EXPORT_STATUS_TABLE_NAME;\r\n      const export_id = 'export_1705305600000_efg123_99999999';\r\n      const status = 'processing';\r\n      const progress = 10;\r\n\r\n      // モジュールを再読み込み\r\n      jest.resetModules();\r\n      const { updateExportStatus: updateExportStatusReloaded } = require('../update-export-status');\r\n\r\n      // Act\r\n      await updateExportStatusReloaded(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.TableName).toBe('tdnet-export-status'); // デフォルト値\r\n    });\r\n  });\r\n\r\n  describe('エッジケース', () => {\r\n    it('進捗率0%でも正常に更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_hij456_00000000';\r\n      const status = 'pending';\r\n      const progress = 0;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.ExpressionAttributeValues?.[':progress']).toEqual({ N: '0' });\r\n    });\r\n\r\n    it('進捗率100%でも正常に更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_klm789_11111112';\r\n      const status = 'completed';\r\n      const progress = 100;\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.ExpressionAttributeValues?.[':progress']).toEqual({ N: '100' });\r\n    });\r\n\r\n    it('長いエラーメッセージも正常に記録される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_nop012_22222223';\r\n      const status = 'failed';\r\n      const progress = 0;\r\n      const error_message = 'A'.repeat(1000); // 1000文字のエラーメッセージ\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress, undefined, undefined, error_message);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.ExpressionAttributeValues?.[':error_message']).toEqual({\r\n        S: error_message,\r\n      });\r\n    });\r\n\r\n    it('特殊文字を含むS3キーも正常に記録される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_qrs345_33333334';\r\n      const status = 'completed';\r\n      const progress = 100;\r\n      const s3_key = 'exports/2024/01/15/export_特殊文字_テスト.json';\r\n\r\n      // Act\r\n      await updateExportStatus(export_id, status, progress, s3_key);\r\n\r\n      // Assert\r\n      const command = mockSend.mock.calls[0][0] as UpdateItemCommand;\r\n      expect(command.input.ExpressionAttributeValues?.[':s3_key']).toEqual({ S: s3_key });\r\n    });\r\n  });\r\n});\r\n"],"version":3}