3beb80d14fe7ae212980681d6f65df21
"use strict";
/**
 * Export to S3 Unit Tests
 *
 * Requirements: 要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('@aws-sdk/client-s3', () => {
    const actualModule = jest.requireActual('@aws-sdk/client-s3');
    return {
        ...actualModule,
        S3Client: jest.fn().mockImplementation(() => ({
            send: mockSend,
        })),
    };
});
jest.mock('../../../utils/logger');
jest.mock('../../../utils/retry', () => ({
    retryWithBackoff: jest.fn((fn) => fn()), // retryをバイパス
}));
// モック設定（importより前に定義）
const mockSend = jest.fn();
const export_to_s3_1 = require("../export-to-s3");
describe('exportToS3', () => {
    const mockDisclosures = [
        {
            disclosure_id: '20240115_1234_001',
            company_code: '1234',
            company_name: 'テスト株式会社',
            disclosure_type: '決算短信',
            title: '2024年3月期 第3四半期決算短信',
            disclosed_at: '2024-01-15T10:30:00Z',
            pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
            collected_at: '2024-01-15T10:35:00Z',
            date_partition: '2024-01',
        },
        {
            disclosure_id: '20240115_5678_001',
            company_code: '5678',
            company_name: 'サンプル株式会社',
            disclosure_type: '有価証券報告書',
            title: '第50期有価証券報告書',
            disclosed_at: '2024-01-15T11:00:00Z',
            pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',
            collected_at: '2024-01-15T11:05:00Z',
            date_partition: '2024-01',
        },
    ];
    beforeEach(() => {
        jest.clearAllMocks();
        mockSend.mockClear();
        mockSend.mockResolvedValue({
            $metadata: { httpStatusCode: 200 },
            ETag: '"mock-etag"',
        });
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('JSON形式のエクスポート', () => {
        it('JSON形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
            expect(mockSend).toHaveBeenCalledTimes(1);
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('application/json');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('JSONに件数とデータが含まれる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const parsed = JSON.parse(body);
            expect(parsed).toHaveProperty('count', 2);
            expect(parsed).toHaveProperty('disclosures');
            expect(parsed.disclosures).toHaveLength(2);
            expect(parsed.disclosures[0]).toEqual(mockDisclosures[0]);
        });
    });
    describe('CSV形式のエクスポート', () => {
        it('CSV形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.csv$/);
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('text/csv');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('CSVヘッダーが正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[0]).toBe('disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,s3_key,collected_at,date_partition');
        });
        it('CSVデータ行が正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toBe('20240115_1234_001,1234,テスト株式会社,決算短信,2024年3月期 第3四半期決算短信,2024-01-15T10:30:00Z,https://example.com/pdf/20240115_1234_001.pdf,pdfs/2024/01/15/20240115_1234_001.pdf,2024-01-15T10:35:00Z,2024-01');
            expect(lines[2]).toBe('20240115_5678_001,5678,サンプル株式会社,有価証券報告書,第50期有価証券報告書,2024-01-15T11:00:00Z,https://example.com/pdf/20240115_5678_001.pdf,pdfs/2024/01/15/20240115_5678_001.pdf,2024-01-15T11:05:00Z,2024-01');
        });
        it('カンマを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithComma = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル, カンマ含む',
                },
            ];
            const export_id = 'export_1705305600000_ghi789_11111111';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithComma, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル, カンマ含む"');
        });
        it('ダブルクォートを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithQuote = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル"引用符"含む',
                },
            ];
            const export_id = 'export_1705305600000_jkl012_22222222';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithQuote, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル""引用符""含む"');
        });
        it('改行を含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithNewline = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル\n改行含む',
                },
            ];
            const export_id = 'export_1705305600000_mno345_33333333';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithNewline, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            // 改行を含む値はダブルクォートで囲まれる
            expect(body).toContain('"タイトル\n改行含む"');
        });
    });
    describe('S3キー生成', () => {
        it('S3キーが正しいフォーマットで生成される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            // フォーマット: exports/YYYY/MM/DD/export_id.format
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
        });
    });
    describe('ライフサイクルポリシー', () => {
        it('auto-deleteタグが設定される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFLSCxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDOUQsT0FBTztRQUNMLEdBQUcsWUFBWTtRQUNmLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM1QyxJQUFJLEVBQUUsUUFBUTtTQUNmLENBQUMsQ0FBQztLQUNKLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdkMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxhQUFhO0NBQ3ZELENBQUMsQ0FBQyxDQUFDO0FBaEJKLHNCQUFzQjtBQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFpQjNCLGtEQUE2QztBQUk3QyxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixNQUFNLGVBQWUsR0FBaUI7UUFDcEM7WUFDRSxhQUFhLEVBQUUsbUJBQW1CO1lBQ2xDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLFlBQVksRUFBRSxTQUFTO1lBQ3ZCLGVBQWUsRUFBRSxNQUFNO1lBQ3ZCLEtBQUssRUFBRSxvQkFBb0I7WUFDM0IsWUFBWSxFQUFFLHNCQUFzQjtZQUNwQyxPQUFPLEVBQUUsK0NB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QUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRXhwb3J0IHRvIFMzIFVuaXQgVGVzdHNcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7YxNC4x77yI44Om44OL44OD44OI44OG44K544OI77yJXHJcbiAqL1xyXG5cclxuLy8g44Oi44OD44Kv6Kit5a6a77yIaW1wb3J044KI44KK5YmN44Gr5a6a576p77yJXHJcbmNvbnN0IG1vY2tTZW5kID0gamVzdC5mbigpO1xyXG5cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnLCAoKSA9PiB7XHJcbiAgY29uc3QgYWN0dWFsTW9kdWxlID0gamVzdC5yZXF1aXJlQWN0dWFsKCdAYXdzLXNkay9jbGllbnQtczMnKTtcclxuICByZXR1cm4ge1xyXG4gICAgLi4uYWN0dWFsTW9kdWxlLFxyXG4gICAgUzNDbGllbnQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgc2VuZDogbW9ja1NlbmQsXHJcbiAgICB9KSksXHJcbiAgfTtcclxufSk7XHJcblxyXG5qZXN0Lm1vY2soJy4uLy4uLy4uL3V0aWxzL2xvZ2dlcicpO1xyXG5qZXN0Lm1vY2soJy4uLy4uLy4uL3V0aWxzL3JldHJ5JywgKCkgPT4gKHtcclxuICByZXRyeVdpdGhCYWNrb2ZmOiBqZXN0LmZuKChmbikgPT4gZm4oKSksIC8vIHJldHJ544KS44OQ44Kk44OR44K5XHJcbn0pKTtcclxuXHJcbmltcG9ydCB7IGV4cG9ydFRvUzMgfSBmcm9tICcuLi9leHBvcnQtdG8tczMnO1xyXG5pbXBvcnQgeyBEaXNjbG9zdXJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBQdXRPYmplY3RDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcclxuXHJcbmRlc2NyaWJlKCdleHBvcnRUb1MzJywgKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tEaXNjbG9zdXJlczogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAge1xyXG4gICAgICBkaXNjbG9zdXJlX2lkOiAnMjAyNDAxMTVfMTIzNF8wMDEnLFxyXG4gICAgICBjb21wYW55X2NvZGU6ICcxMjM0JyxcclxuICAgICAgY29tcGFueV9uYW1lOiAn44OG44K544OI5qCq5byP5Lya56S+JyxcclxuICAgICAgZGlzY2xvc3VyZV90eXBlOiAn5rG6566X55+t5L+hJyxcclxuICAgICAgdGl0bGU6ICcyMDI05bm0M+aciOacnyDnrKwz5Zub5Y2K5pyf5rG6566X55+t5L+hJyxcclxuICAgICAgZGlzY2xvc2VkX2F0OiAnMjAyNC0wMS0xNVQxMDozMDowMFonLFxyXG4gICAgICBwZGZfdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfMTIzNF8wMDEucGRmJyxcclxuICAgICAgczNfa2V5OiAncGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgIGNvbGxlY3RlZF9hdDogJzIwMjQtMDEtMTVUMTA6MzU6MDBaJyxcclxuICAgICAgZGF0ZV9wYXJ0aXRpb246ICcyMDI0LTAxJyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGRpc2Nsb3N1cmVfaWQ6ICcyMDI0MDExNV81Njc4XzAwMScsXHJcbiAgICAgIGNvbXBhbnlfY29kZTogJzU2NzgnLFxyXG4gICAgICBjb21wYW55X25hbWU6ICfjgrXjg7Pjg5fjg6vmoKrlvI/kvJrnpL4nLFxyXG4gICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmnInkvqHoqLzliLjloLHlkYrmm7gnLFxyXG4gICAgICB0aXRsZTogJ+esrDUw5pyf5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JyxcclxuICAgICAgZGlzY2xvc2VkX2F0OiAnMjAyNC0wMS0xNVQxMTowMDowMFonLFxyXG4gICAgICBwZGZfdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfNTY3OF8wMDEucGRmJyxcclxuICAgICAgczNfa2V5OiAncGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzU2NzhfMDAxLnBkZicsXHJcbiAgICAgIGNvbGxlY3RlZF9hdDogJzIwMjQtMDEtMTVUMTE6MDU6MDBaJyxcclxuICAgICAgZGF0ZV9wYXJ0aXRpb246ICcyMDI0LTAxJyxcclxuICAgIH0sXHJcbiAgXTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIG1vY2tTZW5kLm1vY2tDbGVhcigpO1xyXG4gICAgbW9ja1NlbmQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAkbWV0YWRhdGE6IHsgaHR0cFN0YXR1c0NvZGU6IDIwMCB9LFxyXG4gICAgICBFVGFnOiAnXCJtb2NrLWV0YWdcIicsXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcHJvY2Vzcy5lbnYuRVhQT1JUX0JVQ0tFVF9OQU1FID0gJ3Rlc3QtZXhwb3J0cy1idWNrZXQnO1xyXG4gICAgcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiA9ICdhcC1ub3J0aGVhc3QtMSc7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdKU09O5b2i5byP44Gu44Ko44Kv44K544Od44O844OIJywgKCkgPT4ge1xyXG4gICAgaXQoJ0pTT07lvaLlvI/jgadTM+OBq+OCqOOCr+OCueODneODvOODiOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHMzX2tleSkudG9NYXRjaCgvXmV4cG9ydHNcXC9cXGR7NH1cXC9cXGR7Mn1cXC9cXGR7Mn1cXC9leHBvcnRfXFxkK19bYS16MC05XStfW2EtejAtOV0rXFwuanNvbiQvKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrU2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tTZW5kLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuQnVja2V0KS50b0JlKCd0ZXN0LWV4cG9ydHMtYnVja2V0Jyk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LktleSkudG9CZShzM19rZXkpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5Db250ZW50VHlwZSkudG9CZSgnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5UYWdnaW5nKS50b0JlKCdhdXRvLWRlbGV0ZT10cnVlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnSlNPTuOBq+S7tuaVsOOBqOODh+ODvOOCv+OBjOWQq+OBvuOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tTZW5kLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgY29uc3QgYm9keSA9IGNvbW1hbmQuaW5wdXQuQm9keSBhcyBzdHJpbmc7XHJcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoYm9keSk7XHJcblxyXG4gICAgICBleHBlY3QocGFyc2VkKS50b0hhdmVQcm9wZXJ0eSgnY291bnQnLCAyKTtcclxuICAgICAgZXhwZWN0KHBhcnNlZCkudG9IYXZlUHJvcGVydHkoJ2Rpc2Nsb3N1cmVzJyk7XHJcbiAgICAgIGV4cGVjdChwYXJzZWQuZGlzY2xvc3VyZXMpLnRvSGF2ZUxlbmd0aCgyKTtcclxuICAgICAgZXhwZWN0KHBhcnNlZC5kaXNjbG9zdXJlc1swXSkudG9FcXVhbChtb2NrRGlzY2xvc3VyZXNbMF0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDU1blvaLlvI/jga7jgqjjgq/jgrnjg53jg7zjg4gnLCAoKSA9PiB7XHJcbiAgICBpdCgnQ1NW5b2i5byP44GnUzPjgavjgqjjgq/jgrnjg53jg7zjg4jjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2RlZjQ1Nl84NzY1NDMyMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHMzX2tleSkudG9NYXRjaCgvXmV4cG9ydHNcXC9cXGR7NH1cXC9cXGR7Mn1cXC9cXGR7Mn1cXC9leHBvcnRfXFxkK19bYS16MC05XStfW2EtejAtOV0rXFwuY3N2JC8pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tTZW5kLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuQnVja2V0KS50b0JlKCd0ZXN0LWV4cG9ydHMtYnVja2V0Jyk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LktleSkudG9CZShzM19rZXkpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5Db250ZW50VHlwZSkudG9CZSgndGV4dC9jc3YnKTtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuVGFnZ2luZykudG9CZSgnYXV0by1kZWxldGU9dHJ1ZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0NTVuODmOODg+ODgOODvOOBjOato+OBl+OBj+WHuuWKm+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1swXSkudG9CZShcclxuICAgICAgICAnZGlzY2xvc3VyZV9pZCxjb21wYW55X2NvZGUsY29tcGFueV9uYW1lLGRpc2Nsb3N1cmVfdHlwZSx0aXRsZSxkaXNjbG9zZWRfYXQscGRmX3VybCxzM19rZXksY29sbGVjdGVkX2F0LGRhdGVfcGFydGl0aW9uJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0NTVuODh+ODvOOCv+ihjOOBjOato+OBl+OBj+WHuuWKm+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9CZShcclxuICAgICAgICAnMjAyNDAxMTVfMTIzNF8wMDEsMTIzNCzjg4bjgrnjg4jmoKrlvI/kvJrnpL4s5rG6566X55+t5L+hLDIwMjTlubQz5pyI5pyfIOesrDPlm5vljYrmnJ/msbrnrpfnn63kv6EsMjAyNC0wMS0xNVQxMDozMDowMFosaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfMTIzNF8wMDEucGRmLHBkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV8xMjM0XzAwMS5wZGYsMjAyNC0wMS0xNVQxMDozNTowMFosMjAyNC0wMSdcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KGxpbmVzWzJdKS50b0JlKFxyXG4gICAgICAgICcyMDI0MDExNV81Njc4XzAwMSw1Njc4LOOCteODs+ODl+ODq+agquW8j+S8muekvizmnInkvqHoqLzliLjloLHlkYrmm7gs56ysNTDmnJ/mnInkvqHoqLzliLjloLHlkYrmm7gsMjAyNC0wMS0xNVQxMTowMDowMFosaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfNTY3OF8wMDEucGRmLHBkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV81Njc4XzAwMS5wZGYsMjAyNC0wMS0xNVQxMTowNTowMFosMjAyNC0wMSdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgqvjg7Pjg57jgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoQ29tbWE6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5tb2NrRGlzY2xvc3VyZXNbMF0sXHJcbiAgICAgICAgICB0aXRsZTogJ+OCv+OCpOODiOODqywg44Kr44Oz44Oe5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZ2hpNzg5XzExMTExMTExJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aENvbW1hLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgZXhwZWN0KGxpbmVzWzFdKS50b0NvbnRhaW4oJ1wi44K/44Kk44OI44OrLCDjgqvjg7Pjg57lkKvjgoBcIicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+ODgOODluODq+OCr+OCqeODvOODiOOCkuWQq+OCgOWApOOBjOato+OBl+OBj+OCqOOCueOCseODvOODl+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlc1dpdGhRdW90ZTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrXCLlvJXnlKjnrKZcIuWQq+OCgCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2prbDAxMl8yMjIyMjIyMic7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBkaXNjbG9zdXJlc1dpdGhRdW90ZSwgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODq1wiXCLlvJXnlKjnrKZcIlwi5ZCr44KAXCInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmlLnooYzjgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoTmV3bGluZTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrXFxu5pS56KGM5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfbW5vMzQ1XzMzMzMzMzMzJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aE5ld2xpbmUsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tTZW5kLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgY29uc3QgYm9keSA9IGNvbW1hbmQuaW5wdXQuQm9keSBhcyBzdHJpbmc7XHJcblxyXG4gICAgICAvLyDmlLnooYzjgpLlkKvjgoDlgKTjga/jg4Djg5bjg6vjgq/jgqnjg7zjg4jjgaflm7Ljgb7jgozjgotcclxuICAgICAgZXhwZWN0KGJvZHkpLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6tcXG7mlLnooYzlkKvjgoBcIicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTM+OCreODvOeUn+aIkCcsICgpID0+IHtcclxuICAgIGl0KCdTM+OCreODvOOBjOato+OBl+OBhOODleOCqeODvOODnuODg+ODiOOBp+eUn+aIkOOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgLy8g44OV44Kp44O844Oe44OD44OIOiBleHBvcnRzL1lZWVkvTU0vREQvZXhwb3J0X2lkLmZvcm1hdFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfjg6njgqTjg5XjgrXjgqTjgq/jg6vjg53jg6rjgrfjg7wnLCAoKSA9PiB7XHJcbiAgICBpdCgnYXV0by1kZWxldGXjgr/jgrDjgYzoqK3lrprjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2FiYzEyM18xMjM0NTY3OCc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdqc29uJztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9