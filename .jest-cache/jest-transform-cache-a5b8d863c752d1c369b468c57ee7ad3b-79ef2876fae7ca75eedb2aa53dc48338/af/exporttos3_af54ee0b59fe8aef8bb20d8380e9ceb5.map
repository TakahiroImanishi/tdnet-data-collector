{"version":3,"names":["cov_1vn32myjbx","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","file","mappings","names","sources","sourcesContent","version","_coverageSchema","coverage","actualCoverage","exports","exportToS3","client_s3_1","require","logger_1","retry_1","s3Client","S3Client","region","process","env","AWS_REGION","EXPORT_BUCKET","EXPORT_BUCKET_NAME","export_id","disclosures","format","logger","info","count","length","s3_key","generateS3Key","content","toJSON","toCSV","retryWithBackoff","send","PutObjectCommand","Bucket","Key","Body","ContentType","Tagging","maxRetries","initialDelay","backoffMultiplier","jitter","size_bytes","Buffer","byteLength","now","Date","year","getUTCFullYear","month","String","getUTCMonth","padStart","day","getUTCDate","JSON","stringify","headers","headerRow","join","dataRows","map","disclosure","header","value","escapeCSVValue","includes","escaped","replace"],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\export-to-s3.ts"],"sourcesContent":["/**\r\n * S3エクスポート\r\n *\r\n * JSON/CSV形式でS3に保存します。大量データ対応（ストリーム処理）。\r\n *\r\n * Requirements: 要件5.2（エクスポート形式）\r\n */\r\n\r\nimport { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\r\nimport { logger } from '../../utils/logger';\r\nimport { retryWithBackoff } from '../../utils/retry';\r\nimport { Disclosure } from '../../types';\r\n\r\n// S3クライアント（グローバルスコープで初期化）\r\nconst s3Client = new S3Client({ region: process.env.AWS_REGION || 'ap-northeast-1' });\r\n\r\n// 環境変数\r\nconst EXPORT_BUCKET = process.env.EXPORT_BUCKET_NAME || 'tdnet-exports';\r\n\r\n/**\r\n * S3にエクスポート\r\n *\r\n * @param export_id エクスポートID\r\n * @param disclosures 開示情報のリスト\r\n * @param format フォーマット（json, csv）\r\n * @returns S3キー\r\n */\r\nexport async function exportToS3(\r\n  export_id: string,\r\n  disclosures: Disclosure[],\r\n  format: 'json' | 'csv'\r\n): Promise<string> {\r\n  logger.info('Exporting to S3', {\r\n    export_id,\r\n    format,\r\n    count: disclosures.length,\r\n  });\r\n\r\n  // S3キーを生成\r\n  const s3_key = generateS3Key(export_id, format);\r\n\r\n  // フォーマットに応じて変換\r\n  const content = format === 'json' ? toJSON(disclosures) : toCSV(disclosures);\r\n\r\n  // S3にアップロード\r\n  await retryWithBackoff(\r\n    async () => {\r\n      await s3Client.send(\r\n        new PutObjectCommand({\r\n          Bucket: EXPORT_BUCKET,\r\n          Key: s3_key,\r\n          Body: content,\r\n          ContentType: format === 'json' ? 'application/json' : 'text/csv',\r\n          // ライフサイクルポリシーで7日後に自動削除されるようにタグを設定\r\n          Tagging: 'auto-delete=true',\r\n        })\r\n      );\r\n    },\r\n    {\r\n      maxRetries: 3,\r\n      initialDelay: 2000,\r\n      backoffMultiplier: 2,\r\n      jitter: true,\r\n    }\r\n  );\r\n\r\n  logger.info('Exported to S3 successfully', {\r\n    export_id,\r\n    s3_key,\r\n    size_bytes: Buffer.byteLength(content, 'utf8'),\r\n  });\r\n\r\n  return s3_key;\r\n}\r\n\r\n/**\r\n * S3キーを生成\r\n *\r\n * フォーマット: exports/YYYY/MM/DD/export_id.format\r\n * 例: exports/2024/01/15/export_1705305600000_abc123_12345678.json\r\n *\r\n * @param export_id エクスポートID\r\n * @param format フォーマット（json, csv）\r\n * @returns S3キー\r\n */\r\nfunction generateS3Key(export_id: string, format: 'json' | 'csv'): string {\r\n  const now = new Date();\r\n  const year = now.getUTCFullYear();\r\n  const month = String(now.getUTCMonth() + 1).padStart(2, '0');\r\n  const day = String(now.getUTCDate()).padStart(2, '0');\r\n\r\n  return `exports/${year}/${month}/${day}/${export_id}.${format}`;\r\n}\r\n\r\n/**\r\n * JSON形式に変換\r\n *\r\n * @param disclosures 開示情報のリスト\r\n * @returns JSON文字列\r\n */\r\nfunction toJSON(disclosures: Disclosure[]): string {\r\n  return JSON.stringify(\r\n    {\r\n      count: disclosures.length,\r\n      disclosures,\r\n    },\r\n    null,\r\n    2\r\n  );\r\n}\r\n\r\n/**\r\n * CSV形式に変換\r\n *\r\n * @param disclosures 開示情報のリスト\r\n * @returns CSV文字列\r\n */\r\nfunction toCSV(disclosures: Disclosure[]): string {\r\n  // CSVヘッダー\r\n  const headers = [\r\n    'disclosure_id',\r\n    'company_code',\r\n    'company_name',\r\n    'disclosure_type',\r\n    'title',\r\n    'disclosed_at',\r\n    'pdf_url',\r\n    's3_key',\r\n    'collected_at',\r\n    'date_partition',\r\n  ];\r\n\r\n  // CSVヘッダー行\r\n  const headerRow = headers.join(',');\r\n\r\n  // CSVデータ行\r\n  const dataRows = disclosures.map((disclosure) => {\r\n    return headers\r\n      .map((header) => {\r\n        const value = disclosure[header as keyof Disclosure];\r\n        // カンマやダブルクォートを含む場合はエスケープ\r\n        return escapeCSVValue(String(value));\r\n      })\r\n      .join(',');\r\n  });\r\n\r\n  // ヘッダー + データ行\r\n  return [headerRow, ...dataRows].join('\\n');\r\n}\r\n\r\n/**\r\n * CSV値をエスケープ\r\n *\r\n * カンマ、ダブルクォート、改行を含む場合はダブルクォートで囲み、\r\n * ダブルクォートは2つ重ねてエスケープします。\r\n *\r\n * @param value 値\r\n * @returns エスケープ後の値\r\n */\r\nfunction escapeCSVValue(value: string): string {\r\n  // カンマ、ダブルクォート、改行を含む場合はエスケープが必要\r\n  if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\r\n    // ダブルクォートを2つ重ねてエスケープ\r\n    const escaped = value.replace(/\"/g, '\"\"');\r\n    return `\"${escaped}\"`;\r\n  }\r\n  return value;\r\n}\r\n"],"mappings":";;AAAA;;;;;;;AAAA;AAAA,SAAAA,eAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,MAAA,OAAAC,QAAA;EAAA,IAAAC,GAAA;EAAA,IAAAC,YAAA;IAAAL,IAAA;IAAAM,YAAA;MAAA;QAAAC,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;U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","ignoreList":[]}