f82e6114076165fd6ae149c9f7d2aa68
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const assertions_1 = require("aws-cdk-lib/assertions");
const cloudwatch_alarms_1 = require("../lib/constructs/cloudwatch-alarms");
describe('CloudWatchAlarms Construct', () => {
    let stack;
    let testLambdaFunction;
    beforeEach(() => {
        const app = new cdk.App();
        stack = new cdk.Stack(app, 'TestStack');
        // テスト用のLambda関数を作成
        testLambdaFunction = new lambda.Function(stack, 'TestFunction', {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: 'index.handler',
            code: lambda.Code.fromInline('exports.handler = async () => ({ statusCode: 200 });'),
            functionName: 'test-function',
        });
    });
    test('SNS Topicが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.resourceCountIs('AWS::SNS::Topic', 1);
        template.hasResourceProperties('AWS::SNS::Topic', {
            DisplayName: 'TDnet Data Collector Alerts (test)',
            TopicName: 'tdnet-alerts-test',
        });
    });
    test('メール通知が設定されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            alertEmail: 'test@example.com',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.resourceCountIs('AWS::SNS::Subscription', 1);
        template.hasResourceProperties('AWS::SNS::Subscription', {
            Protocol: 'email',
            Endpoint: 'test@example.com',
        });
    });
    test('Lambda Error Rateアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            errorRateThreshold: 10,
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // Error Rateアラームが存在することを確認（AlarmNameとAlarmDescriptionはトークンなのでMatch.anyValue()を使用）
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(), // トークンを含むため
            AlarmDescription: assertions_1.Match.anyValue(), // トークンを含むため
            ComparisonOperator: 'GreaterThanThreshold',
            Threshold: 10,
            EvaluationPeriods: 1,
            TreatMissingData: 'notBreaching',
        });
    });
    test('Lambda Durationアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            durationThreshold: 840, // 14分 = 840秒
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // Durationアラームが存在することを確認（AlarmNameとAlarmDescriptionはトークンなのでMatch.anyValue()を使用）
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(), // トークンを含むため
            AlarmDescription: assertions_1.Match.anyValue(), // トークンを含むため
            ComparisonOperator: 'GreaterThanThreshold',
            Threshold: 840000, // ミリ秒
            EvaluationPeriods: 2,
            TreatMissingData: 'notBreaching',
        });
    });
    test('Lambda Throttlesアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // Throttlesアラームが存在することを確認（AlarmNameとAlarmDescriptionはトークンなのでMatch.anyValue()を使用）
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(), // トークンを含むため
            AlarmDescription: assertions_1.Match.anyValue(), // トークンを含むため
            ComparisonOperator: 'GreaterThanOrEqualToThreshold',
            Threshold: 1,
            EvaluationPeriods: 1,
            TreatMissingData: 'notBreaching',
        });
    });
    test('CollectionSuccessRateアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            collectionSuccessRateThreshold: 95,
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // CollectionSuccessRateアラームが存在することを確認
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: 'tdnet-collection-success-rate-test',
            AlarmDescription: '収集成功率が 95% を下回りました',
            ComparisonOperator: 'LessThanThreshold',
            Threshold: 95,
            EvaluationPeriods: 1,
            TreatMissingData: 'notBreaching',
        });
    });
    test('NoDataCollectedアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // NoDataCollectedアラームが存在することを確認
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: 'tdnet-no-data-collected-test',
            AlarmDescription: '24時間データ収集がありません',
            ComparisonOperator: 'LessThanThreshold',
            Threshold: 1,
            EvaluationPeriods: 1,
            TreatMissingData: 'breaching',
        });
    });
    test('CollectionFailureアラームが作成されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // CollectionFailureアラームが存在することを確認
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: 'tdnet-collection-failures-test',
            AlarmDescription: '24時間で10件以上の収集失敗が発生しました',
            ComparisonOperator: 'GreaterThanThreshold',
            Threshold: 10,
            EvaluationPeriods: 1,
            TreatMissingData: 'notBreaching',
        });
    });
    test('複数のLambda関数に対してアラームが作成されること', () => {
        // Arrange
        const testLambdaFunction2 = new lambda.Function(stack, 'TestFunction2', {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: 'index.handler',
            code: lambda.Code.fromInline('exports.handler = async () => ({ statusCode: 200 });'),
            functionName: 'test-function-2',
        });
        // Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction, testLambdaFunction2],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // 各Lambda関数に対して3つのアラーム（Error Rate, Duration, Throttles）が作成される
        // + カスタムメトリクスアラーム3つ（CollectionSuccessRate, NoData, CollectionFailure）
        // = 2 * 3 + 3 = 9個のアラーム
        template.resourceCountIs('AWS::CloudWatch::Alarm', 9);
    });
    test('すべてのアラームにSNSアクションが設定されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // すべてのアラームにAlarmActionsが設定されていることを確認
        const alarms = template.findResources('AWS::CloudWatch::Alarm');
        const alarmKeys = Object.keys(alarms);
        expect(alarmKeys.length).toBeGreaterThan(0);
        alarmKeys.forEach((key) => {
            const alarm = alarms[key];
            expect(alarm.Properties.AlarmActions).toBeDefined();
            expect(alarm.Properties.AlarmActions.length).toBeGreaterThan(0);
        });
    });
    test('デフォルト閾値が正しく設定されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            // 閾値を指定しない（デフォルト値を使用）
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // Error Rate: 10% (AlarmNameはトークンなのでMatch.anyValue()を使用)
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(),
            Threshold: 10,
            ComparisonOperator: 'GreaterThanThreshold',
            EvaluationPeriods: 1,
        });
        // Duration: 840秒 = 840000ミリ秒 (AlarmNameはトークンなのでMatch.anyValue()を使用)
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(),
            Threshold: 840000,
            ComparisonOperator: 'GreaterThanThreshold',
            EvaluationPeriods: 2,
        });
        // CollectionSuccessRate: 95%
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: 'tdnet-collection-success-rate-test',
            Threshold: 95,
        });
    });
    test('カスタム閾値が正しく設定されること', () => {
        // Arrange & Act
        new cloudwatch_alarms_1.CloudWatchAlarms(stack, 'TestAlarms', {
            lambdaFunctions: [testLambdaFunction],
            environment: 'test',
            errorRateThreshold: 5, // カスタム: 5%
            durationThreshold: 600, // カスタム: 10分 = 600秒
            collectionSuccessRateThreshold: 90, // カスタム: 90%
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // Error Rate: 5% (AlarmNameはトークンなのでMatch.anyValue()を使用)
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(),
            Threshold: 5,
            ComparisonOperator: 'GreaterThanThreshold',
            EvaluationPeriods: 1,
        });
        // Duration: 600秒 = 600000ミリ秒 (AlarmNameはトークンなのでMatch.anyValue()を使用)
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: assertions_1.Match.anyValue(),
            Threshold: 600000,
            ComparisonOperator: 'GreaterThanThreshold',
            EvaluationPeriods: 2,
        });
        // CollectionSuccessRate: 90%
        template.hasResourceProperties('AWS::CloudWatch::Alarm', {
            AlarmName: 'tdnet-collection-success-rate-test',
            Threshold: 90,
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGNsb3Vkd2F0Y2gtYWxhcm1zLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMsK0RBQWlEO0FBQ2pELHVEQUF5RDtBQUN6RCwyRUFBdUU7QUFFdkUsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUMxQyxJQUFJLEtBQWdCLENBQUM7SUFDckIsSUFBSSxrQkFBbUMsQ0FBQztJQUV4QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDMUIsS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFeEMsbUJBQW1CO1FBQ25CLGtCQUFrQixHQUFHLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFO1lBQzlELE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7WUFDbkMsT0FBTyxFQUFFLGVBQWU7WUFDeEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLHNEQUFzRCxDQUFDO1lBQ3BGLFlBQVksRUFBRSxlQUFlO1NBQzlCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUM3QixnQkFBZ0I7UUFDaEIsSUFBSSxvQ0FBZ0IsQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFO1lBQ3hDLGVBQWUsRUFBRSxDQUFDLGtCQUFrQixDQUFDO1lBQ3JDLFdBQVcsRUFBRSxNQUFNO1NBQ3BCLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FB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QXFCLENBQUMsd0JBQXdCLEVBQUU7WUFDdkQsU0FBUyxFQUFFLG9DQUFvQztZQUMvQyxTQUFTLEVBQUUsRUFBRTtTQUNkLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGNsb3Vkd2F0Y2gtYWxhcm1zLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgeyBUZW1wbGF0ZSwgTWF0Y2ggfSBmcm9tICdhd3MtY2RrLWxpYi9hc3NlcnRpb25zJztcclxuaW1wb3J0IHsgQ2xvdWRXYXRjaEFsYXJtcyB9IGZyb20gJy4uL2xpYi9jb25zdHJ1Y3RzL2Nsb3Vkd2F0Y2gtYWxhcm1zJztcclxuXHJcbmRlc2NyaWJlKCdDbG91ZFdhdGNoQWxhcm1zIENvbnN0cnVjdCcsICgpID0+IHtcclxuICBsZXQgc3RhY2s6IGNkay5TdGFjaztcclxuICBsZXQgdGVzdExhbWJkYUZ1bmN0aW9uOiBsYW1iZGEuRnVuY3Rpb247XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcclxuICAgIHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdUZXN0U3RhY2snKTtcclxuXHJcbiAgICAvLyDjg4bjgrnjg4jnlKjjga5MYW1iZGHplqLmlbDjgpLkvZzmiJBcclxuICAgIHRlc3RMYW1iZGFGdW5jdGlvbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24oc3RhY2ssICdUZXN0RnVuY3Rpb24nLCB7XHJcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21JbmxpbmUoJ2V4cG9ydHMuaGFuZGxlciA9IGFzeW5jICgpID0+ICh7IHN0YXR1c0NvZGU6IDIwMCB9KTsnKSxcclxuICAgICAgZnVuY3Rpb25OYW1lOiAndGVzdC1mdW5jdGlvbicsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnU05TIFRvcGlj44GM5L2c5oiQ44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcbiAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6U05TOjpUb3BpYycsIDEpO1xyXG5cclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTTlM6OlRvcGljJywge1xyXG4gICAgICBEaXNwbGF5TmFtZTogJ1REbmV0IERhdGEgQ29sbGVjdG9yIEFsZXJ0cyAodGVzdCknLFxyXG4gICAgICBUb3BpY05hbWU6ICd0ZG5ldC1hbGVydHMtdGVzdCcsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgn44Oh44O844Or6YCa55+l44GM6Kit5a6a44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgICBhbGVydEVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpTTlM6OlN1YnNjcmlwdGlvbicsIDEpO1xyXG5cclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTTlM6OlN1YnNjcmlwdGlvbicsIHtcclxuICAgICAgUHJvdG9jb2w6ICdlbWFpbCcsXHJcbiAgICAgIEVuZHBvaW50OiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnTGFtYmRhIEVycm9yIFJhdGXjgqLjg6njg7zjg6DjgYzkvZzmiJDjgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgQ2xvdWRXYXRjaEFsYXJtcyhzdGFjaywgJ1Rlc3RBbGFybXMnLCB7XHJcbiAgICAgIGxhbWJkYUZ1bmN0aW9uczogW3Rlc3RMYW1iZGFGdW5jdGlvbl0sXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICAgIGVycm9yUmF0ZVRocmVzaG9sZDogMTAsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuXHJcbiAgICAvLyBFcnJvciBSYXRl44Ki44Op44O844Og44GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqN77yIQWxhcm1OYW1l44GoQWxhcm1EZXNjcmlwdGlvbuOBr+ODiOODvOOCr+ODs+OBquOBruOBp01hdGNoLmFueVZhbHVlKCnjgpLkvb/nlKjvvIlcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIHtcclxuICAgICAgQWxhcm1OYW1lOiBNYXRjaC5hbnlWYWx1ZSgpLCAvLyDjg4jjg7zjgq/jg7PjgpLlkKvjgoDjgZ/jgoFcclxuICAgICAgQWxhcm1EZXNjcmlwdGlvbjogTWF0Y2guYW55VmFsdWUoKSwgLy8g44OI44O844Kv44Oz44KS5ZCr44KA44Gf44KBXHJcbiAgICAgIENvbXBhcmlzb25PcGVyYXRvcjogJ0dyZWF0ZXJUaGFuVGhyZXNob2xkJyxcclxuICAgICAgVGhyZXNob2xkOiAxMCxcclxuICAgICAgRXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgIFRyZWF0TWlzc2luZ0RhdGE6ICdub3RCcmVhY2hpbmcnLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ0xhbWJkYSBEdXJhdGlvbuOCouODqeODvOODoOOBjOS9nOaIkOOBleOCjOOCi+OBk+OBqCcsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBDbG91ZFdhdGNoQWxhcm1zKHN0YWNrLCAnVGVzdEFsYXJtcycsIHtcclxuICAgICAgbGFtYmRhRnVuY3Rpb25zOiBbdGVzdExhbWJkYUZ1bmN0aW9uXSxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgICAgZHVyYXRpb25UaHJlc2hvbGQ6IDg0MCwgLy8gMTTliIYgPSA4NDDnp5JcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgIC8vIER1cmF0aW9u44Ki44Op44O844Og44GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqN77yIQWxhcm1OYW1l44GoQWxhcm1EZXNjcmlwdGlvbuOBr+ODiOODvOOCr+ODs+OBquOBruOBp01hdGNoLmFueVZhbHVlKCnjgpLkvb/nlKjvvIlcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIHtcclxuICAgICAgQWxhcm1OYW1lOiBNYXRjaC5hbnlWYWx1ZSgpLCAvLyDjg4jjg7zjgq/jg7PjgpLlkKvjgoDjgZ/jgoFcclxuICAgICAgQWxhcm1EZXNjcmlwdGlvbjogTWF0Y2guYW55VmFsdWUoKSwgLy8g44OI44O844Kv44Oz44KS5ZCr44KA44Gf44KBXHJcbiAgICAgIENvbXBhcmlzb25PcGVyYXRvcjogJ0dyZWF0ZXJUaGFuVGhyZXNob2xkJyxcclxuICAgICAgVGhyZXNob2xkOiA4NDAwMDAsIC8vIOODn+ODquenklxyXG4gICAgICBFdmFsdWF0aW9uUGVyaW9kczogMixcclxuICAgICAgVHJlYXRNaXNzaW5nRGF0YTogJ25vdEJyZWFjaGluZycsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnTGFtYmRhIFRocm90dGxlc+OCouODqeODvOODoOOBjOS9nOaIkOOBleOCjOOCi+OBk+OBqCcsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBDbG91ZFdhdGNoQWxhcm1zKHN0YWNrLCAnVGVzdEFsYXJtcycsIHtcclxuICAgICAgbGFtYmRhRnVuY3Rpb25zOiBbdGVzdExhbWJkYUZ1bmN0aW9uXSxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgIC8vIFRocm90dGxlc+OCouODqeODvOODoOOBjOWtmOWcqOOBmeOCi+OBk+OBqOOCkueiuuiqje+8iEFsYXJtTmFtZeOBqEFsYXJtRGVzY3JpcHRpb27jga/jg4jjg7zjgq/jg7Pjgarjga7jgadNYXRjaC5hbnlWYWx1ZSgp44KS5L2/55So77yJXHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRXYXRjaDo6QWxhcm0nLCB7XHJcbiAgICAgIEFsYXJtTmFtZTogTWF0Y2guYW55VmFsdWUoKSwgLy8g44OI44O844Kv44Oz44KS5ZCr44KA44Gf44KBXHJcbiAgICAgIEFsYXJtRGVzY3JpcHRpb246IE1hdGNoLmFueVZhbHVlKCksIC8vIOODiOODvOOCr+ODs+OCkuWQq+OCgOOBn+OCgVxyXG4gICAgICBDb21wYXJpc29uT3BlcmF0b3I6ICdHcmVhdGVyVGhhbk9yRXF1YWxUb1RocmVzaG9sZCcsXHJcbiAgICAgIFRocmVzaG9sZDogMSxcclxuICAgICAgRXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgIFRyZWF0TWlzc2luZ0RhdGE6ICdub3RCcmVhY2hpbmcnLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ0NvbGxlY3Rpb25TdWNjZXNzUmF0ZeOCouODqeODvOODoOOBjOS9nOaIkOOBleOCjOOCi+OBk+OBqCcsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBDbG91ZFdhdGNoQWxhcm1zKHN0YWNrLCAnVGVzdEFsYXJtcycsIHtcclxuICAgICAgbGFtYmRhRnVuY3Rpb25zOiBbdGVzdExhbWJkYUZ1bmN0aW9uXSxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgICAgY29sbGVjdGlvblN1Y2Nlc3NSYXRlVGhyZXNob2xkOiA5NSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgIC8vIENvbGxlY3Rpb25TdWNjZXNzUmF0ZeOCouODqeODvOODoOOBjOWtmOWcqOOBmeOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkV2F0Y2g6OkFsYXJtJywge1xyXG4gICAgICBBbGFybU5hbWU6ICd0ZG5ldC1jb2xsZWN0aW9uLXN1Y2Nlc3MtcmF0ZS10ZXN0JyxcclxuICAgICAgQWxhcm1EZXNjcmlwdGlvbjogJ+WPjumbhuaIkOWKn+eOh+OBjCA5NSUg44KS5LiL5Zue44KK44G+44GX44GfJyxcclxuICAgICAgQ29tcGFyaXNvbk9wZXJhdG9yOiAnTGVzc1RoYW5UaHJlc2hvbGQnLFxyXG4gICAgICBUaHJlc2hvbGQ6IDk1LFxyXG4gICAgICBFdmFsdWF0aW9uUGVyaW9kczogMSxcclxuICAgICAgVHJlYXRNaXNzaW5nRGF0YTogJ25vdEJyZWFjaGluZycsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnTm9EYXRhQ29sbGVjdGVk44Ki44Op44O844Og44GM5L2c5oiQ44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8gTm9EYXRhQ29sbGVjdGVk44Ki44Op44O844Og44GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqNXHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRXYXRjaDo6QWxhcm0nLCB7XHJcbiAgICAgIEFsYXJtTmFtZTogJ3RkbmV0LW5vLWRhdGEtY29sbGVjdGVkLXRlc3QnLFxyXG4gICAgICBBbGFybURlc2NyaXB0aW9uOiAnMjTmmYLplpPjg4fjg7zjgr/lj47pm4bjgYzjgYLjgorjgb7jgZvjgpMnLFxyXG4gICAgICBDb21wYXJpc29uT3BlcmF0b3I6ICdMZXNzVGhhblRocmVzaG9sZCcsXHJcbiAgICAgIFRocmVzaG9sZDogMSxcclxuICAgICAgRXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICAgIFRyZWF0TWlzc2luZ0RhdGE6ICdicmVhY2hpbmcnLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ0NvbGxlY3Rpb25GYWlsdXJl44Ki44Op44O844Og44GM5L2c5oiQ44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8gQ29sbGVjdGlvbkZhaWx1cmXjgqLjg6njg7zjg6DjgYzlrZjlnKjjgZnjgovjgZPjgajjgpLnorroqo1cclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIHtcclxuICAgICAgQWxhcm1OYW1lOiAndGRuZXQtY29sbGVjdGlvbi1mYWlsdXJlcy10ZXN0JyxcclxuICAgICAgQWxhcm1EZXNjcmlwdGlvbjogJzI05pmC6ZaT44GnMTDku7bku6XkuIrjga7lj47pm4blpLHmlZfjgYznmbrnlJ/jgZfjgb7jgZfjgZ8nLFxyXG4gICAgICBDb21wYXJpc29uT3BlcmF0b3I6ICdHcmVhdGVyVGhhblRocmVzaG9sZCcsXHJcbiAgICAgIFRocmVzaG9sZDogMTAsXHJcbiAgICAgIEV2YWx1YXRpb25QZXJpb2RzOiAxLFxyXG4gICAgICBUcmVhdE1pc3NpbmdEYXRhOiAnbm90QnJlYWNoaW5nJyxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfopIfmlbDjga5MYW1iZGHplqLmlbDjgavlr77jgZfjgabjgqLjg6njg7zjg6DjgYzkvZzmiJDjgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlXHJcbiAgICBjb25zdCB0ZXN0TGFtYmRhRnVuY3Rpb24yID0gbmV3IGxhbWJkYS5GdW5jdGlvbihzdGFjaywgJ1Rlc3RGdW5jdGlvbjInLCB7XHJcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21JbmxpbmUoJ2V4cG9ydHMuaGFuZGxlciA9IGFzeW5jICgpID0+ICh7IHN0YXR1c0NvZGU6IDIwMCB9KTsnKSxcclxuICAgICAgZnVuY3Rpb25OYW1lOiAndGVzdC1mdW5jdGlvbi0yJyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb24sIHRlc3RMYW1iZGFGdW5jdGlvbjJdLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8g5ZCETGFtYmRh6Zai5pWw44Gr5a++44GX44GmM+OBpOOBruOCouODqeODvOODoO+8iEVycm9yIFJhdGUsIER1cmF0aW9uLCBUaHJvdHRsZXPvvInjgYzkvZzmiJDjgZXjgozjgotcclxuICAgIC8vICsg44Kr44K544K/44Og44Oh44OI44Oq44Kv44K544Ki44Op44O844OgM+OBpO+8iENvbGxlY3Rpb25TdWNjZXNzUmF0ZSwgTm9EYXRhLCBDb2xsZWN0aW9uRmFpbHVyZe+8iVxyXG4gICAgLy8gPSAyICogMyArIDMgPSA55YCL44Gu44Ki44Op44O844OgXHJcbiAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6Q2xvdWRXYXRjaDo6QWxhcm0nLCA5KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgn44GZ44G544Gm44Gu44Ki44Op44O844Og44GrU05T44Ki44Kv44K344On44Oz44GM6Kit5a6a44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8g44GZ44G544Gm44Gu44Ki44Op44O844Og44GrQWxhcm1BY3Rpb25z44GM6Kit5a6a44GV44KM44Gm44GE44KL44GT44Go44KS56K66KqNXHJcbiAgICBjb25zdCBhbGFybXMgPSB0ZW1wbGF0ZS5maW5kUmVzb3VyY2VzKCdBV1M6OkNsb3VkV2F0Y2g6OkFsYXJtJyk7XHJcbiAgICBjb25zdCBhbGFybUtleXMgPSBPYmplY3Qua2V5cyhhbGFybXMpO1xyXG5cclxuICAgIGV4cGVjdChhbGFybUtleXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcblxyXG4gICAgYWxhcm1LZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICBjb25zdCBhbGFybSA9IGFsYXJtc1trZXldO1xyXG4gICAgICBleHBlY3QoYWxhcm0uUHJvcGVydGllcy5BbGFybUFjdGlvbnMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChhbGFybS5Qcm9wZXJ0aWVzLkFsYXJtQWN0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfjg4fjg5Xjgqnjg6vjg4jplr7lgKTjgYzmraPjgZfjgY/oqK3lrprjgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgQ2xvdWRXYXRjaEFsYXJtcyhzdGFjaywgJ1Rlc3RBbGFybXMnLCB7XHJcbiAgICAgIGxhbWJkYUZ1bmN0aW9uczogW3Rlc3RMYW1iZGFGdW5jdGlvbl0sXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICAgIC8vIOmWvuWApOOCkuaMh+WumuOBl+OBquOBhO+8iOODh+ODleOCqeODq+ODiOWApOOCkuS9v+eUqO+8iVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8gRXJyb3IgUmF0ZTogMTAlIChBbGFybU5hbWXjga/jg4jjg7zjgq/jg7Pjgarjga7jgadNYXRjaC5hbnlWYWx1ZSgp44KS5L2/55SoKVxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkV2F0Y2g6OkFsYXJtJywge1xyXG4gICAgICBBbGFybU5hbWU6IE1hdGNoLmFueVZhbHVlKCksXHJcbiAgICAgIFRocmVzaG9sZDogMTAsXHJcbiAgICAgIENvbXBhcmlzb25PcGVyYXRvcjogJ0dyZWF0ZXJUaGFuVGhyZXNob2xkJyxcclxuICAgICAgRXZhbHVhdGlvblBlcmlvZHM6IDEsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBEdXJhdGlvbjogODQw56eSID0gODQwMDAw44Of44Oq56eSIChBbGFybU5hbWXjga/jg4jjg7zjgq/jg7Pjgarjga7jgadNYXRjaC5hbnlWYWx1ZSgp44KS5L2/55SoKVxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkV2F0Y2g6OkFsYXJtJywge1xyXG4gICAgICBBbGFybU5hbWU6IE1hdGNoLmFueVZhbHVlKCksXHJcbiAgICAgIFRocmVzaG9sZDogODQwMDAwLFxyXG4gICAgICBDb21wYXJpc29uT3BlcmF0b3I6ICdHcmVhdGVyVGhhblRocmVzaG9sZCcsXHJcbiAgICAgIEV2YWx1YXRpb25QZXJpb2RzOiAyLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQ29sbGVjdGlvblN1Y2Nlc3NSYXRlOiA5NSVcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIHtcclxuICAgICAgQWxhcm1OYW1lOiAndGRuZXQtY29sbGVjdGlvbi1zdWNjZXNzLXJhdGUtdGVzdCcsXHJcbiAgICAgIFRocmVzaG9sZDogOTUsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgn44Kr44K544K/44Og6Za+5YCk44GM5q2j44GX44GP6Kit5a6a44GV44KM44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IENsb3VkV2F0Y2hBbGFybXMoc3RhY2ssICdUZXN0QWxhcm1zJywge1xyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IFt0ZXN0TGFtYmRhRnVuY3Rpb25dLFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgICBlcnJvclJhdGVUaHJlc2hvbGQ6IDUsIC8vIOOCq+OCueOCv+ODoDogNSVcclxuICAgICAgZHVyYXRpb25UaHJlc2hvbGQ6IDYwMCwgLy8g44Kr44K544K/44OgOiAxMOWIhiA9IDYwMOenklxyXG4gICAgICBjb2xsZWN0aW9uU3VjY2Vzc1JhdGVUaHJlc2hvbGQ6IDkwLCAvLyDjgqvjgrnjgr/jg6A6IDkwJVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8gRXJyb3IgUmF0ZTogNSUgKEFsYXJtTmFtZeOBr+ODiOODvOOCr+ODs+OBquOBruOBp01hdGNoLmFueVZhbHVlKCnjgpLkvb/nlKgpXHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRXYXRjaDo6QWxhcm0nLCB7XHJcbiAgICAgIEFsYXJtTmFtZTogTWF0Y2guYW55VmFsdWUoKSxcclxuICAgICAgVGhyZXNob2xkOiA1LFxyXG4gICAgICBDb21wYXJpc29uT3BlcmF0b3I6ICdHcmVhdGVyVGhhblRocmVzaG9sZCcsXHJcbiAgICAgIEV2YWx1YXRpb25QZXJpb2RzOiAxLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRHVyYXRpb246IDYwMOenkiA9IDYwMDAwMOODn+ODquenkiAoQWxhcm1OYW1l44Gv44OI44O844Kv44Oz44Gq44Gu44GnTWF0Y2guYW55VmFsdWUoKeOCkuS9v+eUqClcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIHtcclxuICAgICAgQWxhcm1OYW1lOiBNYXRjaC5hbnlWYWx1ZSgpLFxyXG4gICAgICBUaHJlc2hvbGQ6IDYwMDAwMCxcclxuICAgICAgQ29tcGFyaXNvbk9wZXJhdG9yOiAnR3JlYXRlclRoYW5UaHJlc2hvbGQnLFxyXG4gICAgICBFdmFsdWF0aW9uUGVyaW9kczogMixcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIENvbGxlY3Rpb25TdWNjZXNzUmF0ZTogOTAlXHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRXYXRjaDo6QWxhcm0nLCB7XHJcbiAgICAgIEFsYXJtTmFtZTogJ3RkbmV0LWNvbGxlY3Rpb24tc3VjY2Vzcy1yYXRlLXRlc3QnLFxyXG4gICAgICBUaHJlc2hvbGQ6IDkwLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=