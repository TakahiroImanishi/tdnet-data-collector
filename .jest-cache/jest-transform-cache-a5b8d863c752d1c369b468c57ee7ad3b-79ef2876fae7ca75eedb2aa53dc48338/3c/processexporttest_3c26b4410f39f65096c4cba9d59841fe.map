{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\process-export.test.ts","mappings":";AAAA;;;;GAIG;;AAEH,sBAAsB;AACtB,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;AAClC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAC7B,IAAI,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;AACrC,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;AACpC,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;AAEnC,sDAAkD;AAClD,4DAAwD;AACxD,kDAA6C;AAC7C,kEAA6D;AAC7D,gEAA2D;AAI3D,YAAY;AACZ,MAAM,oBAAoB,GAAG,oCAAgE,CAAC;AAC9F,MAAM,cAAc,GAAG,yBAAoD,CAAC;AAC5E,MAAM,sBAAsB,GAAG,yCAAoE,CAAC;AACpG,MAAM,qBAAqB,GAAG,uCAAkE,CAAC;AAEjG,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;IAC7B,MAAM,eAAe,GAAiB;QACpC;YACE,aAAa,EAAE,mBAAmB;YAClC,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,SAAS;YACvB,eAAe,EAAE,MAAM;YACvB,KAAK,EAAE,oBAAoB;YAC3B,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,+CAA+C;YACxD,MAAM,EAAE,uCAAuC;YAC/C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B;QACD;YACE,aAAa,EAAE,mBAAmB;YAClC,YAAY,EAAE,MAAM;YACpB,YAAY,EAAE,UAAU;YACxB,eAAe,EAAE,SAAS;YAC1B,KAAK,EAAE,aAAa;YACpB,YAAY,EAAE,sBAAsB;YACpC,OAAO,EAAE,+CAA+C;YACxD,MAAM,EAAE,uCAAuC;YAC/C,YAAY,EAAE,sBAAsB;YACpC,cAAc,EAAE,SAAS;SAC1B;KACF,CAAC;IAEF,UAAU,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,cAAc;QACd,oBAAoB,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;QACxD,cAAc,CAAC,iBAAiB,CAAC,8DAA8D,CAAC,CAAC;QACjG,sBAAsB,CAAC,iBAAiB,EAAE,CAAC;QAC3C,qBAAqB,CAAC,iBAAiB,CAAC,iDAAiD,CAAC,CAAC;IAC7F,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE;oBACN,UAAU,EAAE,YAAY;oBACxB,QAAQ,EAAE,YAAY;iBACvB;aACF,CAAC;YAEF,MAAM;YACN,MAAM,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAE5C,SAAS;YACT,WAAW;YACX,MAAM,CAAC,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAEtE,+BAA+B;YAC/B,MAAM,CAAC,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,sBAAsB,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACvF,MAAM,CAAC,sBAAsB,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACvF,MAAM,CAAC,sBAAsB,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YAEvF,gBAAgB;YAChB,MAAM,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,eAAe,EAAE,MAAM,CAAC,CAAC;YAEhF,uBAAuB;YACvB,MAAM,CAAC,qBAAqB,CAAC,CAAC,oBAAoB,CAChD,8DAA8D,EAC9D,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CACjB,CAAC;YAEF,qBAAqB;YACrB,MAAM,CAAC,sBAAsB,CAAC,CAAC,uBAAuB,CACpD,CAAC,EACD,SAAS,EACT,WAAW,EACX,GAAG,EACH,8DAA8D,EAC9D,iDAAiD,CAClD,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;YACtC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,KAAK;gBACb,MAAM,EAAE;oBACN,YAAY,EAAE,MAAM;iBACrB;aACF,CAAC;YAEF,cAAc,CAAC,iBAAiB,CAAC,6DAA6D,CAAC,CAAC;YAEhG,MAAM;YACN,MAAM,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAE5C,SAAS;YACT,MAAM,CAAC,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACtE,MAAM,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,eAAe,EAAE,KAAK,CAAC,CAAC;YAC/E,MAAM,CAAC,qBAAqB,CAAC,CAAC,oBAAoB,CAChD,6DAA6D,EAC7D,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CACjB,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;YAChC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM;YACN,MAAM,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAE5C,SAAS;YACT,MAAM,KAAK,GAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,CAAC;YAChD,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;gBACvB,SAAS;gBACT,WAAW;gBACX,GAAG;gBACH,8DAA8D;gBAC9D,iDAAiD;aAClD,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;YACvC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE;oBACN,YAAY,EAAE,MAAM;iBACrB;aACF,CAAC;YAEF,oBAAoB,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;YAC3C,cAAc,CAAC,iBAAiB,CAAC,8DAA8D,CAAC,CAAC;YAEjG,MAAM;YACN,MAAM,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAE5C,SAAS;YACT,MAAM,CAAC,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACtE,MAAM,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC;YACnE,MAAM,CAAC,sBAAsB,CAAC,CAAC,wBAAwB,CACrD,SAAS,EACT,WAAW,EACX,GAAG,EACH,8DAA8D,EAC9D,iDAAiD,CAClD,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qBAAqB,EAAE,KAAK,IAAI,EAAE;YACnC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,KAAK;gBACb,MAAM,EAAE;oBACN,UAAU,EAAE,YAAY;oBACxB,QAAQ,EAAE,YAAY;iBACvB;aACF,CAAC;YAEF,eAAe;YACf,MAAM,YAAY,GAAiB,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBACzE,aAAa,EAAE,YAAY,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM;gBAC3D,YAAY,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;gBACxC,YAAY,EAAE,KAAK,CAAC,EAAE;gBACtB,eAAe,EAAE,MAAM;gBACvB,KAAK,EAAE,OAAO,CAAC,EAAE;gBACjB,YAAY,EAAE,sBAAsB;gBACpC,OAAO,EAAE,2BAA2B,CAAC,MAAM;gBAC3C,MAAM,EAAE,mBAAmB,CAAC,MAAM;gBAClC,YAAY,EAAE,sBAAsB;gBACpC,cAAc,EAAE,SAAS;aAC1B,CAAC,CAAC,CAAC;YAEJ,oBAAoB,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;YACrD,cAAc,CAAC,iBAAiB,CAAC,6DAA6D,CAAC,CAAC;YAEhG,MAAM;YACN,MAAM,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAE5C,SAAS;YACT,MAAM,CAAC,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACtE,MAAM,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;YAC5E,MAAM,CAAC,sBAAsB,CAAC,CAAC,wBAAwB,CACrD,SAAS,EACT,WAAW,EACX,GAAG,EACH,6DAA6D,EAC7D,iDAAiD,CAClD,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,EAAE,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACnD,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;YAClE,KAAK,CAAC,IAAI,GAAG,wCAAwC,CAAC;YACtD,oBAAoB,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAE9C,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CACjE,wCAAwC,CACzC,CAAC;YAEF,yBAAyB;YACzB,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,wCAAwC,CACzC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YACzC,oBAAoB,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAE9C,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YAErF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,eAAe,CAChB,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,iBAAiB,EAAE,GAAG,EAAE;QAC/B,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACjD,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YAC/C,cAAc,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAExC,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;YAE3F,oCAAoC;YACpC,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACjF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACjF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,qBAAqB,CACtB,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,KAAK;gBACb,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YACzC,KAAK,CAAC,IAAI,GAAG,cAAc,CAAC;YAC5B,cAAc,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAExC,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YAErF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,eAAe,CAChB,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;YACzD,qBAAqB,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAE/C,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CACjE,+BAA+B,CAChC,CAAC;YAEF,yCAAyC;YACzC,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACjF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACjF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;YACjF,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,+BAA+B,CAChC,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,EAAE,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;YACjC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;YACtD,sBAAsB,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC,aAAa;YAElE,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CACjE,4BAA4B,CAC7B,CAAC;YAEF,oBAAoB;YACpB,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,0BAA0B,EAAE,KAAK,IAAI,EAAE;YACxC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;YACrD,oBAAoB,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAE9C,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CACjE,2BAA2B,CAC5B,CAAC;YAEF,oCAAoC;YACpC,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,2BAA2B,CAC5B,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YACzC,UAAU;YACV,MAAM,SAAS,GAAG,sCAAsC,CAAC;YACzD,MAAM,WAAW,GAAsB;gBACrC,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,EAAE;aACX,CAAC;YAEF,oBAAoB,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAEvD,eAAe;YACf,MAAM,MAAM,CAAC,IAAA,8BAAa,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAEjF,kCAAkC;YAClC,MAAM,CAAC,sBAAsB,CAAC,CAAC,oBAAoB,CACjD,SAAS,EACT,QAAQ,EACR,CAAC,EACD,SAAS,EACT,SAAS,EACT,cAAc,CACf,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\__tests__\\process-export.test.ts"],"sourcesContent":["/**\r\n * Process Export Unit Tests\r\n *\r\n * Requirements: 要件14.1（ユニットテスト）\r\n */\r\n\r\n// モック設定（importより前に定義）\r\njest.mock('../query-disclosures');\r\njest.mock('../export-to-s3');\r\njest.mock('../update-export-status');\r\njest.mock('../generate-signed-url');\r\njest.mock('../../../utils/logger');\r\n\r\nimport { processExport } from '../process-export';\r\nimport { queryDisclosures } from '../query-disclosures';\r\nimport { exportToS3 } from '../export-to-s3';\r\nimport { updateExportStatus } from '../update-export-status';\r\nimport { generateSignedUrl } from '../generate-signed-url';\r\nimport { Disclosure } from '../../../types';\r\nimport { ExportRequestBody } from '../types';\r\n\r\n// モック関数の型定義\r\nconst mockQueryDisclosures = queryDisclosures as jest.MockedFunction<typeof queryDisclosures>;\r\nconst mockExportToS3 = exportToS3 as jest.MockedFunction<typeof exportToS3>;\r\nconst mockUpdateExportStatus = updateExportStatus as jest.MockedFunction<typeof updateExportStatus>;\r\nconst mockGenerateSignedUrl = generateSignedUrl as jest.MockedFunction<typeof generateSignedUrl>;\r\n\r\ndescribe('processExport', () => {\r\n  const mockDisclosures: Disclosure[] = [\r\n    {\r\n      disclosure_id: '20240115_1234_001',\r\n      company_code: '1234',\r\n      company_name: 'テスト株式会社',\r\n      disclosure_type: '決算短信',\r\n      title: '2024年3月期 第3四半期決算短信',\r\n      disclosed_at: '2024-01-15T10:30:00Z',\r\n      pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',\r\n      s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',\r\n      collected_at: '2024-01-15T10:35:00Z',\r\n      date_partition: '2024-01',\r\n    },\r\n    {\r\n      disclosure_id: '20240115_5678_001',\r\n      company_code: '5678',\r\n      company_name: 'サンプル株式会社',\r\n      disclosure_type: '有価証券報告書',\r\n      title: '第50期有価証券報告書',\r\n      disclosed_at: '2024-01-15T11:00:00Z',\r\n      pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',\r\n      s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',\r\n      collected_at: '2024-01-15T11:05:00Z',\r\n      date_partition: '2024-01',\r\n    },\r\n  ];\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n\r\n    // デフォルトのモック実装\r\n    mockQueryDisclosures.mockResolvedValue(mockDisclosures);\r\n    mockExportToS3.mockResolvedValue('exports/2024/01/15/export_1705305600000_abc123_12345678.json');\r\n    mockUpdateExportStatus.mockResolvedValue();\r\n    mockGenerateSignedUrl.mockResolvedValue('https://s3.amazonaws.com/signed-url?expires=...');\r\n  });\r\n\r\n  describe('正常系: エクスポート処理の完全な実行', () => {\r\n    it('JSON形式でエクスポート処理が正常に完了する', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_abc123_12345678';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {\r\n          start_date: '2024-01-01',\r\n          end_date: '2024-01-31',\r\n        },\r\n      };\r\n\r\n      // Act\r\n      await processExport(export_id, requestBody);\r\n\r\n      // Assert\r\n      // 1. データ取得\r\n      expect(mockQueryDisclosures).toHaveBeenCalledWith(requestBody.filter);\r\n\r\n      // 2. 進捗更新（10%, 50%, 90%, 100%）\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledTimes(4);\r\n      expect(mockUpdateExportStatus).toHaveBeenNthCalledWith(1, export_id, 'processing', 10);\r\n      expect(mockUpdateExportStatus).toHaveBeenNthCalledWith(2, export_id, 'processing', 50);\r\n      expect(mockUpdateExportStatus).toHaveBeenNthCalledWith(3, export_id, 'processing', 90);\r\n\r\n      // 3. S3へのエクスポート\r\n      expect(mockExportToS3).toHaveBeenCalledWith(export_id, mockDisclosures, 'json');\r\n\r\n      // 4. 署名付きURL生成（有効期限7日）\r\n      expect(mockGenerateSignedUrl).toHaveBeenCalledWith(\r\n        'exports/2024/01/15/export_1705305600000_abc123_12345678.json',\r\n        7 * 24 * 60 * 60\r\n      );\r\n\r\n      // 5. 完了ステータス更新（100%）\r\n      expect(mockUpdateExportStatus).toHaveBeenNthCalledWith(\r\n        4,\r\n        export_id,\r\n        'completed',\r\n        100,\r\n        'exports/2024/01/15/export_1705305600000_abc123_12345678.json',\r\n        'https://s3.amazonaws.com/signed-url?expires=...'\r\n      );\r\n    });\r\n\r\n    it('CSV形式でエクスポート処理が正常に完了する', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_def456_87654321';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'csv',\r\n        filter: {\r\n          company_code: '1234',\r\n        },\r\n      };\r\n\r\n      mockExportToS3.mockResolvedValue('exports/2024/01/15/export_1705305600000_def456_87654321.csv');\r\n\r\n      // Act\r\n      await processExport(export_id, requestBody);\r\n\r\n      // Assert\r\n      expect(mockQueryDisclosures).toHaveBeenCalledWith(requestBody.filter);\r\n      expect(mockExportToS3).toHaveBeenCalledWith(export_id, mockDisclosures, 'csv');\r\n      expect(mockGenerateSignedUrl).toHaveBeenCalledWith(\r\n        'exports/2024/01/15/export_1705305600000_def456_87654321.csv',\r\n        7 * 24 * 60 * 60\r\n      );\r\n    });\r\n\r\n    it('進捗更新が正しい順序で実行される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_ghi789_11111111';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      // Act\r\n      await processExport(export_id, requestBody);\r\n\r\n      // Assert\r\n      const calls = mockUpdateExportStatus.mock.calls;\r\n      expect(calls[0]).toEqual([export_id, 'processing', 10]);\r\n      expect(calls[1]).toEqual([export_id, 'processing', 50]);\r\n      expect(calls[2]).toEqual([export_id, 'processing', 90]);\r\n      expect(calls[3]).toEqual([\r\n        export_id,\r\n        'completed',\r\n        100,\r\n        'exports/2024/01/15/export_1705305600000_abc123_12345678.json',\r\n        'https://s3.amazonaws.com/signed-url?expires=...',\r\n      ]);\r\n    });\r\n\r\n    it('空のデータセットでもエクスポート処理が完了する', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_jkl012_22222222';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {\r\n          company_code: '9999',\r\n        },\r\n      };\r\n\r\n      mockQueryDisclosures.mockResolvedValue([]);\r\n      mockExportToS3.mockResolvedValue('exports/2024/01/15/export_1705305600000_jkl012_22222222.json');\r\n\r\n      // Act\r\n      await processExport(export_id, requestBody);\r\n\r\n      // Assert\r\n      expect(mockQueryDisclosures).toHaveBeenCalledWith(requestBody.filter);\r\n      expect(mockExportToS3).toHaveBeenCalledWith(export_id, [], 'json');\r\n      expect(mockUpdateExportStatus).toHaveBeenLastCalledWith(\r\n        export_id,\r\n        'completed',\r\n        100,\r\n        'exports/2024/01/15/export_1705305600000_jkl012_22222222.json',\r\n        'https://s3.amazonaws.com/signed-url?expires=...'\r\n      );\r\n    });\r\n\r\n    it('大量データのエクスポート処理が完了する', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_mno345_33333333';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'csv',\r\n        filter: {\r\n          start_date: '2024-01-01',\r\n          end_date: '2024-12-31',\r\n        },\r\n      };\r\n\r\n      // 1000件のモックデータ\r\n      const largeDataset: Disclosure[] = Array.from({ length: 1000 }, (_, i) => ({\r\n        disclosure_id: `20240115_${String(i).padStart(4, '0')}_001`,\r\n        company_code: String(i).padStart(4, '0'),\r\n        company_name: `企業${i}`,\r\n        disclosure_type: '決算短信',\r\n        title: `タイトル${i}`,\r\n        disclosed_at: '2024-01-15T10:30:00Z',\r\n        pdf_url: `https://example.com/pdf/${i}.pdf`,\r\n        s3_key: `pdfs/2024/01/15/${i}.pdf`,\r\n        collected_at: '2024-01-15T10:35:00Z',\r\n        date_partition: '2024-01',\r\n      }));\r\n\r\n      mockQueryDisclosures.mockResolvedValue(largeDataset);\r\n      mockExportToS3.mockResolvedValue('exports/2024/01/15/export_1705305600000_mno345_33333333.csv');\r\n\r\n      // Act\r\n      await processExport(export_id, requestBody);\r\n\r\n      // Assert\r\n      expect(mockQueryDisclosures).toHaveBeenCalledWith(requestBody.filter);\r\n      expect(mockExportToS3).toHaveBeenCalledWith(export_id, largeDataset, 'csv');\r\n      expect(mockUpdateExportStatus).toHaveBeenLastCalledWith(\r\n        export_id,\r\n        'completed',\r\n        100,\r\n        'exports/2024/01/15/export_1705305600000_mno345_33333333.csv',\r\n        'https://s3.amazonaws.com/signed-url?expires=...'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('異常系: データ取得失敗', () => {\r\n    it('DynamoDB例外が発生した場合、failedステータスに更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_pqr678_44444444';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('ProvisionedThroughputExceededException');\r\n      error.name = 'ProvisionedThroughputExceededException';\r\n      mockQueryDisclosures.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow(\r\n        'ProvisionedThroughputExceededException'\r\n      );\r\n\r\n      // failedステータスに更新されることを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'ProvisionedThroughputExceededException'\r\n      );\r\n    });\r\n\r\n    it('クエリタイムアウトが発生した場合、failedステータスに更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_stu901_55555555';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('Query timeout');\r\n      mockQueryDisclosures.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow('Query timeout');\r\n\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'Query timeout'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('異常系: S3エクスポート失敗', () => {\r\n    it('S3 PutObject失敗時、failedステータスに更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_vwx234_66666666';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('S3 PutObject failed');\r\n      mockExportToS3.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow('S3 PutObject failed');\r\n\r\n      // 進捗10%, 50%まで更新された後、failedになることを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 10);\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 50);\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'S3 PutObject failed'\r\n      );\r\n    });\r\n\r\n    it('S3アクセス拒否エラー時、failedステータスに更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_yza567_77777777';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'csv',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('Access Denied');\r\n      error.name = 'AccessDenied';\r\n      mockExportToS3.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow('Access Denied');\r\n\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'Access Denied'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('異常系: 署名付きURL生成失敗', () => {\r\n    it('署名付きURL生成失敗時、failedステータスに更新される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_bcd890_88888888';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('Failed to generate signed URL');\r\n      mockGenerateSignedUrl.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow(\r\n        'Failed to generate signed URL'\r\n      );\r\n\r\n      // 進捗10%, 50%, 90%まで更新された後、failedになることを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 10);\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 50);\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 90);\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'Failed to generate signed URL'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('異常系: 進捗更新失敗', () => {\r\n    it('進捗更新失敗時もエラーが伝播される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_efg123_99999999';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('DynamoDB UpdateItem failed');\r\n      mockUpdateExportStatus.mockRejectedValueOnce(error); // 最初の呼び出しで失敗\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow(\r\n        'DynamoDB UpdateItem failed'\r\n      );\r\n\r\n      // 最初の進捗更新で失敗することを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(export_id, 'processing', 10);\r\n    });\r\n  });\r\n\r\n  describe('異常系: エラー時のステータス更新確認', () => {\r\n    it('エラー発生時、エラーメッセージが正しく記録される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_hij456_00000000';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      const error = new Error('Unexpected error occurred');\r\n      mockQueryDisclosures.mockRejectedValue(error);\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toThrow(\r\n        'Unexpected error occurred'\r\n      );\r\n\r\n      // failedステータス更新時にエラーメッセージが含まれることを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'Unexpected error occurred'\r\n      );\r\n    });\r\n\r\n    it('非Errorオブジェクトのエラー時も文字列化される', async () => {\r\n      // Arrange\r\n      const export_id = 'export_1705305600000_klm789_11111112';\r\n      const requestBody: ExportRequestBody = {\r\n        format: 'json',\r\n        filter: {},\r\n      };\r\n\r\n      mockQueryDisclosures.mockRejectedValue('String error');\r\n\r\n      // Act & Assert\r\n      await expect(processExport(export_id, requestBody)).rejects.toBe('String error');\r\n\r\n      // failedステータス更新時にエラーが文字列化されることを確認\r\n      expect(mockUpdateExportStatus).toHaveBeenCalledWith(\r\n        export_id,\r\n        'failed',\r\n        0,\r\n        undefined,\r\n        undefined,\r\n        'String error'\r\n      );\r\n    });\r\n  });\r\n});\r\n"],"version":3}