{"version":3,"names":["cov_gxsmymfu","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","file","mappings","names","sources","sourcesContent","version","_coverageSchema","coverage","actualCoverage","exports","saveMetadata","client_dynamodb_1","require","util_dynamodb_1","date_partition_1","retry_1","logger_1","cloudwatch_metrics_1","errors_1","dynamoClient","DynamoDBClient","getDynamoTable","process","env","DYNAMODB_TABLE","disclosure","s3_key","date_partition","generateDatePartition","disclosed_at","item","disclosure_id","company_code","company_name","disclosure_type","title","pdf_url","collected_at","Date","toISOString","logger","info","retryWithBackoff","send","PutItemCommand","TableName","Item","marshall","ConditionExpression","error","RetryableError","message","maxRetries","initialDelay","backoffMultiplier","jitter","shouldRetry","sendSuccessMetric","DatePartition","warn","error_type","constructor","error_message","String","sendErrorMetric","DisclosureId"],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\save-metadata.ts"],"sourcesContent":["/**\r\n * メタデータ保存機能\r\n *\r\n * 開示情報のメタデータをDynamoDBに保存します。\r\n * 重複チェックとdate_partitionの自動生成を含みます。\r\n *\r\n * Requirements: 要件1.4, 2.4（メタデータ保存、重複チェック）\r\n */\r\n\r\nimport { DynamoDBClient, PutItemCommand } from '@aws-sdk/client-dynamodb';\r\nimport { marshall } from '@aws-sdk/util-dynamodb';\r\nimport { generateDatePartition } from '../../utils/date-partition';\r\nimport { retryWithBackoff } from '../../utils/retry';\r\nimport { logger } from '../../utils/logger';\r\nimport { sendErrorMetric, sendSuccessMetric } from '../../utils/cloudwatch-metrics';\r\nimport { RetryableError } from '../../errors';\r\nimport { Disclosure } from '../../types';\r\n\r\n// DynamoDBクライアントはグローバルスコープで初期化（再利用される）\r\nconst dynamoClient = new DynamoDBClient({});\r\n\r\n// 環境変数は関数内で取得（テスト時の柔軟性のため）\r\nfunction getDynamoTable(): string {\r\n  return process.env.DYNAMODB_TABLE || 'tdnet_disclosures';\r\n}\r\n\r\n/**\r\n * メタデータをDynamoDBに保存\r\n *\r\n * Two-Phase Commit原則に従い、date_partitionを事前生成してから保存します。\r\n * 重複チェック（ConditionExpression）により、同じdisclosure_idの重複保存を防ぎます。\r\n *\r\n * @param disclosure - 開示情報\r\n * @param s3_key - S3キー（PDFファイルの保存先）\r\n * @throws ConditionalCheckFailedException 重複する開示IDの場合（警告レベル）\r\n * @throws ValidationError date_partitionの生成に失敗した場合\r\n *\r\n * @example\r\n * ```typescript\r\n * const disclosure: Disclosure = {\r\n *   disclosure_id: 'TD20240115001',\r\n *   company_code: '1234',\r\n *   company_name: '株式会社サンプル',\r\n *   disclosure_type: '決算短信',\r\n *   title: '2024年3月期 第3四半期決算短信',\r\n *   disclosed_at: '2024-01-15T10:30:00Z',\r\n *   pdf_url: 'https://www.release.tdnet.info/inbs/140120240115001.pdf',\r\n *   s3_key: '',\r\n *   collected_at: '',\r\n *   date_partition: '',\r\n * };\r\n *\r\n * await saveMetadata(disclosure, '2024/01/15/TD20240115001.pdf');\r\n * ```\r\n */\r\nexport async function saveMetadata(disclosure: Disclosure, s3_key: string): Promise<void> {\r\n  try {\r\n    // date_partitionを事前生成（Two-Phase Commit原則）\r\n    const date_partition = generateDatePartition(disclosure.disclosed_at);\r\n\r\n    const item = {\r\n      disclosure_id: disclosure.disclosure_id,\r\n      company_code: disclosure.company_code,\r\n      company_name: disclosure.company_name,\r\n      disclosure_type: disclosure.disclosure_type,\r\n      title: disclosure.title,\r\n      disclosed_at: disclosure.disclosed_at,\r\n      date_partition,\r\n      pdf_url: disclosure.pdf_url,\r\n      s3_key,\r\n      collected_at: new Date().toISOString(),\r\n    };\r\n\r\n    logger.info('Saving metadata to DynamoDB', {\r\n      disclosure_id: disclosure.disclosure_id,\r\n      date_partition,\r\n    });\r\n\r\n    // DynamoDBに保存（重複チェック付き、再試行あり）\r\n    await retryWithBackoff(\r\n      async () => {\r\n        try {\r\n          await dynamoClient.send(\r\n            new PutItemCommand({\r\n              TableName: getDynamoTable(),\r\n              Item: marshall(item),\r\n              ConditionExpression: 'attribute_not_exists(disclosure_id)',\r\n            })\r\n          );\r\n        } catch (error: any) {\r\n          // ProvisionedThroughputExceededExceptionは再試行可能\r\n          if (error.name === 'ProvisionedThroughputExceededException') {\r\n            throw new RetryableError(\r\n              `DynamoDB throughput exceeded: ${error.message}`,\r\n              error\r\n            );\r\n          }\r\n          // ConditionalCheckFailedExceptionは再試行不可（重複）\r\n          if (error.name === 'ConditionalCheckFailedException') {\r\n            throw error; // そのままスロー（外側のcatchで処理）\r\n          }\r\n          // その他のエラーもそのままスロー\r\n          throw error;\r\n        }\r\n      },\r\n      {\r\n        maxRetries: 3,\r\n        initialDelay: 1000,\r\n        backoffMultiplier: 2,\r\n        jitter: true,\r\n        shouldRetry: (error) => error instanceof RetryableError,\r\n      }\r\n    );\r\n\r\n    logger.info('Metadata saved successfully', {\r\n      disclosure_id: disclosure.disclosure_id,\r\n      date_partition,\r\n      s3_key,\r\n    });\r\n\r\n    // 成功メトリクス送信\r\n    await sendSuccessMetric(1, 'SaveMetadata', {\r\n      DatePartition: date_partition,\r\n    });\r\n  } catch (error: any) {\r\n    if (error.name === 'ConditionalCheckFailedException') {\r\n      // 重複は警告レベルで記録（エラーではない）\r\n      logger.warn('Duplicate disclosure detected', {\r\n        disclosure_id: disclosure.disclosure_id,\r\n        s3_key,\r\n      });\r\n      return; // 重複は無視\r\n    }\r\n\r\n    logger.error('Failed to save metadata', {\r\n      disclosure_id: disclosure.disclosure_id,\r\n      error_type: error.constructor?.name || 'Unknown',\r\n      error_message: error.message || String(error),\r\n    });\r\n\r\n    // エラーメトリクス送信\r\n    await sendErrorMetric(\r\n      error.constructor?.name || 'Unknown',\r\n      'SaveMetadata',\r\n      { DisclosureId: disclosure.disclosure_id }\r\n    );\r\n\r\n    throw error;\r\n  }\r\n}\r\n"],"mappings":";;AAAA;;;;;;;;AAAA;AAAA,SAAAA,aAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,MAAA,OAAAC,QAAA;EAAA,IAAAC,GAAA;EAAA,IAAAC,YAAA;IAAAL,IAAA;IAAAM,YAAA;MAAA;QAAAC,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;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","ignoreList":[]}