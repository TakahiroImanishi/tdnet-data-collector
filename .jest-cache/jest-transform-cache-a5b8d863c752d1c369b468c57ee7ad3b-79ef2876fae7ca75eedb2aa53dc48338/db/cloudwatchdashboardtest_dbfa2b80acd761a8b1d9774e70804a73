c0c22a0a2364c6797ce32c56c3c77dc2
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const dynamodb = __importStar(require("aws-cdk-lib/aws-dynamodb"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const apigateway = __importStar(require("aws-cdk-lib/aws-apigateway"));
const assertions_1 = require("aws-cdk-lib/assertions");
const cloudwatch_dashboard_1 = require("../lib/constructs/cloudwatch-dashboard");
describe('CloudWatchDashboard', () => {
    let stack;
    let mockLambdaFunctions;
    let mockDynamodbTables;
    let mockS3Buckets;
    let mockApiGateway;
    beforeEach(() => {
        stack = new cdk.Stack();
        // モックLambda関数を作成
        const createMockLambda = (id) => {
            return new lambda.Function(stack, id, {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromInline('exports.handler = async () => {};'),
            });
        };
        mockLambdaFunctions = {
            collector: createMockLambda('CollectorFunction'),
            query: createMockLambda('QueryFunction'),
            export: createMockLambda('ExportFunction'),
            collect: createMockLambda('CollectFunction'),
            collectStatus: createMockLambda('CollectStatusFunction'),
            exportStatus: createMockLambda('ExportStatusFunction'),
            pdfDownload: createMockLambda('PdfDownloadFunction'),
        };
        // モックDynamoDBテーブルを作成
        mockDynamodbTables = {
            disclosures: new dynamodb.Table(stack, 'DisclosuresTable', {
                partitionKey: { name: 'disclosure_id', type: dynamodb.AttributeType.STRING },
            }),
            executions: new dynamodb.Table(stack, 'ExecutionsTable', {
                partitionKey: { name: 'execution_id', type: dynamodb.AttributeType.STRING },
            }),
            exportStatus: new dynamodb.Table(stack, 'ExportStatusTable', {
                partitionKey: { name: 'export_id', type: dynamodb.AttributeType.STRING },
            }),
        };
        // モックS3バケットを作成
        mockS3Buckets = {
            pdfs: new s3.Bucket(stack, 'PdfsBucket'),
            exports: new s3.Bucket(stack, 'ExportsBucket'),
        };
        // モックAPI Gatewayを作成
        mockApiGateway = new apigateway.RestApi(stack, 'TestApi', {
            restApiName: 'test-api',
            deploy: false, // デプロイを無効化してテストを高速化
        });
        // ダミーリソースとメソッドを追加（API Gatewayの検証エラーを回避）
        const resource = mockApiGateway.root.addResource('test');
        resource.addMethod('GET');
    });
    test('ダッシュボードが正しく作成される', () => {
        // CloudWatch Dashboardを作成
        const dashboard = new cloudwatch_dashboard_1.CloudWatchDashboard(stack, 'TestDashboard', {
            environment: 'dev',
            lambdaFunctions: mockLambdaFunctions,
            dynamodbTables: mockDynamodbTables,
            s3Buckets: mockS3Buckets,
            apiGateway: mockApiGateway,
        });
        // ダッシュボードが作成されていることを確認
        expect(dashboard.dashboard).toBeDefined();
        // CloudFormationテンプレートを取得
        const template = assertions_1.Template.fromStack(stack);
        // ダッシュボードリソースが存在することを確認
        template.hasResourceProperties('AWS::CloudWatch::Dashboard', {
            DashboardName: 'tdnet-collector-dev',
        });
    });
    test('すべてのウィジェットが含まれている', () => {
        // CloudWatch Dashboardを作成
        new cloudwatch_dashboard_1.CloudWatchDashboard(stack, 'TestDashboard', {
            environment: 'dev',
            lambdaFunctions: mockLambdaFunctions,
            dynamodbTables: mockDynamodbTables,
            s3Buckets: mockS3Buckets,
            apiGateway: mockApiGateway,
        });
        // CloudFormationテンプレートを取得
        const template = assertions_1.Template.fromStack(stack);
        // ダッシュボードリソースが存在することを確認
        template.resourceCountIs('AWS::CloudWatch::Dashboard', 1);
        // ダッシュボードリソースを取得
        const dashboards = template.findResources('AWS::CloudWatch::Dashboard');
        const dashboardKeys = Object.keys(dashboards);
        expect(dashboardKeys.length).toBe(1);
        // DashboardBodyプロパティが存在することを確認
        const dashboard = dashboards[dashboardKeys[0]];
        expect(dashboard.Properties.DashboardBody).toBeDefined();
        // DashboardBodyが文字列であることを確認（CDK Tokenまたは実際のJSON文字列）
        expect(typeof dashboard.Properties.DashboardBody).toBe('object');
    });
    test('環境名が正しく設定される', () => {
        // 本番環境でダッシュボードを作成
        new cloudwatch_dashboard_1.CloudWatchDashboard(stack, 'ProdDashboard', {
            environment: 'prod',
            lambdaFunctions: mockLambdaFunctions,
            dynamodbTables: mockDynamodbTables,
            s3Buckets: mockS3Buckets,
            apiGateway: mockApiGateway,
        });
        // CloudFormationテンプレートを取得
        const template = assertions_1.Template.fromStack(stack);
        // ダッシュボード名に環境名が含まれていることを確認
        template.hasResourceProperties('AWS::CloudWatch::Dashboard', {
            DashboardName: 'tdnet-collector-prod',
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGNsb3Vkd2F0Y2gtZGFzaGJvYXJkLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMsK0RBQWlEO0FBQ2pELG1FQUFxRDtBQUNyRCx1REFBeUM7QUFDekMsdUVBQXlEO0FBQ3pELHVEQUFrRDtBQUNsRCxpRkFBNkU7QUFFN0UsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxJQUFJLEtBQWdCLENBQUM7SUFDckIsSUFBSSxtQkFRSCxDQUFDO0lBQ0YsSUFBSSxrQkFJSCxDQUFDO0lBQ0YsSUFBSSxhQUdILENBQUM7SUFDRixJQUFJLGNBQW1DLENBQUM7SUFFeEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUV4QixpQkFBaUI7UUFDakIsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEVBQVUsRUFBb0IsRUFBRTtZQUN4RCxPQUFPLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFO2dCQUNwQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO2dCQUNuQyxPQUFPLEVBQUUsZUFBZTtnQkFDeEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLG1DQUFtQyxDQUFDO2FBQ2xFLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQztRQUVGLG1CQUFtQixHQUFHO1lBQ3BCLFNBQVMsRUFBRSxnQkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQztZQUNoRCxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsZUFBZSxDQUFDO1lBQ3hDLE1BQU0sRUFBRSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQztZQUMxQyxPQUFPLEVBQUUsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUM7WUFDNUMs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QUFhLEVBQUUsc0JBQXNCO1NBQ3RDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGNsb3Vkd2F0Y2gtZGFzaGJvYXJkLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgKiBhcyBkeW5hbW9kYiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZHluYW1vZGInO1xyXG5pbXBvcnQgKiBhcyBzMyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xyXG5pbXBvcnQgKiBhcyBhcGlnYXRld2F5IGZyb20gJ2F3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5JztcclxuaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICdhd3MtY2RrLWxpYi9hc3NlcnRpb25zJztcclxuaW1wb3J0IHsgQ2xvdWRXYXRjaERhc2hib2FyZCB9IGZyb20gJy4uL2xpYi9jb25zdHJ1Y3RzL2Nsb3Vkd2F0Y2gtZGFzaGJvYXJkJztcclxuXHJcbmRlc2NyaWJlKCdDbG91ZFdhdGNoRGFzaGJvYXJkJywgKCkgPT4ge1xyXG4gIGxldCBzdGFjazogY2RrLlN0YWNrO1xyXG4gIGxldCBtb2NrTGFtYmRhRnVuY3Rpb25zOiB7XHJcbiAgICBjb2xsZWN0b3I6IGxhbWJkYS5JRnVuY3Rpb247XHJcbiAgICBxdWVyeTogbGFtYmRhLklGdW5jdGlvbjtcclxuICAgIGV4cG9ydDogbGFtYmRhLklGdW5jdGlvbjtcclxuICAgIGNvbGxlY3Q6IGxhbWJkYS5JRnVuY3Rpb247XHJcbiAgICBjb2xsZWN0U3RhdHVzOiBsYW1iZGEuSUZ1bmN0aW9uO1xyXG4gICAgZXhwb3J0U3RhdHVzOiBsYW1iZGEuSUZ1bmN0aW9uO1xyXG4gICAgcGRmRG93bmxvYWQ6IGxhbWJkYS5JRnVuY3Rpb247XHJcbiAgfTtcclxuICBsZXQgbW9ja0R5bmFtb2RiVGFibGVzOiB7XHJcbiAgICBkaXNjbG9zdXJlczogZHluYW1vZGIuSVRhYmxlO1xyXG4gICAgZXhlY3V0aW9uczogZHluYW1vZGIuSVRhYmxlO1xyXG4gICAgZXhwb3J0U3RhdHVzOiBkeW5hbW9kYi5JVGFibGU7XHJcbiAgfTtcclxuICBsZXQgbW9ja1MzQnVja2V0czoge1xyXG4gICAgcGRmczogczMuSUJ1Y2tldDtcclxuICAgIGV4cG9ydHM6IHMzLklCdWNrZXQ7XHJcbiAgfTtcclxuICBsZXQgbW9ja0FwaUdhdGV3YXk6IGFwaWdhdGV3YXkuSVJlc3RBcGk7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XHJcblxyXG4gICAgLy8g44Oi44OD44KvTGFtYmRh6Zai5pWw44KS5L2c5oiQXHJcbiAgICBjb25zdCBjcmVhdGVNb2NrTGFtYmRhID0gKGlkOiBzdHJpbmcpOiBsYW1iZGEuSUZ1bmN0aW9uID0+IHtcclxuICAgICAgcmV0dXJuIG5ldyBsYW1iZGEuRnVuY3Rpb24oc3RhY2ssIGlkLCB7XHJcbiAgICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXHJcbiAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxyXG4gICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21JbmxpbmUoJ2V4cG9ydHMuaGFuZGxlciA9IGFzeW5jICgpID0+IHt9OycpLFxyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgbW9ja0xhbWJkYUZ1bmN0aW9ucyA9IHtcclxuICAgICAgY29sbGVjdG9yOiBjcmVhdGVNb2NrTGFtYmRhKCdDb2xsZWN0b3JGdW5jdGlvbicpLFxyXG4gICAgICBxdWVyeTogY3JlYXRlTW9ja0xhbWJkYSgnUXVlcnlGdW5jdGlvbicpLFxyXG4gICAgICBleHBvcnQ6IGNyZWF0ZU1vY2tMYW1iZGEoJ0V4cG9ydEZ1bmN0aW9uJyksXHJcbiAgICAgIGNvbGxlY3Q6IGNyZWF0ZU1vY2tMYW1iZGEoJ0NvbGxlY3RGdW5jdGlvbicpLFxyXG4gICAgICBjb2xsZWN0U3RhdHVzOiBjcmVhdGVNb2NrTGFtYmRhKCdDb2xsZWN0U3RhdHVzRnVuY3Rpb24nKSxcclxuICAgICAgZXhwb3J0U3RhdHVzOiBjcmVhdGVNb2NrTGFtYmRhKCdFeHBvcnRTdGF0dXNGdW5jdGlvbicpLFxyXG4gICAgICBwZGZEb3dubG9hZDogY3JlYXRlTW9ja0xhbWJkYSgnUGRmRG93bmxvYWRGdW5jdGlvbicpLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDjg6Ljg4Pjgq9EeW5hbW9EQuODhuODvOODluODq+OCkuS9nOaIkFxyXG4gICAgbW9ja0R5bmFtb2RiVGFibGVzID0ge1xyXG4gICAgICBkaXNjbG9zdXJlczogbmV3IGR5bmFtb2RiLlRhYmxlKHN0YWNrLCAnRGlzY2xvc3VyZXNUYWJsZScsIHtcclxuICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ2Rpc2Nsb3N1cmVfaWQnLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICB9KSxcclxuICAgICAgZXhlY3V0aW9uczogbmV3IGR5bmFtb2RiLlRhYmxlKHN0YWNrLCAnRXhlY3V0aW9uc1RhYmxlJywge1xyXG4gICAgICAgIHBhcnRpdGlvbktleTogeyBuYW1lOiAnZXhlY3V0aW9uX2lkJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgfSksXHJcbiAgICAgIGV4cG9ydFN0YXR1czogbmV3IGR5bmFtb2RiLlRhYmxlKHN0YWNrLCAnRXhwb3J0U3RhdHVzVGFibGUnLCB7XHJcbiAgICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6ICdleHBvcnRfaWQnLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICB9KSxcclxuICAgIH07XHJcblxyXG4gICAgLy8g44Oi44OD44KvUzPjg5DjgrHjg4Pjg4jjgpLkvZzmiJBcclxuICAgIG1vY2tTM0J1Y2tldHMgPSB7XHJcbiAgICAgIHBkZnM6IG5ldyBzMy5CdWNrZXQoc3RhY2ssICdQZGZzQnVja2V0JyksXHJcbiAgICAgIGV4cG9ydHM6IG5ldyBzMy5CdWNrZXQoc3RhY2ssICdFeHBvcnRzQnVja2V0JyksXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIOODouODg+OCr0FQSSBHYXRld2F544KS5L2c5oiQXHJcbiAgICBtb2NrQXBpR2F0ZXdheSA9IG5ldyBhcGlnYXRld2F5LlJlc3RBcGkoc3RhY2ssICdUZXN0QXBpJywge1xyXG4gICAgICByZXN0QXBpTmFtZTogJ3Rlc3QtYXBpJyxcclxuICAgICAgZGVwbG95OiBmYWxzZSwgLy8g44OH44OX44Ot44Kk44KS54Sh5Yq55YyW44GX44Gm44OG44K544OI44KS6auY6YCf5YyWXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDjg4Djg5/jg7zjg6rjgr3jg7zjgrnjgajjg6Hjgr3jg4Pjg4njgpLov73liqDvvIhBUEkgR2F0ZXdheeOBruaknOiovOOCqOODqeODvOOCkuWbnumBv++8iVxyXG4gICAgY29uc3QgcmVzb3VyY2UgPSBtb2NrQXBpR2F0ZXdheS5yb290LmFkZFJlc291cmNlKCd0ZXN0Jyk7XHJcbiAgICByZXNvdXJjZS5hZGRNZXRob2QoJ0dFVCcpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfjg4Djg4Pjgrfjg6Xjg5zjg7zjg4njgYzmraPjgZfjgY/kvZzmiJDjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBDbG91ZFdhdGNoIERhc2hib2FyZOOCkuS9nOaIkFxyXG4gICAgY29uc3QgZGFzaGJvYXJkID0gbmV3IENsb3VkV2F0Y2hEYXNoYm9hcmQoc3RhY2ssICdUZXN0RGFzaGJvYXJkJywge1xyXG4gICAgICBlbnZpcm9ubWVudDogJ2RldicsXHJcbiAgICAgIGxhbWJkYUZ1bmN0aW9uczogbW9ja0xhbWJkYUZ1bmN0aW9ucyxcclxuICAgICAgZHluYW1vZGJUYWJsZXM6IG1vY2tEeW5hbW9kYlRhYmxlcyxcclxuICAgICAgczNCdWNrZXRzOiBtb2NrUzNCdWNrZXRzLFxyXG4gICAgICBhcGlHYXRld2F5OiBtb2NrQXBpR2F0ZXdheSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOODgOODg+OCt+ODpeODnOODvOODieOBjOS9nOaIkOOBleOCjOOBpuOBhOOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgZXhwZWN0KGRhc2hib2FyZC5kYXNoYm9hcmQpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgLy8gQ2xvdWRGb3JtYXRpb27jg4bjg7Pjg5fjg6zjg7zjg4jjgpLlj5blvpdcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuXHJcbiAgICAvLyDjg4Djg4Pjgrfjg6Xjg5zjg7zjg4njg6rjgr3jg7zjgrnjgYzlrZjlnKjjgZnjgovjgZPjgajjgpLnorroqo1cclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZFdhdGNoOjpEYXNoYm9hcmQnLCB7XHJcbiAgICAgIERhc2hib2FyZE5hbWU6ICd0ZG5ldC1jb2xsZWN0b3ItZGV2JyxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfjgZnjgbnjgabjga7jgqbjgqPjgrjjgqfjg4Pjg4jjgYzlkKvjgb7jgozjgabjgYTjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBDbG91ZFdhdGNoIERhc2hib2FyZOOCkuS9nOaIkFxyXG4gICAgbmV3IENsb3VkV2F0Y2hEYXNoYm9hcmQoc3RhY2ssICdUZXN0RGFzaGJvYXJkJywge1xyXG4gICAgICBlbnZpcm9ubWVudDogJ2RldicsXHJcbiAgICAgIGxhbWJkYUZ1bmN0aW9uczogbW9ja0xhbWJkYUZ1bmN0aW9ucyxcclxuICAgICAgZHluYW1vZGJUYWJsZXM6IG1vY2tEeW5hbW9kYlRhYmxlcyxcclxuICAgICAgczNCdWNrZXRzOiBtb2NrUzNCdWNrZXRzLFxyXG4gICAgICBhcGlHYXRld2F5OiBtb2NrQXBpR2F0ZXdheSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIENsb3VkRm9ybWF0aW9u44OG44Oz44OX44Os44O844OI44KS5Y+W5b6XXHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgLy8g44OA44OD44K344Ol44Oc44O844OJ44Oq44K944O844K544GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqNXHJcbiAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6Q2xvdWRXYXRjaDo6RGFzaGJvYXJkJywgMSk7XHJcblxyXG4gICAgLy8g44OA44OD44K344Ol44Oc44O844OJ44Oq44K944O844K544KS5Y+W5b6XXHJcbiAgICBjb25zdCBkYXNoYm9hcmRzID0gdGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpDbG91ZFdhdGNoOjpEYXNoYm9hcmQnKTtcclxuICAgIGNvbnN0IGRhc2hib2FyZEtleXMgPSBPYmplY3Qua2V5cyhkYXNoYm9hcmRzKTtcclxuICAgIGV4cGVjdChkYXNoYm9hcmRLZXlzLmxlbmd0aCkudG9CZSgxKTtcclxuXHJcbiAgICAvLyBEYXNoYm9hcmRCb2R544OX44Ot44OR44OG44Kj44GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqNXHJcbiAgICBjb25zdCBkYXNoYm9hcmQgPSBkYXNoYm9hcmRzW2Rhc2hib2FyZEtleXNbMF1dO1xyXG4gICAgZXhwZWN0KGRhc2hib2FyZC5Qcm9wZXJ0aWVzLkRhc2hib2FyZEJvZHkpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgLy8gRGFzaGJvYXJkQm9keeOBjOaWh+Wtl+WIl+OBp+OBguOCi+OBk+OBqOOCkueiuuiqje+8iENESyBUb2tlbuOBvuOBn+OBr+Wun+mam+OBrkpTT07mloflrZfliJfvvIlcclxuICAgIGV4cGVjdCh0eXBlb2YgZGFzaGJvYXJkLlByb3BlcnRpZXMuRGFzaGJvYXJkQm9keSkudG9CZSgnb2JqZWN0Jyk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ+eSsOWig+WQjeOBjOato+OBl+OBj+ioreWumuOBleOCjOOCiycsICgpID0+IHtcclxuICAgIC8vIOacrOeVqueSsOWig+OBp+ODgOODg+OCt+ODpeODnOODvOODieOCkuS9nOaIkFxyXG4gICAgbmV3IENsb3VkV2F0Y2hEYXNoYm9hcmQoc3RhY2ssICdQcm9kRGFzaGJvYXJkJywge1xyXG4gICAgICBlbnZpcm9ubWVudDogJ3Byb2QnLFxyXG4gICAgICBsYW1iZGFGdW5jdGlvbnM6IG1vY2tMYW1iZGFGdW5jdGlvbnMsXHJcbiAgICAgIGR5bmFtb2RiVGFibGVzOiBtb2NrRHluYW1vZGJUYWJsZXMsXHJcbiAgICAgIHMzQnVja2V0czogbW9ja1MzQnVja2V0cyxcclxuICAgICAgYXBpR2F0ZXdheTogbW9ja0FwaUdhdGV3YXksXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBDbG91ZEZvcm1hdGlvbuODhuODs+ODl+ODrOODvOODiOOCkuWPluW+l1xyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgIC8vIOODgOODg+OCt+ODpeODnOODvOODieWQjeOBq+eSsOWig+WQjeOBjOWQq+OBvuOCjOOBpuOBhOOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkV2F0Y2g6OkRhc2hib2FyZCcsIHtcclxuICAgICAgRGFzaGJvYXJkTmFtZTogJ3RkbmV0LWNvbGxlY3Rvci1wcm9kJyxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9