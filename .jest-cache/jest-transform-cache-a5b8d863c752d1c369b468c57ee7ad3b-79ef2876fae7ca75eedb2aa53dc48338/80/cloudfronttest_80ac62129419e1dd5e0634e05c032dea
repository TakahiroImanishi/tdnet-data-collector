382069c38ab769a262000fbb5f4412a3
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const assertions_1 = require("aws-cdk-lib/assertions");
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const cloudfront_1 = require("../lib/constructs/cloudfront");
describe('DashboardCloudFront Construct', () => {
    let app;
    let stack;
    let dashboardBucket;
    beforeEach(() => {
        app = new cdk.App();
        stack = new cdk.Stack(app, 'TestStack', {
            env: {
                account: '123456789012',
                region: 'ap-northeast-1',
            },
        });
        // テスト用のS3バケットを作成
        dashboardBucket = new s3.Bucket(stack, 'TestDashboardBucket', {
            bucketName: 'test-dashboard-bucket',
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
    });
    test('CloudFront Distributionが作成される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.resourceCountIs('AWS::CloudFront::Distribution', 1);
    });
    test('Origin Access Identity (OAI) が作成される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.resourceCountIs('AWS::CloudFront::CloudFrontOriginAccessIdentity', 1);
        template.hasResourceProperties('AWS::CloudFront::CloudFrontOriginAccessIdentity', {
            CloudFrontOriginAccessIdentityConfig: {
                Comment: 'OAI for TDnet Dashboard (test)',
            },
        });
    });
    test('S3バケットポリシーにOAIからの読み取り権限が追加される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::S3::BucketPolicy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({
                        Action: 's3:GetObject',
                        Effect: 'Allow',
                        Principal: {
                            CanonicalUser: assertions_1.Match.anyValue(),
                        },
                        Resource: assertions_1.Match.anyValue(),
                    }),
                ]),
            },
        });
    });
    test('HTTPS強制が設定される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                DefaultCacheBehavior: {
                    ViewerProtocolPolicy: 'redirect-to-https',
                },
            },
        });
    });
    test('index.html用のキャッシュポリシーが作成される（TTL: 60秒）', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::CachePolicy', {
            CachePolicyConfig: {
                Name: 'tdnet-dashboard-index-test',
                DefaultTTL: 60,
                MinTTL: 0,
                MaxTTL: 60,
            },
        });
    });
    test('静的アセット用のキャッシュポリシーが作成される（TTL: 1日）', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::CachePolicy', {
            CachePolicyConfig: {
                Name: 'tdnet-dashboard-assets-test',
                DefaultTTL: 86400, // 1日 = 86400秒
                MinTTL: 0,
                MaxTTL: 31536000, // 365日
            },
        });
    });
    test('静的アセット用の追加ビヘイビアが設定される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                CacheBehaviors: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({
                        PathPattern: '/static/*',
                        ViewerProtocolPolicy: 'redirect-to-https',
                    }),
                    assertions_1.Match.objectLike({
                        PathPattern: '*.js',
                        ViewerProtocolPolicy: 'redirect-to-https',
                    }),
                    assertions_1.Match.objectLike({
                        PathPattern: '*.css',
                        ViewerProtocolPolicy: 'redirect-to-https',
                    }),
                ]),
            },
        });
    });
    test('SPA用エラーページ設定（404/403 → index.html）が設定される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                CustomErrorResponses: assertions_1.Match.arrayWith([
                    {
                        ErrorCode: 404,
                        ResponseCode: 200,
                        ResponsePagePath: '/index.html',
                        ErrorCachingMinTTL: 60,
                    },
                    {
                        ErrorCode: 403,
                        ResponseCode: 200,
                        ResponsePagePath: '/index.html',
                        ErrorCachingMinTTL: 60,
                    },
                ]),
            },
        });
    });
    test('デフォルトルートオブジェクトがindex.htmlに設定される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                DefaultRootObject: 'index.html',
            },
        });
    });
    test('圧縮が有効化される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                DefaultCacheBehavior: {
                    Compress: true,
                },
            },
        });
    });
    test('価格クラスがPRICE_CLASS_100に設定される（コスト最適化）', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                PriceClass: 'PriceClass_100',
            },
        });
    });
    test('HTTP/2とHTTP/3が有効化される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                HttpVersion: 'http2and3',
            },
        });
    });
    test('最小TLSバージョンがTLSv1.2に設定される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                ViewerCertificate: {
                    MinimumProtocolVersion: 'TLSv1.2_2021',
                },
            },
        });
    });
    test('CloudFront Distribution URLがCfnOutputとして出力される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        template.hasOutput('TestCloudFrontDistributionDomainName*', {
            Description: 'CloudFront Distribution Domain Name',
            Export: {
                Name: 'tdnet-dashboard-domain-test',
            },
        });
        template.hasOutput('TestCloudFrontDistributionId*', {
            Description: 'CloudFront Distribution ID',
            Export: {
                Name: 'tdnet-dashboard-distribution-id-test',
            },
        });
        template.hasOutput('TestCloudFrontDashboardUrl*', {
            Description: 'TDnet Dashboard URL',
            Export: {
                Name: 'tdnet-dashboard-url-test',
            },
        });
    });
    test('Gzip圧縮とBrotli圧縮が有効化される', () => {
        // Arrange & Act
        new cloudfront_1.DashboardCloudFront(stack, 'TestCloudFront', {
            dashboardBucket,
            environment: 'test',
        });
        // Assert
        const template = assertions_1.Template.fromStack(stack);
        // キャッシュポリシーでGzipとBrotliが有効化されていることを確認
        template.hasResourceProperties('AWS::CloudFront::CachePolicy', {
            CachePolicyConfig: {
                ParametersInCacheKeyAndForwardedToOrigin: {
                    EnableAcceptEncodingGzip: true,
                    EnableAcceptEncodingBrotli: true,
                },
            },
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGNsb3VkZnJvbnQudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGlEQUFtQztBQUNuQyx1REFBeUQ7QUFDekQsdURBQXlDO0FBQ3pDLDZEQUFtRTtBQUVuRSxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO0lBQzdDLElBQUksR0FBWSxDQUFDO0lBQ2pCLElBQUksS0FBZ0IsQ0FBQztJQUNyQixJQUFJLGVBQTJCLENBQUM7SUFFaEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNwQixLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUU7WUFDdEMsR0FBRyxFQUFFO2dCQUNILE9BQU8sRUFBRSxjQUFjO2dCQUN2QixNQUFNLEVBQUUsZ0JBQWdCO2FBQ3pCO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsaUJBQWlCO1FBQ2pCLGVBQWUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLHFCQUFxQixFQUFFO1lBQzVELFVBQVUsRUFBRSx1QkFBdUI7WUFDbkMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTztTQUN6QyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDekMsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLGVBQWUsQ0FBQywrQkFBK0IsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLGVBQWUsQ0FBQyxpREFBaUQsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUvRSxRQUFRLENBQUMscUJBQXFCLENBQUMsaURBQWlELEVBQUU7WUFDaEYsb0NBQW9DLEVBQUU7Z0JBQ3BDLE9BQU8sRUFBRSxnQ0FBZ0M7YUFDMUM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDekMsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLHFCQUFxQixDQUFDLHVCQUF1QixFQUFFO1lBQ3RELGNBQWMsRUFBRTtnQkFDZCxTQUFTLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUM7b0JBQ3pCLGtCQUFLLENBQUMsVUFBVSxDQUFDO3dCQUNmLE1BQU0sRUFBRSxjQUFjO3dCQUN0QixNQUFNLEVBQUUsT0FBTzt3QkFDZixTQUFTLEVBQUU7NEJBQ1QsYUFBYSxFQUFFLGtCQUFLLENBQUMsUUFBUSxFQUFFO3lCQUNoQzt3QkFDRCxRQUFRLEVBQUUsa0JBQUssQ0FBQyxRQUFRLEVBQUU7cUJBQzNCLENBQUM7aUJBQ0gsQ0FBQzthQUNIO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUN6QixnQkFBZ0I7UUFDaEIsSUFBSSxnQ0FBbUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUU7WUFDL0MsZUFBZTtZQUNmLFdBQVcsRUFBRSxNQUFNO1NBQ3BCLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxRQUFRLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7WUFDOUQsa0JBQWtCLEVBQUU7Z0JBQ2xCLG9CQUFvQixFQUFFO29CQUNwQixvQkFBb0IsRUFBRSxtQkFBbUI7aUJBQzFDO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7UUFDakQsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLHFCQUFxQixDQUFDLDhCQUE4QixFQUFFO1lBQzdELGlCQUFpQixFQUFFO2dCQUNqQixJQUFJLEVBQUUsNEJBQTRCO2dCQUNsQyxVQUFVLEVBQUUsRUFBRTtnQkFDZCxNQUFNLEVBQUUsQ0FBQztnQkFDVCxNQUFNLEVBQUUsRUFBRTthQUNYO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQzVDLGdCQUFnQjtRQUNoQixJQUFJLGdDQUFtQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRTtZQUMvQyxlQUFlO1lBQ2YsV0FBVyxFQUFFLE1BQU07U0FDcEIsQ0FBQyxDQUFDO1FBRUgsU0FBUztRQUNULE1BQU0sUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRTtZQUM3RCxpQkFBaUIsRUFBRTtnQkFDakIsSUFBSSxFQUFFLDZCQUE2QjtnQkFDbkMsVUFBVSxFQUFFLEtBQUssRUFBRSxjQUFjO2dCQUNqQyxNQUFNLEVBQUUsQ0FBQztnQkFDVCxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU87YUFDMUI7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLHFCQUFxQixDQUFDLCtCQUErQixFQUFFO1lBQzlELGtCQUFrQixFQUFFO2dCQUNsQixjQUFjLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUM7b0JBQzlCLGtCQUFLLENBQUMsVUFBVSxDQUFDO3dCQUNmLFdBQVcsRUFBRSxXQUFXO3dCQUN4QixvQkFBb0IsRUFBRSxtQkFBbUI7cUJBQzFDLENBQUM7b0JBQ0Ysa0JBQUssQ0FBQyxVQUFVLENBQUM7d0JBQ2YsV0FBVyxFQUFFLE1BQU07d0JBQ25CLG9CQUFvQixFQUFFLG1CQUFtQjtxQkFDMUMsQ0FBQztvQkFDRixrQkFBSyxDQUFDLFVBQVUsQ0FBQzt3QkFDZixXQUFXLEVBQUUsT0FBTzt3QkFDcEIsb0JBQW9CLEVBQUUsbUJBQW1CO3FCQUMxQyxDQUFDO2lCQUNILENBQUM7YUFDSDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtRQUNwRCxnQkFBZ0I7UUFDaEIsSUFBSSxnQ0FBbUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUU7WUFDL0MsZUFBZTtZQUNmLFdBQVcsRUFBRSxNQUFNO1NBQ3BCLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxRQUFRLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7WUFDOUQsa0JBQWtCLEVBQUU7Z0JBQ2xCLG9CQUFvQixFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDO29CQUNwQzt3QkFDRSxTQUFTLEVBQUUsR0FBRzt3QkFDZCxZQUFZLEVBQUUsR0FBRzt3QkFDakIsZ0JBQWdCLEVBQUUsYUFBYTt3QkFDL0Isa0JBQWtCLEVBQUUsRUFBRTtxQkFDdkI7b0JBQ0Q7d0JBQ0UsU0FBUyxFQUFFLEdBQUc7d0JBQ2QsWUFBWSxFQUFFLEdBQUc7d0JBQ2pCLGdCQUFnQixFQUFFLGFBQWE7d0JBQy9CLGtCQUFrQixFQUFFLEVBQUU7cUJBQ3ZCO2lCQUNGLENBQUM7YUFDSDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtRQUMzQyxnQkFBZ0I7UUFDaEIsSUFBSSxnQ0FBbUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUU7WUFDL0MsZUFBZTtZQUNmLFdBQVcsRUFBRSxNQUFNO1NBQ3BCLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxRQUFRLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7WUFDOUQsa0JBQWtCLEVBQUU7Z0JBQ2xCLGlCQUFpQixFQUFFLFlBQVk7YUFDaEM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3JCLGdCQUFnQjtRQUNoQixJQUFJLGdDQUFtQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRTtZQUMvQyxlQUFlO1lBQ2YsV0FBVyxFQUFFLE1BQU07U0FDcEIsQ0FBQyxDQUFDO1FBRUgsU0FBUztRQUNULE1BQU0sUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQywrQkFBK0IsRUFBRTtZQUM5RCxrQkFBa0IsRUFBRTtnQkFDbEIsb0JBQW9CLEVBQUU7b0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2lCQUNmO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLHFCQUFxQixDQUFDLCtCQUErQixFQUFFO1lBQzlELGtCQUFrQixFQUFFO2dCQUNsQixVQUFVLEVBQUUsZ0JBQWdCO2FBQzdCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLGdCQUFnQjtRQUNoQixJQUFJLGdDQUFtQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRTtZQUMvQyxlQUFlO1lBQ2YsV0FBVyxFQUFFLE1BQU07U0FDcEIsQ0FBQyxDQUFDO1FBRUgsU0FBUztRQUNULE1BQU0sUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQywrQkFBK0IsRUFBRTtZQUM5RCxrQkFBa0IsRUFBRTtnQkFDbEIsV0FBVyxFQUFFLFdBQVc7YUFDekI7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDcEMsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsUUFBUSxDQUFDLHFCQUFxQixDQUFDLCtCQUErQixFQUFFO1lBQzlELGtCQUFrQixFQUFFO2dCQUNsQixpQkFBaUIsRUFBRTtvQkFDakIsc0JBQXNCLEVBQUUsY0FBYztpQkFDdkM7YUFDRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLCtDQUErQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxnQkFBZ0I7UUFDaEIsSUFBSSxnQ0FBbUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUU7WUFDL0MsZUFBZTtZQUNmLFdBQVcsRUFBRSxNQUFNO1NBQ3BCLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxRQUFRLENBQUMsU0FBUyxDQUFDLHVDQUF1QyxFQUFFO1lBQzFELFdBQVcsRUFBRSxxQ0FBcUM7WUFDbEQsTUFBTSxFQUFFO2dCQUNOLElBQUksRUFBRSw2QkFBNkI7YUFDcEM7U0FDRixDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsU0FBUyxDQUFDLCtCQUErQixFQUFFO1lBQ2xELFdBQVcsRUFBRSw0QkFBNEI7WUFDekMsTUFBTSxFQUFFO2dCQUNOLElBQUksRUFBRSxzQ0FBc0M7YUFDN0M7U0FDRixDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsU0FBUyxDQUFDLDZCQUE2QixFQUFFO1lBQ2hELFdBQVcsRUFBRSxxQkFBcUI7WUFDbEMsTUFBTSxFQUFFO2dCQUNOLElBQUksRUFBRSwwQkFBMEI7YUFDakM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsZ0JBQWdCO1FBQ2hCLElBQUksZ0NBQW1CLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFO1lBQy9DLGVBQWU7WUFDZixXQUFXLEVBQUUsTUFBTTtTQUNwQixDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFM0Msc0NBQXNDO1FBQ3RDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRTtZQUM3RCxpQkFBaUIsRUFBRTtnQkFDakIsd0NBQXdDLEVBQUU7b0JBQ3hDLHdCQUF3QixFQUFFLElBQUk7b0JBQzlCLDBCQUEwQixFQUFFLElBQUk7aUJBQ2pDO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXGNka1xcX190ZXN0c19fXFxjbG91ZGZyb250LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcclxuaW1wb3J0IHsgVGVtcGxhdGUsIE1hdGNoIH0gZnJvbSAnYXdzLWNkay1saWIvYXNzZXJ0aW9ucyc7XHJcbmltcG9ydCAqIGFzIHMzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zMyc7XHJcbmltcG9ydCB7IERhc2hib2FyZENsb3VkRnJvbnQgfSBmcm9tICcuLi9saWIvY29uc3RydWN0cy9jbG91ZGZyb250JztcclxuXHJcbmRlc2NyaWJlKCdEYXNoYm9hcmRDbG91ZEZyb250IENvbnN0cnVjdCcsICgpID0+IHtcclxuICBsZXQgYXBwOiBjZGsuQXBwO1xyXG4gIGxldCBzdGFjazogY2RrLlN0YWNrO1xyXG4gIGxldCBkYXNoYm9hcmRCdWNrZXQ6IHMzLklCdWNrZXQ7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgYXBwID0gbmV3IGNkay5BcHAoKTtcclxuICAgIHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdUZXN0U3RhY2snLCB7XHJcbiAgICAgIGVudjoge1xyXG4gICAgICAgIGFjY291bnQ6ICcxMjM0NTY3ODkwMTInLFxyXG4gICAgICAgIHJlZ2lvbjogJ2FwLW5vcnRoZWFzdC0xJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOODhuOCueODiOeUqOOBrlMz44OQ44Kx44OD44OI44KS5L2c5oiQXHJcbiAgICBkYXNoYm9hcmRCdWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnVGVzdERhc2hib2FyZEJ1Y2tldCcsIHtcclxuICAgICAgYnVja2V0TmFtZTogJ3Rlc3QtZGFzaGJvYXJkLWJ1Y2tldCcsXHJcbiAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LkRFU1RST1ksXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnQ2xvdWRGcm9udCBEaXN0cmlidXRpb27jgYzkvZzmiJDjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCAxKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnT3JpZ2luIEFjY2VzcyBJZGVudGl0eSAoT0FJKSDjgYzkvZzmiJDjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpDbG91ZEZyb250OjpDbG91ZEZyb250T3JpZ2luQWNjZXNzSWRlbnRpdHknLCAxKTtcclxuICAgIFxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkNsb3VkRnJvbnRPcmlnaW5BY2Nlc3NJZGVudGl0eScsIHtcclxuICAgICAgQ2xvdWRGcm9udE9yaWdpbkFjY2Vzc0lkZW50aXR5Q29uZmlnOiB7XHJcbiAgICAgICAgQ29tbWVudDogJ09BSSBmb3IgVERuZXQgRGFzaGJvYXJkICh0ZXN0KScsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnUzPjg5DjgrHjg4Pjg4jjg53jg6rjgrfjg7zjgatPQUnjgYvjgonjga7oqq3jgb/lj5bjgormqKnpmZDjgYzov73liqDjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTMzo6QnVja2V0UG9saWN5Jywge1xyXG4gICAgICBQb2xpY3lEb2N1bWVudDoge1xyXG4gICAgICAgIFN0YXRlbWVudDogTWF0Y2guYXJyYXlXaXRoKFtcclxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xyXG4gICAgICAgICAgICBBY3Rpb246ICdzMzpHZXRPYmplY3QnLFxyXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXHJcbiAgICAgICAgICAgIFByaW5jaXBhbDoge1xyXG4gICAgICAgICAgICAgIENhbm9uaWNhbFVzZXI6IE1hdGNoLmFueVZhbHVlKCksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIFJlc291cmNlOiBNYXRjaC5hbnlWYWx1ZSgpLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgXSksXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnSFRUUFPlvLfliLbjgYzoqK3lrprjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XHJcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xyXG4gICAgICAgIERlZmF1bHRDYWNoZUJlaGF2aW9yOiB7XHJcbiAgICAgICAgICBWaWV3ZXJQcm90b2NvbFBvbGljeTogJ3JlZGlyZWN0LXRvLWh0dHBzJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ2luZGV4Lmh0bWznlKjjga7jgq3jg6Pjg4Pjgrfjg6Xjg53jg6rjgrfjg7zjgYzkvZzmiJDjgZXjgozjgovvvIhUVEw6IDYw56eS77yJJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IERhc2hib2FyZENsb3VkRnJvbnQoc3RhY2ssICdUZXN0Q2xvdWRGcm9udCcsIHtcclxuICAgICAgZGFzaGJvYXJkQnVja2V0LFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGcm9udDo6Q2FjaGVQb2xpY3knLCB7XHJcbiAgICAgIENhY2hlUG9saWN5Q29uZmlnOiB7XHJcbiAgICAgICAgTmFtZTogJ3RkbmV0LWRhc2hib2FyZC1pbmRleC10ZXN0JyxcclxuICAgICAgICBEZWZhdWx0VFRMOiA2MCxcclxuICAgICAgICBNaW5UVEw6IDAsXHJcbiAgICAgICAgTWF4VFRMOiA2MCxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfpnZnnmoTjgqLjgrvjg4Pjg4jnlKjjga7jgq3jg6Pjg4Pjgrfjg6Xjg53jg6rjgrfjg7zjgYzkvZzmiJDjgZXjgozjgovvvIhUVEw6IDHml6XvvIknLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpDYWNoZVBvbGljeScsIHtcclxuICAgICAgQ2FjaGVQb2xpY3lDb25maWc6IHtcclxuICAgICAgICBOYW1lOiAndGRuZXQtZGFzaGJvYXJkLWFzc2V0cy10ZXN0JyxcclxuICAgICAgICBEZWZhdWx0VFRMOiA4NjQwMCwgLy8gMeaXpSA9IDg2NDAw56eSXHJcbiAgICAgICAgTWluVFRMOiAwLFxyXG4gICAgICAgIE1heFRUTDogMzE1MzYwMDAsIC8vIDM2NeaXpVxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ+mdmeeahOOCouOCu+ODg+ODiOeUqOOBrui/veWKoOODk+ODmOOCpOODk+OCouOBjOioreWumuOBleOCjOOCiycsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBEYXNoYm9hcmRDbG91ZEZyb250KHN0YWNrLCAnVGVzdENsb3VkRnJvbnQnLCB7XHJcbiAgICAgIGRhc2hib2FyZEJ1Y2tldCxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcclxuICAgICAgRGlzdHJpYnV0aW9uQ29uZmlnOiB7XHJcbiAgICAgICAgQ2FjaGVCZWhhdmlvcnM6IE1hdGNoLmFycmF5V2l0aChbXHJcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcclxuICAgICAgICAgICAgUGF0aFBhdHRlcm46ICcvc3RhdGljLyonLFxyXG4gICAgICAgICAgICBWaWV3ZXJQcm90b2NvbFBvbGljeTogJ3JlZGlyZWN0LXRvLWh0dHBzJyxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XHJcbiAgICAgICAgICAgIFBhdGhQYXR0ZXJuOiAnKi5qcycsXHJcbiAgICAgICAgICAgIFZpZXdlclByb3RvY29sUG9saWN5OiAncmVkaXJlY3QtdG8taHR0cHMnLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcclxuICAgICAgICAgICAgUGF0aFBhdHRlcm46ICcqLmNzcycsXHJcbiAgICAgICAgICAgIFZpZXdlclByb3RvY29sUG9saWN5OiAncmVkaXJlY3QtdG8taHR0cHMnLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgXSksXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgnU1BB55So44Ko44Op44O844Oa44O844K46Kit5a6a77yINDA0LzQwMyDihpIgaW5kZXguaHRtbO+8ieOBjOioreWumuOBleOCjOOCiycsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBEYXNoYm9hcmRDbG91ZEZyb250KHN0YWNrLCAnVGVzdENsb3VkRnJvbnQnLCB7XHJcbiAgICAgIGRhc2hib2FyZEJ1Y2tldCxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcclxuICAgICAgRGlzdHJpYnV0aW9uQ29uZmlnOiB7XHJcbiAgICAgICAgQ3VzdG9tRXJyb3JSZXNwb25zZXM6IE1hdGNoLmFycmF5V2l0aChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEVycm9yQ29kZTogNDA0LFxyXG4gICAgICAgICAgICBSZXNwb25zZUNvZGU6IDIwMCxcclxuICAgICAgICAgICAgUmVzcG9uc2VQYWdlUGF0aDogJy9pbmRleC5odG1sJyxcclxuICAgICAgICAgICAgRXJyb3JDYWNoaW5nTWluVFRMOiA2MCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEVycm9yQ29kZTogNDAzLFxyXG4gICAgICAgICAgICBSZXNwb25zZUNvZGU6IDIwMCxcclxuICAgICAgICAgICAgUmVzcG9uc2VQYWdlUGF0aDogJy9pbmRleC5odG1sJyxcclxuICAgICAgICAgICAgRXJyb3JDYWNoaW5nTWluVFRMOiA2MCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgXSksXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgn44OH44OV44Kp44Or44OI44Or44O844OI44Kq44OW44K444Kn44Kv44OI44GMaW5kZXguaHRtbOOBq+ioreWumuOBleOCjOOCiycsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBEYXNoYm9hcmRDbG91ZEZyb250KHN0YWNrLCAnVGVzdENsb3VkRnJvbnQnLCB7XHJcbiAgICAgIGRhc2hib2FyZEJ1Y2tldCxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcclxuICAgICAgRGlzdHJpYnV0aW9uQ29uZmlnOiB7XHJcbiAgICAgICAgRGVmYXVsdFJvb3RPYmplY3Q6ICdpbmRleC5odG1sJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCflnKfnuK7jgYzmnInlirnljJbjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XHJcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xyXG4gICAgICAgIERlZmF1bHRDYWNoZUJlaGF2aW9yOiB7XHJcbiAgICAgICAgICBDb21wcmVzczogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ+S+oeagvOOCr+ODqeOCueOBjFBSSUNFX0NMQVNTXzEwMOOBq+ioreWumuOBleOCjOOCi++8iOOCs+OCueODiOacgOmBqeWMlu+8iScsICgpID0+IHtcclxuICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgIG5ldyBEYXNoYm9hcmRDbG91ZEZyb250KHN0YWNrLCAnVGVzdENsb3VkRnJvbnQnLCB7XHJcbiAgICAgIGRhc2hib2FyZEJ1Y2tldCxcclxuICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFzc2VydFxyXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcclxuICAgICAgRGlzdHJpYnV0aW9uQ29uZmlnOiB7XHJcbiAgICAgICAgUHJpY2VDbGFzczogJ1ByaWNlQ2xhc3NfMTAwJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCdIVFRQLzLjgahIVFRQLzPjgYzmnInlirnljJbjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XHJcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xyXG4gICAgICAgIEh0dHBWZXJzaW9uOiAnaHR0cDJhbmQzJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCfmnIDlsI9UTFPjg5Djg7zjgrjjg6fjg7PjgYxUTFN2MS4y44Gr6Kit5a6a44GV44KM44KLJywgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZSAmIEFjdFxyXG4gICAgbmV3IERhc2hib2FyZENsb3VkRnJvbnQoc3RhY2ssICdUZXN0Q2xvdWRGcm9udCcsIHtcclxuICAgICAgZGFzaGJvYXJkQnVja2V0LFxyXG4gICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXNzZXJ0XHJcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGcm9udDo6RGlzdHJpYnV0aW9uJywge1xyXG4gICAgICBEaXN0cmlidXRpb25Db25maWc6IHtcclxuICAgICAgICBWaWV3ZXJDZXJ0aWZpY2F0ZToge1xyXG4gICAgICAgICAgTWluaW11bVByb3RvY29sVmVyc2lvbjogJ1RMU3YxLjJfMjAyMScsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBVUkzjgYxDZm5PdXRwdXTjgajjgZfjgablh7rlipvjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIHRlbXBsYXRlLmhhc091dHB1dCgnVGVzdENsb3VkRnJvbnREaXN0cmlidXRpb25Eb21haW5OYW1lKicsIHtcclxuICAgICAgRGVzY3JpcHRpb246ICdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBEb21haW4gTmFtZScsXHJcbiAgICAgIEV4cG9ydDoge1xyXG4gICAgICAgIE5hbWU6ICd0ZG5ldC1kYXNoYm9hcmQtZG9tYWluLXRlc3QnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGVtcGxhdGUuaGFzT3V0cHV0KCdUZXN0Q2xvdWRGcm9udERpc3RyaWJ1dGlvbklkKicsIHtcclxuICAgICAgRGVzY3JpcHRpb246ICdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBJRCcsXHJcbiAgICAgIEV4cG9ydDoge1xyXG4gICAgICAgIE5hbWU6ICd0ZG5ldC1kYXNoYm9hcmQtZGlzdHJpYnV0aW9uLWlkLXRlc3QnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGVtcGxhdGUuaGFzT3V0cHV0KCdUZXN0Q2xvdWRGcm9udERhc2hib2FyZFVybConLCB7XHJcbiAgICAgIERlc2NyaXB0aW9uOiAnVERuZXQgRGFzaGJvYXJkIFVSTCcsXHJcbiAgICAgIEV4cG9ydDoge1xyXG4gICAgICAgIE5hbWU6ICd0ZG5ldC1kYXNoYm9hcmQtdXJsLXRlc3QnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ0d6aXDlnKfnuK7jgahCcm90bGnlnKfnuK7jgYzmnInlirnljJbjgZXjgozjgosnLCAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICBuZXcgRGFzaGJvYXJkQ2xvdWRGcm9udChzdGFjaywgJ1Rlc3RDbG91ZEZyb250Jywge1xyXG4gICAgICBkYXNoYm9hcmRCdWNrZXQsXHJcbiAgICAgIGVudmlyb25tZW50OiAndGVzdCcsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBc3NlcnRcclxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICAgIFxyXG4gICAgLy8g44Kt44Oj44OD44K344Ol44Od44Oq44K344O844GnR3ppcOOBqEJyb3RsaeOBjOacieWKueWMluOBleOCjOOBpuOBhOOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkNhY2hlUG9saWN5Jywge1xyXG4gICAgICBDYWNoZVBvbGljeUNvbmZpZzoge1xyXG4gICAgICAgIFBhcmFtZXRlcnNJbkNhY2hlS2V5QW5kRm9yd2FyZGVkVG9PcmlnaW46IHtcclxuICAgICAgICAgIEVuYWJsZUFjY2VwdEVuY29kaW5nR3ppcDogdHJ1ZSxcclxuICAgICAgICAgIEVuYWJsZUFjY2VwdEVuY29kaW5nQnJvdGxpOiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==