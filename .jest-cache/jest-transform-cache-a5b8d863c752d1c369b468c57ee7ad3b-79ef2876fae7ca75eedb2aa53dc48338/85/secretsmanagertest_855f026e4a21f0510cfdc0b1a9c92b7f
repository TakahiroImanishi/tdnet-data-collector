dcb57727db53c68cf3373c387330c443
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const assertions_1 = require("aws-cdk-lib/assertions");
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const secrets_manager_1 = require("../lib/constructs/secrets-manager");
describe('SecretsManagerConstruct', () => {
    let app;
    let stack;
    let template;
    beforeEach(() => {
        app = new cdk.App();
        stack = new cdk.Stack(app, 'TestStack');
    });
    describe('シークレット作成', () => {
        it('シークレット名が /tdnet/api-key であること', () => {
            // Arrange & Act
            new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            template = assertions_1.Template.fromStack(stack);
            // Assert
            template.hasResourceProperties('AWS::SecretsManager::Secret', {
                Name: '/tdnet/api-key',
            });
        });
        it('シークレットの説明が設定されていること', () => {
            // Arrange & Act
            new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            template = assertions_1.Template.fromStack(stack);
            // Assert
            template.hasResourceProperties('AWS::SecretsManager::Secret', {
                Description: 'TDnet API Key for authentication',
            });
        });
        it('シークレットが自動生成設定を持つこと', () => {
            // Arrange & Act
            new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            template = assertions_1.Template.fromStack(stack);
            // Assert
            template.hasResourceProperties('AWS::SecretsManager::Secret', {
                GenerateSecretString: {
                    SecretStringTemplate: '{"apiKey":""}',
                    GenerateStringKey: 'apiKey',
                    ExcludePunctuation: true,
                    PasswordLength: 32,
                },
            });
        });
        it('シークレットが暗号化されていること（デフォルトのAWS管理キー）', () => {
            // Arrange & Act
            new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            template = assertions_1.Template.fromStack(stack);
            // Assert
            // KmsKeyIdが指定されていない場合、デフォルトのAWS管理キーが使用される
            template.hasResourceProperties('AWS::SecretsManager::Secret', {
                KmsKeyId: assertions_1.Match.absent(),
            });
        });
    });
    describe('Lambda関数へのアクセス権限', () => {
        it('Lambda関数にシークレット読み取り権限が付与されること', () => {
            // Arrange
            const secretsManager = new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            const testFunction = new lambda.Function(stack, 'TestFunction', {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromInline('exports.handler = async () => {}'),
            });
            // Act
            secretsManager.grantRead(testFunction);
            template = assertions_1.Template.fromStack(stack);
            // Assert
            // Lambda関数のロールにシークレット読み取りポリシーが追加されていることを確認
            template.hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Action: ['secretsmanager:GetSecretValue', 'secretsmanager:DescribeSecret'],
                            Effect: 'Allow',
                            Resource: {
                                Ref: assertions_1.Match.stringLikeRegexp('SecretsManagerApiKeySecret'),
                            },
                        }),
                    ]),
                },
            });
        });
        it('複数のLambda関数にシークレット読み取り権限が付与されること', () => {
            // Arrange
            const secretsManager = new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            const queryFunction = new lambda.Function(stack, 'QueryFunction', {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromInline('exports.handler = async () => {}'),
            });
            const exportFunction = new lambda.Function(stack, 'ExportFunction', {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromInline('exports.handler = async () => {}'),
            });
            // Act
            secretsManager.grantRead(queryFunction);
            secretsManager.grantRead(exportFunction);
            template = assertions_1.Template.fromStack(stack);
            // Assert
            // 各Lambda関数のロールにシークレット読み取りポリシーが追加されていることを確認
            const allPolicies = template.findResources('AWS::IAM::Policy');
            const secretsPolicies = Object.values(allPolicies).filter((policy) => {
                const statements = policy.Properties?.PolicyDocument?.Statement || [];
                return statements.some((stmt) => Array.isArray(stmt.Action) &&
                    stmt.Action.includes('secretsmanager:GetSecretValue'));
            });
            // 少なくとも2つのシークレット読み取りポリシーが存在することを確認
            expect(secretsPolicies.length).toBeGreaterThanOrEqual(2);
        });
    });
    describe('ヘルパーメソッド', () => {
        it('getSecretArn() がシークレットARNを返すこと', () => {
            // Arrange
            const secretsManager = new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            // Act
            const secretArn = secretsManager.getSecretArn();
            // Assert
            expect(secretArn).toBeDefined();
            expect(typeof secretArn).toBe('string');
        });
        it('getSecretValue() がSecretValue型を返すこと', () => {
            // Arrange
            const secretsManager = new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            // Act
            const secretValue = secretsManager.getSecretValue();
            // Assert
            expect(secretValue).toBeDefined();
            // SecretValue型は unsafeUnwrap() メソッドを持つ
            expect(typeof secretValue.unsafeUnwrap).toBe('function');
        });
    });
    describe('削除保護', () => {
        it('シークレットが削除保護されていること（RETAIN）', () => {
            // Arrange & Act
            new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            template = assertions_1.Template.fromStack(stack);
            // Assert
            // DeletionPolicyがRetainであることを確認
            const secrets = template.findResources('AWS::SecretsManager::Secret');
            const secretKeys = Object.keys(secrets);
            expect(secretKeys.length).toBe(1);
            const secretResource = secrets[secretKeys[0]];
            expect(secretResource.DeletionPolicy).toBe('Retain');
        });
    });
    describe('統合テスト', () => {
        it('SecretsManagerConstructが正しくスタックに統合されること', () => {
            // Arrange & Act
            const secretsManager = new secrets_manager_1.SecretsManagerConstruct(stack, 'SecretsManager');
            const testFunction = new lambda.Function(stack, 'TestFunction', {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromInline('exports.handler = async () => {}'),
                environment: {
                    API_KEY_SECRET_ARN: secretsManager.getSecretArn(),
                },
            });
            secretsManager.grantRead(testFunction);
            template = assertions_1.Template.fromStack(stack);
            // Assert
            // 1. シークレットが作成されていること
            template.resourceCountIs('AWS::SecretsManager::Secret', 1);
            // 2. Lambda関数が作成されていること
            template.resourceCountIs('AWS::Lambda::Function', 1);
            // 3. Lambda関数の環境変数にシークレットARNが設定されていること
            template.hasResourceProperties('AWS::Lambda::Function', {
                Environment: {
                    Variables: {
                        API_KEY_SECRET_ARN: {
                            Ref: assertions_1.Match.stringLikeRegexp('SecretsManagerApiKeySecret'),
                        },
                    },
                },
            });
            // 4. IAMポリシーが作成されていること
            template.resourceCountIs('AWS::IAM::Policy', 1);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXHNlY3JldHMtbWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsaURBQW1DO0FBQ25DLHVEQUF5RDtBQUN6RCwrREFBaUQ7QUFDakQsdUVBQTRFO0FBRTVFLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7SUFDdkMsSUFBSSxHQUFZLENBQUM7SUFDakIsSUFBSSxLQUFnQixDQUFDO0lBQ3JCLElBQUksUUFBa0IsQ0FBQztJQUV2QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7UUFDeEIsRUFBRSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtZQUN2QyxnQkFBZ0I7WUFDaEIsSUFBSSx5Q0FBdUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUNyRCxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFckMsU0FBUztZQUNULFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyw2QkFBNkIsRUFBRTtnQkFDNUQsSUFBSSxFQUFFLGdCQUFnQjthQUN2QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7WUFDN0IsZ0JBQWdCO1lBQ2hCLElBQUkseUNBQXVCLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFDckQsUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxD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dkMsUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXJDLFNBQVM7WUFDVCxzQkFBc0I7WUFDdEIsUUFBUSxDQUFDLGVBQWUsQ0FBQyw2QkFBNkIsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUUzRCx3QkFBd0I7WUFDeEIsUUFBUSxDQUFDLGVBQWUsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUVyRCx1Q0FBdUM7WUFDdkMsUUFBUSxDQUFDLHFCQUFxQixDQUFDLHVCQUF1QixFQUFFO2dCQUN0RCxXQUFXLEVBQUU7b0JBQ1gsU0FBUyxFQUFFO3dCQUNULGtCQUFrQixFQUFFOzRCQUNsQixHQUFHLEVBQUUsa0JBQUssQ0FBQyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBQzt5QkFDMUQ7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCx1QkFBdUI7WUFDdkIsUUFBUSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXHNlY3JldHMtbWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCB7IFRlbXBsYXRlLCBNYXRjaCB9IGZyb20gJ2F3cy1jZGstbGliL2Fzc2VydGlvbnMnO1xyXG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0IH0gZnJvbSAnLi4vbGliL2NvbnN0cnVjdHMvc2VjcmV0cy1tYW5hZ2VyJztcclxuXHJcbmRlc2NyaWJlKCdTZWNyZXRzTWFuYWdlckNvbnN0cnVjdCcsICgpID0+IHtcclxuICBsZXQgYXBwOiBjZGsuQXBwO1xyXG4gIGxldCBzdGFjazogY2RrLlN0YWNrO1xyXG4gIGxldCB0ZW1wbGF0ZTogVGVtcGxhdGU7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgYXBwID0gbmV3IGNkay5BcHAoKTtcclxuICAgIHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdUZXN0U3RhY2snKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+OCt+ODvOOCr+ODrOODg+ODiOS9nOaIkCcsICgpID0+IHtcclxuICAgIGl0KCfjgrfjg7zjgq/jg6zjg4Pjg4jlkI3jgYwgL3RkbmV0L2FwaS1rZXkg44Gn44GC44KL44GT44GoJywgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICAgIG5ldyBTZWNyZXRzTWFuYWdlckNvbnN0cnVjdChzdGFjaywgJ1NlY3JldHNNYW5hZ2VyJyk7XHJcbiAgICAgIHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6U2VjcmV0c01hbmFnZXI6OlNlY3JldCcsIHtcclxuICAgICAgICBOYW1lOiAnL3RkbmV0L2FwaS1rZXknLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgrfjg7zjgq/jg6zjg4Pjg4jjga7oqqzmmI7jgYzoqK3lrprjgZXjgozjgabjgYTjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgICAgbmV3IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0KHN0YWNrLCAnU2VjcmV0c01hbmFnZXInKTtcclxuICAgICAgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jywge1xyXG4gICAgICAgIERlc2NyaXB0aW9uOiAnVERuZXQgQVBJIEtleSBmb3IgYXV0aGVudGljYXRpb24nLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgrfjg7zjgq/jg6zjg4Pjg4jjgYzoh6rli5XnlJ/miJDoqK3lrprjgpLmjIHjgaTjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgICAgbmV3IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0KHN0YWNrLCAnU2VjcmV0c01hbmFnZXInKTtcclxuICAgICAgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jywge1xyXG4gICAgICAgIEdlbmVyYXRlU2VjcmV0U3RyaW5nOiB7XHJcbiAgICAgICAgICBTZWNyZXRTdHJpbmdUZW1wbGF0ZTogJ3tcImFwaUtleVwiOlwiXCJ9JyxcclxuICAgICAgICAgIEdlbmVyYXRlU3RyaW5nS2V5OiAnYXBpS2V5JyxcclxuICAgICAgICAgIEV4Y2x1ZGVQdW5jdHVhdGlvbjogdHJ1ZSxcclxuICAgICAgICAgIFBhc3N3b3JkTGVuZ3RoOiAzMixcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgrfjg7zjgq/jg6zjg4Pjg4jjgYzmmpflj7fljJbjgZXjgozjgabjgYTjgovjgZPjgajvvIjjg4fjg5Xjgqnjg6vjg4jjga5BV1PnrqHnkIbjgq3jg7zvvIknLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgICAgbmV3IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0KHN0YWNrLCAnU2VjcmV0c01hbmFnZXInKTtcclxuICAgICAgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIC8vIEttc0tleUlk44GM5oyH5a6a44GV44KM44Gm44GE44Gq44GE5aC05ZCI44CB44OH44OV44Kp44Or44OI44GuQVdT566h55CG44Kt44O844GM5L2/55So44GV44KM44KLXHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jywge1xyXG4gICAgICAgIEttc0tleUlkOiBNYXRjaC5hYnNlbnQoKSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0xhbWJkYemWouaVsOOBuOOBruOCouOCr+OCu+OCueaoqemZkCcsICgpID0+IHtcclxuICAgIGl0KCdMYW1iZGHplqLmlbDjgavjgrfjg7zjgq/jg6zjg4Pjg4joqq3jgb/lj5bjgormqKnpmZDjgYzku5jkuI7jgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3Qgc2VjcmV0c01hbmFnZXIgPSBuZXcgU2VjcmV0c01hbmFnZXJDb25zdHJ1Y3Qoc3RhY2ssICdTZWNyZXRzTWFuYWdlcicpO1xyXG4gICAgICBjb25zdCB0ZXN0RnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHN0YWNrLCAnVGVzdEZ1bmN0aW9uJywge1xyXG4gICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcclxuICAgICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tSW5saW5lKCdleHBvcnRzLmhhbmRsZXIgPSBhc3luYyAoKSA9PiB7fScpLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBzZWNyZXRzTWFuYWdlci5ncmFudFJlYWQodGVzdEZ1bmN0aW9uKTtcclxuICAgICAgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIC8vIExhbWJkYemWouaVsOOBruODreODvOODq+OBq+OCt+ODvOOCr+ODrOODg+ODiOiqreOBv+WPluOCiuODneODquOCt+ODvOOBjOi/veWKoOOBleOCjOOBpuOBhOOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpQb2xpY3knLCB7XHJcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcclxuICAgICAgICAgIFN0YXRlbWVudDogTWF0Y2guYXJyYXlXaXRoKFtcclxuICAgICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XHJcbiAgICAgICAgICAgICAgQWN0aW9uOiBbJ3NlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlJywgJ3NlY3JldHNtYW5hZ2VyOkRlc2NyaWJlU2VjcmV0J10sXHJcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxyXG4gICAgICAgICAgICAgIFJlc291cmNlOiB7XHJcbiAgICAgICAgICAgICAgICBSZWY6IE1hdGNoLnN0cmluZ0xpa2VSZWdleHAoJ1NlY3JldHNNYW5hZ2VyQXBpS2V5U2VjcmV0JyksXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICBdKSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfopIfmlbDjga5MYW1iZGHplqLmlbDjgavjgrfjg7zjgq/jg6zjg4Pjg4joqq3jgb/lj5bjgormqKnpmZDjgYzku5jkuI7jgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3Qgc2VjcmV0c01hbmFnZXIgPSBuZXcgU2VjcmV0c01hbmFnZXJDb25zdHJ1Y3Qoc3RhY2ssICdTZWNyZXRzTWFuYWdlcicpO1xyXG4gICAgICBjb25zdCBxdWVyeUZ1bmN0aW9uID0gbmV3IGxhbWJkYS5GdW5jdGlvbihzdGFjaywgJ1F1ZXJ5RnVuY3Rpb24nLCB7XHJcbiAgICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXHJcbiAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxyXG4gICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21JbmxpbmUoJ2V4cG9ydHMuaGFuZGxlciA9IGFzeW5jICgpID0+IHt9JyksXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBleHBvcnRGdW5jdGlvbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24oc3RhY2ssICdFeHBvcnRGdW5jdGlvbicsIHtcclxuICAgICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXHJcbiAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUlubGluZSgnZXhwb3J0cy5oYW5kbGVyID0gYXN5bmMgKCkgPT4ge30nKSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgc2VjcmV0c01hbmFnZXIuZ3JhbnRSZWFkKHF1ZXJ5RnVuY3Rpb24pO1xyXG4gICAgICBzZWNyZXRzTWFuYWdlci5ncmFudFJlYWQoZXhwb3J0RnVuY3Rpb24pO1xyXG4gICAgICB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgLy8g5ZCETGFtYmRh6Zai5pWw44Gu44Ot44O844Or44Gr44K344O844Kv44Os44OD44OI6Kqt44G/5Y+W44KK44Od44Oq44K344O844GM6L+95Yqg44GV44KM44Gm44GE44KL44GT44Go44KS56K66KqNXHJcbiAgICAgIGNvbnN0IGFsbFBvbGljaWVzID0gdGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpJQU06OlBvbGljeScpO1xyXG4gICAgICBjb25zdCBzZWNyZXRzUG9saWNpZXMgPSBPYmplY3QudmFsdWVzKGFsbFBvbGljaWVzKS5maWx0ZXIoKHBvbGljeTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc3RhdGVtZW50cyA9IHBvbGljeS5Qcm9wZXJ0aWVzPy5Qb2xpY3lEb2N1bWVudD8uU3RhdGVtZW50IHx8IFtdO1xyXG4gICAgICAgIHJldHVybiBzdGF0ZW1lbnRzLnNvbWUoKHN0bXQ6IGFueSkgPT4gXHJcbiAgICAgICAgICBBcnJheS5pc0FycmF5KHN0bXQuQWN0aW9uKSAmJiBcclxuICAgICAgICAgIHN0bXQuQWN0aW9uLmluY2x1ZGVzKCdzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZScpXHJcbiAgICAgICAgKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyDlsJHjgarjgY/jgajjgoIy44Gk44Gu44K344O844Kv44Os44OD44OI6Kqt44G/5Y+W44KK44Od44Oq44K344O844GM5a2Y5Zyo44GZ44KL44GT44Go44KS56K66KqNXHJcbiAgICAgIGV4cGVjdChzZWNyZXRzUG9saWNpZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDIpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfjg5jjg6vjg5Hjg7zjg6Hjgr3jg4Pjg4knLCAoKSA9PiB7XHJcbiAgICBpdCgnZ2V0U2VjcmV0QXJuKCkg44GM44K344O844Kv44Os44OD44OIQVJO44KS6L+U44GZ44GT44GoJywgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHNlY3JldHNNYW5hZ2VyID0gbmV3IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0KHN0YWNrLCAnU2VjcmV0c01hbmFnZXInKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCBzZWNyZXRBcm4gPSBzZWNyZXRzTWFuYWdlci5nZXRTZWNyZXRBcm4oKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3Qoc2VjcmV0QXJuKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHNlY3JldEFybikudG9CZSgnc3RyaW5nJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZ2V0U2VjcmV0VmFsdWUoKSDjgYxTZWNyZXRWYWx1ZeWei+OCkui/lOOBmeOBk+OBqCcsICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzZWNyZXRzTWFuYWdlciA9IG5ldyBTZWNyZXRzTWFuYWdlckNvbnN0cnVjdChzdGFjaywgJ1NlY3JldHNNYW5hZ2VyJyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3Qgc2VjcmV0VmFsdWUgPSBzZWNyZXRzTWFuYWdlci5nZXRTZWNyZXRWYWx1ZSgpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChzZWNyZXRWYWx1ZSkudG9CZURlZmluZWQoKTtcclxuICAgICAgLy8gU2VjcmV0VmFsdWXlnovjga8gdW5zYWZlVW53cmFwKCkg44Oh44K944OD44OJ44KS5oyB44GkXHJcbiAgICAgIGV4cGVjdCh0eXBlb2Ygc2VjcmV0VmFsdWUudW5zYWZlVW53cmFwKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfliYrpmaTkv53orbcnLCAoKSA9PiB7XHJcbiAgICBpdCgn44K344O844Kv44Os44OD44OI44GM5YmK6Zmk5L+d6K2344GV44KM44Gm44GE44KL44GT44Go77yIUkVUQUlO77yJJywgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlICYgQWN0XHJcbiAgICAgIG5ldyBTZWNyZXRzTWFuYWdlckNvbnN0cnVjdChzdGFjaywgJ1NlY3JldHNNYW5hZ2VyJyk7XHJcbiAgICAgIHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICAvLyBEZWxldGlvblBvbGljeeOBjFJldGFpbuOBp+OBguOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgICBjb25zdCBzZWNyZXRzID0gdGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jyk7XHJcbiAgICAgIGNvbnN0IHNlY3JldEtleXMgPSBPYmplY3Qua2V5cyhzZWNyZXRzKTtcclxuICAgICAgZXhwZWN0KHNlY3JldEtleXMubGVuZ3RoKS50b0JlKDEpO1xyXG5cclxuICAgICAgY29uc3Qgc2VjcmV0UmVzb3VyY2UgPSBzZWNyZXRzW3NlY3JldEtleXNbMF1dO1xyXG4gICAgICBleHBlY3Qoc2VjcmV0UmVzb3VyY2UuRGVsZXRpb25Qb2xpY3kpLnRvQmUoJ1JldGFpbicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfntbHlkIjjg4bjgrnjg4gnLCAoKSA9PiB7XHJcbiAgICBpdCgnU2VjcmV0c01hbmFnZXJDb25zdHJ1Y3TjgYzmraPjgZfjgY/jgrnjgr/jg4Pjgq/jgavntbHlkIjjgZXjgozjgovjgZPjgagnLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2UgJiBBY3RcclxuICAgICAgY29uc3Qgc2VjcmV0c01hbmFnZXIgPSBuZXcgU2VjcmV0c01hbmFnZXJDb25zdHJ1Y3Qoc3RhY2ssICdTZWNyZXRzTWFuYWdlcicpO1xyXG4gICAgICBjb25zdCB0ZXN0RnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHN0YWNrLCAnVGVzdEZ1bmN0aW9uJywge1xyXG4gICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcclxuICAgICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tSW5saW5lKCdleHBvcnRzLmhhbmRsZXIgPSBhc3luYyAoKSA9PiB7fScpLFxyXG4gICAgICAgIGVudmlyb25tZW50OiB7XHJcbiAgICAgICAgICBBUElfS0VZX1NFQ1JFVF9BUk46IHNlY3JldHNNYW5hZ2VyLmdldFNlY3JldEFybigpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBzZWNyZXRzTWFuYWdlci5ncmFudFJlYWQodGVzdEZ1bmN0aW9uKTtcclxuICAgICAgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIC8vIDEuIOOCt+ODvOOCr+ODrOODg+ODiOOBjOS9nOaIkOOBleOCjOOBpuOBhOOCi+OBk+OBqFxyXG4gICAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6U2VjcmV0c01hbmFnZXI6OlNlY3JldCcsIDEpO1xyXG5cclxuICAgICAgLy8gMi4gTGFtYmRh6Zai5pWw44GM5L2c5oiQ44GV44KM44Gm44GE44KL44GT44GoXHJcbiAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpMYW1iZGE6OkZ1bmN0aW9uJywgMSk7XHJcblxyXG4gICAgICAvLyAzLiBMYW1iZGHplqLmlbDjga7nkrDlooPlpInmlbDjgavjgrfjg7zjgq/jg6zjg4Pjg4hBUk7jgYzoqK3lrprjgZXjgozjgabjgYTjgovjgZPjgahcclxuICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkxhbWJkYTo6RnVuY3Rpb24nLCB7XHJcbiAgICAgICAgRW52aXJvbm1lbnQ6IHtcclxuICAgICAgICAgIFZhcmlhYmxlczoge1xyXG4gICAgICAgICAgICBBUElfS0VZX1NFQ1JFVF9BUk46IHtcclxuICAgICAgICAgICAgICBSZWY6IE1hdGNoLnN0cmluZ0xpa2VSZWdleHAoJ1NlY3JldHNNYW5hZ2VyQXBpS2V5U2VjcmV0JyksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gNC4gSUFN44Od44Oq44K344O844GM5L2c5oiQ44GV44KM44Gm44GE44KL44GT44GoXHJcbiAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpJQU06OlBvbGljeScsIDEpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=