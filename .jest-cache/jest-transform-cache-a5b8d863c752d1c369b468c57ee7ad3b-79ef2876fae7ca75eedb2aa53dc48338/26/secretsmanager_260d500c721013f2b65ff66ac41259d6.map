{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\constructs\\secrets-manager.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+EAAiE;AAEjE,iDAAmC;AACnC,2CAAuC;AAEvC;;;;;;;;;;GAUG;AACH,MAAa,uBAAwB,SAAQ,sBAAS;IACpD;;;;;OAKG;IACa,YAAY,CAAwB;IAEpD,YAAY,KAAgB,EAAE,EAAU;QACtC,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QAEjB,gBAAgB;QAChB,IAAI,CAAC,YAAY,GAAG,IAAI,cAAc,CAAC,MAAM,CAAC,IAAI,EAAE,cAAc,EAAE;YAClE,UAAU,EAAE,gBAAgB;YAC5B,WAAW,EAAE,kCAAkC;YAC/C,iBAAiB;YACjB,oBAAoB,EAAE;gBACpB,oBAAoB,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC;gBACpD,iBAAiB,EAAE,QAAQ;gBAC3B,kBAAkB,EAAE,IAAI;gBACxB,cAAc,EAAE,EAAE;aACnB;YACD,oBAAoB;YACpB,aAAa,EAAE,SAAS,EAAE,mBAAmB;YAC7C,SAAS;YACT,aAAa,EAAE,GAAG,CAAC,aAAa,CAAC,MAAM,EAAE,aAAa;SACvD,CAAC,CAAC;QAEH,+BAA+B;QAC/B,iCAAiC;QACjC,GAAG;QACH,OAAO;QACP,8DAA8D;QAC9D,sCAAsC;QACtC,gEAAgE;QAChE,MAAM;IACR,CAAC;IAED;;;;;;;;;;;OAWG;IACI,SAAS,CAAC,cAA+B;QAC9C,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;IAC9C,CAAC;IAED;;;;;;OAMG;IACI,YAAY;QACjB,OAAO,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC;IACrC,CAAC;IAED;;;;;;;OAOG;IACI,cAAc;QACnB,OAAO,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC;IACvC,CAAC;CACF;AA7ED,0DA6EC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\constructs\\secrets-manager.ts"],"sourcesContent":["import * as secretsmanager from 'aws-cdk-lib/aws-secretsmanager';\r\nimport * as lambda from 'aws-cdk-lib/aws-lambda';\r\nimport * as cdk from 'aws-cdk-lib';\r\nimport { Construct } from 'constructs';\r\n\r\n/**\r\n * Secrets Manager Construct\r\n * \r\n * TDnet Data CollectorプロジェクトのAPIキーを安全に管理するための\r\n * AWS Secrets Managerリソースを定義します。\r\n * \r\n * 機能:\r\n * - /tdnet/api-key シークレットの作成\r\n * - Lambda関数へのシークレット読み取り権限付与\r\n * - 自動ローテーション設定（Phase 4で実装予定）\r\n */\r\nexport class SecretsManagerConstruct extends Construct {\r\n  /**\r\n   * APIキーシークレット\r\n   * \r\n   * シークレット名: /tdnet/api-key\r\n   * フォーマット: { \"apiKey\": \"your-api-key-here\" }\r\n   */\r\n  public readonly apiKeySecret: secretsmanager.Secret;\r\n\r\n  constructor(scope: Construct, id: string) {\r\n    super(scope, id);\r\n\r\n    // APIキーシークレット作成\r\n    this.apiKeySecret = new secretsmanager.Secret(this, 'ApiKeySecret', {\r\n      secretName: '/tdnet/api-key',\r\n      description: 'TDnet API Key for authentication',\r\n      // シークレット値の初期生成設定\r\n      generateSecretString: {\r\n        secretStringTemplate: JSON.stringify({ apiKey: '' }),\r\n        generateStringKey: 'apiKey',\r\n        excludePunctuation: true,\r\n        passwordLength: 32,\r\n      },\r\n      // 暗号化設定（AWS管理キーを使用）\r\n      encryptionKey: undefined, // デフォルトのAWS管理キーを使用\r\n      // 削除保護設定\r\n      removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護\r\n    });\r\n\r\n    // TODO: Phase 4で自動ローテーション設定を実装\r\n    // 自動ローテーションにはローテーション用Lambda関数が必要\r\n    // \r\n    // 実装例:\r\n    // this.apiKeySecret.addRotationSchedule('RotationSchedule', {\r\n    //   rotationLambda: rotationFunction,\r\n    //   automaticallyAfter: cdk.Duration.days(90), // 90日ごとにローテーション\r\n    // });\r\n  }\r\n\r\n  /**\r\n   * Lambda関数にシークレット読み取り権限を付与\r\n   * \r\n   * @param lambdaFunction - シークレットにアクセスするLambda関数\r\n   * \r\n   * 使用例:\r\n   * ```typescript\r\n   * const secretsManager = new SecretsManagerConstruct(this, 'SecretsManager');\r\n   * secretsManager.grantRead(queryLambda);\r\n   * secretsManager.grantRead(exportLambda);\r\n   * ```\r\n   */\r\n  public grantRead(lambdaFunction: lambda.Function): void {\r\n    this.apiKeySecret.grantRead(lambdaFunction);\r\n  }\r\n\r\n  /**\r\n   * シークレットARNを取得\r\n   * \r\n   * Lambda関数の環境変数に設定する際に使用します。\r\n   * \r\n   * @returns シークレットARN\r\n   */\r\n  public getSecretArn(): string {\r\n    return this.apiKeySecret.secretArn;\r\n  }\r\n\r\n  /**\r\n   * シークレット値を取得（CDK内部でのみ使用）\r\n   * \r\n   * 注意: この値は環境変数に直接設定しないでください。\r\n   * Lambda関数内でAWS SDKを使用してシークレット値を取得してください。\r\n   * \r\n   * @returns シークレット値（SecretValue型）\r\n   */\r\n  public getSecretValue(): secretsmanager.SecretValue {\r\n    return this.apiKeySecret.secretValue;\r\n  }\r\n}\r\n"],"version":3}