eca3725d994f03d2a124bd1d5d3cb8e7
"use strict";
/**
 * DynamoDB Table Structure Verification Test
 *
 * Task 3.2: DynamoDBテーブル構造の検証テスト
 * Requirements: 要件2.5, 13.3（データベース、暗号化）
 *
 * このテストは、CDKで定義されたDynamoDBテーブルが設計通りに構成されていることを検証します。
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const assertions_1 = require("aws-cdk-lib/assertions");
const tdnet_data_collector_stack_1 = require("../lib/tdnet-data-collector-stack");
describe('DynamoDB Tables', () => {
    let template;
    beforeAll(() => {
        const app = new cdk.App();
        const stack = new tdnet_data_collector_stack_1.TdnetDataCollectorStack(app, 'TestStack', {
            env: { account: '123456789012', region: 'ap-northeast-1' },
        });
        template = assertions_1.Template.fromStack(stack);
    });
    describe('tdnet_disclosures table', () => {
        it('should be created with correct configuration', () => {
            // テーブルが存在することを確認
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_disclosures',
                BillingMode: 'PAY_PER_REQUEST', // オンデマンドモード
                SSESpecification: {
                    SSEEnabled: true, // 暗号化有効化
                },
                PointInTimeRecoverySpecification: {
                    PointInTimeRecoveryEnabled: true, // ポイントインタイムリカバリ有効化
                },
            });
        });
        it('should have correct partition key', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_disclosures',
                KeySchema: [
                    {
                        AttributeName: 'disclosure_id',
                        KeyType: 'HASH', // パーティションキー
                    },
                ],
                AttributeDefinitions: assertions_1.Match.arrayWith([
                    {
                        AttributeName: 'disclosure_id',
                        AttributeType: 'S', // String型
                    },
                ]),
            });
        });
        it('should have GSI_CompanyCode_DiscloseDate index', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_disclosures',
                GlobalSecondaryIndexes: assertions_1.Match.arrayWith([
                    {
                        IndexName: 'GSI_CompanyCode_DiscloseDate',
                        KeySchema: [
                            {
                                AttributeName: 'company_code',
                                KeyType: 'HASH', // パーティションキー
                            },
                            {
                                AttributeName: 'disclosed_at',
                                KeyType: 'RANGE', // ソートキー
                            },
                        ],
                        Projection: {
                            ProjectionType: 'ALL', // すべての属性を投影
                        },
                    },
                ]),
                AttributeDefinitions: assertions_1.Match.arrayWith([
                    {
                        AttributeName: 'company_code',
                        AttributeType: 'S',
                    },
                    {
                        AttributeName: 'disclosed_at',
                        AttributeType: 'S',
                    },
                ]),
            });
        });
        it('should have GSI_DatePartition index', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_disclosures',
                GlobalSecondaryIndexes: assertions_1.Match.arrayWith([
                    {
                        IndexName: 'GSI_DatePartition',
                        KeySchema: [
                            {
                                AttributeName: 'date_partition',
                                KeyType: 'HASH', // パーティションキー
                            },
                            {
                                AttributeName: 'disclosed_at',
                                KeyType: 'RANGE', // ソートキー
                            },
                        ],
                        Projection: {
                            ProjectionType: 'ALL',
                        },
                    },
                ]),
                AttributeDefinitions: assertions_1.Match.arrayWith([
                    {
                        AttributeName: 'date_partition',
                        AttributeType: 'S',
                    },
                ]),
            });
        });
        it('should have exactly 2 GSIs', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_disclosures',
                GlobalSecondaryIndexes: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({ IndexName: 'GSI_CompanyCode_DiscloseDate' }),
                    assertions_1.Match.objectLike({ IndexName: 'GSI_DatePartition' }),
                ]),
            });
        });
    });
    describe('tdnet_executions table', () => {
        it('should be created with correct configuration', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_executions',
                BillingMode: 'PAY_PER_REQUEST', // オンデマンドモード
                SSESpecification: {
                    SSEEnabled: true, // 暗号化有効化
                },
                PointInTimeRecoverySpecification: {
                    PointInTimeRecoveryEnabled: true, // ポイントインタイムリカバリ有効化
                },
            });
        });
        it('should have correct partition key', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_executions',
                KeySchema: [
                    {
                        AttributeName: 'execution_id',
                        KeyType: 'HASH', // パーティションキー
                    },
                ],
                AttributeDefinitions: assertions_1.Match.arrayWith([
                    {
                        AttributeName: 'execution_id',
                        AttributeType: 'S', // String型
                    },
                ]),
            });
        });
        it('should have TTL enabled', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_executions',
                TimeToLiveSpecification: {
                    AttributeName: 'ttl',
                    Enabled: true, // TTL有効化
                },
            });
        });
        it('should have GSI_Status_StartedAt index', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_executions',
                GlobalSecondaryIndexes: assertions_1.Match.arrayWith([
                    {
                        IndexName: 'GSI_Status_StartedAt',
                        KeySchema: [
                            {
                                AttributeName: 'status',
                                KeyType: 'HASH', // パーティションキー
                            },
                            {
                                AttributeName: 'started_at',
                                KeyType: 'RANGE', // ソートキー
                            },
                        ],
                        Projection: {
                            ProjectionType: 'ALL',
                        },
                    },
                ]),
                AttributeDefinitions: assertions_1.Match.arrayWith([
                    {
                        AttributeName: 'status',
                        AttributeType: 'S',
                    },
                    {
                        AttributeName: 'started_at',
                        AttributeType: 'S',
                    },
                ]),
            });
        });
        it('should have exactly 1 GSI', () => {
            template.hasResourceProperties('AWS::DynamoDB::Table', {
                TableName: 'tdnet_executions',
                GlobalSecondaryIndexes: [
                    assertions_1.Match.objectLike({ IndexName: 'GSI_Status_StartedAt' }),
                ],
            });
        });
    });
    describe('CloudFormation Outputs', () => {
        it('should export DisclosuresTableName', () => {
            template.hasOutput('DisclosuresTableName', {
                Value: {
                    Ref: assertions_1.Match.stringLikeRegexp('DisclosuresTable'),
                },
                Export: {
                    Name: 'TdnetDisclosuresTableName',
                },
            });
        });
        it('should export ExecutionsTableName', () => {
            template.hasOutput('ExecutionsTableName', {
                Value: {
                    Ref: assertions_1.Match.stringLikeRegexp('ExecutionsTable'),
                },
                Export: {
                    Name: 'TdnetExecutionsTableName',
                },
            });
        });
    });
    describe('Security and Compliance', () => {
        it('should have encryption enabled on all tables', () => {
            // すべてのDynamoDBテーブルで暗号化が有効化されていることを確認
            const tables = template.findResources('AWS::DynamoDB::Table');
            const tableKeys = Object.keys(tables);
            expect(tableKeys.length).toBeGreaterThanOrEqual(2);
            tableKeys.forEach((key) => {
                const table = tables[key];
                expect(table.Properties.SSESpecification).toBeDefined();
                expect(table.Properties.SSESpecification.SSEEnabled).toBe(true);
            });
        });
        it('should have point-in-time recovery enabled on all tables', () => {
            // すべてのDynamoDBテーブルでポイントインタイムリカバリが有効化されていることを確認
            const tables = template.findResources('AWS::DynamoDB::Table');
            const tableKeys = Object.keys(tables);
            tableKeys.forEach((key) => {
                const table = tables[key];
                expect(table.Properties.PointInTimeRecoverySpecification).toBeDefined();
                expect(table.Properties.PointInTimeRecoverySpecification
                    .PointInTimeRecoveryEnabled).toBe(true);
            });
        });
        it('should use on-demand billing mode for cost optimization', () => {
            // すべてのDynamoDBテーブルでオンデマンドモードが使用されていることを確認
            const tables = template.findResources('AWS::DynamoDB::Table');
            const tableKeys = Object.keys(tables);
            tableKeys.forEach((key) => {
                const table = tables[key];
                expect(table.Properties.BillingMode).toBe('PAY_PER_REQUEST');
            });
        });
    });
    describe('Table Count', () => {
        it('should have exactly 2 DynamoDB tables', () => {
            // DynamoDBテーブルが正確に2つ存在することを確認
            template.resourceCountIs('AWS::DynamoDB::Table', 2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGR5bmFtb2RiLXRhYmxlcy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUFtQztBQUNuQyx1REFBeUQ7QUFDekQsa0ZBQTRFO0FBRTVFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxRQUFrQixDQUFDO0lBRXZCLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMxQixNQUFNLEtBQUssR0FBRyxJQUFJLG9EQUF1QixDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUU7WUFDMUQsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsZ0JBQWdCLEVBQUU7U0FDM0QsQ0FBQyxDQUFDO1FBQ0gsUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtRQUN2QyxFQUFFLENBQUMsOENBQThDLEVBQUUsR0FBRyxFQUFFO1lBQ3RELGlCQUFpQjtZQUNqQixRQUFRLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLEVBQUU7Z0JBQ3JELFNBQVMsRUFBRSxtQkFBbUI7Z0JBQzlCLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxZQUFZO2dCQUM1QyxnQkFBZ0IsRUFBRTtvQkFDaEIsVUFBVSxFQUFFLElBQUksRUFBRSxTQUFTO2lCQUM1QjtnQkFDRCxnQ0FBZ0MsRUFBRTtvQkFDaEMsMEJBQTBCLEVBQUUsSUFBSSxFQUFFLG1CQUFtQjtpQkFDdEQ7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FB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LENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyw4QkFBOEI7WUFDOUIsUUFBUSxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxfX3Rlc3RzX19cXGR5bmFtb2RiLXRhYmxlcy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBEeW5hbW9EQiBUYWJsZSBTdHJ1Y3R1cmUgVmVyaWZpY2F0aW9uIFRlc3RcclxuICpcclxuICogVGFzayAzLjI6IER5bmFtb0RC44OG44O844OW44Or5qeL6YCg44Gu5qSc6Ki844OG44K544OIXHJcbiAqIFJlcXVpcmVtZW50czog6KaB5Lu2Mi41LCAxMy4z77yI44OH44O844K/44OZ44O844K544CB5pqX5Y+35YyW77yJXHJcbiAqXHJcbiAqIOOBk+OBruODhuOCueODiOOBr+OAgUNES+OBp+Wumue+qeOBleOCjOOBn0R5bmFtb0RC44OG44O844OW44Or44GM6Kit6KiI6YCa44KK44Gr5qeL5oiQ44GV44KM44Gm44GE44KL44GT44Go44KS5qSc6Ki844GX44G+44GZ44CCXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcclxuaW1wb3J0IHsgVGVtcGxhdGUsIE1hdGNoIH0gZnJvbSAnYXdzLWNkay1saWIvYXNzZXJ0aW9ucyc7XHJcbmltcG9ydCB7IFRkbmV0RGF0YUNvbGxlY3RvclN0YWNrIH0gZnJvbSAnLi4vbGliL3RkbmV0LWRhdGEtY29sbGVjdG9yLXN0YWNrJztcclxuXHJcbmRlc2NyaWJlKCdEeW5hbW9EQiBUYWJsZXMnLCAoKSA9PiB7XHJcbiAgbGV0IHRlbXBsYXRlOiBUZW1wbGF0ZTtcclxuXHJcbiAgYmVmb3JlQWxsKCgpID0+IHtcclxuICAgIGNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7XHJcbiAgICBjb25zdCBzdGFjayA9IG5ldyBUZG5ldERhdGFDb2xsZWN0b3JTdGFjayhhcHAsICdUZXN0U3RhY2snLCB7XHJcbiAgICAgIGVudjogeyBhY2NvdW50OiAnMTIzNDU2Nzg5MDEyJywgcmVnaW9uOiAnYXAtbm9ydGhlYXN0LTEnIH0sXHJcbiAgICB9KTtcclxuICAgIHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3RkbmV0X2Rpc2Nsb3N1cmVzIHRhYmxlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBiZSBjcmVhdGVkIHdpdGggY29ycmVjdCBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgICAvLyDjg4bjg7zjg5bjg6vjgYzlrZjlnKjjgZnjgovjgZPjgajjgpLnorroqo1cclxuICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkR5bmFtb0RCOjpUYWJsZScsIHtcclxuICAgICAgICBUYWJsZU5hbWU6ICd0ZG5ldF9kaXNjbG9zdXJlcycsXHJcbiAgICAgICAgQmlsbGluZ01vZGU6ICdQQVlfUEVSX1JFUVVFU1QnLCAvLyDjgqrjg7Pjg4fjg57jg7Pjg4njg6Ljg7zjg4lcclxuICAgICAgICBTU0VTcGVjaWZpY2F0aW9uOiB7XHJcbiAgICAgICAgICBTU0VFbmFibGVkOiB0cnVlLCAvLyDmmpflj7fljJbmnInlirnljJZcclxuICAgICAgICB9LFxyXG4gICAgICAgIFBvaW50SW5UaW1lUmVjb3ZlcnlTcGVjaWZpY2F0aW9uOiB7XHJcbiAgICAgICAgICBQb2ludEluVGltZVJlY292ZXJ5RW5hYmxlZDogdHJ1ZSwgLy8g44Od44Kk44Oz44OI44Kk44Oz44K/44Kk44Og44Oq44Kr44OQ44Oq5pyJ5Yq55YyWXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBwYXJ0aXRpb24ga2V5JywgKCkgPT4ge1xyXG4gICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6RHluYW1vREI6OlRhYmxlJywge1xyXG4gICAgICAgIFRhYmxlTmFtZTogJ3RkbmV0X2Rpc2Nsb3N1cmVzJyxcclxuICAgICAgICBLZXlTY2hlbWE6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ2Rpc2Nsb3N1cmVfaWQnLFxyXG4gICAgICAgICAgICBLZXlUeXBlOiAnSEFTSCcsIC8vIOODkeODvOODhuOCo+OCt+ODp+ODs+OCreODvFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdLFxyXG4gICAgICAgIEF0dHJpYnV0ZURlZmluaXRpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnZGlzY2xvc3VyZV9pZCcsXHJcbiAgICAgICAgICAgIEF0dHJpYnV0ZVR5cGU6ICdTJywgLy8gU3RyaW5n5Z6LXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0pLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGF2ZSBHU0lfQ29tcGFueUNvZGVfRGlzY2xvc2VEYXRlIGluZGV4JywgKCkgPT4ge1xyXG4gICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6RHluYW1vREI6OlRhYmxlJywge1xyXG4gICAgICAgIFRhYmxlTmFtZTogJ3RkbmV0X2Rpc2Nsb3N1cmVzJyxcclxuICAgICAgICBHbG9iYWxTZWNvbmRhcnlJbmRleGVzOiBNYXRjaC5hcnJheVdpdGgoW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBJbmRleE5hbWU6ICdHU0lfQ29tcGFueUNvZGVfRGlzY2xvc2VEYXRlJyxcclxuICAgICAgICAgICAgS2V5U2NoZW1hOiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ2NvbXBhbnlfY29kZScsXHJcbiAgICAgICAgICAgICAgICBLZXlUeXBlOiAnSEFTSCcsIC8vIOODkeODvOODhuOCo+OCt+ODp+ODs+OCreODvFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ2Rpc2Nsb3NlZF9hdCcsXHJcbiAgICAgICAgICAgICAgICBLZXlUeXBlOiAnUkFOR0UnLCAvLyDjgr3jg7zjg4jjgq3jg7xcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBQcm9qZWN0aW9uOiB7XHJcbiAgICAgICAgICAgICAgUHJvamVjdGlvblR5cGU6ICdBTEwnLCAvLyDjgZnjgbnjgabjga7lsZ7mgKfjgpLmipXlvbFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgXSksXHJcbiAgICAgICAgQXR0cmlidXRlRGVmaW5pdGlvbnM6IE1hdGNoLmFycmF5V2l0aChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEF0dHJpYnV0ZU5hbWU6ICdjb21wYW55X2NvZGUnLFxyXG4gICAgICAgICAgICBBdHRyaWJ1dGVUeXBlOiAnUycsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnZGlzY2xvc2VkX2F0JyxcclxuICAgICAgICAgICAgQXR0cmlidXRlVHlwZTogJ1MnLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdKSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgR1NJX0RhdGVQYXJ0aXRpb24gaW5kZXgnLCAoKSA9PiB7XHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpEeW5hbW9EQjo6VGFibGUnLCB7XHJcbiAgICAgICAgVGFibGVOYW1lOiAndGRuZXRfZGlzY2xvc3VyZXMnLFxyXG4gICAgICAgIEdsb2JhbFNlY29uZGFyeUluZGV4ZXM6IE1hdGNoLmFycmF5V2l0aChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEluZGV4TmFtZTogJ0dTSV9EYXRlUGFydGl0aW9uJyxcclxuICAgICAgICAgICAgS2V5U2NoZW1hOiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ2RhdGVfcGFydGl0aW9uJyxcclxuICAgICAgICAgICAgICAgIEtleVR5cGU6ICdIQVNIJywgLy8g44OR44O844OG44Kj44K344On44Oz44Kt44O8XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnZGlzY2xvc2VkX2F0JyxcclxuICAgICAgICAgICAgICAgIEtleVR5cGU6ICdSQU5HRScsIC8vIOOCveODvOODiOOCreODvFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIFByb2plY3Rpb246IHtcclxuICAgICAgICAgICAgICBQcm9qZWN0aW9uVHlwZTogJ0FMTCcsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0pLFxyXG4gICAgICAgIEF0dHJpYnV0ZURlZmluaXRpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnZGF0ZV9wYXJ0aXRpb24nLFxyXG4gICAgICAgICAgICBBdHRyaWJ1dGVUeXBlOiAnUycsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0pLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGF2ZSBleGFjdGx5IDIgR1NJcycsICgpID0+IHtcclxuICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkR5bmFtb0RCOjpUYWJsZScsIHtcclxuICAgICAgICBUYWJsZU5hbWU6ICd0ZG5ldF9kaXNjbG9zdXJlcycsXHJcbiAgICAgICAgR2xvYmFsU2Vjb25kYXJ5SW5kZXhlczogTWF0Y2guYXJyYXlXaXRoKFtcclxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBJbmRleE5hbWU6ICdHU0lfQ29tcGFueUNvZGVfRGlzY2xvc2VEYXRlJyB9KSxcclxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBJbmRleE5hbWU6ICdHU0lfRGF0ZVBhcnRpdGlvbicgfSksXHJcbiAgICAgICAgXSksXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd0ZG5ldF9leGVjdXRpb25zIHRhYmxlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBiZSBjcmVhdGVkIHdpdGggY29ycmVjdCBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6RHluYW1vREI6OlRhYmxlJywge1xyXG4gICAgICAgIFRhYmxlTmFtZTogJ3RkbmV0X2V4ZWN1dGlvbnMnLFxyXG4gICAgICAgIEJpbGxpbmdNb2RlOiAnUEFZX1BFUl9SRVFVRVNUJywgLy8g44Kq44Oz44OH44Oe44Oz44OJ44Oi44O844OJXHJcbiAgICAgICAgU1NFU3BlY2lmaWNhdGlvbjoge1xyXG4gICAgICAgICAgU1NFRW5hYmxlZDogdHJ1ZSwgLy8g5pqX5Y+35YyW5pyJ5Yq55YyWXHJcbiAgICAgICAgfSxcclxuICAgICAgICBQb2ludEluVGltZVJlY292ZXJ5U3BlY2lmaWNhdGlvbjoge1xyXG4gICAgICAgICAgUG9pbnRJblRpbWVSZWNvdmVyeUVuYWJsZWQ6IHRydWUsIC8vIOODneOCpOODs+ODiOOCpOODs+OCv+OCpOODoOODquOCq+ODkOODquacieWKueWMllxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgcGFydGl0aW9uIGtleScsICgpID0+IHtcclxuICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkR5bmFtb0RCOjpUYWJsZScsIHtcclxuICAgICAgICBUYWJsZU5hbWU6ICd0ZG5ldF9leGVjdXRpb25zJyxcclxuICAgICAgICBLZXlTY2hlbWE6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ2V4ZWN1dGlvbl9pZCcsXHJcbiAgICAgICAgICAgIEtleVR5cGU6ICdIQVNIJywgLy8g44OR44O844OG44Kj44K344On44Oz44Kt44O8XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgQXR0cmlidXRlRGVmaW5pdGlvbnM6IE1hdGNoLmFycmF5V2l0aChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEF0dHJpYnV0ZU5hbWU6ICdleGVjdXRpb25faWQnLFxyXG4gICAgICAgICAgICBBdHRyaWJ1dGVUeXBlOiAnUycsIC8vIFN0cmluZ+Wei1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdKSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgVFRMIGVuYWJsZWQnLCAoKSA9PiB7XHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpEeW5hbW9EQjo6VGFibGUnLCB7XHJcbiAgICAgICAgVGFibGVOYW1lOiAndGRuZXRfZXhlY3V0aW9ucycsXHJcbiAgICAgICAgVGltZVRvTGl2ZVNwZWNpZmljYXRpb246IHtcclxuICAgICAgICAgIEF0dHJpYnV0ZU5hbWU6ICd0dGwnLFxyXG4gICAgICAgICAgRW5hYmxlZDogdHJ1ZSwgLy8gVFRM5pyJ5Yq55YyWXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgR1NJX1N0YXR1c19TdGFydGVkQXQgaW5kZXgnLCAoKSA9PiB7XHJcbiAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpEeW5hbW9EQjo6VGFibGUnLCB7XHJcbiAgICAgICAgVGFibGVOYW1lOiAndGRuZXRfZXhlY3V0aW9ucycsXHJcbiAgICAgICAgR2xvYmFsU2Vjb25kYXJ5SW5kZXhlczogTWF0Y2guYXJyYXlXaXRoKFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgSW5kZXhOYW1lOiAnR1NJX1N0YXR1c19TdGFydGVkQXQnLFxyXG4gICAgICAgICAgICBLZXlTY2hlbWE6IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnc3RhdHVzJyxcclxuICAgICAgICAgICAgICAgIEtleVR5cGU6ICdIQVNIJywgLy8g44OR44O844OG44Kj44K344On44Oz44Kt44O8XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiAnc3RhcnRlZF9hdCcsXHJcbiAgICAgICAgICAgICAgICBLZXlUeXBlOiAnUkFOR0UnLCAvLyDjgr3jg7zjg4jjgq3jg7xcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBQcm9qZWN0aW9uOiB7XHJcbiAgICAgICAgICAgICAgUHJvamVjdGlvblR5cGU6ICdBTEwnLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdKSxcclxuICAgICAgICBBdHRyaWJ1dGVEZWZpbml0aW9uczogTWF0Y2guYXJyYXlXaXRoKFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogJ3N0YXR1cycsXHJcbiAgICAgICAgICAgIEF0dHJpYnV0ZVR5cGU6ICdTJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIEF0dHJpYnV0ZU5hbWU6ICdzdGFydGVkX2F0JyxcclxuICAgICAgICAgICAgQXR0cmlidXRlVHlwZTogJ1MnLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdKSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgZXhhY3RseSAxIEdTSScsICgpID0+IHtcclxuICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkR5bmFtb0RCOjpUYWJsZScsIHtcclxuICAgICAgICBUYWJsZU5hbWU6ICd0ZG5ldF9leGVjdXRpb25zJyxcclxuICAgICAgICBHbG9iYWxTZWNvbmRhcnlJbmRleGVzOiBbXHJcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgSW5kZXhOYW1lOiAnR1NJX1N0YXR1c19TdGFydGVkQXQnIH0pLFxyXG4gICAgICAgIF0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDbG91ZEZvcm1hdGlvbiBPdXRwdXRzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgRGlzY2xvc3VyZXNUYWJsZU5hbWUnLCAoKSA9PiB7XHJcbiAgICAgIHRlbXBsYXRlLmhhc091dHB1dCgnRGlzY2xvc3VyZXNUYWJsZU5hbWUnLCB7XHJcbiAgICAgICAgVmFsdWU6IHtcclxuICAgICAgICAgIFJlZjogTWF0Y2guc3RyaW5nTGlrZVJlZ2V4cCgnRGlzY2xvc3VyZXNUYWJsZScpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgRXhwb3J0OiB7XHJcbiAgICAgICAgICBOYW1lOiAnVGRuZXREaXNjbG9zdXJlc1RhYmxlTmFtZScsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGV4cG9ydCBFeGVjdXRpb25zVGFibGVOYW1lJywgKCkgPT4ge1xyXG4gICAgICB0ZW1wbGF0ZS5oYXNPdXRwdXQoJ0V4ZWN1dGlvbnNUYWJsZU5hbWUnLCB7XHJcbiAgICAgICAgVmFsdWU6IHtcclxuICAgICAgICAgIFJlZjogTWF0Y2guc3RyaW5nTGlrZVJlZ2V4cCgnRXhlY3V0aW9uc1RhYmxlJyksXHJcbiAgICAgICAgfSxcclxuICAgICAgICBFeHBvcnQ6IHtcclxuICAgICAgICAgIE5hbWU6ICdUZG5ldEV4ZWN1dGlvbnNUYWJsZU5hbWUnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBhbmQgQ29tcGxpYW5jZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGF2ZSBlbmNyeXB0aW9uIGVuYWJsZWQgb24gYWxsIHRhYmxlcycsICgpID0+IHtcclxuICAgICAgLy8g44GZ44G544Gm44GuRHluYW1vRELjg4bjg7zjg5bjg6vjgafmmpflj7fljJbjgYzmnInlirnljJbjgZXjgozjgabjgYTjgovjgZPjgajjgpLnorroqo1cclxuICAgICAgY29uc3QgdGFibGVzID0gdGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpEeW5hbW9EQjo6VGFibGUnKTtcclxuICAgICAgY29uc3QgdGFibGVLZXlzID0gT2JqZWN0LmtleXModGFibGVzKTtcclxuXHJcbiAgICAgIGV4cGVjdCh0YWJsZUtleXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDIpO1xyXG5cclxuICAgICAgdGFibGVLZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gdGFibGVzW2tleV07XHJcbiAgICAgICAgZXhwZWN0KHRhYmxlLlByb3BlcnRpZXMuU1NFU3BlY2lmaWNhdGlvbikudG9CZURlZmluZWQoKTtcclxuICAgICAgICBleHBlY3QodGFibGUuUHJvcGVydGllcy5TU0VTcGVjaWZpY2F0aW9uLlNTRUVuYWJsZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHBvaW50LWluLXRpbWUgcmVjb3ZlcnkgZW5hYmxlZCBvbiBhbGwgdGFibGVzJywgKCkgPT4ge1xyXG4gICAgICAvLyDjgZnjgbnjgabjga5EeW5hbW9EQuODhuODvOODluODq+OBp+ODneOCpOODs+ODiOOCpOODs+OCv+OCpOODoOODquOCq+ODkOODquOBjOacieWKueWMluOBleOCjOOBpuOBhOOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgICBjb25zdCB0YWJsZXMgPSB0ZW1wbGF0ZS5maW5kUmVzb3VyY2VzKCdBV1M6OkR5bmFtb0RCOjpUYWJsZScpO1xyXG4gICAgICBjb25zdCB0YWJsZUtleXMgPSBPYmplY3Qua2V5cyh0YWJsZXMpO1xyXG5cclxuICAgICAgdGFibGVLZXlzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gdGFibGVzW2tleV07XHJcbiAgICAgICAgZXhwZWN0KFxyXG4gICAgICAgICAgdGFibGUuUHJvcGVydGllcy5Qb2ludEluVGltZVJlY292ZXJ5U3BlY2lmaWNhdGlvblxyXG4gICAgICAgICkudG9CZURlZmluZWQoKTtcclxuICAgICAgICBleHBlY3QoXHJcbiAgICAgICAgICB0YWJsZS5Qcm9wZXJ0aWVzLlBvaW50SW5UaW1lUmVjb3ZlcnlTcGVjaWZpY2F0aW9uXHJcbiAgICAgICAgICAgIC5Qb2ludEluVGltZVJlY292ZXJ5RW5hYmxlZFxyXG4gICAgICAgICkudG9CZSh0cnVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHVzZSBvbi1kZW1hbmQgYmlsbGluZyBtb2RlIGZvciBjb3N0IG9wdGltaXphdGlvbicsICgpID0+IHtcclxuICAgICAgLy8g44GZ44G544Gm44GuRHluYW1vRELjg4bjg7zjg5bjg6vjgafjgqrjg7Pjg4fjg57jg7Pjg4njg6Ljg7zjg4njgYzkvb/nlKjjgZXjgozjgabjgYTjgovjgZPjgajjgpLnorroqo1cclxuICAgICAgY29uc3QgdGFibGVzID0gdGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpEeW5hbW9EQjo6VGFibGUnKTtcclxuICAgICAgY29uc3QgdGFibGVLZXlzID0gT2JqZWN0LmtleXModGFibGVzKTtcclxuXHJcbiAgICAgIHRhYmxlS2V5cy5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICBjb25zdCB0YWJsZSA9IHRhYmxlc1trZXldO1xyXG4gICAgICAgIGV4cGVjdCh0YWJsZS5Qcm9wZXJ0aWVzLkJpbGxpbmdNb2RlKS50b0JlKCdQQVlfUEVSX1JFUVVFU1QnKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1RhYmxlIENvdW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGV4YWN0bHkgMiBEeW5hbW9EQiB0YWJsZXMnLCAoKSA9PiB7XHJcbiAgICAgIC8vIER5bmFtb0RC44OG44O844OW44Or44GM5q2j56K644GrMuOBpOWtmOWcqOOBmeOCi+OBk+OBqOOCkueiuuiqjVxyXG4gICAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6RHluYW1vREI6OlRhYmxlJywgMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==