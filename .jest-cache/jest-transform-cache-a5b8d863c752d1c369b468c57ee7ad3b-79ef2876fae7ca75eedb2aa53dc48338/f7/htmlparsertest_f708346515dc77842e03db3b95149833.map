{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\scraper\\__tests__\\html-parser.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\scraper\\__tests__\\html-parser.test.ts"],"sourcesContent":["/**\r\n * HTMLパーサーのユニットテスト\r\n *\r\n * steeringファイル準拠:\r\n * - development/tdnet-scraping-patterns.md\r\n * - core/error-handling-patterns.md\r\n *\r\n * Requirements: 要件1.2（メタデータ抽出）\r\n */\r\n\r\nimport { parseDisclosureList } from '../html-parser';\r\nimport { ValidationError } from '../../errors';\r\n\r\ndescribe('HTML Parser', () => {\r\n  describe('正常系: HTMLパース成功', () => {\r\n    it('should parse valid HTML with disclosure table', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr>\r\n                <th>企業コード</th>\r\n                <th>企業名</th>\r\n                <th>開示種類</th>\r\n                <th>タイトル</th>\r\n                <th>開示日時</th>\r\n                <th>PDF</th>\r\n              </tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>2024年3月期 第3四半期決算短信</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n      expect(disclosures[0].company_name).toBe('トヨタ自動車株式会社');\r\n      expect(disclosures[0].disclosure_type).toBe('決算短信');\r\n      expect(disclosures[0].title).toBe('2024年3月期 第3四半期決算短信');\r\n      expect(disclosures[0].disclosed_at).toBe('2024-01-15T06:00:00.000Z'); // JST 15:00 → UTC 06:00\r\n      expect(disclosures[0].pdf_url).toBe('https://example.com/test.pdf');\r\n    });\r\n\r\n    it('should parse multiple disclosure rows', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>決算短信タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test1.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test2.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(2);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n      expect(disclosures[1].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip header row', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr>\r\n                <th>企業コード</th>\r\n                <th>企業名</th>\r\n                <th>開示種類</th>\r\n                <th>タイトル</th>\r\n                <th>開示日時</th>\r\n                <th>PDF</th>\r\n              </tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>決算短信タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n    });\r\n  });\r\n\r\n  describe('異常系: エラーハンドリング', () => {\r\n    it('should throw ValidationError for empty HTML', () => {\r\n      expect(() => parseDisclosureList('')).toThrow(ValidationError);\r\n      expect(() => parseDisclosureList('')).toThrow(/empty/);\r\n    });\r\n\r\n    it('should throw ValidationError for whitespace-only HTML', () => {\r\n      expect(() => parseDisclosureList('   \\n\\t  ')).toThrow(ValidationError);\r\n      expect(() => parseDisclosureList('   \\n\\t  ')).toThrow(/empty/);\r\n    });\r\n\r\n    it('should return empty array when no disclosure table found', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <p>No table here</p>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(0);\r\n    });\r\n\r\n    it('should skip rows with insufficient cells', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <!-- 不完全な行: セルが不足 -->\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // 不完全な行はスキップされ、有効な行のみパースされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip rows with invalid company code', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>INVALID</td>\r\n                <td>無効な企業</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>決算短信タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // 無効な企業コードの行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n    });\r\n\r\n    it('should skip rows with invalid date format', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル</td>\r\n                <td>INVALID_DATE</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // 無効な日付の行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip rows with invalid PDF URL', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"invalid_url\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // 無効なPDF URLの行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n  });\r\n\r\n  describe('部分的失敗の処理（Graceful Degradation）', () => {\r\n    it('should continue parsing after encountering invalid rows', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル1</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test1.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>INVALID</td>\r\n                <td>無効な企業</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル2</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test2.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>タイトル3</td>\r\n                <td>2024/01/15 17:00</td>\r\n                <td><a href=\"https://example.com/test3.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // 無効な行をスキップして、有効な行のみパースされる\r\n      expect(disclosures).toHaveLength(2);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n      expect(disclosures[1].company_code).toBe('9984');\r\n    });\r\n  });\r\n\r\n  describe('バリデーションエラー: 必須フィールド欠落', () => {\r\n    it('should skip rows with missing company_name', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td></td>\r\n                <td>決算短信</td>\r\n                <td>タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // company_nameが空の行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip rows with missing disclosure_type', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td></td>\r\n                <td>タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // disclosure_typeが空の行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip rows with missing title', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td></td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // titleが空の行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n\r\n    it('should skip rows with missing PDF link', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>7203</td>\r\n                <td>トヨタ自動車株式会社</td>\r\n                <td>決算短信</td>\r\n                <td>タイトル</td>\r\n                <td>2024/01/15 15:00</td>\r\n                <td><a>PDF</a></td>\r\n              </tr>\r\n              <tr>\r\n                <td>9984</td>\r\n                <td>ソフトバンクグループ株式会社</td>\r\n                <td>業績予想</td>\r\n                <td>業績予想修正</td>\r\n                <td>2024/01/15 16:00</td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      // PDF URLが空の行はスキップされる\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('9984');\r\n    });\r\n  });\r\n\r\n  describe('エッジケース', () => {\r\n    it('should handle empty table (only header)', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(0);\r\n    });\r\n\r\n    it('should handle table with no rows', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(0);\r\n    });\r\n\r\n    it('should trim whitespace from cell values', () => {\r\n      const html = `\r\n        <html>\r\n          <body>\r\n            <table class=\"disclosure-list\">\r\n              <tr><th>Header</th></tr>\r\n              <tr>\r\n                <td>  7203  </td>\r\n                <td>  トヨタ自動車株式会社  </td>\r\n                <td>  決算短信  </td>\r\n                <td>  決算短信タイトル  </td>\r\n                <td>  2024/01/15 15:00  </td>\r\n                <td><a href=\"https://example.com/test.pdf\">PDF</a></td>\r\n              </tr>\r\n            </table>\r\n          </body>\r\n        </html>\r\n      `;\r\n\r\n      const disclosures = parseDisclosureList(html);\r\n\r\n      expect(disclosures).toHaveLength(1);\r\n      expect(disclosures[0].company_code).toBe('7203');\r\n      expect(disclosures[0].company_name).toBe('トヨタ自動車株式会社');\r\n      expect(disclosures[0].disclosure_type).toBe('決算短信');\r\n      expect(disclosures[0].title).toBe('決算短信タイトル');\r\n    });\r\n  });\r\n});\r\n"],"version":3}