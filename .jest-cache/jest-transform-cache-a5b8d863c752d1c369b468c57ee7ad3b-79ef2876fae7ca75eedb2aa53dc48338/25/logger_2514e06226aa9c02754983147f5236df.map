{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\logger.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\utils\\logger.ts"],"sourcesContent":["/**\r\n * 構造化ロガー\r\n *\r\n * Winstonを使用した構造化ロギングを提供します。\r\n * CloudWatch Logs形式のJSON出力をサポートし、ログレベルに応じた適切なログ記録を行います。\r\n *\r\n * Requirements: 要件6.3（構造化ログ）\r\n */\r\n\r\nimport winston from 'winston';\r\n\r\n/**\r\n * ログレベル\r\n */\r\nexport enum LogLevel {\r\n  DEBUG = 'debug',\r\n  INFO = 'info',\r\n  WARN = 'warn',\r\n  ERROR = 'error',\r\n}\r\n\r\n/**\r\n * ログコンテキスト\r\n */\r\nexport interface LogContext {\r\n  [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * ロガーインターフェース\r\n */\r\nexport interface Logger {\r\n  debug(message: string, context?: LogContext): void;\r\n  info(message: string, context?: LogContext): void;\r\n  warn(message: string, context?: LogContext): void;\r\n  error(message: string, context?: LogContext): void;\r\n}\r\n\r\n/**\r\n * Winston ロガーの設定\r\n */\r\nconst winstonLogger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || LogLevel.INFO,\r\n  format: winston.format.combine(\r\n    winston.format.timestamp({\r\n      format: 'YYYY-MM-DDTHH:mm:ss.SSSZ',\r\n    }),\r\n    winston.format.errors({ stack: true }),\r\n    winston.format.json()\r\n  ),\r\n  defaultMeta: {\r\n    service: 'tdnet-data-collector',\r\n    environment: process.env.NODE_ENV || 'development',\r\n  },\r\n  transports: [\r\n    new winston.transports.Console({\r\n      format: winston.format.combine(\r\n        winston.format.colorize(),\r\n        winston.format.printf(({ timestamp, level, message, ...meta }) => {\r\n          const metaStr = Object.keys(meta).length > 0 ? JSON.stringify(meta, null, 2) : '';\r\n          return `${timestamp} [${level}]: ${message} ${metaStr}`;\r\n        })\r\n      ),\r\n    }),\r\n  ],\r\n});\r\n\r\n/**\r\n * 構造化ロガー実装\r\n */\r\nclass StructuredLogger implements Logger {\r\n  /**\r\n   * DEBUGレベルのログを記録\r\n   *\r\n   * @param message ログメッセージ\r\n   * @param context ログコンテキスト（オプション）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * logger.debug('Processing disclosure', {\r\n   *   disclosure_id: 'TD20240115001',\r\n   *   company_code: '1234',\r\n   * });\r\n   * ```\r\n   */\r\n  debug(message: string, context?: LogContext): void {\r\n    winstonLogger.debug(message, context);\r\n  }\r\n\r\n  /**\r\n   * INFOレベルのログを記録\r\n   *\r\n   * @param message ログメッセージ\r\n   * @param context ログコンテキスト（オプション）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * logger.info('Disclosure saved successfully', {\r\n   *   disclosure_id: 'TD20240115001',\r\n   *   date_partition: '2024-01',\r\n   * });\r\n   * ```\r\n   */\r\n  info(message: string, context?: LogContext): void {\r\n    winstonLogger.info(message, context);\r\n  }\r\n\r\n  /**\r\n   * WARNレベルのログを記録\r\n   *\r\n   * @param message ログメッセージ\r\n   * @param context ログコンテキスト（オプション）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * logger.warn('Duplicate item detected', {\r\n   *   disclosure_id: 'TD20240115001',\r\n   * });\r\n   * ```\r\n   */\r\n  warn(message: string, context?: LogContext): void {\r\n    winstonLogger.warn(message, context);\r\n  }\r\n\r\n  /**\r\n   * ERRORレベルのログを記録\r\n   *\r\n   * @param message ログメッセージ\r\n   * @param context ログコンテキスト（オプション）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * logger.error('Failed to save disclosure', {\r\n   *   error_type: 'ValidationError',\r\n   *   error_message: error.message,\r\n   *   context: {\r\n   *     disclosure_id: 'TD20240115001',\r\n   *   },\r\n   *   stack_trace: error.stack,\r\n   * });\r\n   * ```\r\n   */\r\n  error(message: string, context?: LogContext): void {\r\n    winstonLogger.error(message, context);\r\n  }\r\n}\r\n\r\n/**\r\n * グローバルロガーインスタンス\r\n *\r\n * プロジェクト全体で共有されるロガーインスタンスです。\r\n *\r\n * @example\r\n * ```typescript\r\n * import { logger } from './utils/logger';\r\n *\r\n * logger.info('Application started');\r\n * logger.error('Operation failed', {\r\n *   error_type: 'NetworkError',\r\n *   error_message: error.message,\r\n * });\r\n * ```\r\n */\r\nexport const logger: Logger = new StructuredLogger();\r\n\r\n/**\r\n * ログレベルを設定\r\n *\r\n * @param level ログレベル\r\n *\r\n * @example\r\n * ```typescript\r\n * import { setLogLevel, LogLevel } from './utils/logger';\r\n *\r\n * setLogLevel(LogLevel.DEBUG);\r\n * ```\r\n */\r\nexport function setLogLevel(level: LogLevel): void {\r\n  winstonLogger.level = level;\r\n}\r\n\r\n/**\r\n * エラーオブジェクトから構造化ログコンテキストを生成\r\n *\r\n * Steering準拠の標準フォーマット: { error_type, error_message, context, stack_trace }\r\n *\r\n * @param error エラーオブジェクト\r\n * @param additionalContext 追加のコンテキスト（オプション）\r\n * @returns ログコンテキスト\r\n *\r\n * @example\r\n * ```typescript\r\n * try {\r\n *   await operation();\r\n * } catch (error) {\r\n *   logger.error('Operation failed', createErrorContext(error, {\r\n *     disclosure_id: 'TD20240115001',\r\n *   }));\r\n * }\r\n * ```\r\n */\r\nexport function createErrorContext(\r\n  error: Error,\r\n  additionalContext?: LogContext\r\n): LogContext {\r\n  return {\r\n    error_type: error.constructor.name,\r\n    error_message: error.message,\r\n    stack_trace: error.stack,\r\n    ...additionalContext,\r\n  };\r\n}\r\n\r\n/**\r\n * Lambda実行コンテキストを含むエラーログを記録\r\n *\r\n * Lambda実装チェックリストに準拠した標準エラーログフォーマット。\r\n * CloudWatch Logsに構造化ログとして記録されます。\r\n *\r\n * @param message エラーメッセージ\r\n * @param error エラーオブジェクト\r\n * @param lambdaContext Lambda実行コンテキスト（オプション）\r\n * @param additionalContext 追加のコンテキスト（オプション）\r\n *\r\n * @example\r\n * ```typescript\r\n * export async function handler(event: any, context: any) {\r\n *   try {\r\n *     await operation();\r\n *   } catch (error) {\r\n *     logLambdaError('Lambda execution failed', error, context, {\r\n *       disclosure_id: 'TD20240115001',\r\n *     });\r\n *     throw error;\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport function logLambdaError(\r\n  message: string,\r\n  error: Error,\r\n  lambdaContext?: { requestId?: string; functionName?: string },\r\n  additionalContext?: LogContext\r\n): void {\r\n  logger.error(message, {\r\n    error_type: error.constructor.name,\r\n    error_message: error.message,\r\n    context: {\r\n      request_id: lambdaContext?.requestId,\r\n      function_name: lambdaContext?.functionName,\r\n      ...additionalContext,\r\n    },\r\n    stack_trace: error.stack,\r\n  });\r\n}\r\n"],"version":3}