179381ec4dffa04579d4d83d17aea051
"use strict";
/**
 * CloudWatch Logs Construct
 *
 * This construct configures CloudWatch Logs for Lambda functions with environment-specific
 * retention periods to optimize costs and comply with logging requirements.
 *
 * Retention Periods:
 * - Production: 90 days (3 months) - 要件6.3準拠
 * - Development: 7 days (1 week) - コスト最適化
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudWatchLogs = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const logs = __importStar(require("aws-cdk-lib/aws-logs"));
const constructs_1 = require("constructs");
/**
 * CloudWatch Logs Construct
 *
 * Provides centralized log configuration for all Lambda functions
 */
class CloudWatchLogs extends constructs_1.Construct {
    /**
     * Log retention period for the environment
     */
    retentionDays;
    /**
     * Removal policy for log groups
     */
    removalPolicy;
    constructor(scope, id, props) {
        super(scope, id);
        // 環境ごとのログ保持期間を設定
        if (props.environment === 'prod') {
            // 本番環境: 3ヶ月（90日）
            this.retentionDays = logs.RetentionDays.THREE_MONTHS;
            // 本番環境: スタック削除時もログを保持
            this.removalPolicy = cdk.RemovalPolicy.RETAIN;
        }
        else {
            // 開発環境: 1週間（7日）
            this.retentionDays = logs.RetentionDays.ONE_WEEK;
            // 開発環境: スタック削除時にログも削除
            this.removalPolicy = cdk.RemovalPolicy.DESTROY;
        }
    }
    /**
     * Configure CloudWatch Logs for a Lambda function
     *
     * @param lambdaFunction - Lambda function to configure
     * @param logGroupName - Optional custom log group name (defaults to /aws/lambda/{functionName})
     * @returns Created log group
     */
    configureForLambda(lambdaFunction, logGroupName) {
        const logGroup = new logs.LogGroup(this, `${lambdaFunction.node.id}LogGroup`, {
            logGroupName: logGroupName || `/aws/lambda/${lambdaFunction.functionName}`,
            retention: this.retentionDays,
            removalPolicy: this.removalPolicy,
        });
        // CloudFormation Output
        new cdk.CfnOutput(this, `${lambdaFunction.node.id}LogGroupName`, {
            value: logGroup.logGroupName,
            description: `Log group for ${lambdaFunction.functionName}`,
            exportName: `${lambdaFunction.functionName}-LogGroupName`,
        });
        return logGroup;
    }
    /**
     * Configure CloudWatch Logs for multiple Lambda functions
     *
     * @param lambdaFunctions - Array of Lambda functions to configure
     * @returns Array of created log groups
     */
    configureForLambdas(lambdaFunctions) {
        return lambdaFunctions.map((fn) => this.configureForLambda(fn));
    }
    /**
     * Get retention days as number (for testing/validation)
     *
     * @returns Number of days
     */
    getRetentionDaysAsNumber() {
        switch (this.retentionDays) {
            case logs.RetentionDays.ONE_WEEK:
                return 7;
            case logs.RetentionDays.THREE_MONTHS:
                return 90;
            default:
                throw new Error(`Unexpected retention days: ${this.retentionDays}`);
        }
    }
}
exports.CloudWatchLogs = CloudWatchLogs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxsaWJcXGNvbnN0cnVjdHNcXGNsb3Vkd2F0Y2gtbG9ncy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7OztHQVNHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBbUM7QUFDbkMsMkRBQTZDO0FBRTdDLDJDQUF1QztBQWF2Qzs7OztHQUlHO0FBQ0gsTUFBYSxjQUFlLFNBQVEsc0JBQVM7SUFDM0M7O09BRUc7SUFDYSxhQUFhLENBQXFCO0lBRWxEOztPQUVHO0lBQ2EsYUFBYSxDQUFvQjtJQUVqRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQTBCO1FBQ2xFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsaUJBQWlCO1FBQ2pCLElBQUksS0FBSyxDQUFDLFdBQVcsS0FBSyxNQUFNLEVBQUUsQ0FBQztZQUNqQyxpQkFBaUI7WUFDakIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQztZQUNyRCxzQkFBc0I7WUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUNoRCxDQUFDO2FBQU0sQ0FBQztZQUNOLGdCQUFnQjtZQUNoQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO1lBQ2pELHNCQUFzQjtZQUN0QixJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1FBQ2pELENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksa0JBQWtCLENBQ3ZCLGNBQStCLEVBQy9CLFlBQXFCO1FBRXJCLE1BQU0sUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsVUFBVSxFQUFFO1lBQzVFLFlBQVksRUFBRSxZQUFZLElBQUksZUFBZSxjQUFjLENBQUMsWUFBWSxFQUFFO1lBQzFFLFNBQVMsRUFBRSxJQUFJLENBQUMsYUFBYTtZQUM3QixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7U0FDbEMsQ0FBQyxDQUFDO1FBRUgsd0JBQXdCO1FBQ3hCLElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsY0FBYyxFQUFFO1lBQy9ELEtBQUssRUFBRSxRQUFRLENBQUMsWUFBWTtZQUM1QixXQUFXLEVBQUUsaUJBQWlCLGNBQWMsQ0FBQyxZQUFZLEVBQUU7WUFDM0QsVUFBVSxFQUFFLEdBQUcsY0FBYyxDQUFDLFlBQVksZUFBZTtTQUMxRCxDQUFDLENBQUM7UUFFSCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxtQkFBbUIsQ0FBQyxlQUFrQztRQUMzRCxPQUFPLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksd0JBQXdCO1FBQzdCLFFBQVEsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzNCLEtBQUssSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRO2dCQUM5QixPQUFPLENBQUMsQ0FBQztZQUNYLEtBQUssSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZO2dCQUNsQyxPQUFPLEVBQUUsQ0FBQztZQUNaO2dCQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQ3hFLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFoRkQsd0NBZ0ZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXGNka1xcbGliXFxjb25zdHJ1Y3RzXFxjbG91ZHdhdGNoLWxvZ3MudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENsb3VkV2F0Y2ggTG9ncyBDb25zdHJ1Y3RcclxuICogXHJcbiAqIFRoaXMgY29uc3RydWN0IGNvbmZpZ3VyZXMgQ2xvdWRXYXRjaCBMb2dzIGZvciBMYW1iZGEgZnVuY3Rpb25zIHdpdGggZW52aXJvbm1lbnQtc3BlY2lmaWNcclxuICogcmV0ZW50aW9uIHBlcmlvZHMgdG8gb3B0aW1pemUgY29zdHMgYW5kIGNvbXBseSB3aXRoIGxvZ2dpbmcgcmVxdWlyZW1lbnRzLlxyXG4gKiBcclxuICogUmV0ZW50aW9uIFBlcmlvZHM6XHJcbiAqIC0gUHJvZHVjdGlvbjogOTAgZGF5cyAoMyBtb250aHMpIC0g6KaB5Lu2Ni4z5rqW5ougXHJcbiAqIC0gRGV2ZWxvcG1lbnQ6IDcgZGF5cyAoMSB3ZWVrKSAtIOOCs+OCueODiOacgOmBqeWMllxyXG4gKi9cclxuXHJcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCAqIGFzIGxvZ3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxvZ3MnO1xyXG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xyXG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4uL2NvbmZpZy9lbnZpcm9ubWVudC1jb25maWcnO1xyXG5cclxuLyoqXHJcbiAqIFByb3BlcnRpZXMgZm9yIENsb3VkV2F0Y2ggTG9ncyBDb25zdHJ1Y3RcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2xvdWRXYXRjaExvZ3NQcm9wcyB7XHJcbiAgLyoqXHJcbiAgICogRW52aXJvbm1lbnQgbmFtZSAoZGV2IG9yIHByb2QpXHJcbiAgICovXHJcbiAgZW52aXJvbm1lbnQ6IEVudmlyb25tZW50O1xyXG59XHJcblxyXG4vKipcclxuICogQ2xvdWRXYXRjaCBMb2dzIENvbnN0cnVjdFxyXG4gKiBcclxuICogUHJvdmlkZXMgY2VudHJhbGl6ZWQgbG9nIGNvbmZpZ3VyYXRpb24gZm9yIGFsbCBMYW1iZGEgZnVuY3Rpb25zXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQ2xvdWRXYXRjaExvZ3MgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xyXG4gIC8qKlxyXG4gICAqIExvZyByZXRlbnRpb24gcGVyaW9kIGZvciB0aGUgZW52aXJvbm1lbnRcclxuICAgKi9cclxuICBwdWJsaWMgcmVhZG9ubHkgcmV0ZW50aW9uRGF5czogbG9ncy5SZXRlbnRpb25EYXlzO1xyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmFsIHBvbGljeSBmb3IgbG9nIGdyb3Vwc1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkb25seSByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeTtcclxuXHJcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IENsb3VkV2F0Y2hMb2dzUHJvcHMpIHtcclxuICAgIHN1cGVyKHNjb3BlLCBpZCk7XHJcblxyXG4gICAgLy8g55Kw5aKD44GU44Go44Gu44Ot44Kw5L+d5oyB5pyf6ZaT44KS6Kit5a6aXHJcbiAgICBpZiAocHJvcHMuZW52aXJvbm1lbnQgPT09ICdwcm9kJykge1xyXG4gICAgICAvLyDmnKznlarnkrDlooM6IDPjg7bmnIjvvIg5MOaXpe+8iVxyXG4gICAgICB0aGlzLnJldGVudGlvbkRheXMgPSBsb2dzLlJldGVudGlvbkRheXMuVEhSRUVfTU9OVEhTO1xyXG4gICAgICAvLyDmnKznlarnkrDlooM6IOOCueOCv+ODg+OCr+WJiumZpOaZguOCguODreOCsOOCkuS/neaMgVxyXG4gICAgICB0aGlzLnJlbW92YWxQb2xpY3kgPSBjZGsuUmVtb3ZhbFBvbGljeS5SRVRBSU47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDplovnmbrnkrDlooM6IDHpgLHplpPvvIg35pel77yJXHJcbiAgICAgIHRoaXMucmV0ZW50aW9uRGF5cyA9IGxvZ3MuUmV0ZW50aW9uRGF5cy5PTkVfV0VFSztcclxuICAgICAgLy8g6ZaL55m655Kw5aKDOiDjgrnjgr/jg4Pjgq/liYrpmaTmmYLjgavjg63jgrDjgoLliYrpmaRcclxuICAgICAgdGhpcy5yZW1vdmFsUG9saWN5ID0gY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbmZpZ3VyZSBDbG91ZFdhdGNoIExvZ3MgZm9yIGEgTGFtYmRhIGZ1bmN0aW9uXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGxhbWJkYUZ1bmN0aW9uIC0gTGFtYmRhIGZ1bmN0aW9uIHRvIGNvbmZpZ3VyZVxyXG4gICAqIEBwYXJhbSBsb2dHcm91cE5hbWUgLSBPcHRpb25hbCBjdXN0b20gbG9nIGdyb3VwIG5hbWUgKGRlZmF1bHRzIHRvIC9hd3MvbGFtYmRhL3tmdW5jdGlvbk5hbWV9KVxyXG4gICAqIEByZXR1cm5zIENyZWF0ZWQgbG9nIGdyb3VwXHJcbiAgICovXHJcbiAgcHVibGljIGNvbmZpZ3VyZUZvckxhbWJkYShcclxuICAgIGxhbWJkYUZ1bmN0aW9uOiBsYW1iZGEuRnVuY3Rpb24sXHJcbiAgICBsb2dHcm91cE5hbWU/OiBzdHJpbmdcclxuICApOiBsb2dzLkxvZ0dyb3VwIHtcclxuICAgIGNvbnN0IGxvZ0dyb3VwID0gbmV3IGxvZ3MuTG9nR3JvdXAodGhpcywgYCR7bGFtYmRhRnVuY3Rpb24ubm9kZS5pZH1Mb2dHcm91cGAsIHtcclxuICAgICAgbG9nR3JvdXBOYW1lOiBsb2dHcm91cE5hbWUgfHwgYC9hd3MvbGFtYmRhLyR7bGFtYmRhRnVuY3Rpb24uZnVuY3Rpb25OYW1lfWAsXHJcbiAgICAgIHJldGVudGlvbjogdGhpcy5yZXRlbnRpb25EYXlzLFxyXG4gICAgICByZW1vdmFsUG9saWN5OiB0aGlzLnJlbW92YWxQb2xpY3ksXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBDbG91ZEZvcm1hdGlvbiBPdXRwdXRcclxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsIGAke2xhbWJkYUZ1bmN0aW9uLm5vZGUuaWR9TG9nR3JvdXBOYW1lYCwge1xyXG4gICAgICB2YWx1ZTogbG9nR3JvdXAubG9nR3JvdXBOYW1lLFxyXG4gICAgICBkZXNjcmlwdGlvbjogYExvZyBncm91cCBmb3IgJHtsYW1iZGFGdW5jdGlvbi5mdW5jdGlvbk5hbWV9YCxcclxuICAgICAgZXhwb3J0TmFtZTogYCR7bGFtYmRhRnVuY3Rpb24uZnVuY3Rpb25OYW1lfS1Mb2dHcm91cE5hbWVgLFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGxvZ0dyb3VwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29uZmlndXJlIENsb3VkV2F0Y2ggTG9ncyBmb3IgbXVsdGlwbGUgTGFtYmRhIGZ1bmN0aW9uc1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBsYW1iZGFGdW5jdGlvbnMgLSBBcnJheSBvZiBMYW1iZGEgZnVuY3Rpb25zIHRvIGNvbmZpZ3VyZVxyXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGNyZWF0ZWQgbG9nIGdyb3Vwc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25maWd1cmVGb3JMYW1iZGFzKGxhbWJkYUZ1bmN0aW9uczogbGFtYmRhLkZ1bmN0aW9uW10pOiBsb2dzLkxvZ0dyb3VwW10ge1xyXG4gICAgcmV0dXJuIGxhbWJkYUZ1bmN0aW9ucy5tYXAoKGZuKSA9PiB0aGlzLmNvbmZpZ3VyZUZvckxhbWJkYShmbikpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHJldGVudGlvbiBkYXlzIGFzIG51bWJlciAoZm9yIHRlc3RpbmcvdmFsaWRhdGlvbilcclxuICAgKiBcclxuICAgKiBAcmV0dXJucyBOdW1iZXIgb2YgZGF5c1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRSZXRlbnRpb25EYXlzQXNOdW1iZXIoKTogbnVtYmVyIHtcclxuICAgIHN3aXRjaCAodGhpcy5yZXRlbnRpb25EYXlzKSB7XHJcbiAgICAgIGNhc2UgbG9ncy5SZXRlbnRpb25EYXlzLk9ORV9XRUVLOlxyXG4gICAgICAgIHJldHVybiA3O1xyXG4gICAgICBjYXNlIGxvZ3MuUmV0ZW50aW9uRGF5cy5USFJFRV9NT05USFM6XHJcbiAgICAgICAgcmV0dXJuIDkwO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCByZXRlbnRpb24gZGF5czogJHt0aGlzLnJldGVudGlvbkRheXN9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==