{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\constructs\\cloudwatch-logs.ts","mappings":";AAAA;;;;;;;;;GASG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,iDAAmC;AACnC,2DAA6C;AAE7C,2CAAuC;AAavC;;;;GAIG;AACH,MAAa,cAAe,SAAQ,sBAAS;IAC3C;;OAEG;IACa,aAAa,CAAqB;IAElD;;OAEG;IACa,aAAa,CAAoB;IAEjD,YAAY,KAAgB,EAAE,EAAU,EAAE,KAA0B;QAClE,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QAEjB,iBAAiB;QACjB,IAAI,KAAK,CAAC,WAAW,KAAK,MAAM,EAAE,CAAC;YACjC,iBAAiB;YACjB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC;YACrD,sBAAsB;YACtB,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC;QAChD,CAAC;aAAM,CAAC;YACN,gBAAgB;YAChB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC;YACjD,sBAAsB;YACtB,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC,OAAO,CAAC;QACjD,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACI,kBAAkB,CACvB,cAA+B,EAC/B,YAAqB;QAErB,MAAM,QAAQ,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,cAAc,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE;YAC5E,YAAY,EAAE,YAAY,IAAI,eAAe,cAAc,CAAC,YAAY,EAAE;YAC1E,SAAS,EAAE,IAAI,CAAC,aAAa;YAC7B,aAAa,EAAE,IAAI,CAAC,aAAa;SAClC,CAAC,CAAC;QAEH,wBAAwB;QACxB,IAAI,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,GAAG,cAAc,CAAC,IAAI,CAAC,EAAE,cAAc,EAAE;YAC/D,KAAK,EAAE,QAAQ,CAAC,YAAY;YAC5B,WAAW,EAAE,iBAAiB,cAAc,CAAC,YAAY,EAAE;YAC3D,UAAU,EAAE,GAAG,cAAc,CAAC,YAAY,eAAe;SAC1D,CAAC,CAAC;QAEH,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED;;;;;OAKG;IACI,mBAAmB,CAAC,eAAkC;QAC3D,OAAO,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;IAClE,CAAC;IAED;;;;OAIG;IACI,wBAAwB;QAC7B,QAAQ,IAAI,CAAC,aAAa,EAAE,CAAC;YAC3B,KAAK,IAAI,CAAC,aAAa,CAAC,QAAQ;gBAC9B,OAAO,CAAC,CAAC;YACX,KAAK,IAAI,CAAC,aAAa,CAAC,YAAY;gBAClC,OAAO,EAAE,CAAC;YACZ;gBACE,MAAM,IAAI,KAAK,CAAC,8BAA8B,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;QACxE,CAAC;IACH,CAAC;CACF;AAhFD,wCAgFC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\lib\\constructs\\cloudwatch-logs.ts"],"sourcesContent":["/**\r\n * CloudWatch Logs Construct\r\n * \r\n * This construct configures CloudWatch Logs for Lambda functions with environment-specific\r\n * retention periods to optimize costs and comply with logging requirements.\r\n * \r\n * Retention Periods:\r\n * - Production: 90 days (3 months) - 要件6.3準拠\r\n * - Development: 7 days (1 week) - コスト最適化\r\n */\r\n\r\nimport * as cdk from 'aws-cdk-lib';\r\nimport * as logs from 'aws-cdk-lib/aws-logs';\r\nimport * as lambda from 'aws-cdk-lib/aws-lambda';\r\nimport { Construct } from 'constructs';\r\nimport { Environment } from '../config/environment-config';\r\n\r\n/**\r\n * Properties for CloudWatch Logs Construct\r\n */\r\nexport interface CloudWatchLogsProps {\r\n  /**\r\n   * Environment name (dev or prod)\r\n   */\r\n  environment: Environment;\r\n}\r\n\r\n/**\r\n * CloudWatch Logs Construct\r\n * \r\n * Provides centralized log configuration for all Lambda functions\r\n */\r\nexport class CloudWatchLogs extends Construct {\r\n  /**\r\n   * Log retention period for the environment\r\n   */\r\n  public readonly retentionDays: logs.RetentionDays;\r\n\r\n  /**\r\n   * Removal policy for log groups\r\n   */\r\n  public readonly removalPolicy: cdk.RemovalPolicy;\r\n\r\n  constructor(scope: Construct, id: string, props: CloudWatchLogsProps) {\r\n    super(scope, id);\r\n\r\n    // 環境ごとのログ保持期間を設定\r\n    if (props.environment === 'prod') {\r\n      // 本番環境: 3ヶ月（90日）\r\n      this.retentionDays = logs.RetentionDays.THREE_MONTHS;\r\n      // 本番環境: スタック削除時もログを保持\r\n      this.removalPolicy = cdk.RemovalPolicy.RETAIN;\r\n    } else {\r\n      // 開発環境: 1週間（7日）\r\n      this.retentionDays = logs.RetentionDays.ONE_WEEK;\r\n      // 開発環境: スタック削除時にログも削除\r\n      this.removalPolicy = cdk.RemovalPolicy.DESTROY;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure CloudWatch Logs for a Lambda function\r\n   * \r\n   * @param lambdaFunction - Lambda function to configure\r\n   * @param logGroupName - Optional custom log group name (defaults to /aws/lambda/{functionName})\r\n   * @returns Created log group\r\n   */\r\n  public configureForLambda(\r\n    lambdaFunction: lambda.Function,\r\n    logGroupName?: string\r\n  ): logs.LogGroup {\r\n    const logGroup = new logs.LogGroup(this, `${lambdaFunction.node.id}LogGroup`, {\r\n      logGroupName: logGroupName || `/aws/lambda/${lambdaFunction.functionName}`,\r\n      retention: this.retentionDays,\r\n      removalPolicy: this.removalPolicy,\r\n    });\r\n\r\n    // CloudFormation Output\r\n    new cdk.CfnOutput(this, `${lambdaFunction.node.id}LogGroupName`, {\r\n      value: logGroup.logGroupName,\r\n      description: `Log group for ${lambdaFunction.functionName}`,\r\n      exportName: `${lambdaFunction.functionName}-LogGroupName`,\r\n    });\r\n\r\n    return logGroup;\r\n  }\r\n\r\n  /**\r\n   * Configure CloudWatch Logs for multiple Lambda functions\r\n   * \r\n   * @param lambdaFunctions - Array of Lambda functions to configure\r\n   * @returns Array of created log groups\r\n   */\r\n  public configureForLambdas(lambdaFunctions: lambda.Function[]): logs.LogGroup[] {\r\n    return lambdaFunctions.map((fn) => this.configureForLambda(fn));\r\n  }\r\n\r\n  /**\r\n   * Get retention days as number (for testing/validation)\r\n   * \r\n   * @returns Number of days\r\n   */\r\n  public getRetentionDaysAsNumber(): number {\r\n    switch (this.retentionDays) {\r\n      case logs.RetentionDays.ONE_WEEK:\r\n        return 7;\r\n      case logs.RetentionDays.THREE_MONTHS:\r\n        return 90;\r\n      default:\r\n        throw new Error(`Unexpected retention days: ${this.retentionDays}`);\r\n    }\r\n  }\r\n}\r\n"],"version":3}