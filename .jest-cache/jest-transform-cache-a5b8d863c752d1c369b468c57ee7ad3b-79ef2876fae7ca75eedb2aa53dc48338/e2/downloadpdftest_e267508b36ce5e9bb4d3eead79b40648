1440cbdff44eff09dda3191a70fc72f2
"use strict";
/**
 * downloadPdf関数のユニットテスト
 *
 * Requirements: 要件1.3, 3.3, 6.1（PDFダウンロード、S3保存、エラーハンドリング）
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// モック設定
jest.mock('axios');
const axios_1 = __importDefault(require("axios"));
const client_s3_1 = require("@aws-sdk/client-s3");
const aws_sdk_client_mock_1 = require("aws-sdk-client-mock");
const download_pdf_1 = require("../download-pdf");
const errors_1 = require("../../../errors");
const pdfDownloader = __importStar(require("../../../scraper/pdf-downloader"));
const mockedAxios = axios_1.default;
const s3Mock = (0, aws_sdk_client_mock_1.mockClient)(client_s3_1.S3Client);
// validatePdfFileのモック
jest.spyOn(pdfDownloader, 'validatePdfFile').mockImplementation(() => { });
describe('downloadPdf', () => {
    const originalEnv = process.env.S3_BUCKET;
    beforeEach(() => {
        jest.clearAllMocks();
        s3Mock.reset();
        process.env.S3_BUCKET = 'test-bucket';
    });
    afterEach(() => {
        process.env.S3_BUCKET = originalEnv;
    });
    describe('正常系', () => {
        it('PDFをダウンロードしてS3に保存できる', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
            // Act
            const result = await (0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at);
            // Assert
            expect(result).toBe('2024/01/15/TD20240115001.pdf');
            expect(mockedAxios.get).toHaveBeenCalledWith(pdf_url, {
                responseType: 'arraybuffer',
                timeout: 60000,
                headers: {
                    'User-Agent': 'TDnet-Data-Collector/1.0',
                },
            });
            expect(s3Mock.calls()).toHaveLength(1);
            expect(s3Mock.call(0).args[0].input).toMatchObject({
                Bucket: 'test-bucket',
                Key: '2024/01/15/TD20240115001.pdf',
                ContentType: 'application/pdf',
            });
        });
        it('月またぎ（UTC→JST）のS3キーを正しく生成できる', async () => {
            // Arrange: UTC 2024-01-31 15:30 → JST 2024-02-01 00:30
            const disclosure_id = 'TD20240131001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240131001.pdf';
            const disclosed_at = '2024-01-31T15:30:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
            // Act
            const result = await (0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at);
            // Assert
            expect(result).toBe('2024/02/01/TD20240131001.pdf');
        });
        it('年またぎ（UTC→JST）のS3キーを正しく生成できる', async () => {
            // Arrange: UTC 2023-12-31 15:30 → JST 2024-01-01 00:30
            const disclosure_id = 'TD20231231001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120231231001.pdf';
            const disclosed_at = '2023-12-31T15:30:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
            // Act
            const result = await (0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at);
            // Assert
            expect(result).toBe('2024/01/01/TD20231231001.pdf');
        });
    });
    describe('異常系', () => {
        it('タイムアウトエラーで再試行する', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const timeoutError = new Error('Timeout');
            timeoutError.code = 'ETIMEDOUT';
            timeoutError.isAxiosError = true;
            mockedAxios.get.mockRejectedValue(timeoutError);
            // Act & Assert
            await expect((0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at)).rejects.toThrow();
            expect(mockedAxios.get).toHaveBeenCalledTimes(4); // 初回 + 3回再試行
        });
        it('5xxエラーで再試行する', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const serverError = new Error('Server Error');
            serverError.isAxiosError = true;
            serverError.response = { status: 503 };
            mockedAxios.get.mockRejectedValue(serverError);
            // Act & Assert
            await expect((0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at)).rejects.toThrow();
            expect(mockedAxios.get).toHaveBeenCalledTimes(4); // 初回 + 3回再試行
        });
        it('429エラーで再試行する', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const rateLimitError = new Error('Too Many Requests');
            rateLimitError.isAxiosError = true;
            rateLimitError.response = { status: 429 };
            mockedAxios.get.mockRejectedValue(rateLimitError);
            // Act & Assert
            await expect((0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at)).rejects.toThrow();
            expect(mockedAxios.get).toHaveBeenCalledTimes(4); // 初回 + 3回再試行
        });
        it('PDFバリデーションエラーで即座に失敗する', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const invalidPdfBuffer = Buffer.from('not a pdf');
            mockedAxios.get.mockResolvedValue({
                data: invalidPdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            // validatePdfFileのモックを一時的に解除
            pdfDownloader.validatePdfFile.mockImplementationOnce(() => {
                throw new errors_1.ValidationError('Invalid PDF header');
            });
            // Act & Assert
            await expect((0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at)).rejects.toThrow(errors_1.ValidationError);
            expect(mockedAxios.get).toHaveBeenCalledTimes(1); // 再試行しない
        });
        it('S3アップロードエラーで失敗する', async () => {
            // Arrange
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).rejects(new Error('S3 upload failed'));
            // Act & Assert
            await expect((0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at)).rejects.toThrow('S3 upload failed');
        });
    });
    describe('エッジケース', () => {
        it('うるう年2月末（UTC→JST）のS3キーを正しく生成できる', async () => {
            // Arrange: UTC 2024-02-29 15:00 → JST 2024-03-01 00:00
            const disclosure_id = 'TD20240229001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240229001.pdf';
            const disclosed_at = '2024-02-29T15:00:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
            // Act
            const result = await (0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at);
            // Assert
            expect(result).toBe('2024/03/01/TD20240229001.pdf');
        });
        it('環境変数S3_BUCKETが未設定の場合、デフォルト値を使用する', async () => {
            // Arrange
            delete process.env.S3_BUCKET;
            const disclosure_id = 'TD20240115001';
            const pdf_url = 'https://www.release.tdnet.info/inbs/140120240115001.pdf';
            const disclosed_at = '2024-01-15T10:30:00Z';
            const pdfBuffer = Buffer.from('%PDF-1.4\n%test content');
            mockedAxios.get.mockResolvedValue({
                data: pdfBuffer,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            });
            s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
            // Act
            await (0, download_pdf_1.downloadPdf)(disclosure_id, pdf_url, disclosed_at);
            // Assert
            const input = s3Mock.call(0).args[0].input;
            expect(input.Bucket).toBe('tdnet-data-collector-pdfs');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3RvclxcX190ZXN0c19fXFxkb3dubG9hZC1wZGYudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFTSCxRQUFRO0FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQVJuQixrREFBMEI7QUFDMUIsa0RBQWdFO0FBQ2hFLDZEQUFpRDtBQUNqRCxrREFBOEM7QUFDOUMsNENBQWtEO0FBQ2xELCtFQUFpRTtBQUlqRSxNQUFNLFdBQVcsR0FBRyxlQUFrQyxDQUFDO0FBQ3ZELE1BQU0sTUFBTSxHQUFHLElBQUEsZ0NBQVUsRUFBQyxvQkFBUSxDQUFDLENBQUM7QUFFcEMsc0JBQXNCO0FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDLENBQUM7QUFFMUUsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFMUMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7SUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLHNCQUFzQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BDLFVBQVU7WUFDVixNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUM7WUFDdEMsTUFBTSxPQUFPLEdBQUcseURBQXlELENBQUM7WUFDMUUsTUFBTSxZQUFZLEdBQUcsc0JBQXNCLENBQUM7WUFDNUMsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBRXpELFdBQVcsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUM7Z0JBQ2hDLElBQUksRUFBRSxTQUFTO2dCQUNmLE1BQU0sRUFBRSxHQUFHO2dCQUNYLFVBQVUsRUFBRSxJQUFJO2dCQUNoQixPQUFPLEVBQUUsRUFBRTtnQkFDWCxNQUFNLEVBQUUsRUFBUzthQUNsQixDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsRUFBRSxDQUFDLDRCQUFnQixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXpDLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsMEJBQVcsRUFBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBRXZFLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLEVBQUU7Z0JBQ3BELFlBQVksRUFBRSxhQUFhO2dCQUMzQixPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUU7b0JBQ1AsWUFBWSxFQUFFLDBCQUEwQjtpQkFDekM7YUFDRixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLENBQUM7Z0JBQ2pELE1BQU0sRUFBRSxhQUFhO2dCQUNyQixHQUFHLEVBQUUsOEJBQThCO2dCQUNuQyxXQUFXLEVBQUUsaUJBQWlCO2FBQy9CLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNDLHVEQUF1RDtZQUN2RCxNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUM7WUFDdEMsTUFBTSxPQUFPLEdBQUcseURBQXlELENBQUM7WUFDMUUsTUFBTSxZQUFZLEdBQUcsc0JBQXNCLENBQUM7WUFDNUMsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBRXpELFdBQVcsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUM7Z0JBQ2hDLElBQUksRUFBRSxTQUFTO2dCQUNmLE1BQU0sRUFBRSxHQUFHO2dCQUNYLFVBQVUsRUFBRSxJQUFJO2dCQUNoQixPQUFPLEVBQUUsRUFBRTtnQkFDWCxNQUFNLEVBQUUsRUFBUzthQUNsQixDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsRUFBRSxDQUFDLDRCQUFnQixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXpDLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsMEJBQVcsRUFBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBRXZFLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsdURBQXVEO1lBQ3ZELE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztZQUMxRSxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztZQUM1QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFFekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxFQUFTO2FBQ2xCLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxFQUFFLENBQUMsNEJBQWdCLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFekMsTUFBTTtZQUNOLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSwwQkFBVyxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFFdkUsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLGlCQUFpQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9CLFVBQVU7WUFDVixNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUM7WUFDdEMsTUFBTSxPQUFPLEdBQUcseURBQXlELENBQUM7WUFDMUUsTUFBTSxZQUFZLEdBQUcsc0JBQXNCLENBQUM7WUFFNUMsTUFBTSxZQUFZLEdBQUcsSUFBSSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDekMsWUFBb0IsQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDO1lBQ3hDLFlBQW9CLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztZQUUxQyxXQUFXLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRWhELGVBQWU7WUFDZixNQUFNLE1BQU0sQ0FBQyxJQUFBLDBCQUFXLEVBQUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNsRixNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYTtRQUNqRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxjQUFjLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUIsVUFBVTtZQUNWLE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztZQUMxRSxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztZQUU1QyxNQUFNLFdBQVcsR0FBRyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUM3QyxXQUFtQixDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDeEMsV0FBbUIsQ0FBQyxRQUFRLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUM7WUFFaEQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUUvQyxlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQUMsSUFBQSwwQkFBVyxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbEYsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWE7UUFDakUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsY0FBYyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVCLFVBQVU7WUFDVixNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUM7WUFDdEMsTUFBTSxPQUFPLEdBQUcseURBQXlELENBQUM7WUFDMUUsTUFBTSxZQUFZLEdBQUcsc0JBQXNCLENBQUM7WUFFNUMsTUFBTSxjQUFjLEdBQUcsSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUNyRCxjQUFzQixDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDM0MsY0FBc0IsQ0FBQyxRQUFRLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUM7WUFFbkQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVsRCxlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQUMsSUFBQSwwQkFBVyxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbEYsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWE7UUFDakUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckMsVUFBVTtZQUNWLE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztZQUMxRSxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztZQUM1QyxNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFbEQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxFQUFTO2FBQ2xCLENBQUMsQ0FBQztZQUVILDZCQUE2QjtZQUM1QixhQUFhLENBQUMsZUFBNkIsQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQ3ZFLE1BQU0sSUFBSSx3QkFBZSxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDbEQsQ0FBQyxDQUFDLENBQUM7WUFFSCxlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQUMsSUFBQSwwQkFBVyxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUM3RSx3QkFBZSxDQUNoQixDQUFDO1lBQ0YsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7UUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEMsVUFBVTtZQUNWLE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztZQUMxRSxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztZQUM1QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFFekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxFQUFTO2FBQ2xCLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxFQUFFLENBQUMsNEJBQWdCLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1lBRW5FLGVBQWU7WUFDZixNQUFNLE1BQU0sQ0FBQyxJQUFBLDBCQUFXLEVBQUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQzdFLGtCQUFrQixDQUNuQixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5Qyx1REFBdUQ7WUFDdkQsTUFBTSxhQUFhLEdBQUcsZUFBZSxDQUFDO1lBQ3RDLE1BQU0sT0FBTyxHQUFHLHlEQUF5RCxDQUFDO1lBQzFFLE1BQU0sWUFBWSxHQUFHLHNCQUFzQixDQUFDO1lBQzVDLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUV6RCxXQUFXLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsU0FBUztnQkFDZixNQUFNLEVBQUUsR0FBRztnQkFDWCxVQUFVLEVBQUUsSUFBSTtnQkFDaEIsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsTUFBTSxFQUFFLEVBQVM7YUFDbEIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLEVBQUUsQ0FBQyw0QkFBZ0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUV6QyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDBCQUFXLEVBQUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztZQUV2RSxTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hELFVBQVU7WUFDVixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO1lBQzdCLE1BQU0sYUFBYSxHQUFHLGVBQWUsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztZQUMxRSxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztZQUM1QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFFekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxFQUFTO2FBQ2xCLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxFQUFFLENBQUMsNEJBQWdCLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFekMsTUFBTTtZQUNOLE1BQU0sSUFBQSwwQkFBVyxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFFeEQsU0FBUztZQUNULE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQVksQ0FBQztZQUNsRCxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcY29sbGVjdG9yXFxfX3Rlc3RzX19cXGRvd25sb2FkLXBkZi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBkb3dubG9hZFBkZumWouaVsOOBruODpuODi+ODg+ODiOODhuOCueODiFxyXG4gKlxyXG4gKiBSZXF1aXJlbWVudHM6IOimgeS7tjEuMywgMy4zLCA2LjHvvIhQREbjg4Djgqbjg7Pjg63jg7zjg4njgIFTM+S/neWtmOOAgeOCqOODqeODvOODj+ODs+ODieODquODs+OCsO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XHJcbmltcG9ydCB7IFMzQ2xpZW50LCBQdXRPYmplY3RDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcclxuaW1wb3J0IHsgbW9ja0NsaWVudCB9IGZyb20gJ2F3cy1zZGstY2xpZW50LW1vY2snO1xyXG5pbXBvcnQgeyBkb3dubG9hZFBkZiB9IGZyb20gJy4uL2Rvd25sb2FkLXBkZic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4uLy4uLy4uL2Vycm9ycyc7XHJcbmltcG9ydCAqIGFzIHBkZkRvd25sb2FkZXIgZnJvbSAnLi4vLi4vLi4vc2NyYXBlci9wZGYtZG93bmxvYWRlcic7XHJcblxyXG4vLyDjg6Ljg4Pjgq/oqK3lrppcclxuamVzdC5tb2NrKCdheGlvcycpO1xyXG5jb25zdCBtb2NrZWRBeGlvcyA9IGF4aW9zIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBheGlvcz47XHJcbmNvbnN0IHMzTW9jayA9IG1vY2tDbGllbnQoUzNDbGllbnQpO1xyXG5cclxuLy8gdmFsaWRhdGVQZGZGaWxl44Gu44Oi44OD44KvXHJcbmplc3Quc3B5T24ocGRmRG93bmxvYWRlciwgJ3ZhbGlkYXRlUGRmRmlsZScpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcblxyXG5kZXNjcmliZSgnZG93bmxvYWRQZGYnLCAoKSA9PiB7XHJcbiAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudi5TM19CVUNLRVQ7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBzM01vY2sucmVzZXQoKTtcclxuICAgIHByb2Nlc3MuZW52LlMzX0JVQ0tFVCA9ICd0ZXN0LWJ1Y2tldCc7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBwcm9jZXNzLmVudi5TM19CVUNLRVQgPSBvcmlnaW5hbEVudjtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+ato+W4uOezuycsICgpID0+IHtcclxuICAgIGl0KCdQREbjgpLjg4Djgqbjg7Pjg63jg7zjg4njgZfjgaZTM+OBq+S/neWtmOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlX2lkID0gJ1REMjAyNDAxMTUwMDEnO1xyXG4gICAgICBjb25zdCBwZGZfdXJsID0gJ2h0dHBzOi8vd3d3LnJlbGVhc2UudGRuZXQuaW5mby9pbmJzLzE0MDEyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBkaXNjbG9zZWRfYXQgPSAnMjAyNC0wMS0xNVQxMDozMDowMFonO1xyXG4gICAgICBjb25zdCBwZGZCdWZmZXIgPSBCdWZmZXIuZnJvbSgnJVBERi0xLjRcXG4ldGVzdCBjb250ZW50Jyk7XHJcblxyXG4gICAgICBtb2NrZWRBeGlvcy5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHBkZkJ1ZmZlcixcclxuICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICBzdGF0dXNUZXh0OiAnT0snLFxyXG4gICAgICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgICAgIGNvbmZpZzoge30gYXMgYW55LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHMzTW9jay5vbihQdXRPYmplY3RDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZG93bmxvYWRQZGYoZGlzY2xvc3VyZV9pZCwgcGRmX3VybCwgZGlzY2xvc2VkX2F0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRBeGlvcy5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBkZl91cmwsIHtcclxuICAgICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicsXHJcbiAgICAgICAgdGltZW91dDogNjAwMDAsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ1VzZXItQWdlbnQnOiAnVERuZXQtRGF0YS1Db2xsZWN0b3IvMS4wJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHMzTW9jay5jYWxscygpKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChzM01vY2suY2FsbCgwKS5hcmdzWzBdLmlucHV0KS50b01hdGNoT2JqZWN0KHtcclxuICAgICAgICBCdWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXHJcbiAgICAgICAgS2V5OiAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZicsXHJcbiAgICAgICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9wZGYnLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmnIjjgb7jgZ/jgY7vvIhVVEPihpJKU1TvvInjga5TM+OCreODvOOCkuato+OBl+OBj+eUn+aIkOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZTogVVRDIDIwMjQtMDEtMzEgMTU6MzAg4oaSIEpTVCAyMDI0LTAyLTAxIDAwOjMwXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVfaWQgPSAnVEQyMDI0MDEzMTAwMSc7XHJcbiAgICAgIGNvbnN0IHBkZl91cmwgPSAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjQwMTMxMDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGRpc2Nsb3NlZF9hdCA9ICcyMDI0LTAxLTMxVDE1OjMwOjAwWic7XHJcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCclUERGLTEuNFxcbiV0ZXN0IGNvbnRlbnQnKTtcclxuXHJcbiAgICAgIG1vY2tlZEF4aW9zLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogcGRmQnVmZmVyLFxyXG4gICAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6ICdPSycsXHJcbiAgICAgICAgaGVhZGVyczoge30sXHJcbiAgICAgICAgY29uZmlnOiB7fSBhcyBhbnksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgczNNb2NrLm9uKFB1dE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzIwMjQvMDIvMDEvVEQyMDI0MDEzMTAwMS5wZGYnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCflubTjgb7jgZ/jgY7vvIhVVEPihpJKU1TvvInjga5TM+OCreODvOOCkuato+OBl+OBj+eUn+aIkOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZTogVVRDIDIwMjMtMTItMzEgMTU6MzAg4oaSIEpTVCAyMDI0LTAxLTAxIDAwOjMwXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVfaWQgPSAnVEQyMDIzMTIzMTAwMSc7XHJcbiAgICAgIGNvbnN0IHBkZl91cmwgPSAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjMxMjMxMDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGRpc2Nsb3NlZF9hdCA9ICcyMDIzLTEyLTMxVDE1OjMwOjAwWic7XHJcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCclUERGLTEuNFxcbiV0ZXN0IGNvbnRlbnQnKTtcclxuXHJcbiAgICAgIG1vY2tlZEF4aW9zLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogcGRmQnVmZmVyLFxyXG4gICAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6ICdPSycsXHJcbiAgICAgICAgaGVhZGVyczoge30sXHJcbiAgICAgICAgY29uZmlnOiB7fSBhcyBhbnksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgczNNb2NrLm9uKFB1dE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzIwMjQvMDEvMDEvVEQyMDIzMTIzMTAwMS5wZGYnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn55Ww5bi457O7JywgKCkgPT4ge1xyXG4gICAgaXQoJ+OCv+OCpOODoOOCouOCpuODiOOCqOODqeODvOOBp+WGjeippuihjOOBmeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlX2lkID0gJ1REMjAyNDAxMTUwMDEnO1xyXG4gICAgICBjb25zdCBwZGZfdXJsID0gJ2h0dHBzOi8vd3d3LnJlbGVhc2UudGRuZXQuaW5mby9pbmJzLzE0MDEyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBkaXNjbG9zZWRfYXQgPSAnMjAyNC0wMS0xNVQxMDozMDowMFonO1xyXG5cclxuICAgICAgY29uc3QgdGltZW91dEVycm9yID0gbmV3IEVycm9yKCdUaW1lb3V0Jyk7XHJcbiAgICAgICh0aW1lb3V0RXJyb3IgYXMgYW55KS5jb2RlID0gJ0VUSU1FRE9VVCc7XHJcbiAgICAgICh0aW1lb3V0RXJyb3IgYXMgYW55KS5pc0F4aW9zRXJyb3IgPSB0cnVlO1xyXG5cclxuICAgICAgbW9ja2VkQXhpb3MuZ2V0Lm1vY2tSZWplY3RlZFZhbHVlKHRpbWVvdXRFcnJvcik7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGRvd25sb2FkUGRmKGRpc2Nsb3N1cmVfaWQsIHBkZl91cmwsIGRpc2Nsb3NlZF9hdCkpLnJlamVjdHMudG9UaHJvdygpO1xyXG4gICAgICBleHBlY3QobW9ja2VkQXhpb3MuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoNCk7IC8vIOWIneWbniArIDPlm57lho3oqabooYxcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCc1eHjjgqjjg6njg7zjgaflho3oqabooYzjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZV9pZCA9ICdURDIwMjQwMTE1MDAxJztcclxuICAgICAgY29uc3QgcGRmX3VybCA9ICdodHRwczovL3d3dy5yZWxlYXNlLnRkbmV0LmluZm8vaW5icy8xNDAxMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZGlzY2xvc2VkX2F0ID0gJzIwMjQtMDEtMTVUMTA6MzA6MDBaJztcclxuXHJcbiAgICAgIGNvbnN0IHNlcnZlckVycm9yID0gbmV3IEVycm9yKCdTZXJ2ZXIgRXJyb3InKTtcclxuICAgICAgKHNlcnZlckVycm9yIGFzIGFueSkuaXNBeGlvc0Vycm9yID0gdHJ1ZTtcclxuICAgICAgKHNlcnZlckVycm9yIGFzIGFueSkucmVzcG9uc2UgPSB7IHN0YXR1czogNTAzIH07XHJcblxyXG4gICAgICBtb2NrZWRBeGlvcy5nZXQubW9ja1JlamVjdGVkVmFsdWUoc2VydmVyRXJyb3IpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpKS5yZWplY3RzLnRvVGhyb3coKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZEF4aW9zLmdldCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDQpOyAvLyDliJ3lm54gKyAz5Zue5YaN6Kmm6KGMXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnNDI544Ko44Op44O844Gn5YaN6Kmm6KGM44GZ44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVfaWQgPSAnVEQyMDI0MDExNTAwMSc7XHJcbiAgICAgIGNvbnN0IHBkZl91cmwgPSAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGRpc2Nsb3NlZF9hdCA9ICcyMDI0LTAxLTE1VDEwOjMwOjAwWic7XHJcblxyXG4gICAgICBjb25zdCByYXRlTGltaXRFcnJvciA9IG5ldyBFcnJvcignVG9vIE1hbnkgUmVxdWVzdHMnKTtcclxuICAgICAgKHJhdGVMaW1pdEVycm9yIGFzIGFueSkuaXNBeGlvc0Vycm9yID0gdHJ1ZTtcclxuICAgICAgKHJhdGVMaW1pdEVycm9yIGFzIGFueSkucmVzcG9uc2UgPSB7IHN0YXR1czogNDI5IH07XHJcblxyXG4gICAgICBtb2NrZWRBeGlvcy5nZXQubW9ja1JlamVjdGVkVmFsdWUocmF0ZUxpbWl0RXJyb3IpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpKS5yZWplY3RzLnRvVGhyb3coKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZEF4aW9zLmdldCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDQpOyAvLyDliJ3lm54gKyAz5Zue5YaN6Kmm6KGMXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnUERG44OQ44Oq44OH44O844K344On44Oz44Ko44Op44O844Gn5Y2z5bqn44Gr5aSx5pWX44GZ44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVfaWQgPSAnVEQyMDI0MDExNTAwMSc7XHJcbiAgICAgIGNvbnN0IHBkZl91cmwgPSAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGRpc2Nsb3NlZF9hdCA9ICcyMDI0LTAxLTE1VDEwOjMwOjAwWic7XHJcbiAgICAgIGNvbnN0IGludmFsaWRQZGZCdWZmZXIgPSBCdWZmZXIuZnJvbSgnbm90IGEgcGRmJyk7XHJcblxyXG4gICAgICBtb2NrZWRBeGlvcy5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IGludmFsaWRQZGZCdWZmZXIsXHJcbiAgICAgICAgc3RhdHVzOiAyMDAsXHJcbiAgICAgICAgc3RhdHVzVGV4dDogJ09LJyxcclxuICAgICAgICBoZWFkZXJzOiB7fSxcclxuICAgICAgICBjb25maWc6IHt9IGFzIGFueSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyB2YWxpZGF0ZVBkZkZpbGXjga7jg6Ljg4Pjgq/jgpLkuIDmmYLnmoTjgavop6PpmaRcclxuICAgICAgKHBkZkRvd25sb2FkZXIudmFsaWRhdGVQZGZGaWxlIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignSW52YWxpZCBQREYgaGVhZGVyJyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgICAgVmFsaWRhdGlvbkVycm9yXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRBeGlvcy5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTsgLy8g5YaN6Kmm6KGM44GX44Gq44GEXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnUzPjgqLjg4Pjg5fjg63jg7zjg4njgqjjg6njg7zjgaflpLHmlZfjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZV9pZCA9ICdURDIwMjQwMTE1MDAxJztcclxuICAgICAgY29uc3QgcGRmX3VybCA9ICdodHRwczovL3d3dy5yZWxlYXNlLnRkbmV0LmluZm8vaW5icy8xNDAxMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZGlzY2xvc2VkX2F0ID0gJzIwMjQtMDEtMTVUMTA6MzA6MDBaJztcclxuICAgICAgY29uc3QgcGRmQnVmZmVyID0gQnVmZmVyLmZyb20oJyVQREYtMS40XFxuJXRlc3QgY29udGVudCcpO1xyXG5cclxuICAgICAgbW9ja2VkQXhpb3MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBwZGZCdWZmZXIsXHJcbiAgICAgICAgc3RhdHVzOiAyMDAsXHJcbiAgICAgICAgc3RhdHVzVGV4dDogJ09LJyxcclxuICAgICAgICBoZWFkZXJzOiB7fSxcclxuICAgICAgICBjb25maWc6IHt9IGFzIGFueSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBzM01vY2sub24oUHV0T2JqZWN0Q29tbWFuZCkucmVqZWN0cyhuZXcgRXJyb3IoJ1MzIHVwbG9hZCBmYWlsZWQnKSk7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGRvd25sb2FkUGRmKGRpc2Nsb3N1cmVfaWQsIHBkZl91cmwsIGRpc2Nsb3NlZF9hdCkpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgICAnUzMgdXBsb2FkIGZhaWxlZCdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn44Ko44OD44K444Kx44O844K5JywgKCkgPT4ge1xyXG4gICAgaXQoJ+OBhuOCi+OBhuW5tDLmnIjmnKvvvIhVVEPihpJKU1TvvInjga5TM+OCreODvOOCkuato+OBl+OBj+eUn+aIkOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZTogVVRDIDIwMjQtMDItMjkgMTU6MDAg4oaSIEpTVCAyMDI0LTAzLTAxIDAwOjAwXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVfaWQgPSAnVEQyMDI0MDIyOTAwMSc7XHJcbiAgICAgIGNvbnN0IHBkZl91cmwgPSAnaHR0cHM6Ly93d3cucmVsZWFzZS50ZG5ldC5pbmZvL2luYnMvMTQwMTIwMjQwMjI5MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGRpc2Nsb3NlZF9hdCA9ICcyMDI0LTAyLTI5VDE1OjAwOjAwWic7XHJcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCclUERGLTEuNFxcbiV0ZXN0IGNvbnRlbnQnKTtcclxuXHJcbiAgICAgIG1vY2tlZEF4aW9zLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogcGRmQnVmZmVyLFxyXG4gICAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6ICdPSycsXHJcbiAgICAgICAgaGVhZGVyczoge30sXHJcbiAgICAgICAgY29uZmlnOiB7fSBhcyBhbnksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgczNNb2NrLm9uKFB1dE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb3dubG9hZFBkZihkaXNjbG9zdXJlX2lkLCBwZGZfdXJsLCBkaXNjbG9zZWRfYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzIwMjQvMDMvMDEvVEQyMDI0MDIyOTAwMS5wZGYnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfnkrDlooPlpInmlbBTM19CVUNLRVTjgYzmnKroqK3lrprjga7loLTlkIjjgIHjg4fjg5Xjgqnjg6vjg4jlgKTjgpLkvb/nlKjjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LlMzX0JVQ0tFVDtcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZV9pZCA9ICdURDIwMjQwMTE1MDAxJztcclxuICAgICAgY29uc3QgcGRmX3VybCA9ICdodHRwczovL3d3dy5yZWxlYXNlLnRkbmV0LmluZm8vaW5icy8xNDAxMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZGlzY2xvc2VkX2F0ID0gJzIwMjQtMDEtMTVUMTA6MzA6MDBaJztcclxuICAgICAgY29uc3QgcGRmQnVmZmVyID0gQnVmZmVyLmZyb20oJyVQREYtMS40XFxuJXRlc3QgY29udGVudCcpO1xyXG5cclxuICAgICAgbW9ja2VkQXhpb3MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBwZGZCdWZmZXIsXHJcbiAgICAgICAgc3RhdHVzOiAyMDAsXHJcbiAgICAgICAgc3RhdHVzVGV4dDogJ09LJyxcclxuICAgICAgICBoZWFkZXJzOiB7fSxcclxuICAgICAgICBjb25maWc6IHt9IGFzIGFueSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBzM01vY2sub24oUHV0T2JqZWN0Q29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGRvd25sb2FkUGRmKGRpc2Nsb3N1cmVfaWQsIHBkZl91cmwsIGRpc2Nsb3NlZF9hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3QgaW5wdXQgPSBzM01vY2suY2FsbCgwKS5hcmdzWzBdLmlucHV0IGFzIGFueTtcclxuICAgICAgZXhwZWN0KGlucHV0LkJ1Y2tldCkudG9CZSgndGRuZXQtZGF0YS1jb2xsZWN0b3ItcGRmcycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=