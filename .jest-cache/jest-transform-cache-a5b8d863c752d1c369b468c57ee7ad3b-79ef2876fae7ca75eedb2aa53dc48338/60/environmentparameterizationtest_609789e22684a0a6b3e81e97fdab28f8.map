{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\environment-parameterization.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\cdk\\__tests__\\environment-parameterization.test.ts"],"sourcesContent":["/**\r\n * Environment Parameterization Test\r\n *\r\n * Task 15.15-A: CDKスタックの環境パラメータ化テスト\r\n * Requirements: 要件8.1（設定管理）\r\n *\r\n * このテストは、CDKスタックが環境（dev/prod）ごとに正しくパラメータ化されていることを検証します。\r\n */\r\n\r\nimport * as cdk from 'aws-cdk-lib';\r\nimport { Template } from 'aws-cdk-lib/assertions';\r\nimport { TdnetDataCollectorStack } from '../lib/tdnet-data-collector-stack';\r\n\r\ndescribe('Environment Parameterization', () => {\r\n  const testAccount = '123456789012';\r\n  const testRegion = 'ap-northeast-1';\r\n\r\n  describe('Development Environment', () => {\r\n    let template: Template;\r\n\r\n    beforeAll(() => {\r\n      const app = new cdk.App();\r\n      const stack = new TdnetDataCollectorStack(app, 'TestStack-dev', {\r\n        env: { account: testAccount, region: testRegion },\r\n        environmentConfig: { environment: 'dev' },\r\n      });\r\n      template = Template.fromStack(stack);\r\n    });\r\n\r\n    describe('DynamoDB Tables', () => {\r\n      it('should have environment suffix in table names', () => {\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_disclosures_dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_executions_dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_export_status_dev',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('S3 Buckets', () => {\r\n      it('should have environment suffix in bucket names', () => {\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-data-collector-pdfs-dev-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-data-collector-exports-dev-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-dashboard-dev-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-cloudtrail-logs-dev-${testAccount}`,\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('Lambda Functions', () => {\r\n      it('should have environment suffix in function names', () => {\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collector-dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-query-dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-export-dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collect-dev',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collect-status-dev',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('API Gateway', () => {\r\n      it('should have environment suffix in API name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::RestApi', {\r\n          Name: 'tdnet-data-collector-api-dev',\r\n        });\r\n      });\r\n\r\n      it('should have environment suffix in API key name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::ApiKey', {\r\n          Name: 'tdnet-api-key-dev',\r\n        });\r\n      });\r\n\r\n      it('should have environment suffix in usage plan name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::UsagePlan', {\r\n          UsagePlanName: 'tdnet-usage-plan-dev',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('WAF', () => {\r\n      it('should have environment suffix in Web ACL name', () => {\r\n        template.hasResourceProperties('AWS::WAFv2::WebACL', {\r\n          Name: 'tdnet-web-acl-dev',\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Production Environment', () => {\r\n    let template: Template;\r\n\r\n    beforeAll(() => {\r\n      const app = new cdk.App();\r\n      const stack = new TdnetDataCollectorStack(app, 'TestStack-prod', {\r\n        env: { account: testAccount, region: testRegion },\r\n        environmentConfig: { environment: 'prod' },\r\n      });\r\n      template = Template.fromStack(stack);\r\n    });\r\n\r\n    describe('DynamoDB Tables', () => {\r\n      it('should have environment suffix in table names', () => {\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_disclosures_prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_executions_prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n          TableName: 'tdnet_export_status_prod',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('S3 Buckets', () => {\r\n      it('should have environment suffix in bucket names', () => {\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-data-collector-pdfs-prod-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-data-collector-exports-prod-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-dashboard-prod-${testAccount}`,\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::S3::Bucket', {\r\n          BucketName: `tdnet-cloudtrail-logs-prod-${testAccount}`,\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('Lambda Functions', () => {\r\n      it('should have environment suffix in function names', () => {\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collector-prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-query-prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-export-prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collect-prod',\r\n        });\r\n\r\n        template.hasResourceProperties('AWS::Lambda::Function', {\r\n          FunctionName: 'tdnet-collect-status-prod',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('API Gateway', () => {\r\n      it('should have environment suffix in API name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::RestApi', {\r\n          Name: 'tdnet-data-collector-api-prod',\r\n        });\r\n      });\r\n\r\n      it('should have environment suffix in API key name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::ApiKey', {\r\n          Name: 'tdnet-api-key-prod',\r\n        });\r\n      });\r\n\r\n      it('should have environment suffix in usage plan name', () => {\r\n        template.hasResourceProperties('AWS::ApiGateway::UsagePlan', {\r\n          UsagePlanName: 'tdnet-usage-plan-prod',\r\n        });\r\n      });\r\n    });\r\n\r\n    describe('WAF', () => {\r\n      it('should have environment suffix in Web ACL name', () => {\r\n        template.hasResourceProperties('AWS::WAFv2::WebACL', {\r\n          Name: 'tdnet-web-acl-prod',\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Default Environment (no config provided)', () => {\r\n    let template: Template;\r\n\r\n    beforeAll(() => {\r\n      const app = new cdk.App();\r\n      const stack = new TdnetDataCollectorStack(app, 'TestStack-default', {\r\n        env: { account: testAccount, region: testRegion },\r\n        // environmentConfig not provided - should default to 'dev'\r\n      });\r\n      template = Template.fromStack(stack);\r\n    });\r\n\r\n    it('should default to dev environment', () => {\r\n      template.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures_dev',\r\n      });\r\n\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-collector-dev',\r\n      });\r\n\r\n      template.hasResourceProperties('AWS::ApiGateway::RestApi', {\r\n        Name: 'tdnet-data-collector-api-dev',\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Resource Isolation', () => {\r\n    it('should create different resource names for dev and prod', () => {\r\n      const app = new cdk.App();\r\n      \r\n      const devStack = new TdnetDataCollectorStack(app, 'DevStack', {\r\n        env: { account: testAccount, region: testRegion },\r\n        environmentConfig: { environment: 'dev' },\r\n      });\r\n      \r\n      const prodStack = new TdnetDataCollectorStack(app, 'ProdStack', {\r\n        env: { account: testAccount, region: testRegion },\r\n        environmentConfig: { environment: 'prod' },\r\n      });\r\n\r\n      const devTemplate = Template.fromStack(devStack);\r\n      const prodTemplate = Template.fromStack(prodStack);\r\n\r\n      // Verify dev resources\r\n      devTemplate.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures_dev',\r\n      });\r\n\r\n      // Verify prod resources\r\n      prodTemplate.hasResourceProperties('AWS::DynamoDB::Table', {\r\n        TableName: 'tdnet_disclosures_prod',\r\n      });\r\n\r\n      // Ensure they are different\r\n      expect(devStack.disclosuresTable.tableName).not.toBe(\r\n        prodStack.disclosuresTable.tableName\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Environment Variable Propagation', () => {\r\n    let template: Template;\r\n\r\n    beforeAll(() => {\r\n      const app = new cdk.App();\r\n      const stack = new TdnetDataCollectorStack(app, 'TestStack-env-vars', {\r\n        env: { account: testAccount, region: testRegion },\r\n        environmentConfig: { environment: 'dev' },\r\n      });\r\n      template = Template.fromStack(stack);\r\n    });\r\n\r\n    it('should pass environment-specific table names to Lambda functions', () => {\r\n      // Collector function should have dev table names\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-collector-dev',\r\n        Environment: {\r\n          Variables: {\r\n            DYNAMODB_TABLE: 'tdnet_disclosures_dev',\r\n            DYNAMODB_EXECUTIONS_TABLE: 'tdnet_executions_dev',\r\n          },\r\n        },\r\n      });\r\n\r\n      // Query function should have dev table name\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-query-dev',\r\n        Environment: {\r\n          Variables: {\r\n            DYNAMODB_TABLE_NAME: 'tdnet_disclosures_dev',\r\n          },\r\n        },\r\n      });\r\n\r\n      // Export function should have dev table names\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-export-dev',\r\n        Environment: {\r\n          Variables: {\r\n            DYNAMODB_TABLE_NAME: 'tdnet_disclosures_dev',\r\n            EXPORT_STATUS_TABLE_NAME: 'tdnet_export_status_dev',\r\n          },\r\n        },\r\n      });\r\n    });\r\n\r\n    it('should pass environment-specific bucket names to Lambda functions', () => {\r\n      // Collector function should have dev bucket name\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-collector-dev',\r\n        Environment: {\r\n          Variables: {\r\n            S3_BUCKET: `tdnet-data-collector-pdfs-dev-${testAccount}`,\r\n          },\r\n        },\r\n      });\r\n\r\n      // Query function should have dev bucket name\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-query-dev',\r\n        Environment: {\r\n          Variables: {\r\n            S3_BUCKET_NAME: `tdnet-data-collector-pdfs-dev-${testAccount}`,\r\n          },\r\n        },\r\n      });\r\n\r\n      // Export function should have dev bucket name\r\n      template.hasResourceProperties('AWS::Lambda::Function', {\r\n        FunctionName: 'tdnet-export-dev',\r\n        Environment: {\r\n          Variables: {\r\n            EXPORT_BUCKET_NAME: `tdnet-data-collector-exports-dev-${testAccount}`,\r\n          },\r\n        },\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"version":3}