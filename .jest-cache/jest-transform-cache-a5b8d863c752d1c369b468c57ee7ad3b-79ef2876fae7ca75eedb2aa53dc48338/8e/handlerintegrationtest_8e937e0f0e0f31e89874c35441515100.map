{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\__tests__\\handler.integration.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collector\\__tests__\\handler.integration.test.ts"],"sourcesContent":["/**\r\n * Lambda Collector統合テスト\r\n * Property 1: 日付範囲収集の完全性\r\n * Property 2: メタデータとPDFの同時取得\r\n * Requirements: 要件1.1, 1.2, 1.3, 1.4\r\n */\r\n\r\nimport { Context } from 'aws-lambda';\r\nimport { handler, CollectorEvent } from '../handler';\r\nimport { scrapeTdnetList } from '../scrape-tdnet-list';\r\nimport { downloadPdf } from '../download-pdf';\r\nimport { saveMetadata } from '../save-metadata';\r\nimport { updateExecutionStatus } from '../update-execution-status';\r\n\r\njest.mock('../scrape-tdnet-list');\r\njest.mock('../download-pdf');\r\njest.mock('../save-metadata');\r\njest.mock('../update-execution-status');\r\n\r\nconst mockScrapeTdnetList = scrapeTdnetList as jest.MockedFunction<typeof scrapeTdnetList>;\r\nconst mockDownloadPdf = downloadPdf as jest.MockedFunction<typeof downloadPdf>;\r\nconst mockSaveMetadata = saveMetadata as jest.MockedFunction<typeof saveMetadata>;\r\nconst mockUpdateExecutionStatus = updateExecutionStatus as jest.MockedFunction<typeof updateExecutionStatus>;\r\n\r\ndescribe('Lambda Collector Integration Tests', () => {\r\n  let mockContext: Context;\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    mockContext = {\r\n      awsRequestId: 'test-request-id',\r\n      functionName: 'test-function',\r\n      functionVersion: '1',\r\n      invokedFunctionArn: 'arn:aws:lambda:us-east-1:123456789012:function:test',\r\n      memoryLimitInMB: '512',\r\n      logGroupName: '/aws/lambda/test',\r\n      logStreamName: '2024/01/15/test',\r\n      getRemainingTimeInMillis: () => 30000,\r\n      done: jest.fn(),\r\n      fail: jest.fn(),\r\n      succeed: jest.fn(),\r\n      callbackWaitsForEmptyEventLoop: true,\r\n    };\r\n\r\n    mockUpdateExecutionStatus.mockResolvedValue({\r\n      execution_id: 'test-exec',\r\n      status: 'running',\r\n      progress: 0,\r\n      collected_count: 0,\r\n      failed_count: 0,\r\n      started_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n    });\r\n    mockDownloadPdf.mockResolvedValue('s3://bucket/test.pdf');\r\n    mockSaveMetadata.mockResolvedValue(undefined);\r\n  });\r\n\r\n  describe('Property 1: 日付範囲収集の完全性', () => {\r\n    it('指定期間内のすべての日付をスクレイピングする（1週間）', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-01',\r\n        end_date: '2024-01-07',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1001',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-01T10:00:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledTimes(7);\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-01');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-02');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-03');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-04');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-05');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-06');\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-07');\r\n      expect(response.status).toBe('success');\r\n      expect(response.collected_count).toBe(7);\r\n    });\r\n\r\n    it('日付の抜けがないことを検証する', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-20',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:00:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledTimes(6);\r\n      const calledDates = mockScrapeTdnetList.mock.calls.map((call) => call[0]);\r\n      expect(calledDates).toEqual([\r\n        '2024-01-15', '2024-01-16', '2024-01-17',\r\n        '2024-01-18', '2024-01-19', '2024-01-20',\r\n      ]);\r\n      expect(response.status).toBe('success');\r\n    });\r\n\r\n    it('1日だけの範囲でも正しく処理される', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:00:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledTimes(1);\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledWith('2024-01-15');\r\n      expect(response.status).toBe('success');\r\n      expect(response.collected_count).toBe(1);\r\n    });\r\n\r\n    it('開示情報が0件の日があっても処理を継続する', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-01',\r\n        end_date: '2024-01-03',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockImplementation(async (date: string) => {\r\n        if (date === '2024-01-01') return [{\r\n          company_code: '1001',\r\n          company_name: 'Test Company',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test',\r\n          disclosed_at: '2024-01-01T10:00:00Z',\r\n          pdf_url: 'https://example.com/test.pdf',\r\n        }];\r\n        if (date === '2024-01-02') return [];\r\n        if (date === '2024-01-03') return [{\r\n          company_code: '1003',\r\n          company_name: 'Test Company',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test',\r\n          disclosed_at: '2024-01-03T10:00:00Z',\r\n          pdf_url: 'https://example.com/test.pdf',\r\n        }];\r\n        return [];\r\n      });\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockScrapeTdnetList).toHaveBeenCalledTimes(3);\r\n      expect(response.status).toBe('success');\r\n      expect(response.collected_count).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('Property 2: メタデータとPDFの同時取得', () => {\r\n    it('メタデータとPDFの両方が永続化される', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:30:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      mockDownloadPdf.mockResolvedValue('2024/01/15/TD20240115001.pdf');\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockDownloadPdf).toHaveBeenCalledTimes(1);\r\n      expect(mockSaveMetadata).toHaveBeenCalledTimes(1);\r\n      expect(response.status).toBe('success');\r\n      expect(response.collected_count).toBe(1);\r\n    });\r\n\r\n    it('disclosure_idでメタデータとPDFが紐付けられる', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:30:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      let capturedDisclosureId: string | undefined;\r\n\r\n      mockDownloadPdf.mockImplementation(async (disclosure_id) => {\r\n        capturedDisclosureId = disclosure_id;\r\n        return `2024/01/15/${disclosure_id}.pdf`;\r\n      });\r\n\r\n      mockSaveMetadata.mockImplementation(async (disclosure, s3_key) => {\r\n        expect(disclosure.disclosure_id).toBe(capturedDisclosureId);\r\n        expect(s3_key).toContain(capturedDisclosureId!);\r\n      });\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(response.status).toBe('success');\r\n      expect(capturedDisclosureId).toBeDefined();\r\n    });\r\n\r\n    it('PDFダウンロード失敗時はメタデータも保存されない', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:30:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      mockDownloadPdf.mockRejectedValue(new Error('PDF download failed'));\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockDownloadPdf).toHaveBeenCalledTimes(1);\r\n      expect(mockSaveMetadata).not.toHaveBeenCalled();\r\n      expect(response.status).toBe('failed');\r\n      expect(response.collected_count).toBe(0);\r\n      expect(response.failed_count).toBe(1);\r\n    });\r\n\r\n    it('メタデータ保存失敗時は失敗としてカウントされる', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([{\r\n        company_code: '1234',\r\n        company_name: 'Test Company',\r\n        disclosure_type: '決算短信',\r\n        title: 'Test',\r\n        disclosed_at: '2024-01-15T10:30:00Z',\r\n        pdf_url: 'https://example.com/test.pdf',\r\n      }]);\r\n\r\n      mockDownloadPdf.mockResolvedValue('2024/01/15/TD20240115001.pdf');\r\n      mockSaveMetadata.mockRejectedValue(new Error('DynamoDB error'));\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(mockDownloadPdf).toHaveBeenCalledTimes(1);\r\n      expect(mockSaveMetadata).toHaveBeenCalledTimes(1);\r\n      expect(response.status).toBe('failed');\r\n      expect(response.collected_count).toBe(0);\r\n      expect(response.failed_count).toBe(1);\r\n    });\r\n\r\n    it('一部成功・一部失敗でpartial_successになる', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([\r\n        {\r\n          company_code: '1001',\r\n          company_name: 'Test Company A',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test 1',\r\n          disclosed_at: '2024-01-15T10:00:00Z',\r\n          pdf_url: 'https://example.com/test1.pdf',\r\n        },\r\n        {\r\n          company_code: '1002',\r\n          company_name: 'Test Company B',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test 2',\r\n          disclosed_at: '2024-01-15T11:00:00Z',\r\n          pdf_url: 'https://example.com/test2.pdf',\r\n        },\r\n        {\r\n          company_code: '1003',\r\n          company_name: 'Test Company C',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test 3',\r\n          disclosed_at: '2024-01-15T12:00:00Z',\r\n          pdf_url: 'https://example.com/test3.pdf',\r\n        },\r\n      ]);\r\n\r\n      mockDownloadPdf.mockResolvedValueOnce('2024/01/15/TD20240115001.pdf');\r\n      mockSaveMetadata.mockResolvedValueOnce(undefined);\r\n\r\n      mockDownloadPdf.mockRejectedValueOnce(new Error('PDF download failed'));\r\n\r\n      mockDownloadPdf.mockResolvedValueOnce('2024/01/15/TD20240115003.pdf');\r\n      mockSaveMetadata.mockResolvedValueOnce(undefined);\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(response.status).toBe('partial_success');\r\n      expect(response.collected_count).toBe(2);\r\n      expect(response.failed_count).toBe(1);\r\n    });\r\n\r\n    it('両方成功時のみcollected_countがインクリメントされる', async () => {\r\n      const event: CollectorEvent = {\r\n        mode: 'on-demand',\r\n        start_date: '2024-01-15',\r\n        end_date: '2024-01-15',\r\n      };\r\n\r\n      mockScrapeTdnetList.mockResolvedValue([\r\n        {\r\n          company_code: '1001',\r\n          company_name: 'Test Company A',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test 1',\r\n          disclosed_at: '2024-01-15T10:00:00Z',\r\n          pdf_url: 'https://example.com/test1.pdf',\r\n        },\r\n        {\r\n          company_code: '1002',\r\n          company_name: 'Test Company B',\r\n          disclosure_type: '決算短信',\r\n          title: 'Test 2',\r\n          disclosed_at: '2024-01-15T11:00:00Z',\r\n          pdf_url: 'https://example.com/test2.pdf',\r\n        },\r\n      ]);\r\n\r\n      mockDownloadPdf.mockResolvedValueOnce('2024/01/15/TD20240115001.pdf');\r\n      mockSaveMetadata.mockResolvedValueOnce(undefined);\r\n\r\n      mockDownloadPdf.mockResolvedValueOnce('2024/01/15/TD20240115002.pdf');\r\n      mockSaveMetadata.mockRejectedValueOnce(new Error('DynamoDB error'));\r\n\r\n      const response = await handler(event, mockContext);\r\n\r\n      expect(response.status).toBe('partial_success');\r\n      expect(response.collected_count).toBe(1);\r\n      expect(response.failed_count).toBe(1);\r\n    });\r\n  });\r\n});\r\n"],"version":3}