{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\format-csv.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\query\\format-csv.ts"],"sourcesContent":["/**\r\n * Format as CSV\r\n *\r\n * 開示情報リストをCSV形式に変換します。\r\n *\r\n * Requirements: 要件5.2（CSV形式）\r\n */\r\n\r\nimport { Disclosure } from '../../types';\r\n\r\n/**\r\n * 開示情報リストをCSV形式に変換\r\n *\r\n * @param disclosures 開示情報リスト\r\n * @returns CSV文字列\r\n *\r\n * @example\r\n * ```typescript\r\n * const csv = formatAsCsv(disclosures);\r\n * // => \"disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,collected_at\\n...\"\r\n * ```\r\n */\r\nexport function formatAsCsv(disclosures: Disclosure[]): string {\r\n  // CSVヘッダー\r\n  const headers = [\r\n    'disclosure_id',\r\n    'company_code',\r\n    'company_name',\r\n    'disclosure_type',\r\n    'title',\r\n    'disclosed_at',\r\n    'pdf_url',\r\n    's3_key',\r\n    'collected_at',\r\n    'date_partition',\r\n  ];\r\n\r\n  // CSVヘッダー行\r\n  const headerRow = headers.join(',');\r\n\r\n  // CSVデータ行\r\n  const dataRows = disclosures.map((disclosure) => {\r\n    return [\r\n      escapeCsvField(disclosure.disclosure_id),\r\n      escapeCsvField(disclosure.company_code),\r\n      escapeCsvField(disclosure.company_name),\r\n      escapeCsvField(disclosure.disclosure_type),\r\n      escapeCsvField(disclosure.title),\r\n      escapeCsvField(disclosure.disclosed_at),\r\n      escapeCsvField(disclosure.pdf_url),\r\n      escapeCsvField(disclosure.s3_key),\r\n      escapeCsvField(disclosure.collected_at),\r\n      escapeCsvField(disclosure.date_partition),\r\n    ].join(',');\r\n  });\r\n\r\n  // ヘッダーとデータを結合\r\n  return [headerRow, ...dataRows].join('\\n');\r\n}\r\n\r\n/**\r\n * CSVフィールドをエスケープ\r\n *\r\n * カンマ、改行、ダブルクォートを含むフィールドをダブルクォートで囲みます。\r\n * ダブルクォート自体は2つ連続させてエスケープします。\r\n *\r\n * @param field フィールド値\r\n * @returns エスケープ済みフィールド値\r\n *\r\n * @example\r\n * ```typescript\r\n * escapeCsvField('Hello, World'); // => '\"Hello, World\"'\r\n * escapeCsvField('Say \"Hello\"');  // => '\"Say \"\"Hello\"\"\"'\r\n * escapeCsvField('Line1\\nLine2'); // => '\"Line1\\nLine2\"'\r\n * ```\r\n */\r\nfunction escapeCsvField(field: string): string {\r\n  // null/undefinedの場合は空文字列\r\n  if (field === null || field === undefined) {\r\n    return '';\r\n  }\r\n\r\n  // 文字列に変換\r\n  const str = String(field);\r\n\r\n  // カンマ、改行、ダブルクォートを含む場合はエスケープが必要\r\n  if (str.includes(',') || str.includes('\\n') || str.includes('\"')) {\r\n    // ダブルクォートを2つ連続させてエスケープ\r\n    const escaped = str.replace(/\"/g, '\"\"');\r\n    // ダブルクォートで囲む\r\n    return `\"${escaped}\"`;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\n/**\r\n * CSV文字列をパース（テスト用）\r\n *\r\n * @param csv CSV文字列\r\n * @returns パース済みデータ\r\n */\r\nexport function parseCsv(csv: string): Array<Record<string, string>> {\r\n  const lines = csv.split('\\n').filter((line) => line.trim() !== '');\r\n  if (lines.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  // ヘッダー行\r\n  const headers = lines[0].split(',');\r\n\r\n  // データ行\r\n  const data: Array<Record<string, string>> = [];\r\n  for (let i = 1; i < lines.length; i++) {\r\n    const values = lines[i].split(',');\r\n    const row: Record<string, string> = {};\r\n    for (let j = 0; j < headers.length; j++) {\r\n      row[headers[j]] = values[j] || '';\r\n    }\r\n    data.push(row);\r\n  }\r\n\r\n  return data;\r\n}\r\n"],"version":3}