e5d4272a5fe74a2b4f837e1d261f0f1b
"use strict";
/**
 * PDFファイルバリデーションのユニットテスト
 *
 * Property 6: PDFファイルの整合性
 * - サイズ範囲内（10KB〜50MB）
 * - PDFヘッダー（%PDF-）で始まる
 *
 * Requirements: 要件2.3（整合性検証）
 */
Object.defineProperty(exports, "__esModule", { value: true });
const pdf_downloader_1 = require("../pdf-downloader");
const errors_1 = require("../../errors");
describe('PDF File Validation', () => {
    describe('Property 6: PDFファイルの整合性 - サイズ範囲', () => {
        it('should accept valid PDF files within size range (10KB)', () => {
            // 有効なPDFファイル（最小サイズ）
            const minValidPdf = Buffer.alloc(10 * 1024);
            minValidPdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(minValidPdf)).not.toThrow();
        });
        it('should accept valid PDF files within size range (50MB)', () => {
            // 有効なPDFファイル（最大サイズ）
            const maxValidPdf = Buffer.alloc(50 * 1024 * 1024);
            maxValidPdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(maxValidPdf)).not.toThrow();
        });
        it('should accept valid PDF files within size range (1MB)', () => {
            // 有効なPDFファイル（中間サイズ）
            const validPdf = Buffer.alloc(1 * 1024 * 1024);
            validPdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(validPdf)).not.toThrow();
        });
        it('should reject PDF files smaller than 10KB', () => {
            const tooSmallPdf = Buffer.alloc(5 * 1024);
            tooSmallPdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(tooSmallPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(tooSmallPdf)).toThrow(/too small/);
        });
        it('should reject PDF files larger than 50MB', () => {
            const tooLargePdf = Buffer.alloc(51 * 1024 * 1024);
            tooLargePdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(tooLargePdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(tooLargePdf)).toThrow(/too large/);
        });
    });
    describe('Property 6: PDFヘッダー検証', () => {
        it('should accept PDF files with valid header (%PDF-1.4)', () => {
            const validPdf = Buffer.alloc(10 * 1024);
            validPdf.write('%PDF-1.4');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(validPdf)).not.toThrow();
        });
        it('should accept PDF files with valid header (%PDF-1.5)', () => {
            const validPdf = Buffer.alloc(10 * 1024);
            validPdf.write('%PDF-1.5');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(validPdf)).not.toThrow();
        });
        it('should accept PDF files with valid header (%PDF-1.7)', () => {
            const validPdf = Buffer.alloc(10 * 1024);
            validPdf.write('%PDF-1.7');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(validPdf)).not.toThrow();
        });
        it('should reject files with invalid header', () => {
            const invalidPdf = Buffer.alloc(10 * 1024);
            invalidPdf.write('INVALID');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(invalidPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(invalidPdf)).toThrow(/Invalid PDF header/);
        });
        it('should reject files with empty header', () => {
            const emptyPdf = Buffer.alloc(10 * 1024);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(emptyPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(emptyPdf)).toThrow(/Invalid PDF header/);
        });
        it('should reject files with partial PDF header', () => {
            const partialPdf = Buffer.alloc(10 * 1024);
            partialPdf.write('%PDF');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(partialPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(partialPdf)).toThrow(/Invalid PDF header/);
        });
    });
    describe('Edge Cases', () => {
        it('should reject files at exactly 10KB boundary without valid header', () => {
            const boundaryPdf = Buffer.alloc(10 * 1024);
            boundaryPdf.write('NOTPDF');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(boundaryPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(boundaryPdf)).toThrow(/Invalid PDF header/);
        });
        it('should reject files at exactly 50MB boundary without valid header', () => {
            const boundaryPdf = Buffer.alloc(50 * 1024 * 1024);
            boundaryPdf.write('NOTPDF');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(boundaryPdf)).toThrow(errors_1.ValidationError);
            expect(() => (0, pdf_downloader_1.validatePdfFile)(boundaryPdf)).toThrow(/Invalid PDF header/);
        });
        it('should handle files with exactly 5 bytes (minimum for header check)', () => {
            const minHeaderPdf = Buffer.alloc(10 * 1024);
            minHeaderPdf.write('%PDF-');
            expect(() => (0, pdf_downloader_1.validatePdfFile)(minHeaderPdf)).not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxzY3JhcGVyXFxfX3Rlc3RzX19cXHBkZi12YWxpZGF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7O0dBUUc7O0FBRUgsc0RBQW9EO0FBQ3BELHlDQUErQztBQUUvQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEdBQUcsRUFBRTtZQUNoRSxvQkFBb0I7WUFDcEIsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDNUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBQSxnQ0FBZSxFQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEdBQUcsRUFBRTtZQUNoRSxvQkFBb0I7WUFDcEIsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ25ELFdBQVcsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUEsZ0NBQWUsRUFBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7WUFDL0Qsb0JBQW9CO1lBQ3BCLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJ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QVksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUEsZ0NBQWUsRUFBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM1RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxzY3JhcGVyXFxfX3Rlc3RzX19cXHBkZi12YWxpZGF0b3IudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogUERG44OV44Kh44Kk44Or44OQ44Oq44OH44O844K344On44Oz44Gu44Om44OL44OD44OI44OG44K544OIXHJcbiAqXHJcbiAqIFByb3BlcnR5IDY6IFBERuODleOCoeOCpOODq+OBruaVtOWQiOaAp1xyXG4gKiAtIOOCteOCpOOCuuevhOWbsuWGhe+8iDEwS0LjgJw1ME1C77yJXHJcbiAqIC0gUERG44OY44OD44OA44O877yIJVBERi3vvInjgaflp4vjgb7jgotcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7YyLjPvvIjmlbTlkIjmgKfmpJzoqLzvvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyB2YWxpZGF0ZVBkZkZpbGUgfSBmcm9tICcuLi9wZGYtZG93bmxvYWRlcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4uLy4uL2Vycm9ycyc7XHJcblxyXG5kZXNjcmliZSgnUERGIEZpbGUgVmFsaWRhdGlvbicsICgpID0+IHtcclxuICBkZXNjcmliZSgnUHJvcGVydHkgNjogUERG44OV44Kh44Kk44Or44Gu5pW05ZCI5oCnIC0g44K144Kk44K656+E5ZuyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgUERGIGZpbGVzIHdpdGhpbiBzaXplIHJhbmdlICgxMEtCKScsICgpID0+IHtcclxuICAgICAgLy8g5pyJ5Yq544GqUERG44OV44Kh44Kk44Or77yI5pyA5bCP44K144Kk44K677yJXHJcbiAgICAgIGNvbnN0IG1pblZhbGlkUGRmID0gQnVmZmVyLmFsbG9jKDEwICogMTAyNCk7XHJcbiAgICAgIG1pblZhbGlkUGRmLndyaXRlKCclUERGLTEuNCcpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKG1pblZhbGlkUGRmKSkubm90LnRvVGhyb3coKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYWNjZXB0IHZhbGlkIFBERiBmaWxlcyB3aXRoaW4gc2l6ZSByYW5nZSAoNTBNQiknLCAoKSA9PiB7XHJcbiAgICAgIC8vIOacieWKueOBqlBERuODleOCoeOCpOODq++8iOacgOWkp+OCteOCpOOCuu+8iVxyXG4gICAgICBjb25zdCBtYXhWYWxpZFBkZiA9IEJ1ZmZlci5hbGxvYyg1MCAqIDEwMjQgKiAxMDI0KTtcclxuICAgICAgbWF4VmFsaWRQZGYud3JpdGUoJyVQREYtMS40Jyk7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUobWF4VmFsaWRQZGYpKS5ub3QudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgUERGIGZpbGVzIHdpdGhpbiBzaXplIHJhbmdlICgxTUIpJywgKCkgPT4ge1xyXG4gICAgICAvLyDmnInlirnjgapQREbjg5XjgqHjgqTjg6vvvIjkuK3plpPjgrXjgqTjgrrvvIlcclxuICAgICAgY29uc3QgdmFsaWRQZGYgPSBCdWZmZXIuYWxsb2MoMSAqIDEwMjQgKiAxMDI0KTtcclxuICAgICAgdmFsaWRQZGYud3JpdGUoJyVQREYtMS40Jyk7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUodmFsaWRQZGYpKS5ub3QudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgUERGIGZpbGVzIHNtYWxsZXIgdGhhbiAxMEtCJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0b29TbWFsbFBkZiA9IEJ1ZmZlci5hbGxvYyg1ICogMTAyNCk7XHJcbiAgICAgIHRvb1NtYWxsUGRmLndyaXRlKCclUERGLTEuNCcpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHRvb1NtYWxsUGRmKSkudG9UaHJvdyhWYWxpZGF0aW9uRXJyb3IpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHRvb1NtYWxsUGRmKSkudG9UaHJvdygvdG9vIHNtYWxsLyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBQREYgZmlsZXMgbGFyZ2VyIHRoYW4gNTBNQicsICgpID0+IHtcclxuICAgICAgY29uc3QgdG9vTGFyZ2VQZGYgPSBCdWZmZXIuYWxsb2MoNTEgKiAxMDI0ICogMTAyNCk7XHJcbiAgICAgIHRvb0xhcmdlUGRmLndyaXRlKCclUERGLTEuNCcpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHRvb0xhcmdlUGRmKSkudG9UaHJvdyhWYWxpZGF0aW9uRXJyb3IpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHRvb0xhcmdlUGRmKSkudG9UaHJvdygvdG9vIGxhcmdlLyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1Byb3BlcnR5IDY6IFBERuODmOODg+ODgOODvOaknOiovCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYWNjZXB0IFBERiBmaWxlcyB3aXRoIHZhbGlkIGhlYWRlciAoJVBERi0xLjQpJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB2YWxpZFBkZiA9IEJ1ZmZlci5hbGxvYygxMCAqIDEwMjQpO1xyXG4gICAgICB2YWxpZFBkZi53cml0ZSgnJVBERi0xLjQnKTtcclxuICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlUGRmRmlsZSh2YWxpZFBkZikpLm5vdC50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBQREYgZmlsZXMgd2l0aCB2YWxpZCBoZWFkZXIgKCVQREYtMS41KScsICgpID0+IHtcclxuICAgICAgY29uc3QgdmFsaWRQZGYgPSBCdWZmZXIuYWxsb2MoMTAgKiAxMDI0KTtcclxuICAgICAgdmFsaWRQZGYud3JpdGUoJyVQREYtMS41Jyk7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUodmFsaWRQZGYpKS5ub3QudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgUERGIGZpbGVzIHdpdGggdmFsaWQgaGVhZGVyICglUERGLTEuNyknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbGlkUGRmID0gQnVmZmVyLmFsbG9jKDEwICogMTAyNCk7XHJcbiAgICAgIHZhbGlkUGRmLndyaXRlKCclUERGLTEuNycpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHZhbGlkUGRmKSkubm90LnRvVGhyb3coKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIHdpdGggaW52YWxpZCBoZWFkZXInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWRQZGYgPSBCdWZmZXIuYWxsb2MoMTAgKiAxMDI0KTtcclxuICAgICAgaW52YWxpZFBkZi53cml0ZSgnSU5WQUxJRCcpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKGludmFsaWRQZGYpKS50b1Rocm93KFZhbGlkYXRpb25FcnJvcik7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUoaW52YWxpZFBkZikpLnRvVGhyb3coL0ludmFsaWQgUERGIGhlYWRlci8pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZmlsZXMgd2l0aCBlbXB0eSBoZWFkZXInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVtcHR5UGRmID0gQnVmZmVyLmFsbG9jKDEwICogMTAyNCk7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUoZW1wdHlQZGYpKS50b1Rocm93KFZhbGlkYXRpb25FcnJvcik7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUoZW1wdHlQZGYpKS50b1Rocm93KC9JbnZhbGlkIFBERiBoZWFkZXIvKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIHdpdGggcGFydGlhbCBQREYgaGVhZGVyJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXJ0aWFsUGRmID0gQnVmZmVyLmFsbG9jKDEwICogMTAyNCk7XHJcbiAgICAgIHBhcnRpYWxQZGYud3JpdGUoJyVQREYnKTtcclxuICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlUGRmRmlsZShwYXJ0aWFsUGRmKSkudG9UaHJvdyhWYWxpZGF0aW9uRXJyb3IpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKHBhcnRpYWxQZGYpKS50b1Rocm93KC9JbnZhbGlkIFBERiBoZWFkZXIvKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRWRnZSBDYXNlcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIGF0IGV4YWN0bHkgMTBLQiBib3VuZGFyeSB3aXRob3V0IHZhbGlkIGhlYWRlcicsICgpID0+IHtcclxuICAgICAgY29uc3QgYm91bmRhcnlQZGYgPSBCdWZmZXIuYWxsb2MoMTAgKiAxMDI0KTtcclxuICAgICAgYm91bmRhcnlQZGYud3JpdGUoJ05PVFBERicpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKGJvdW5kYXJ5UGRmKSkudG9UaHJvdyhWYWxpZGF0aW9uRXJyb3IpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKGJvdW5kYXJ5UGRmKSkudG9UaHJvdygvSW52YWxpZCBQREYgaGVhZGVyLyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBmaWxlcyBhdCBleGFjdGx5IDUwTUIgYm91bmRhcnkgd2l0aG91dCB2YWxpZCBoZWFkZXInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGJvdW5kYXJ5UGRmID0gQnVmZmVyLmFsbG9jKDUwICogMTAyNCAqIDEwMjQpO1xyXG4gICAgICBib3VuZGFyeVBkZi53cml0ZSgnTk9UUERGJyk7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUoYm91bmRhcnlQZGYpKS50b1Rocm93KFZhbGlkYXRpb25FcnJvcik7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVBkZkZpbGUoYm91bmRhcnlQZGYpKS50b1Rocm93KC9JbnZhbGlkIFBERiBoZWFkZXIvKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGZpbGVzIHdpdGggZXhhY3RseSA1IGJ5dGVzIChtaW5pbXVtIGZvciBoZWFkZXIgY2hlY2spJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtaW5IZWFkZXJQZGYgPSBCdWZmZXIuYWxsb2MoMTAgKiAxMDI0KTtcclxuICAgICAgbWluSGVhZGVyUGRmLndyaXRlKCclUERGLScpO1xyXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQZGZGaWxlKG1pbkhlYWRlclBkZikpLm5vdC50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==