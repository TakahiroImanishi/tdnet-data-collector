b7381622e3cebf50c3c9cd09636b229e
"use strict";
/**
 * 開示ID生成ユーティリティ
 *
 * 開示情報の一意なIDを生成します。
 * フォーマット: 日付_企業コード_連番（例: "20240115_1234_001"）
 *
 * Requirements: 要件2.3（開示ID生成）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateDisclosureId = generateDisclosureId;
const errors_1 = require("../errors");
/**
 * 開示IDを生成（日付_企業コード_連番形式）
 *
 * TDnetは日本の開示情報サービスであり、開示日時はJST（日本標準時）基準で管理されます。
 * UTC時刻をそのまま使用すると、月またぎのエッジケースで誤った日付になる可能性があります。
 *
 * 例: UTC 2024-01-31T15:30:00Z → JST 2024-02-01T00:30:00+09:00
 *     UTCのまま使用すると "20240131" になるが、正しくは "20240201" であるべき
 *
 * @param disclosedAt ISO 8601形式の日時文字列（UTC推奨）
 * @param companyCode 企業コード（4桁）
 * @param sequence 連番（同一日・同一企業の複数開示を区別）
 * @returns 開示ID（例: "20240115_1234_001"）
 * @throws ValidationError 不正な入力の場合
 */
function generateDisclosureId(disclosedAt, companyCode, sequence) {
    // バリデーション
    if (!disclosedAt || !/^\d{4}-\d{2}-\d{2}T/.test(disclosedAt)) {
        throw new errors_1.ValidationError(`Invalid disclosedAt format: ${disclosedAt}`);
    }
    if (!companyCode || !/^\d{4}$/.test(companyCode)) {
        throw new errors_1.ValidationError(`Invalid companyCode: ${companyCode}`);
    }
    if (!Number.isInteger(sequence) || sequence < 0 || sequence > 999) {
        throw new errors_1.ValidationError(`Invalid sequence: ${sequence} (must be an integer between 0-999)`);
    }
    // UTCからJSTに変換（UTC+9時間）してから日付を抽出
    // これにより、月またぎのエッジケースを正しく処理できる
    const utcDate = new Date(disclosedAt);
    const jstDate = new Date(utcDate.getTime() + 9 * 60 * 60 * 1000);
    // YYYYMMDD形式で日付を抽出
    const year = jstDate.getUTCFullYear();
    const month = String(jstDate.getUTCMonth() + 1).padStart(2, '0');
    const day = String(jstDate.getUTCDate()).padStart(2, '0');
    const date = `${year}${month}${day}`;
    // 連番を3桁にゼロパディング
    const seq = String(sequence).padStart(3, '0');
    return `${date}_${companyCode}_${seq}`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFx1dGlsc1xcZGlzY2xvc3VyZS1pZC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUFtQkgsb0RBaUNDO0FBbERELHNDQUE0QztBQUU1Qzs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQUNILFNBQWdCLG9CQUFvQixDQUNsQyxXQUFtQixFQUNuQixXQUFtQixFQUNuQixRQUFnQjtJQUVoQixVQUFVO0lBQ1YsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1FBQzdELE1BQU0sSUFBSSx3QkFBZSxDQUFDLCtCQUErQixXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFRCxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1FBQ2pELE1BQU0sSUFBSSx3QkFBZSxDQUFDLHdCQUF3QixXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxJQUFJLFFBQVEsR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNsRSxNQUFNLElBQUksd0JBQWUsQ0FBQyxxQkFBcUIsUUFBUSxxQ0FBcUMsQ0FBQyxDQUFDO0lBQ2hHLENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsNkJBQTZCO0lBQzdCLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUVqRSxtQkFBbUI7SUFDbkIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3RDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNqRSxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUMxRCxNQUFNLElBQUksR0FBRyxHQUFHLElBQUksR0FBRyxLQUFLLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFFckMsZ0JBQWdCO0lBQ2hCLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRTlDLE9BQU8sR0FBRyxJQUFJLElBQUksV0FBVyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ3pDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFx1dGlsc1xcZGlzY2xvc3VyZS1pZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog6ZaL56S6SUTnlJ/miJDjg6bjg7zjg4bjgqPjg6rjg4bjgqNcclxuICpcclxuICog6ZaL56S65oOF5aCx44Gu5LiA5oSP44GqSUTjgpLnlJ/miJDjgZfjgb7jgZnjgIJcclxuICog44OV44Kp44O844Oe44OD44OIOiDml6Xku5hf5LyB5qWt44Kz44O844OJX+mAo+eVqu+8iOS+izogXCIyMDI0MDExNV8xMjM0XzAwMVwi77yJXHJcbiAqXHJcbiAqIFJlcXVpcmVtZW50czog6KaB5Lu2Mi4z77yI6ZaL56S6SUTnlJ/miJDvvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICcuLi9lcnJvcnMnO1xyXG5cclxuLyoqXHJcbiAqIOmWi+ekuklE44KS55Sf5oiQ77yI5pel5LuYX+S8gealreOCs+ODvOODiV/pgKPnlarlvaLlvI/vvIlcclxuICpcclxuICogVERuZXTjga/ml6XmnKzjga7plovnpLrmg4XloLHjgrXjg7zjg5PjgrnjgafjgYLjgorjgIHplovnpLrml6XmmYLjga9KU1TvvIjml6XmnKzmqJnmupbmmYLvvInln7rmupbjgafnrqHnkIbjgZXjgozjgb7jgZnjgIJcclxuICogVVRD5pmC5Yi744KS44Gd44Gu44G+44G+5L2/55So44GZ44KL44Go44CB5pyI44G+44Gf44GO44Gu44Ko44OD44K444Kx44O844K544Gn6Kqk44Gj44Gf5pel5LuY44Gr44Gq44KL5Y+v6IO95oCn44GM44GC44KK44G+44GZ44CCXHJcbiAqIFxyXG4gKiDkvos6IFVUQyAyMDI0LTAxLTMxVDE1OjMwOjAwWiDihpIgSlNUIDIwMjQtMDItMDFUMDA6MzA6MDArMDk6MDBcclxuICogICAgIFVUQ+OBruOBvuOBvuS9v+eUqOOBmeOCi+OBqCBcIjIwMjQwMTMxXCIg44Gr44Gq44KL44GM44CB5q2j44GX44GP44GvIFwiMjAyNDAyMDFcIiDjgafjgYLjgovjgbnjgY1cclxuICpcclxuICogQHBhcmFtIGRpc2Nsb3NlZEF0IElTTyA4NjAx5b2i5byP44Gu5pel5pmC5paH5a2X5YiX77yIVVRD5o6o5aWo77yJXHJcbiAqIEBwYXJhbSBjb21wYW55Q29kZSDkvIHmpa3jgrPjg7zjg4nvvIg05qGB77yJXHJcbiAqIEBwYXJhbSBzZXF1ZW5jZSDpgKPnlarvvIjlkIzkuIDml6Xjg7vlkIzkuIDkvIHmpa3jga7opIfmlbDplovnpLrjgpLljLrliKXvvIlcclxuICogQHJldHVybnMg6ZaL56S6SUTvvIjkvos6IFwiMjAyNDAxMTVfMTIzNF8wMDFcIu+8iVxyXG4gKiBAdGhyb3dzIFZhbGlkYXRpb25FcnJvciDkuI3mraPjgarlhaXlipvjga7loLTlkIhcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZURpc2Nsb3N1cmVJZChcclxuICBkaXNjbG9zZWRBdDogc3RyaW5nLFxyXG4gIGNvbXBhbnlDb2RlOiBzdHJpbmcsXHJcbiAgc2VxdWVuY2U6IG51bWJlclxyXG4pOiBzdHJpbmcge1xyXG4gIC8vIOODkOODquODh+ODvOOCt+ODp+ODs1xyXG4gIGlmICghZGlzY2xvc2VkQXQgfHwgIS9eXFxkezR9LVxcZHsyfS1cXGR7Mn1ULy50ZXN0KGRpc2Nsb3NlZEF0KSkge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgSW52YWxpZCBkaXNjbG9zZWRBdCBmb3JtYXQ6ICR7ZGlzY2xvc2VkQXR9YCk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWNvbXBhbnlDb2RlIHx8ICEvXlxcZHs0fSQvLnRlc3QoY29tcGFueUNvZGUpKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBJbnZhbGlkIGNvbXBhbnlDb2RlOiAke2NvbXBhbnlDb2RlfWApO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHNlcXVlbmNlKSB8fCBzZXF1ZW5jZSA8IDAgfHwgc2VxdWVuY2UgPiA5OTkpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYEludmFsaWQgc2VxdWVuY2U6ICR7c2VxdWVuY2V9IChtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbiAwLTk5OSlgKTtcclxuICB9XHJcblxyXG4gIC8vIFVUQ+OBi+OCiUpTVOOBq+WkieaPm++8iFVUQys55pmC6ZaT77yJ44GX44Gm44GL44KJ5pel5LuY44KS5oq95Ye6XHJcbiAgLy8g44GT44KM44Gr44KI44KK44CB5pyI44G+44Gf44GO44Gu44Ko44OD44K444Kx44O844K544KS5q2j44GX44GP5Yem55CG44Gn44GN44KLXHJcbiAgY29uc3QgdXRjRGF0ZSA9IG5ldyBEYXRlKGRpc2Nsb3NlZEF0KTtcclxuICBjb25zdCBqc3REYXRlID0gbmV3IERhdGUodXRjRGF0ZS5nZXRUaW1lKCkgKyA5ICogNjAgKiA2MCAqIDEwMDApO1xyXG4gIFxyXG4gIC8vIFlZWVlNTURE5b2i5byP44Gn5pel5LuY44KS5oq95Ye6XHJcbiAgY29uc3QgeWVhciA9IGpzdERhdGUuZ2V0VVRDRnVsbFllYXIoKTtcclxuICBjb25zdCBtb250aCA9IFN0cmluZyhqc3REYXRlLmdldFVUQ01vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xyXG4gIGNvbnN0IGRheSA9IFN0cmluZyhqc3REYXRlLmdldFVUQ0RhdGUoKSkucGFkU3RhcnQoMiwgJzAnKTtcclxuICBjb25zdCBkYXRlID0gYCR7eWVhcn0ke21vbnRofSR7ZGF5fWA7XHJcblxyXG4gIC8vIOmAo+eVquOCkjPmoYHjgavjgrzjg63jg5Hjg4fjgqPjg7PjgrBcclxuICBjb25zdCBzZXEgPSBTdHJpbmcoc2VxdWVuY2UpLnBhZFN0YXJ0KDMsICcwJyk7XHJcblxyXG4gIHJldHVybiBgJHtkYXRlfV8ke2NvbXBhbnlDb2RlfV8ke3NlcX1gO1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==