{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collect\\__tests__\\handler.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\collect\\__tests__\\handler.test.ts"],"sourcesContent":["﻿/**\r\n * Lambda Collect Handler Tests\r\n *\r\n * POST /collect エンド�Eイント�EユニットテスチE\r\n */\r\n\r\nimport { APIGatewayProxyEvent, Context } from 'aws-lambda';\r\nimport { handler } from '../handler';\r\nimport { LambdaClient, InvokeCommand } from '@aws-sdk/client-lambda';\r\nimport { SecretsManagerClient, GetSecretValueCommand } from '@aws-sdk/client-secrets-manager';\r\nimport { mockClient } from 'aws-sdk-client-mock';\r\n\r\n// AWS SDK Mocks\r\nconst lambdaMock = mockClient(LambdaClient);\r\nconst secretsMock = mockClient(SecretsManagerClient);\r\n\r\n// Mock Context\r\nconst mockContext: Context = {\r\n  callbackWaitsForEmptyEventLoop: false,\r\n  functionName: 'tdnet-collect',\r\n  functionVersion: '1',\r\n  invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:tdnet-collect',\r\n  memoryLimitInMB: '256',\r\n  awsRequestId: 'test-request-id-12345',\r\n  logGroupName: '/aws/lambda/tdnet-collect',\r\n  logStreamName: '2024/01/15/[$LATEST]abcdef',\r\n  getRemainingTimeInMillis: () => 30000,\r\n  done: () => {},\r\n  fail: () => {},\r\n  succeed: () => {},\r\n};\r\n\r\n/**\r\n * チE��ト用の日付を動的に生�E\r\n * 現在日から相対皁E��日付を返すことで、テストが常に有効な日付篁E��を使用できるようにする\r\n */\r\nconst getTestDates = () => {\r\n  const today = new Date();\r\n  const startDate = new Date(today);\r\n  startDate.setDate(startDate.getDate() - 7); // 7日剁E\r\n  const endDate = new Date(today);\r\n  endDate.setDate(endDate.getDate() - 2); // 2日剁E\r\n  \r\n  return {\r\n    start_date: startDate.toISOString().split('T')[0],\r\n    end_date: endDate.toISOString().split('T')[0],\r\n  };\r\n};\r\n\r\n/**\r\n * 持E��日数前�E日付を取征E\r\n */\r\nconst getDaysAgo = (days: number): string => {\r\n  const date = new Date();\r\n  date.setDate(date.getDate() - days);\r\n  return date.toISOString().split('T')[0];\r\n};\r\n\r\n/**\r\n * 持E��日数後�E日付を取征E\r\n */\r\nconst getDaysLater = (days: number): string => {\r\n  const date = new Date();\r\n  date.setDate(date.getDate() + days);\r\n  return date.toISOString().split('T')[0];\r\n};\r\n\r\n/**\r\n * テスト用のAPIGatewayProxyEventを作成\r\n */\r\nconst createTestEvent = (body: any, apiKey: string = 'test-api-key-12345'): APIGatewayProxyEvent => {\r\n  return {\r\n    body: body === null ? null : JSON.stringify(body),\r\n    headers: {\r\n      'x-api-key': apiKey,\r\n    },\r\n    multiValueHeaders: {},\r\n    httpMethod: 'POST',\r\n    isBase64Encoded: false,\r\n    path: '/collect',\r\n    pathParameters: null,\r\n    queryStringParameters: null,\r\n    multiValueQueryStringParameters: null,\r\n    stageVariables: null,\r\n    requestContext: {} as any,\r\n    resource: '',\r\n  };\r\n};\r\n\r\ndescribe('POST /collect Handler', () => {\r\n  beforeEach(() => {\r\n    lambdaMock.reset();\r\n    secretsMock.reset();\r\n    \r\n    // Secrets Managerのモック設定（APIキーを返す）\r\n    secretsMock.on(GetSecretValueCommand).resolves({\r\n      SecretString: 'test-api-key-12345',\r\n    });\r\n    \r\n    process.env.COLLECTOR_FUNCTION_NAME = 'tdnet-collector';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n    process.env.API_KEY_SECRET_ARN = 'arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:tdnet-api-key';\r\n    \r\n    // APIキーキャッシュをクリア（テスト間の影響を防ぐ）\r\n    // Note: キャッシュはモジュールスコープにあるため、直接アクセスできない\r\n    // 代わりに、各テストで新しいAPIキーを使用するか、TEST_ENVを設定する\r\n    delete process.env.TEST_ENV;\r\n    delete process.env.API_KEY;\r\n  });\r\n\r\n  afterEach(() => {\r\n    delete process.env.COLLECTOR_FUNCTION_NAME;\r\n    delete process.env.AWS_REGION;\r\n    delete process.env.API_KEY_SECRET_ARN;\r\n    delete process.env.TEST_ENV;\r\n    delete process.env.API_KEY;\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('有効なリクエストで200を返す', async () => {\r\n      // Lambda Collectorの呼び出しをモチE���E�同期呼び出し！E\r\n      const mockCollectorResponse = {\r\n        execution_id: 'exec_1234567890_abc123_test1234',\r\n        status: 'success',\r\n        message: 'Collection started',\r\n        collected_count: 0,\r\n        failed_count: 0,\r\n      };\r\n\r\n      lambdaMock.on(InvokeCommand).resolves({\r\n        StatusCode: 200,\r\n        Payload: Buffer.from(JSON.stringify(mockCollectorResponse)),\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(200);\r\n      expect(result.headers?.['Content-Type']).toBe('application/json');\r\n      expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');\r\n\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('success');\r\n      expect(body.data).toHaveProperty('execution_id');\r\n      expect(body.data).toHaveProperty('status', 'pending');\r\n      expect(body.data).toHaveProperty('message');\r\n      expect(body.data).toHaveProperty('started_at');\r\n    });\r\n\r\n    it('Lambda Collectorから返されたexecution_idを使用する', async () => {\r\n      const mockCollectorResponse = {\r\n        execution_id: 'exec_1234567890_abc123_test1234',\r\n        status: 'success',\r\n        message: 'Collection started',\r\n        collected_count: 0,\r\n        failed_count: 0,\r\n      };\r\n\r\n      lambdaMock.on(InvokeCommand).resolves({\r\n        StatusCode: 200,\r\n        Payload: Buffer.from(JSON.stringify(mockCollectorResponse)),\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n      const body = JSON.parse(result.body);\r\n\r\n      // Lambda Collectorから返されたexecution_idが使用されてぁE��ことを確誁E\r\n      expect(body.data.execution_id).toBe('exec_1234567890_abc123_test1234');\r\n    });\r\n\r\n    it('Lambda呼び出しがRequestResponseモードで実行される', async () => {\r\n      const mockCollectorResponse = {\r\n        execution_id: 'exec_1234567890_abc123_test1234',\r\n        status: 'success',\r\n        message: 'Collection started',\r\n        collected_count: 0,\r\n        failed_count: 0,\r\n      };\r\n\r\n      lambdaMock.on(InvokeCommand).resolves({\r\n        StatusCode: 200,\r\n        Payload: Buffer.from(JSON.stringify(mockCollectorResponse)),\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      await handler(event, mockContext);\r\n\r\n      // InvokeCommandが正しいパラメータで呼ばれたことを確認\r\n      const calls = lambdaMock.commandCalls(InvokeCommand);\r\n      expect(calls.length).toBe(1);\r\n      expect(calls[0].args[0].input.InvocationType).toBe('RequestResponse');\r\n      expect(calls[0].args[0].input.FunctionName).toBe('test-collector-function');\r\n    });\r\n  });\r\n\r\n  describe('バリチE�Eションエラー', () => {\r\n    it('リクエスト�EチE��がなぁE��合�E400を返す', async () => {\r\n      const event = createTestEvent(null);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Request body is required');\r\n    });\r\n\r\n    it('start_dateがなぁE��合�E400を返す', async () => {\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          end_date: getDaysAgo(2),\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('start_date is required');\r\n    });\r\n\r\n    it('end_dateがなぁE��合�E400を返す', async () => {\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: getDaysAgo(7),\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('end_date is required');\r\n    });\r\n\r\n    it('start_dateのフォーマットが不正な場合�E400を返す', async () => {\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: '2024/01/15', // 不正なフォーマッチE\r\n          end_date: getDaysAgo(2),\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid start_date format');\r\n    });\r\n\r\n    it('start_dateが存在しなぁE��付�E場合�E400を返す', async () => {\r\n      // 存在しなぁE��付を使用�E�E朁E0日は存在しなぁE��E\r\n      // ただし、E年以冁E�E日付を使用する忁E��がある\r\n      const today = new Date();\r\n      const year = today.getFullYear();\r\n      const month = today.getMonth() + 1; // 現在の朁E\r\n      \r\n      const event = createTestEvent({\r\n          start_date: `${year}-02-30`, // 2朁E0日は存在しなぁE\r\n          end_date: `${year}-03-01`,\r\n        });\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      // 日付�E整合性チェチE��で無効な日付を検�E\r\n      expect(body.error.message).toContain('Invalid start_date');\r\n    });\r\n\r\n    it('start_dateがend_dateより後�E場合�E400を返す', async () => {\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: getDaysAgo(2),\r\n          end_date: getDaysAgo(7),\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('must be before or equal to');\r\n    });\r\n\r\n    it('start_dateぁE年以上前の場合�E400を返す', async () => {\r\n      const twoYearsAgo = getDaysAgo(730); // 2年剁E\r\n\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: twoYearsAgo,\r\n          end_date: getDaysAgo(2),\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('too old');\r\n    });\r\n\r\n    it('end_dateが未来日の場合�E400を返す', async () => {\r\n      const twoDaysLater = getDaysLater(2); // 2日征E\r\n\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: getDaysAgo(7),\r\n          end_date: twoDaysLater,\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('cannot be in the future');\r\n    });\r\n  });\r\n\r\n  describe('Lambda呼び出しエラー', () => {\r\n    it('Lambda Collectorの呼び出しに失敗した場合�E500を返す', async () => {\r\n      lambdaMock.on(InvokeCommand).rejects(new Error('Lambda invocation failed'));\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n      expect(body.error.message).toContain('Failed to start data collection');\r\n    });\r\n\r\n    it('Lambda Collectorが空のPayloadを返した場合�E500を返す', async () => {\r\n      lambdaMock.on(InvokeCommand).resolves({\r\n        StatusCode: 200,\r\n        Payload: undefined,\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n    });\r\n\r\n    it('Lambda Collectorがexecution_idを返さなぁE��合�E500を返す', async () => {\r\n      const mockCollectorResponse = {\r\n        status: 'success',\r\n        message: 'Collection started',\r\n        collected_count: 0,\r\n        failed_count: 0,\r\n        // execution_idがなぁE\r\n      };\r\n\r\n      lambdaMock.on(InvokeCommand).resolves({\r\n        StatusCode: 200,\r\n        Payload: Buffer.from(JSON.stringify(mockCollectorResponse)),\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n    });\r\n  });\r\n\r\n  describe('APIキー認証エラー', () => {\r\n    it('APIキーヘッダーがない場合は401を返す', async () => {\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates, '');\r\n      delete event.headers['x-api-key'];\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('API key is required');\r\n    });\r\n\r\n    it('無効なAPIキーの場合は401を返す', async () => {\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates, 'invalid-api-key');\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n    });\r\n\r\n    it('Secrets Manager取得エラーの場合は500を返す', async () => {\r\n      secretsMock.reset();\r\n      secretsMock.on(GetSecretValueCommand).rejects(new Error('Secrets Manager error'));\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n      // getApiKey()で発生したエラーは、validateApiKey()でキャッチされ、\r\n      // 最終的にhandler()のcatchブロックで\"Failed to retrieve API key\"として処理される\r\n      expect(body.error.message).toContain('Failed to retrieve API key');\r\n    });\r\n\r\n    it('Secrets ManagerがSecretStringを返さない場合は500を返す', async () => {\r\n      secretsMock.reset();\r\n      secretsMock.on(GetSecretValueCommand).resolves({\r\n        SecretString: undefined,\r\n      });\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n      expect(body.error.message).toContain('Failed to retrieve API key');\r\n    });\r\n\r\n    it('API_KEY_SECRET_ARN環境変数が設定されていない場合は500を返す', async () => {\r\n      delete process.env.API_KEY_SECRET_ARN;\r\n\r\n      const testDates = getTestDates();\r\n      const event = createTestEvent(testDates);\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('error');\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n      expect(body.error.message).toContain('Failed to retrieve API key');\r\n\r\n      // 環境変数を復元\r\n      process.env.API_KEY_SECRET_ARN = 'arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:tdnet-api-key';\r\n    });\r\n  });\r\n\r\n  describe('バリデーションエラー（追加）', () => {\r\n    it('end_dateのフォーマットが不正な場合は400を返す', async () => {\r\n      const event: APIGatewayProxyEvent = {\r\n        body: JSON.stringify({\r\n          start_date: getDaysAgo(7),\r\n          end_date: '2024/01/15', // 不正なフォーマット\r\n        }),\r\n        headers: {\r\n          'x-api-key': 'test-api-key-12345',\r\n        },\r\n        multiValueHeaders: {},\r\n        httpMethod: 'POST',\r\n        isBase64Encoded: false,\r\n        path: '/collect',\r\n        pathParameters: null,\r\n        queryStringParameters: null,\r\n        multiValueQueryStringParameters: null,\r\n        stageVariables: null,\r\n        requestContext: {} as any,\r\n        resource: '',\r\n      };\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid end_date format');\r\n    });\r\n\r\n    it('end_dateが存在しない日付の場合は400を返す', async () => {\r\n      const today = new Date();\r\n      const year = today.getFullYear();\r\n      \r\n      const event = createTestEvent({\r\n        start_date: `${year}-02-01`,\r\n        end_date: `${year}-02-30`, // 2月30日は存在しない\r\n      });\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid end_date');\r\n    });\r\n\r\n    it('end_dateが無効な日付（NaN）の場合は400を返す', async () => {\r\n      const event = createTestEvent({\r\n        start_date: getDaysAgo(7),\r\n        end_date: '2024-13-01', // 13月は存在しない\r\n      });\r\n\r\n      const result = await handler(event, mockContext);\r\n\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid end_date');\r\n    });\r\n  });\r\n});\r\n"],"version":3}