2fae365d36378d7b00ddfb751f304b94
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.SecretsManagerConstruct = void 0;
const secretsmanager = __importStar(require("aws-cdk-lib/aws-secretsmanager"));
const cdk = __importStar(require("aws-cdk-lib"));
const constructs_1 = require("constructs");
/**
 * Secrets Manager Construct
 *
 * TDnet Data CollectorプロジェクトのAPIキーを安全に管理するための
 * AWS Secrets Managerリソースを定義します。
 *
 * 機能:
 * - /tdnet/api-key シークレットの作成
 * - Lambda関数へのシークレット読み取り権限付与
 * - 自動ローテーション設定（Phase 4で実装予定）
 */
class SecretsManagerConstruct extends constructs_1.Construct {
    /**
     * APIキーシークレット
     *
     * シークレット名: /tdnet/api-key
     * フォーマット: { "apiKey": "your-api-key-here" }
     */
    apiKeySecret;
    constructor(scope, id) {
        super(scope, id);
        // APIキーシークレット作成
        this.apiKeySecret = new secretsmanager.Secret(this, 'ApiKeySecret', {
            secretName: '/tdnet/api-key',
            description: 'TDnet API Key for authentication',
            // シークレット値の初期生成設定
            generateSecretString: {
                secretStringTemplate: JSON.stringify({ apiKey: '' }),
                generateStringKey: 'apiKey',
                excludePunctuation: true,
                passwordLength: 32,
            },
            // 暗号化設定（AWS管理キーを使用）
            encryptionKey: undefined, // デフォルトのAWS管理キーを使用
            // 削除保護設定
            removalPolicy: cdk.RemovalPolicy.RETAIN, // 本番環境では削除保護
        });
        // TODO: Phase 4で自動ローテーション設定を実装
        // 自動ローテーションにはローテーション用Lambda関数が必要
        // 
        // 実装例:
        // this.apiKeySecret.addRotationSchedule('RotationSchedule', {
        //   rotationLambda: rotationFunction,
        //   automaticallyAfter: cdk.Duration.days(90), // 90日ごとにローテーション
        // });
    }
    /**
     * Lambda関数にシークレット読み取り権限を付与
     *
     * @param lambdaFunction - シークレットにアクセスするLambda関数
     *
     * 使用例:
     * ```typescript
     * const secretsManager = new SecretsManagerConstruct(this, 'SecretsManager');
     * secretsManager.grantRead(queryLambda);
     * secretsManager.grantRead(exportLambda);
     * ```
     */
    grantRead(lambdaFunction) {
        this.apiKeySecret.grantRead(lambdaFunction);
    }
    /**
     * シークレットARNを取得
     *
     * Lambda関数の環境変数に設定する際に使用します。
     *
     * @returns シークレットARN
     */
    getSecretArn() {
        return this.apiKeySecret.secretArn;
    }
    /**
     * シークレット値を取得（CDK内部でのみ使用）
     *
     * 注意: この値は環境変数に直接設定しないでください。
     * Lambda関数内でAWS SDKを使用してシークレット値を取得してください。
     *
     * @returns シークレット値（SecretValue型）
     */
    getSecretValue() {
        return this.apiKeySecret.secretValue;
    }
}
exports.SecretsManagerConstruct = SecretsManagerConstruct;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcY2RrXFxsaWJcXGNvbnN0cnVjdHNcXHNlY3JldHMtbWFuYWdlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrRUFBaUU7QUFFakUsaURBQW1DO0FBQ25DLDJDQUF1QztBQUV2Qzs7Ozs7Ozs7OztHQVVHO0FBQ0gsTUFBYSx1QkFBd0IsU0FBUSxzQkFBUztJQUNwRDs7Ozs7T0FLRztJQUNhLFlBQVksQ0FBd0I7SUFFcEQsWUFBWSxLQUFnQixFQUFFLEVBQVU7UUFDdEMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLGNBQWMsRUFBRTtZQUNsRSxVQUFVLEVBQUUsZ0JBQWdCO1lBQzVCLFdBQVcsRUFBRSxrQ0FBa0M7WUFDL0MsaUJBQWlCO1lBQ2pCLG9CQUFvQixFQUFFO2dCQUNwQixvQkFBb0IsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDO2dCQUNwRCxpQkFBaUIsRUFBRSxRQUFRO2dCQUMzQixrQkFBa0IsRUFBRSxJQUFJO2dCQUN4QixjQUFjLEVBQUUsRUFBRTthQUNuQjtZQUNELG9CQUFvQjtZQUNwQixhQUFhLEVBQUUsU0FBUyxFQUFFLG1CQUFtQjtZQUM3QyxTQUFTO1lBQ1QsYUFBYSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLGFBQWE7U0FDdkQsQ0FBQyxDQUFDO1FBRUgsK0JBQStCO1FBQy9CLGlDQUFpQztRQUNqQyxHQUFHO1FBQ0gsT0FBTztRQUNQLDhEQUE4RDtRQUM5RCxzQ0FBc0M7UUFDdEMsZ0VBQWdFO1FBQ2hFLE1BQU07SUFDUixDQUFDO0lBRUQ7Ozs7Ozs7Ozs7O09BV0c7SUFDSSxTQUFTLENBQUMsY0FBK0I7UUFDOUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNJLFlBQVk7UUFDakIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQztJQUNyQyxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLGNBQWM7UUFDbkIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxDQUFDO0NBQ0Y7QUE3RUQsMERBNkVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXGNka1xcbGliXFxjb25zdHJ1Y3RzXFxzZWNyZXRzLW1hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc2VjcmV0c21hbmFnZXIgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNlY3JldHNtYW5hZ2VyJztcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcclxuXHJcbi8qKlxyXG4gKiBTZWNyZXRzIE1hbmFnZXIgQ29uc3RydWN0XHJcbiAqIFxyXG4gKiBURG5ldCBEYXRhIENvbGxlY3RvcuODl+ODreOCuOOCp+OCr+ODiOOBrkFQSeOCreODvOOCkuWuieWFqOOBq+euoeeQhuOBmeOCi+OBn+OCgeOBrlxyXG4gKiBBV1MgU2VjcmV0cyBNYW5hZ2Vy44Oq44K944O844K544KS5a6a576p44GX44G+44GZ44CCXHJcbiAqIFxyXG4gKiDmqZ/og706XHJcbiAqIC0gL3RkbmV0L2FwaS1rZXkg44K344O844Kv44Os44OD44OI44Gu5L2c5oiQXHJcbiAqIC0gTGFtYmRh6Zai5pWw44G444Gu44K344O844Kv44Os44OD44OI6Kqt44G/5Y+W44KK5qip6ZmQ5LuY5LiOXHJcbiAqIC0g6Ieq5YuV44Ot44O844OG44O844K344On44Oz6Kit5a6a77yIUGhhc2UgNOOBp+Wun+ijheS6iOWumu+8iVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0IGV4dGVuZHMgQ29uc3RydWN0IHtcclxuICAvKipcclxuICAgKiBBUEnjgq3jg7zjgrfjg7zjgq/jg6zjg4Pjg4hcclxuICAgKiBcclxuICAgKiDjgrfjg7zjgq/jg6zjg4Pjg4jlkI06IC90ZG5ldC9hcGkta2V5XHJcbiAgICog44OV44Kp44O844Oe44OD44OIOiB7IFwiYXBpS2V5XCI6IFwieW91ci1hcGkta2V5LWhlcmVcIiB9XHJcbiAgICovXHJcbiAgcHVibGljIHJlYWRvbmx5IGFwaUtleVNlY3JldDogc2VjcmV0c21hbmFnZXIuU2VjcmV0O1xyXG5cclxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XHJcbiAgICBzdXBlcihzY29wZSwgaWQpO1xyXG5cclxuICAgIC8vIEFQSeOCreODvOOCt+ODvOOCr+ODrOODg+ODiOS9nOaIkFxyXG4gICAgdGhpcy5hcGlLZXlTZWNyZXQgPSBuZXcgc2VjcmV0c21hbmFnZXIuU2VjcmV0KHRoaXMsICdBcGlLZXlTZWNyZXQnLCB7XHJcbiAgICAgIHNlY3JldE5hbWU6ICcvdGRuZXQvYXBpLWtleScsXHJcbiAgICAgIGRlc2NyaXB0aW9uOiAnVERuZXQgQVBJIEtleSBmb3IgYXV0aGVudGljYXRpb24nLFxyXG4gICAgICAvLyDjgrfjg7zjgq/jg6zjg4Pjg4jlgKTjga7liJ3mnJ/nlJ/miJDoqK3lrppcclxuICAgICAgZ2VuZXJhdGVTZWNyZXRTdHJpbmc6IHtcclxuICAgICAgICBzZWNyZXRTdHJpbmdUZW1wbGF0ZTogSlNPTi5zdHJpbmdpZnkoeyBhcGlLZXk6ICcnIH0pLFxyXG4gICAgICAgIGdlbmVyYXRlU3RyaW5nS2V5OiAnYXBpS2V5JyxcclxuICAgICAgICBleGNsdWRlUHVuY3R1YXRpb246IHRydWUsXHJcbiAgICAgICAgcGFzc3dvcmRMZW5ndGg6IDMyLFxyXG4gICAgICB9LFxyXG4gICAgICAvLyDmmpflj7fljJboqK3lrprvvIhBV1PnrqHnkIbjgq3jg7zjgpLkvb/nlKjvvIlcclxuICAgICAgZW5jcnlwdGlvbktleTogdW5kZWZpbmVkLCAvLyDjg4fjg5Xjgqnjg6vjg4jjga5BV1PnrqHnkIbjgq3jg7zjgpLkvb/nlKhcclxuICAgICAgLy8g5YmK6Zmk5L+d6K236Kit5a6aXHJcbiAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LlJFVEFJTiwgLy8g5pys55Wq55Kw5aKD44Gn44Gv5YmK6Zmk5L+d6K23XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBUT0RPOiBQaGFzZSA044Gn6Ieq5YuV44Ot44O844OG44O844K344On44Oz6Kit5a6a44KS5a6f6KOFXHJcbiAgICAvLyDoh6rli5Xjg63jg7zjg4bjg7zjgrfjg6fjg7Pjgavjga/jg63jg7zjg4bjg7zjgrfjg6fjg7PnlKhMYW1iZGHplqLmlbDjgYzlv4XopoFcclxuICAgIC8vIFxyXG4gICAgLy8g5a6f6KOF5L6LOlxyXG4gICAgLy8gdGhpcy5hcGlLZXlTZWNyZXQuYWRkUm90YXRpb25TY2hlZHVsZSgnUm90YXRpb25TY2hlZHVsZScsIHtcclxuICAgIC8vICAgcm90YXRpb25MYW1iZGE6IHJvdGF0aW9uRnVuY3Rpb24sXHJcbiAgICAvLyAgIGF1dG9tYXRpY2FsbHlBZnRlcjogY2RrLkR1cmF0aW9uLmRheXMoOTApLCAvLyA5MOaXpeOBlOOBqOOBq+ODreODvOODhuODvOOCt+ODp+ODs1xyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMYW1iZGHplqLmlbDjgavjgrfjg7zjgq/jg6zjg4Pjg4joqq3jgb/lj5bjgormqKnpmZDjgpLku5jkuI5cclxuICAgKiBcclxuICAgKiBAcGFyYW0gbGFtYmRhRnVuY3Rpb24gLSDjgrfjg7zjgq/jg6zjg4Pjg4jjgavjgqLjgq/jgrvjgrnjgZnjgotMYW1iZGHplqLmlbBcclxuICAgKiBcclxuICAgKiDkvb/nlKjkvos6XHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHNlY3JldHNNYW5hZ2VyID0gbmV3IFNlY3JldHNNYW5hZ2VyQ29uc3RydWN0KHRoaXMsICdTZWNyZXRzTWFuYWdlcicpO1xyXG4gICAqIHNlY3JldHNNYW5hZ2VyLmdyYW50UmVhZChxdWVyeUxhbWJkYSk7XHJcbiAgICogc2VjcmV0c01hbmFnZXIuZ3JhbnRSZWFkKGV4cG9ydExhbWJkYSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcHVibGljIGdyYW50UmVhZChsYW1iZGFGdW5jdGlvbjogbGFtYmRhLkZ1bmN0aW9uKTogdm9pZCB7XHJcbiAgICB0aGlzLmFwaUtleVNlY3JldC5ncmFudFJlYWQobGFtYmRhRnVuY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog44K344O844Kv44Os44OD44OIQVJO44KS5Y+W5b6XXHJcbiAgICogXHJcbiAgICogTGFtYmRh6Zai5pWw44Gu55Kw5aKD5aSJ5pWw44Gr6Kit5a6a44GZ44KL6Zqb44Gr5L2/55So44GX44G+44GZ44CCXHJcbiAgICogXHJcbiAgICogQHJldHVybnMg44K344O844Kv44Os44OD44OIQVJOXHJcbiAgICovXHJcbiAgcHVibGljIGdldFNlY3JldEFybigpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuYXBpS2V5U2VjcmV0LnNlY3JldEFybjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOOCt+ODvOOCr+ODrOODg+ODiOWApOOCkuWPluW+l++8iENES+WGhemDqOOBp+OBruOBv+S9v+eUqO+8iVxyXG4gICAqIFxyXG4gICAqIOazqOaEjzog44GT44Gu5YCk44Gv55Kw5aKD5aSJ5pWw44Gr55u05o6l6Kit5a6a44GX44Gq44GE44Gn44GP44Gg44GV44GE44CCXHJcbiAgICogTGFtYmRh6Zai5pWw5YaF44GnQVdTIFNES+OCkuS9v+eUqOOBl+OBpuOCt+ODvOOCr+ODrOODg+ODiOWApOOCkuWPluW+l+OBl+OBpuOBj+OBoOOBleOBhOOAglxyXG4gICAqIFxyXG4gICAqIEByZXR1cm5zIOOCt+ODvOOCr+ODrOODg+ODiOWApO+8iFNlY3JldFZhbHVl5Z6L77yJXHJcbiAgICovXHJcbiAgcHVibGljIGdldFNlY3JldFZhbHVlKCk6IHNlY3JldHNtYW5hZ2VyLlNlY3JldFZhbHVlIHtcclxuICAgIHJldHVybiB0aGlzLmFwaUtleVNlY3JldC5zZWNyZXRWYWx1ZTtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9