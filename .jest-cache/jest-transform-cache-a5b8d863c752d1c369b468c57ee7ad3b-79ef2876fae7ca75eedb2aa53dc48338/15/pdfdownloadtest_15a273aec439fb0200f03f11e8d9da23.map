{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\api\\__tests__\\pdf-download.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\api\\__tests__\\pdf-download.test.ts"],"sourcesContent":["/**\r\n * PDF Download Lambda Function Tests\r\n *\r\n * GET /disclosures/{disclosure_id}/pdf エンドポイントのテスト\r\n */\r\n\r\nimport { APIGatewayProxyEvent, Context } from 'aws-lambda';\r\nimport { DynamoDBClient, GetItemCommand } from '@aws-sdk/client-dynamodb';\r\nimport { S3Client, HeadObjectCommand } from '@aws-sdk/client-s3';\r\nimport { SecretsManagerClient, GetSecretValueCommand } from '@aws-sdk/client-secrets-manager';\r\nimport { mockClient } from 'aws-sdk-client-mock';\r\nimport { handler } from '../pdf-download/handler';\r\n\r\n// モック\r\nconst dynamoMock = mockClient(DynamoDBClient);\r\nconst s3Mock = mockClient(S3Client);\r\nconst secretsManagerMock = mockClient(SecretsManagerClient);\r\n\r\n// getSignedUrlのモック\r\njest.mock('@aws-sdk/s3-request-presigner', () => ({\r\n  getSignedUrl: jest.fn().mockResolvedValue('https://s3.amazonaws.com/signed-url'),\r\n}));\r\n\r\n// テスト用のContext\r\nconst mockContext: Context = {\r\n  awsRequestId: 'test-request-id',\r\n  functionName: 'test-function',\r\n  functionVersion: '1',\r\n  invokedFunctionArn: 'arn:aws:lambda:ap-northeast-1:123456789012:function:test',\r\n  memoryLimitInMB: '256',\r\n  logGroupName: '/aws/lambda/test',\r\n  logStreamName: '2024/01/15/[$LATEST]test',\r\n  callbackWaitsForEmptyEventLoop: true,\r\n  getRemainingTimeInMillis: () => 30000,\r\n  done: () => {},\r\n  fail: () => {},\r\n  succeed: () => {},\r\n} as Context;\r\n\r\ndescribe('PDF Download Lambda Handler', () => {\r\n  beforeEach(() => {\r\n    dynamoMock.reset();\r\n    s3Mock.reset();\r\n    secretsManagerMock.reset();\r\n    secretsManagerMock.on(GetSecretValueCommand).resolves({\r\n      SecretString: 'test-api-key',\r\n    });\r\n    process.env.DYNAMODB_TABLE_NAME = 'tdnet_disclosures';\r\n    process.env.S3_BUCKET_NAME = 'tdnet-data-collector-pdfs';\r\n    process.env.API_KEY = 'test-api-key';\r\n    process.env.AWS_REGION = 'ap-northeast-1';\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('正常系', () => {\r\n    it('署名付きURLを正しく生成して返却する', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        queryStringParameters: {},\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: '2024/01/15/TD20240115001_7203.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.status).toBe('success');\r\n      expect(body.data).toHaveProperty('download_url');\r\n      expect(body.data).toHaveProperty('expires_at');\r\n      expect(body.data.download_url).toBe('https://s3.amazonaws.com/signed-url');\r\n    });\r\n\r\n    it('カスタムexpiration（7200秒）で署名付きURLを生成する', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        queryStringParameters: { expiration: '7200' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: '2024/01/15/TD20240115001_7203.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.data.download_url).toBe('https://s3.amazonaws.com/signed-url');\r\n    });\r\n  });\r\n\r\n  describe('異常系 - バリデーションエラー', () => {\r\n    it('disclosure_idが未指定の場合、400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: {},\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('disclosure_id is required');\r\n    });\r\n\r\n    it('disclosure_idのフォーマットが不正な場合、400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: 'invalid-format' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid disclosure_id format');\r\n    });\r\n\r\n    it('expirationが範囲外の場合、400エラーを返す（最小値未満）', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        queryStringParameters: { expiration: '30' }, // 60秒未満\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Expiration out of range');\r\n    });\r\n\r\n    it('expirationが範囲外の場合、400エラーを返す（最大値超過）', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        queryStringParameters: { expiration: '90000' }, // 86400秒超過\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Expiration out of range');\r\n    });\r\n\r\n    it('expirationが数値でない場合、400エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        queryStringParameters: { expiration: 'invalid' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(400);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('VALIDATION_ERROR');\r\n      expect(body.error.message).toContain('Invalid expiration format');\r\n    });\r\n  });\r\n\r\n  describe('異常系 - 認証エラー', () => {\r\n    it('APIキーが未指定の場合、401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: {},\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('API key is required');\r\n    });\r\n\r\n    it('APIキーが不正な場合、401エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'invalid-key' },\r\n      };\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(401);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('UNAUTHORIZED');\r\n      expect(body.error.message).toContain('Invalid API key');\r\n    });\r\n  });\r\n\r\n  describe('異常系 - リソース不存在', () => {\r\n    it('開示情報が存在しない場合、404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_9999_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: undefined,\r\n      });\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('Disclosure not found');\r\n    });\r\n\r\n    it('pdf_s3_keyが存在しない場合、404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          // pdf_s3_keyが存在しない\r\n        },\r\n      });\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('PDF file not found');\r\n    });\r\n\r\n    it('S3オブジェクトが存在しない場合、404エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: '2024/01/15/TD20240115001_7203.pdf' },\r\n        },\r\n      });\r\n\r\n      const notFoundError = new Error('NotFound');\r\n      notFoundError.name = 'NotFound';\r\n      (notFoundError as any).$metadata = { httpStatusCode: 404 };\r\n      s3Mock.on(HeadObjectCommand).rejects(notFoundError);\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(404);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('NOT_FOUND');\r\n      expect(body.error.message).toContain('PDF file not found in S3');\r\n    });\r\n  });\r\n\r\n  describe('異常系 - DynamoDBエラー', () => {\r\n    it('DynamoDBエラー時、再試行後に500エラーを返す', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).rejects(new Error('DynamoDB error'));\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(500);\r\n      const body = JSON.parse(result.body);\r\n      expect(body.error.code).toBe('INTERNAL_ERROR');\r\n    });\r\n\r\n    it('ProvisionedThroughputExceededException時、再試行する', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      const throttleError = new Error('ProvisionedThroughputExceededException');\r\n      throttleError.name = 'ProvisionedThroughputExceededException';\r\n\r\n      dynamoMock\r\n        .on(GetItemCommand)\r\n        .rejectsOnce(throttleError)\r\n        .resolves({\r\n          Item: {\r\n            disclosure_id: { S: '20240115_7203_001' },\r\n            company_code: { S: '7203' },\r\n            company_name: { S: 'トヨタ自動車株式会社' },\r\n            pdf_s3_key: { S: '2024/01/15/TD20240115001_7203.pdf' },\r\n          },\r\n        });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.statusCode).toBe(200);\r\n      expect(dynamoMock.calls()).toHaveLength(2); // 1回失敗、2回目成功\r\n    });\r\n  });\r\n\r\n  describe('CORS対応', () => {\r\n    it('レスポンスにCORSヘッダーが含まれる', async () => {\r\n      // Arrange\r\n      const event: Partial<APIGatewayProxyEvent> = {\r\n        pathParameters: { disclosure_id: '20240115_7203_001' },\r\n        headers: { 'x-api-key': 'test-api-key' },\r\n      };\r\n\r\n      dynamoMock.on(GetItemCommand).resolves({\r\n        Item: {\r\n          disclosure_id: { S: '20240115_7203_001' },\r\n          company_code: { S: '7203' },\r\n          company_name: { S: 'トヨタ自動車株式会社' },\r\n          pdf_s3_key: { S: '2024/01/15/TD20240115001_7203.pdf' },\r\n        },\r\n      });\r\n\r\n      s3Mock.on(HeadObjectCommand).resolves({});\r\n\r\n      // Act\r\n      const result = await handler(event as APIGatewayProxyEvent, mockContext);\r\n\r\n      // Assert\r\n      expect(result.headers).toHaveProperty('Access-Control-Allow-Origin', '*');\r\n      expect(result.headers).toHaveProperty('Access-Control-Allow-Headers');\r\n    });\r\n  });\r\n});\r\n"],"version":3}