7f52a44f14cf1a7d8dec2f07f7d18548
"use strict";
/**
 * Export to S3 Unit Tests
 *
 * Requirements: 要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック
jest.mock('../../../utils/logger');
jest.mock('../../../utils/retry', () => ({
    retryWithBackoff: jest.fn((fn) => fn()), // retryをバイパス
}));
jest.mock('@aws-sdk/client-s3', () => {
    const actualModule = jest.requireActual('@aws-sdk/client-s3');
    return {
        ...actualModule,
        S3Client: jest.fn().mockImplementation(() => ({
            send: mockSend,
        })),
    };
});
const export_to_s3_1 = require("../export-to-s3");
// S3Clientのモック
const mockSend = jest.fn();
describe('exportToS3', () => {
    const mockDisclosures = [
        {
            disclosure_id: '20240115_1234_001',
            company_code: '1234',
            company_name: 'テスト株式会社',
            disclosure_type: '決算短信',
            title: '2024年3月期 第3四半期決算短信',
            disclosed_at: '2024-01-15T10:30:00Z',
            pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
            collected_at: '2024-01-15T10:35:00Z',
            date_partition: '2024-01',
        },
        {
            disclosure_id: '20240115_5678_001',
            company_code: '5678',
            company_name: 'サンプル株式会社',
            disclosure_type: '有価証券報告書',
            title: '第50期有価証券報告書',
            disclosed_at: '2024-01-15T11:00:00Z',
            pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',
            collected_at: '2024-01-15T11:05:00Z',
            date_partition: '2024-01',
        },
    ];
    beforeEach(() => {
        jest.clearAllMocks();
        mockSend.mockClear();
        mockSend.mockResolvedValue({
            $metadata: { httpStatusCode: 200 },
            ETag: '"mock-etag"',
        });
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('JSON形式のエクスポート', () => {
        it('JSON形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
            expect(mockSend).toHaveBeenCalledTimes(1);
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('application/json');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('JSONに件数とデータが含まれる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const parsed = JSON.parse(body);
            expect(parsed).toHaveProperty('count', 2);
            expect(parsed).toHaveProperty('disclosures');
            expect(parsed.disclosures).toHaveLength(2);
            expect(parsed.disclosures[0]).toEqual(mockDisclosures[0]);
        });
    });
    describe('CSV形式のエクスポート', () => {
        it('CSV形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.csv$/);
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('text/csv');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('CSVヘッダーが正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[0]).toBe('disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,s3_key,collected_at,date_partition');
        });
        it('CSVデータ行が正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toBe('20240115_1234_001,1234,テスト株式会社,決算短信,2024年3月期 第3四半期決算短信,2024-01-15T10:30:00Z,https://example.com/pdf/20240115_1234_001.pdf,pdfs/2024/01/15/20240115_1234_001.pdf,2024-01-15T10:35:00Z,2024-01');
            expect(lines[2]).toBe('20240115_5678_001,5678,サンプル株式会社,有価証券報告書,第50期有価証券報告書,2024-01-15T11:00:00Z,https://example.com/pdf/20240115_5678_001.pdf,pdfs/2024/01/15/20240115_5678_001.pdf,2024-01-15T11:05:00Z,2024-01');
        });
        it('カンマを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithComma = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル, カンマ含む',
                },
            ];
            const export_id = 'export_1705305600000_ghi789_11111111';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithComma, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル, カンマ含む"');
        });
        it('ダブルクォートを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithQuote = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル"引用符"含む',
                },
            ];
            const export_id = 'export_1705305600000_jkl012_22222222';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithQuote, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル""引用符""含む"');
        });
        it('改行を含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithNewline = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル\n改行含む',
                },
            ];
            const export_id = 'export_1705305600000_mno345_33333333';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithNewline, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            // 改行を含む値はダブルクォートで囲まれる
            expect(lines[1]).toContain('"タイトル\n改行含む"');
        });
    });
    describe('S3キー生成', () => {
        it('S3キーが正しいフォーマットで生成される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            // フォーマット: exports/YYYY/MM/DD/export_id.format
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
        });
    });
    describe('ライフサイクルポリシー', () => {
        it('auto-deleteタグが設定される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const command = mockSend.mock.calls[0][0];
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFNSCxNQUFNO0FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ25DLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN2QyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLGFBQWE7Q0FDdkQsQ0FBQyxDQUFDLENBQUM7QUFJSixJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDOUQsT0FBTztRQUNMLEdBQUcsWUFBWTtRQUNmLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM1QyxJQUFJLEVBQUUsUUFBUTtTQUNmLENBQUMsQ0FBQztLQUNKLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQXBCSCxrREFBNkM7QUFVN0MsZUFBZTtBQUNmLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQVczQixRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixNQUFNLGVBQWUsR0FBaUI7UUFDcEM7WUFDRSxhQUFhLEVBQUUsbUJBQW1CO1lBQ2xDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLFlBQVksRUFBRSxTQUFTO1lBQ3ZCLGVBQWUsRUFBRSxNQUFNO1lBQ3ZCLEtBQUssRUFBRSxvQkFBb0I7WUFDM0IsWUFBWSxFQUFFLHNCQUFzQjtZQUNwQyxPQUFPLEVB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QUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFxQixDQUFDO1lBQzlELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcZXhwb3J0XFxfX3Rlc3RzX19cXGV4cG9ydC10by1zMy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBFeHBvcnQgdG8gUzMgVW5pdCBUZXN0c1xyXG4gKlxyXG4gKiBSZXF1aXJlbWVudHM6IOimgeS7tjE0LjHvvIjjg6bjg4vjg4Pjg4jjg4bjgrnjg4jvvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBleHBvcnRUb1MzIH0gZnJvbSAnLi4vZXhwb3J0LXRvLXMzJztcclxuaW1wb3J0IHsgRGlzY2xvc3VyZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJztcclxuaW1wb3J0IHsgUzNDbGllbnQsIFB1dE9iamVjdENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xyXG5cclxuLy8g44Oi44OD44KvXHJcbmplc3QubW9jaygnLi4vLi4vLi4vdXRpbHMvbG9nZ2VyJyk7XHJcbmplc3QubW9jaygnLi4vLi4vLi4vdXRpbHMvcmV0cnknLCAoKSA9PiAoe1xyXG4gIHJldHJ5V2l0aEJhY2tvZmY6IGplc3QuZm4oKGZuKSA9PiBmbigpKSwgLy8gcmV0cnnjgpLjg5DjgqTjg5HjgrlcclxufSkpO1xyXG5cclxuLy8gUzNDbGllbnTjga7jg6Ljg4Pjgq9cclxuY29uc3QgbW9ja1NlbmQgPSBqZXN0LmZuKCk7XHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LXMzJywgKCkgPT4ge1xyXG4gIGNvbnN0IGFjdHVhbE1vZHVsZSA9IGplc3QucmVxdWlyZUFjdHVhbCgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLmFjdHVhbE1vZHVsZSxcclxuICAgIFMzQ2xpZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgIHNlbmQ6IG1vY2tTZW5kLFxyXG4gICAgfSkpLFxyXG4gIH07XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ2V4cG9ydFRvUzMnLCAoKSA9PiB7XHJcbiAgY29uc3QgbW9ja0Rpc2Nsb3N1cmVzOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICB7XHJcbiAgICAgIGRpc2Nsb3N1cmVfaWQ6ICcyMDI0MDExNV8xMjM0XzAwMScsXHJcbiAgICAgIGNvbXBhbnlfY29kZTogJzEyMzQnLFxyXG4gICAgICBjb21wYW55X25hbWU6ICfjg4bjgrnjg4jmoKrlvI/kvJrnpL4nLFxyXG4gICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmsbrnrpfnn63kv6EnLFxyXG4gICAgICB0aXRsZTogJzIwMjTlubQz5pyI5pyfIOesrDPlm5vljYrmnJ/msbrnrpfnn63kv6EnLFxyXG4gICAgICBkaXNjbG9zZWRfYXQ6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsXHJcbiAgICAgIHBkZl91cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV8xMjM0XzAwMS5wZGYnLFxyXG4gICAgICBzM19rZXk6ICdwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfMTIzNF8wMDEucGRmJyxcclxuICAgICAgY29sbGVjdGVkX2F0OiAnMjAyNC0wMS0xNVQxMDozNTowMFonLFxyXG4gICAgICBkYXRlX3BhcnRpdGlvbjogJzIwMjQtMDEnLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgZGlzY2xvc3VyZV9pZDogJzIwMjQwMTE1XzU2NzhfMDAxJyxcclxuICAgICAgY29tcGFueV9jb2RlOiAnNTY3OCcsXHJcbiAgICAgIGNvbXBhbnlfbmFtZTogJ+OCteODs+ODl+ODq+agquW8j+S8muekvicsXHJcbiAgICAgIGRpc2Nsb3N1cmVfdHlwZTogJ+acieS+oeiovOWIuOWgseWRiuabuCcsXHJcbiAgICAgIHRpdGxlOiAn56ysNTDmnJ/mnInkvqHoqLzliLjloLHlkYrmm7gnLFxyXG4gICAgICBkaXNjbG9zZWRfYXQ6ICcyMDI0LTAxLTE1VDExOjAwOjAwWicsXHJcbiAgICAgIHBkZl91cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV81Njc4XzAwMS5wZGYnLFxyXG4gICAgICBzM19rZXk6ICdwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfNTY3OF8wMDEucGRmJyxcclxuICAgICAgY29sbGVjdGVkX2F0OiAnMjAyNC0wMS0xNVQxMTowNTowMFonLFxyXG4gICAgICBkYXRlX3BhcnRpdGlvbjogJzIwMjQtMDEnLFxyXG4gICAgfSxcclxuICBdO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgbW9ja1NlbmQubW9ja0NsZWFyKCk7XHJcbiAgICBtb2NrU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICRtZXRhZGF0YTogeyBodHRwU3RhdHVzQ29kZTogMjAwIH0sXHJcbiAgICAgIEVUYWc6ICdcIm1vY2stZXRhZ1wiJyxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBwcm9jZXNzLmVudi5FWFBPUlRfQlVDS0VUX05BTUUgPSAndGVzdC1leHBvcnRzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0pTT07lvaLlvI/jga7jgqjjgq/jgrnjg53jg7zjg4gnLCAoKSA9PiB7XHJcbiAgICBpdCgnSlNPTuW9ouW8j+OBp1Mz44Gr44Ko44Kv44K544Od44O844OI44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tTZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5CdWNrZXQpLnRvQmUoJ3Rlc3QtZXhwb3J0cy1idWNrZXQnKTtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuS2V5KS50b0JlKHMzX2tleSk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LkNvbnRlbnRUeXBlKS50b0JlKCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdKU09O44Gr5Lu25pWw44Go44OH44O844K/44GM5ZCr44G+44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShib2R5KTtcclxuXHJcbiAgICAgIGV4cGVjdChwYXJzZWQpLnRvSGF2ZVByb3BlcnR5KCdjb3VudCcsIDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkKS50b0hhdmVQcm9wZXJ0eSgnZGlzY2xvc3VyZXMnKTtcclxuICAgICAgZXhwZWN0KHBhcnNlZC5kaXNjbG9zdXJlcykudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkLmRpc2Nsb3N1cmVzWzBdKS50b0VxdWFsKG1vY2tEaXNjbG9zdXJlc1swXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NTVuW9ouW8j+OBruOCqOOCr+OCueODneODvOODiCcsICgpID0+IHtcclxuICAgIGl0KCdDU1blvaLlvI/jgadTM+OBq+OCqOOCr+OCueODneODvOODiOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5jc3YkLyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5CdWNrZXQpLnRvQmUoJ3Rlc3QtZXhwb3J0cy1idWNrZXQnKTtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuS2V5KS50b0JlKHMzX2tleSk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LkNvbnRlbnRUeXBlKS50b0JlKCd0ZXh0L2NzdicpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5UYWdnaW5nKS50b0JlKCdhdXRvLWRlbGV0ZT10cnVlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnQ1NW44OY44OD44OA44O844GM5q2j44GX44GP5Ye65Yqb44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9kZWY0NTZfODc2NTQzMjEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgZXhwZWN0KGxpbmVzWzBdKS50b0JlKFxyXG4gICAgICAgICdkaXNjbG9zdXJlX2lkLGNvbXBhbnlfY29kZSxjb21wYW55X25hbWUsZGlzY2xvc3VyZV90eXBlLHRpdGxlLGRpc2Nsb3NlZF9hdCxwZGZfdXJsLHMzX2tleSxjb2xsZWN0ZWRfYXQsZGF0ZV9wYXJ0aXRpb24nXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnQ1NW44OH44O844K/6KGM44GM5q2j44GX44GP5Ye65Yqb44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9kZWY0NTZfODc2NTQzMjEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgZXhwZWN0KGxpbmVzWzFdKS50b0JlKFxyXG4gICAgICAgICcyMDI0MDExNV8xMjM0XzAwMSwxMjM0LOODhuOCueODiOagquW8j+S8muekvizmsbrnrpfnn63kv6EsMjAyNOW5tDPmnIjmnJ8g56ysM+Wbm+WNiuacn+axuueul+efreS/oSwyMDI0LTAxLTE1VDEwOjMwOjAwWixodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV8xMjM0XzAwMS5wZGYscGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzEyMzRfMDAxLnBkZiwyMDI0LTAxLTE1VDEwOjM1OjAwWiwyMDI0LTAxJ1xyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobGluZXNbMl0pLnRvQmUoXHJcbiAgICAgICAgJzIwMjQwMTE1XzU2NzhfMDAxLDU2Nzgs44K144Oz44OX44Or5qCq5byP5Lya56S+LOacieS+oeiovOWIuOWgseWRiuabuCznrKw1MOacn+acieS+oeiovOWIuOWgseWRiuabuCwyMDI0LTAxLTE1VDExOjAwOjAwWixodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV81Njc4XzAwMS5wZGYscGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzU2NzhfMDAxLnBkZiwyMDI0LTAxLTE1VDExOjA1OjAwWiwyMDI0LTAxJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+OCq+ODs+ODnuOCkuWQq+OCgOWApOOBjOato+OBl+OBj+OCqOOCueOCseODvOODl+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlc1dpdGhDb21tYTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrLCDjgqvjg7Pjg57lkKvjgoAnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9naGk3ODlfMTExMTExMTEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgZGlzY2xvc3VyZXNXaXRoQ29tbWEsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tTZW5kLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgY29uc3QgYm9keSA9IGNvbW1hbmQuaW5wdXQuQm9keSBhcyBzdHJpbmc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6ssIOOCq+ODs+ODnuWQq+OCgFwiJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44OA44OW44Or44Kv44Kp44O844OI44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVzV2l0aFF1b3RlOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubW9ja0Rpc2Nsb3N1cmVzWzBdLFxyXG4gICAgICAgICAgdGl0bGU6ICfjgr/jgqTjg4jjg6tcIuW8leeUqOesplwi5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfamtsMDEyXzIyMjIyMjIyJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aFF1b3RlLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgZXhwZWN0KGxpbmVzWzFdKS50b0NvbnRhaW4oJ1wi44K/44Kk44OI44OrXCJcIuW8leeUqOesplwiXCLlkKvjgoBcIicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+aUueihjOOCkuWQq+OCgOWApOOBjOato+OBl+OBj+OCqOOCueOCseODvOODl+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlc1dpdGhOZXdsaW5lOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubW9ja0Rpc2Nsb3N1cmVzWzBdLFxyXG4gICAgICAgICAgdGl0bGU6ICfjgr/jgqTjg4jjg6tcXG7mlLnooYzlkKvjgoAnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9tbm8zNDVfMzMzMzMzMzMnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgZGlzY2xvc3VyZXNXaXRoTmV3bGluZSwgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja1NlbmQubW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIC8vIOaUueihjOOCkuWQq+OCgOWApOOBr+ODgOODluODq+OCr+OCqeODvOODiOOBp+WbsuOBvuOCjOOCi1xyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6tcXG7mlLnooYzlkKvjgoBcIicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTM+OCreODvOeUn+aIkCcsICgpID0+IHtcclxuICAgIGl0KCdTM+OCreODvOOBjOato+OBl+OBhOODleOCqeODvOODnuODg+ODiOOBp+eUn+aIkOOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgLy8g44OV44Kp44O844Oe44OD44OIOiBleHBvcnRzL1lZWVkvTU0vREQvZXhwb3J0X2lkLmZvcm1hdFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfjg6njgqTjg5XjgrXjgqTjgq/jg6vjg53jg6rjgrfjg7wnLCAoKSA9PiB7XHJcbiAgICBpdCgnYXV0by1kZWxldGXjgr/jgrDjgYzoqK3lrprjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2FiYzEyM18xMjM0NTY3OCc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdqc29uJztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrU2VuZC5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9