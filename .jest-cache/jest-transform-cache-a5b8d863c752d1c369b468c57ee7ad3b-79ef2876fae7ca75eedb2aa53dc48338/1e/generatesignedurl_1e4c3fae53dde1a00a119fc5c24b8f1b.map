{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\generate-signed-url.ts","mappings":";AAAA;;;;;;GAMG;;AAmBH,8CAwBC;AAzCD,kDAAgE;AAChE,wEAA6D;AAC7D,+CAA4C;AAE5C,0BAA0B;AAC1B,MAAM,QAAQ,GAAG,IAAI,oBAAQ,CAAC,EAAE,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,gBAAgB,EAAE,CAAC,CAAC;AAEtF,OAAO;AACP,MAAM,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,eAAe,CAAC;AAExE;;;;;;GAMG;AACI,KAAK,UAAU,iBAAiB,CACrC,MAAc,EACd,YAAoB,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,aAAa;;IAElD,eAAM,CAAC,IAAI,CAAC,uBAAuB,EAAE;QACnC,MAAM;QACN,UAAU,EAAE,SAAS;KACtB,CAAC,CAAC;IAEH,sBAAsB;IACtB,MAAM,OAAO,GAAG,IAAI,4BAAgB,CAAC;QACnC,MAAM,EAAE,aAAa;QACrB,GAAG,EAAE,MAAM;KACZ,CAAC,CAAC;IAEH,aAAa;IACb,MAAM,SAAS,GAAG,MAAM,IAAA,mCAAY,EAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,SAAS,EAAE,CAAC,CAAC;IAEvE,eAAM,CAAC,IAAI,CAAC,mCAAmC,EAAE;QAC/C,MAAM;QACN,UAAU,EAAE,SAAS;KACtB,CAAC,CAAC;IAEH,OAAO,SAAS,CAAC;AACnB,CAAC","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\lambda\\export\\generate-signed-url.ts"],"sourcesContent":["/**\r\n * 署名付きURL生成\r\n *\r\n * S3オブジェクトの署名付きURLを生成します（有効期限7日）。\r\n *\r\n * Requirements: 要件5.1（エクスポート）\r\n */\r\n\r\nimport { S3Client, GetObjectCommand } from '@aws-sdk/client-s3';\r\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\r\nimport { logger } from '../../utils/logger';\r\n\r\n// S3クライアント（グローバルスコープで初期化）\r\nconst s3Client = new S3Client({ region: process.env.AWS_REGION || 'ap-northeast-1' });\r\n\r\n// 環境変数\r\nconst EXPORT_BUCKET = process.env.EXPORT_BUCKET_NAME || 'tdnet-exports';\r\n\r\n/**\r\n * 署名付きURLを生成\r\n *\r\n * @param s3_key S3キー\r\n * @param expiresIn 有効期限（秒）\r\n * @returns 署名付きURL\r\n */\r\nexport async function generateSignedUrl(\r\n  s3_key: string,\r\n  expiresIn: number = 7 * 24 * 60 * 60 // デフォルト: 7日間\r\n): Promise<string> {\r\n  logger.info('Generating signed URL', {\r\n    s3_key,\r\n    expires_in: expiresIn,\r\n  });\r\n\r\n  // GetObjectCommandを作成\r\n  const command = new GetObjectCommand({\r\n    Bucket: EXPORT_BUCKET,\r\n    Key: s3_key,\r\n  });\r\n\r\n  // 署名付きURLを生成\r\n  const signedUrl = await getSignedUrl(s3Client, command, { expiresIn });\r\n\r\n  logger.info('Signed URL generated successfully', {\r\n    s3_key,\r\n    signed_url: signedUrl,\r\n  });\r\n\r\n  return signedUrl;\r\n}\r\n"],"version":3}