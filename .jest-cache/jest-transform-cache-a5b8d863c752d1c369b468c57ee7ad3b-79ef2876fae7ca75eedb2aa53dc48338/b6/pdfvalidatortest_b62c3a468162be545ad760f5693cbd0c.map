{"file":"C:\\Users\\ti198\\investment_analysis_opopo\\src\\scraper\\__tests__\\pdf-validator.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\ti198\\investment_analysis_opopo\\src\\scraper\\__tests__\\pdf-validator.test.ts"],"sourcesContent":["/**\r\n * PDFファイルバリデーションのユニットテスト\r\n *\r\n * Property 6: PDFファイルの整合性\r\n * - サイズ範囲内（10KB〜50MB）\r\n * - PDFヘッダー（%PDF-）で始まる\r\n *\r\n * Requirements: 要件2.3（整合性検証）\r\n */\r\n\r\nimport { validatePdfFile } from '../pdf-downloader';\r\nimport { ValidationError } from '../../errors';\r\n\r\ndescribe('PDF File Validation', () => {\r\n  describe('Property 6: PDFファイルの整合性 - サイズ範囲', () => {\r\n    it('should accept valid PDF files within size range (10KB)', () => {\r\n      // 有効なPDFファイル（最小サイズ）\r\n      const minValidPdf = Buffer.alloc(10 * 1024);\r\n      minValidPdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(minValidPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should accept valid PDF files within size range (50MB)', () => {\r\n      // 有効なPDFファイル（最大サイズ）\r\n      const maxValidPdf = Buffer.alloc(50 * 1024 * 1024);\r\n      maxValidPdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(maxValidPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should accept valid PDF files within size range (1MB)', () => {\r\n      // 有効なPDFファイル（中間サイズ）\r\n      const validPdf = Buffer.alloc(1 * 1024 * 1024);\r\n      validPdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(validPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should reject PDF files smaller than 10KB', () => {\r\n      const tooSmallPdf = Buffer.alloc(5 * 1024);\r\n      tooSmallPdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(tooSmallPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(tooSmallPdf)).toThrow(/too small/);\r\n    });\r\n\r\n    it('should reject PDF files larger than 50MB', () => {\r\n      const tooLargePdf = Buffer.alloc(51 * 1024 * 1024);\r\n      tooLargePdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(tooLargePdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(tooLargePdf)).toThrow(/too large/);\r\n    });\r\n  });\r\n\r\n  describe('Property 6: PDFヘッダー検証', () => {\r\n    it('should accept PDF files with valid header (%PDF-1.4)', () => {\r\n      const validPdf = Buffer.alloc(10 * 1024);\r\n      validPdf.write('%PDF-1.4');\r\n      expect(() => validatePdfFile(validPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should accept PDF files with valid header (%PDF-1.5)', () => {\r\n      const validPdf = Buffer.alloc(10 * 1024);\r\n      validPdf.write('%PDF-1.5');\r\n      expect(() => validatePdfFile(validPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should accept PDF files with valid header (%PDF-1.7)', () => {\r\n      const validPdf = Buffer.alloc(10 * 1024);\r\n      validPdf.write('%PDF-1.7');\r\n      expect(() => validatePdfFile(validPdf)).not.toThrow();\r\n    });\r\n\r\n    it('should reject files with invalid header', () => {\r\n      const invalidPdf = Buffer.alloc(10 * 1024);\r\n      invalidPdf.write('INVALID');\r\n      expect(() => validatePdfFile(invalidPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(invalidPdf)).toThrow(/Invalid PDF header/);\r\n    });\r\n\r\n    it('should reject files with empty header', () => {\r\n      const emptyPdf = Buffer.alloc(10 * 1024);\r\n      expect(() => validatePdfFile(emptyPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(emptyPdf)).toThrow(/Invalid PDF header/);\r\n    });\r\n\r\n    it('should reject files with partial PDF header', () => {\r\n      const partialPdf = Buffer.alloc(10 * 1024);\r\n      partialPdf.write('%PDF');\r\n      expect(() => validatePdfFile(partialPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(partialPdf)).toThrow(/Invalid PDF header/);\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should reject files at exactly 10KB boundary without valid header', () => {\r\n      const boundaryPdf = Buffer.alloc(10 * 1024);\r\n      boundaryPdf.write('NOTPDF');\r\n      expect(() => validatePdfFile(boundaryPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(boundaryPdf)).toThrow(/Invalid PDF header/);\r\n    });\r\n\r\n    it('should reject files at exactly 50MB boundary without valid header', () => {\r\n      const boundaryPdf = Buffer.alloc(50 * 1024 * 1024);\r\n      boundaryPdf.write('NOTPDF');\r\n      expect(() => validatePdfFile(boundaryPdf)).toThrow(ValidationError);\r\n      expect(() => validatePdfFile(boundaryPdf)).toThrow(/Invalid PDF header/);\r\n    });\r\n\r\n    it('should handle files with exactly 5 bytes (minimum for header check)', () => {\r\n      const minHeaderPdf = Buffer.alloc(10 * 1024);\r\n      minHeaderPdf.write('%PDF-');\r\n      expect(() => validatePdfFile(minHeaderPdf)).not.toThrow();\r\n    });\r\n  });\r\n});\r\n"],"version":3}