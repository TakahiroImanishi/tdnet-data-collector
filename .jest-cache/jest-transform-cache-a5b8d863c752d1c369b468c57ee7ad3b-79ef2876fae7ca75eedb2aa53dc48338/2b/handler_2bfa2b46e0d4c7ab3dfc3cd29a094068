4726068270b397e222df9453d53b2bce
"use strict";
/**
 * Lambda Query Handler
 *
 * TDnet開示情報を検索するLambda関数のメインハンドラー。
 * API Gateway統合により、RESTful APIとして公開されます。
 *
 * Requirements: 要件4.1, 4.3, 4.4, 5.2, 11.1（検索API、認証、PDFダウンロード、CSV形式）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = handler;
const client_secrets_manager_1 = require("@aws-sdk/client-secrets-manager");
const logger_1 = require("../../utils/logger");
const cloudwatch_metrics_1 = require("../../utils/cloudwatch-metrics");
const errors_1 = require("../../errors");
const query_disclosures_1 = require("./query-disclosures");
const format_csv_1 = require("./format-csv");
// Secrets Managerクライアント（グローバルスコープで初期化）
const secretsClient = new client_secrets_manager_1.SecretsManagerClient({ region: process.env.AWS_REGION || 'ap-northeast-1' });
// APIキーキャッシュ（5分TTL）
let cachedApiKey = null;
let cacheExpiry = 0;
/**
 * Secrets ManagerからAPIキーを取得
 *
 * テスト環境（TEST_ENV=e2e）では、API_KEY環境変数から直接取得します。
 * 本番環境では、Secrets Managerから取得します。
 *
 * @returns APIキー
 * @throws Error Secrets Managerからの取得に失敗した場合
 */
async function getApiKey() {
    // キャッシュチェック
    if (cachedApiKey && Date.now() < cacheExpiry) {
        return cachedApiKey;
    }
    // テスト環境: API_KEY環境変数から直接取得
    if (process.env.TEST_ENV === 'e2e' && process.env.API_KEY) {
        cachedApiKey = process.env.API_KEY;
        cacheExpiry = Date.now() + 5 * 60 * 1000;
        return cachedApiKey;
    }
    // 本番環境: Secrets Managerから取得
    const secretArn = process.env.API_KEY_SECRET_ARN;
    if (!secretArn) {
        throw new Error('API_KEY_SECRET_ARN environment variable is not set');
    }
    try {
        const command = new client_secrets_manager_1.GetSecretValueCommand({ SecretId: secretArn });
        const response = await secretsClient.send(command);
        if (!response.SecretString) {
            throw new Error('Secret value is empty');
        }
        // APIキーをキャッシュ（5分TTL）
        cachedApiKey = response.SecretString;
        cacheExpiry = Date.now() + 5 * 60 * 1000;
        return cachedApiKey;
    }
    catch (error) {
        logger_1.logger.error('Failed to retrieve API key from Secrets Manager', {
            error: error instanceof Error ? error.message : String(error),
            secret_arn: secretArn,
        });
        throw new Error('Failed to retrieve API key');
    }
}
/**
 * Lambda Queryハンドラー
 *
 * @param event API Gateway Proxy Event
 * @param context Lambda Context
 * @returns API Gateway Proxy Result
 *
 * @example
 * ```typescript
 * // 企業コードで検索
 * GET /disclosures?company_code=7203
 *
 * // 日付範囲で検索
 * GET /disclosures?start_date=2024-01-15&end_date=2024-01-20
 *
 * // CSV形式で取得
 * GET /disclosures?format=csv&start_date=2024-01-15&end_date=2024-01-20
 * ```
 */
async function handler(event, context) {
    const startTime = Date.now();
    try {
        logger_1.logger.info('Lambda Query started', {
            queryStringParameters: event.queryStringParameters,
            request_id: context.awsRequestId,
            function_name: context.functionName,
        });
        // APIキー認証の検証
        await validateApiKey(event);
        // クエリパラメータのパース
        const params = parseQueryParameters(event);
        // 開示情報を検索
        const result = await (0, query_disclosures_1.queryDisclosures)(params);
        const duration = Date.now() - startTime;
        logger_1.logger.info('Lambda Query completed', {
            request_id: context.awsRequestId,
            count: result.count,
            duration_ms: duration,
        });
        // 成功メトリクス送信
        await (0, cloudwatch_metrics_1.sendMetrics)([
            {
                name: 'LambdaExecutionTime',
                value: duration,
                unit: 'Milliseconds',
                dimensions: { FunctionName: 'Query' },
            },
            {
                name: 'QueryResultCount',
                value: result.count,
                unit: 'Count',
                dimensions: { Format: params.format },
            },
        ]);
        // フォーマット別レスポンス
        if (params.format === 'csv') {
            const csv = (0, format_csv_1.formatAsCsv)(result.disclosures);
            return {
                statusCode: 200,
                headers: {
                    'Content-Type': 'text/csv',
                    'Content-Disposition': `attachment; filename="disclosures-${Date.now()}.csv"`,
                    'Access-Control-Allow-Origin': '*',
                },
                body: csv,
            };
        }
        // JSON形式（デフォルト）
        return {
            statusCode: 200,
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
            },
            body: JSON.stringify(result),
        };
    }
    catch (error) {
        const duration = Date.now() - startTime;
        logger_1.logger.error('Lambda Query failed', (0, logger_1.createErrorContext)(error, {
            request_id: context.awsRequestId,
            duration_ms: duration,
        }));
        // エラーメトリクス送信
        await (0, cloudwatch_metrics_1.sendErrorMetric)(error instanceof Error ? error.constructor.name : 'Unknown', 'Query');
        return handleError(error, context.awsRequestId);
    }
}
/**
 * 認証エラークラス
 */
class UnauthorizedError extends Error {
    constructor(message) {
        super(message);
        this.name = 'UnauthorizedError';
    }
}
/**
 * APIキー認証の検証
 *
 * @param event API Gateway Proxy Event
 * @throws UnauthorizedError APIキーが無効な場合
 */
async function validateApiKey(event) {
    const apiKey = event.headers['x-api-key'] || event.headers['X-Api-Key'];
    if (!apiKey) {
        throw new UnauthorizedError('API key is required. Please provide x-api-key header.');
    }
    // Secrets ManagerからAPIキーを取得
    const validApiKey = await getApiKey();
    if (apiKey !== validApiKey) {
        throw new UnauthorizedError('Invalid API key');
    }
}
/**
 * クエリパラメータのパース
 *
 * @param event API Gateway Proxy Event
 * @returns パース済みクエリパラメータ
 * @throws ValidationError バリデーションエラー
 */
function parseQueryParameters(event) {
    const params = event.queryStringParameters || {};
    // フォーマットのバリデーション
    const format = (params.format || 'json');
    if (!['json', 'csv'].includes(format)) {
        throw new errors_1.ValidationError(`Invalid format: ${format}. Expected 'json' or 'csv'.`);
    }
    // リミットのバリデーション（デフォルト: 100、最大: 1000）
    let limit = 100;
    if (params.limit) {
        limit = parseInt(params.limit, 10);
        if (isNaN(limit) || limit < 1 || limit > 1000) {
            throw new errors_1.ValidationError(`Invalid limit: ${params.limit}. Expected a number between 1 and 1000.`);
        }
    }
    // オフセットのバリデーション（デフォルト: 0）
    let offset = 0;
    if (params.offset) {
        offset = parseInt(params.offset, 10);
        if (isNaN(offset) || offset < 0) {
            throw new errors_1.ValidationError(`Invalid offset: ${params.offset}. Expected a non-negative number.`);
        }
    }
    // 日付フォーマットのバリデーション
    if (params.start_date) {
        validateDateFormat(params.start_date, 'start_date');
    }
    if (params.end_date) {
        validateDateFormat(params.end_date, 'end_date');
    }
    // 日付範囲の順序性チェック（Property 8）
    if (params.start_date && params.end_date) {
        const startDate = new Date(params.start_date);
        const endDate = new Date(params.end_date);
        if (startDate > endDate) {
            throw new errors_1.ValidationError(`start_date (${params.start_date}) must be before or equal to end_date (${params.end_date})`);
        }
    }
    // 企業コードのバリデーション（4桁の数字）
    if (params.company_code) {
        const companyCodeRegex = /^\d{4}$/;
        if (!companyCodeRegex.test(params.company_code)) {
            throw new errors_1.ValidationError(`Invalid company_code: ${params.company_code}. Expected 4-digit number.`);
        }
    }
    return {
        company_code: params.company_code,
        start_date: params.start_date,
        end_date: params.end_date,
        disclosure_type: params.disclosure_type,
        format,
        limit,
        offset,
    };
}
/**
 * 日付フォーマットのバリデーション
 *
 * @param date 日付文字列（YYYY-MM-DD）
 * @param fieldName フィールド名
 * @throws ValidationError バリデーションエラー
 */
function validateDateFormat(date, fieldName) {
    // YYYY-MM-DD形式のチェック
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (!dateRegex.test(date)) {
        throw new errors_1.ValidationError(`Invalid ${fieldName} format: ${date}. Expected YYYY-MM-DD format.`);
    }
    // 有効な日付かチェック
    const parsedDate = new Date(date);
    if (isNaN(parsedDate.getTime())) {
        throw new errors_1.ValidationError(`Invalid ${fieldName}: ${date}. Date does not exist.`);
    }
    // 日付の整合性チェック（例: 2023-02-29は2023-03-01に変換されるため検出）
    const [year, month, day] = date.split('-').map(Number);
    if (parsedDate.getFullYear() !== year ||
        parsedDate.getMonth() + 1 !== month ||
        parsedDate.getDate() !== day) {
        throw new errors_1.ValidationError(`Invalid ${fieldName}: ${date}. Date does not exist.`);
    }
}
/**
 * エラーハンドリング
 *
 * カスタムエラーを適切なHTTPステータスコードとエラーコードに変換します。
 * API設計ガイドラインに準拠した形式でエラーレスポンスを返します。
 *
 * @param error エラーオブジェクト
 * @param requestId リクエストID
 * @returns API Gateway Proxy Result
 */
function handleError(error, requestId) {
    // エラー種別に応じたステータスコードとエラーコード
    let statusCode = 500;
    let errorCode = 'INTERNAL_ERROR';
    let details = {};
    if (error instanceof errors_1.ValidationError) {
        statusCode = 400;
        errorCode = 'VALIDATION_ERROR';
        // ValidationErrorの詳細情報を含める
        if (error.details) {
            details = error.details;
        }
    }
    else if (error instanceof errors_1.NotFoundError) {
        statusCode = 404;
        errorCode = 'NOT_FOUND';
    }
    else if (error instanceof UnauthorizedError) {
        statusCode = 401;
        errorCode = 'UNAUTHORIZED';
    }
    else if (error.message.includes('API key')) {
        statusCode = 401;
        errorCode = 'UNAUTHORIZED';
    }
    // API設計ガイドラインに準拠したエラーレスポンス形式
    const errorResponse = {
        status: 'error',
        error: {
            code: errorCode,
            message: error.message,
            details,
        },
        request_id: requestId,
    };
    // 本番環境ではスタックトレースを含めない
    if (process.env.NODE_ENV !== 'production') {
        errorResponse.error.stack = error.stack;
    }
    return {
        statusCode,
        headers: {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*',
        },
        body: JSON.stringify(errorResponse),
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXHF1ZXJ5XFxoYW5kbGVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOztBQTBISCwwQkF3RkM7QUEvTUQsNEVBQThGO0FBQzlGLCtDQUFnRTtBQUNoRSx1RUFBOEU7QUFDOUUseUNBQThEO0FBQzlELDJEQUF1RDtBQUN2RCw2Q0FBMkM7QUFHM0MsdUNBQXVDO0FBQ3ZDLE1BQU0sYUFBYSxHQUFHLElBQUksNkNBQW9CLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0FBRXZHLG9CQUFvQjtBQUNwQixJQUFJLFlBQVksR0FBa0IsSUFBSSxDQUFDO0FBQ3ZDLElBQUksV0FBVyxHQUFXLENBQUMsQ0FBQztBQUU1Qjs7Ozs7Ozs7R0FRRztBQUNILEtBQUssVUFBVSxTQUFTO0lBQ3RCLFlBQVk7SUFDWixJQUFJLFlBQVksSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxFQUFFLENBQUM7UUFDN0MsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVELDJCQUEyQjtJQUMzQixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLEtBQUssSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzFELFlBQVksR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUNuQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ3pDLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFRCw0QkFBNEI7SUFDNUIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQztJQUNqRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDZixNQUFNLElBQUks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QU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztRQUM3QyxVQUFVLEdBQUcsR0FBRyxDQUFDO1FBQ2pCLFNBQVMsR0FBRyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUVELDZCQUE2QjtJQUM3QixNQUFNLGFBQWEsR0FBRztRQUNwQixNQUFNLEVBQUUsT0FBTztRQUNmLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxTQUFTO1lBQ2YsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3RCLE9BQU87U0FDUjtRQUNELFVBQVUsRUFBRSxTQUFTO0tBQ3RCLENBQUM7SUFFRixzQkFBc0I7SUFDdEIsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZLEVBQUUsQ0FBQztRQUN6QyxhQUFhLENBQUMsS0FBYSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO0lBQ25ELENBQUM7SUFFRCxPQUFPO1FBQ0wsVUFBVTtRQUNWLE9BQU8sRUFBRTtZQUNQLGNBQWMsRUFBRSxrQkFBa0I7WUFDbEMsNkJBQTZCLEVBQUUsR0FBRztTQUNuQztRQUNELElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQztLQUNwQyxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxccXVlcnlcXGhhbmRsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIExhbWJkYSBRdWVyeSBIYW5kbGVyXHJcbiAqXHJcbiAqIFREbmV06ZaL56S65oOF5aCx44KS5qSc57Si44GZ44KLTGFtYmRh6Zai5pWw44Gu44Oh44Kk44Oz44OP44Oz44OJ44Op44O844CCXHJcbiAqIEFQSSBHYXRld2F557Wx5ZCI44Gr44KI44KK44CBUkVTVGZ1bCBBUEnjgajjgZfjgablhazplovjgZXjgozjgb7jgZnjgIJcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDopoHku7Y0LjEsIDQuMywgNC40LCA1LjIsIDExLjHvvIjmpJzntKJBUEnjgIHoqo3oqLzjgIFQREbjg4Djgqbjg7Pjg63jg7zjg4njgIFDU1blvaLlvI/vvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCwgQVBJR2F0ZXdheVByb3h5UmVzdWx0LCBDb250ZXh0IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IFNlY3JldHNNYW5hZ2VyQ2xpZW50LCBHZXRTZWNyZXRWYWx1ZUNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc2VjcmV0cy1tYW5hZ2VyJztcclxuaW1wb3J0IHsgbG9nZ2VyLCBjcmVhdGVFcnJvckNvbnRleHQgfSBmcm9tICcuLi8uLi91dGlscy9sb2dnZXInO1xyXG5pbXBvcnQgeyBzZW5kRXJyb3JNZXRyaWMsIHNlbmRNZXRyaWNzIH0gZnJvbSAnLi4vLi4vdXRpbHMvY2xvdWR3YXRjaC1tZXRyaWNzJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9yLCBOb3RGb3VuZEVycm9yIH0gZnJvbSAnLi4vLi4vZXJyb3JzJztcclxuaW1wb3J0IHsgcXVlcnlEaXNjbG9zdXJlcyB9IGZyb20gJy4vcXVlcnktZGlzY2xvc3VyZXMnO1xyXG5pbXBvcnQgeyBmb3JtYXRBc0NzdiB9IGZyb20gJy4vZm9ybWF0LWNzdic7XHJcbmltcG9ydCB7IERpc2Nsb3N1cmUgfSBmcm9tICcuLi8uLi90eXBlcyc7XHJcblxyXG4vLyBTZWNyZXRzIE1hbmFnZXLjgq/jg6njgqTjgqLjg7Pjg4jvvIjjgrDjg63jg7zjg5Djg6vjgrnjgrPjg7zjg5fjgafliJ3mnJ/ljJbvvIlcclxuY29uc3Qgc2VjcmV0c0NsaWVudCA9IG5ldyBTZWNyZXRzTWFuYWdlckNsaWVudCh7IHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAnYXAtbm9ydGhlYXN0LTEnIH0pO1xyXG5cclxuLy8gQVBJ44Kt44O844Kt44Oj44OD44K344Ol77yINeWIhlRUTO+8iVxyXG5sZXQgY2FjaGVkQXBpS2V5OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxubGV0IGNhY2hlRXhwaXJ5OiBudW1iZXIgPSAwO1xyXG5cclxuLyoqXHJcbiAqIFNlY3JldHMgTWFuYWdlcuOBi+OCiUFQSeOCreODvOOCkuWPluW+l1xyXG4gKlxyXG4gKiDjg4bjgrnjg4jnkrDlooPvvIhURVNUX0VOVj1lMmXvvInjgafjga/jgIFBUElfS0VZ55Kw5aKD5aSJ5pWw44GL44KJ55u05o6l5Y+W5b6X44GX44G+44GZ44CCXHJcbiAqIOacrOeVqueSsOWig+OBp+OBr+OAgVNlY3JldHMgTWFuYWdlcuOBi+OCieWPluW+l+OBl+OBvuOBmeOAglxyXG4gKlxyXG4gKiBAcmV0dXJucyBBUEnjgq3jg7xcclxuICogQHRocm93cyBFcnJvciBTZWNyZXRzIE1hbmFnZXLjgYvjgonjga7lj5blvpfjgavlpLHmlZfjgZfjgZ/loLTlkIhcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFwaUtleSgpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIC8vIOOCreODo+ODg+OCt+ODpeODgeOCp+ODg+OCr1xyXG4gIGlmIChjYWNoZWRBcGlLZXkgJiYgRGF0ZS5ub3coKSA8IGNhY2hlRXhwaXJ5KSB7XHJcbiAgICByZXR1cm4gY2FjaGVkQXBpS2V5O1xyXG4gIH1cclxuXHJcbiAgLy8g44OG44K544OI55Kw5aKDOiBBUElfS0VZ55Kw5aKD5aSJ5pWw44GL44KJ55u05o6l5Y+W5b6XXHJcbiAgaWYgKHByb2Nlc3MuZW52LlRFU1RfRU5WID09PSAnZTJlJyAmJiBwcm9jZXNzLmVudi5BUElfS0VZKSB7XHJcbiAgICBjYWNoZWRBcGlLZXkgPSBwcm9jZXNzLmVudi5BUElfS0VZO1xyXG4gICAgY2FjaGVFeHBpcnkgPSBEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMDtcclxuICAgIHJldHVybiBjYWNoZWRBcGlLZXk7XHJcbiAgfVxyXG5cclxuICAvLyDmnKznlarnkrDlooM6IFNlY3JldHMgTWFuYWdlcuOBi+OCieWPluW+l1xyXG4gIGNvbnN0IHNlY3JldEFybiA9IHByb2Nlc3MuZW52LkFQSV9LRVlfU0VDUkVUX0FSTjtcclxuICBpZiAoIXNlY3JldEFybikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdBUElfS0VZX1NFQ1JFVF9BUk4gZW52aXJvbm1lbnQgdmFyaWFibGUgaXMgbm90IHNldCcpO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0U2VjcmV0VmFsdWVDb21tYW5kKHsgU2VjcmV0SWQ6IHNlY3JldEFybiB9KTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VjcmV0c0NsaWVudC5zZW5kKGNvbW1hbmQpO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2UuU2VjcmV0U3RyaW5nKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2VjcmV0IHZhbHVlIGlzIGVtcHR5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQVBJ44Kt44O844KS44Kt44Oj44OD44K344Ol77yINeWIhlRUTO+8iVxyXG4gICAgY2FjaGVkQXBpS2V5ID0gcmVzcG9uc2UuU2VjcmV0U3RyaW5nO1xyXG4gICAgY2FjaGVFeHBpcnkgPSBEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMDtcclxuXHJcbiAgICByZXR1cm4gY2FjaGVkQXBpS2V5O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBBUEkga2V5IGZyb20gU2VjcmV0cyBNYW5hZ2VyJywge1xyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxyXG4gICAgICBzZWNyZXRfYXJuOiBzZWNyZXRBcm4sXHJcbiAgICB9KTtcclxuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIEFQSSBrZXknKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMYW1iZGEgUXVlcnnjgqTjg5njg7Pjg4jvvIhBUEkgR2F0ZXdheee1seWQiO+8iVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBRdWVyeUV2ZW50IGV4dGVuZHMgQVBJR2F0ZXdheVByb3h5RXZlbnQge1xyXG4gIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczoge1xyXG4gICAgY29tcGFueV9jb2RlPzogc3RyaW5nO1xyXG4gICAgc3RhcnRfZGF0ZT86IHN0cmluZztcclxuICAgIGVuZF9kYXRlPzogc3RyaW5nO1xyXG4gICAgZGlzY2xvc3VyZV90eXBlPzogc3RyaW5nO1xyXG4gICAgZm9ybWF0PzogJ2pzb24nIHwgJ2Nzdic7XHJcbiAgICBsaW1pdD86IHN0cmluZztcclxuICAgIG9mZnNldD86IHN0cmluZztcclxuICB9IHwgbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIOOCr+OCqOODquODrOOCueODneODs+OCuVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBRdWVyeVJlc3BvbnNlIHtcclxuICAvKiog5qSc57Si57WQ5p6cICovXHJcbiAgZGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXTtcclxuXHJcbiAgLyoqIOe3j+S7tuaVsCAqL1xyXG4gIHRvdGFsOiBudW1iZXI7XHJcblxyXG4gIC8qKiDlj5blvpfku7bmlbAgKi9cclxuICBjb3VudDogbnVtYmVyO1xyXG5cclxuICAvKiog44Kq44OV44K744OD44OIICovXHJcbiAgb2Zmc2V0OiBudW1iZXI7XHJcblxyXG4gIC8qKiDjg6rjg5/jg4Pjg4ggKi9cclxuICBsaW1pdDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogTGFtYmRhIFF1ZXJ544OP44Oz44OJ44Op44O8XHJcbiAqXHJcbiAqIEBwYXJhbSBldmVudCBBUEkgR2F0ZXdheSBQcm94eSBFdmVudFxyXG4gKiBAcGFyYW0gY29udGV4dCBMYW1iZGEgQ29udGV4dFxyXG4gKiBAcmV0dXJucyBBUEkgR2F0ZXdheSBQcm94eSBSZXN1bHRcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiAvLyDkvIHmpa3jgrPjg7zjg4njgafmpJzntKJcclxuICogR0VUIC9kaXNjbG9zdXJlcz9jb21wYW55X2NvZGU9NzIwM1xyXG4gKlxyXG4gKiAvLyDml6Xku5jnr4Tlm7LjgafmpJzntKJcclxuICogR0VUIC9kaXNjbG9zdXJlcz9zdGFydF9kYXRlPTIwMjQtMDEtMTUmZW5kX2RhdGU9MjAyNC0wMS0yMFxyXG4gKlxyXG4gKiAvLyBDU1blvaLlvI/jgaflj5blvpdcclxuICogR0VUIC9kaXNjbG9zdXJlcz9mb3JtYXQ9Y3N2JnN0YXJ0X2RhdGU9MjAyNC0wMS0xNSZlbmRfZGF0ZT0yMDI0LTAxLTIwXHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXHJcbiAgZXZlbnQ6IFF1ZXJ5RXZlbnQsXHJcbiAgY29udGV4dDogQ29udGV4dFxyXG4pOiBQcm9taXNlPEFQSUdhdGV3YXlQcm94eVJlc3VsdD4ge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBsb2dnZXIuaW5mbygnTGFtYmRhIFF1ZXJ5IHN0YXJ0ZWQnLCB7XHJcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzLFxyXG4gICAgICByZXF1ZXN0X2lkOiBjb250ZXh0LmF3c1JlcXVlc3RJZCxcclxuICAgICAgZnVuY3Rpb25fbmFtZTogY29udGV4dC5mdW5jdGlvbk5hbWUsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBUEnjgq3jg7zoqo3oqLzjga7mpJzoqLxcclxuICAgIGF3YWl0IHZhbGlkYXRlQXBpS2V5KGV2ZW50KTtcclxuXHJcbiAgICAvLyDjgq/jgqjjg6rjg5Hjg6njg6Hjg7zjgr/jga7jg5Hjg7zjgrlcclxuICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlQYXJhbWV0ZXJzKGV2ZW50KTtcclxuXHJcbiAgICAvLyDplovnpLrmg4XloLHjgpLmpJzntKJcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5RGlzY2xvc3VyZXMocGFyYW1zKTtcclxuXHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ0xhbWJkYSBRdWVyeSBjb21wbGV0ZWQnLCB7XHJcbiAgICAgIHJlcXVlc3RfaWQ6IGNvbnRleHQuYXdzUmVxdWVzdElkLFxyXG4gICAgICBjb3VudDogcmVzdWx0LmNvdW50LFxyXG4gICAgICBkdXJhdGlvbl9tczogZHVyYXRpb24sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDmiJDlip/jg6Hjg4jjg6rjgq/jgrnpgIHkv6FcclxuICAgIGF3YWl0IHNlbmRNZXRyaWNzKFtcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6ICdMYW1iZGFFeGVjdXRpb25UaW1lJyxcclxuICAgICAgICB2YWx1ZTogZHVyYXRpb24sXHJcbiAgICAgICAgdW5pdDogJ01pbGxpc2Vjb25kcycsXHJcbiAgICAgICAgZGltZW5zaW9uczogeyBGdW5jdGlvbk5hbWU6ICdRdWVyeScgfSxcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6ICdRdWVyeVJlc3VsdENvdW50JyxcclxuICAgICAgICB2YWx1ZTogcmVzdWx0LmNvdW50LFxyXG4gICAgICAgIHVuaXQ6ICdDb3VudCcsXHJcbiAgICAgICAgZGltZW5zaW9uczogeyBGb3JtYXQ6IHBhcmFtcy5mb3JtYXQgfSxcclxuICAgICAgfSxcclxuICAgIF0pO1xyXG5cclxuICAgIC8vIOODleOCqeODvOODnuODg+ODiOWIpeODrOOCueODneODs+OCuVxyXG4gICAgaWYgKHBhcmFtcy5mb3JtYXQgPT09ICdjc3YnKSB7XHJcbiAgICAgIGNvbnN0IGNzdiA9IGZvcm1hdEFzQ3N2KHJlc3VsdC5kaXNjbG9zdXJlcyk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9jc3YnLFxyXG4gICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb24nOiBgYXR0YWNobWVudDsgZmlsZW5hbWU9XCJkaXNjbG9zdXJlcy0ke0RhdGUubm93KCl9LmNzdlwiYCxcclxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBjc3YsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSlNPTuW9ouW8j++8iOODh+ODleOCqeODq+ODiO+8iVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzQ29kZTogMjAwLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXN1bHQpLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG5cclxuICAgIGxvZ2dlci5lcnJvcihcclxuICAgICAgJ0xhbWJkYSBRdWVyeSBmYWlsZWQnLFxyXG4gICAgICBjcmVhdGVFcnJvckNvbnRleHQoZXJyb3IgYXMgRXJyb3IsIHtcclxuICAgICAgICByZXF1ZXN0X2lkOiBjb250ZXh0LmF3c1JlcXVlc3RJZCxcclxuICAgICAgICBkdXJhdGlvbl9tczogZHVyYXRpb24sXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIC8vIOOCqOODqeODvOODoeODiOODquOCr+OCuemAgeS/oVxyXG4gICAgYXdhaXQgc2VuZEVycm9yTWV0cmljKFxyXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IuY29uc3RydWN0b3IubmFtZSA6ICdVbmtub3duJyxcclxuICAgICAgJ1F1ZXJ5J1xyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gaGFuZGxlRXJyb3IoZXJyb3IgYXMgRXJyb3IsIGNvbnRleHQuYXdzUmVxdWVzdElkKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDoqo3oqLzjgqjjg6njg7zjgq/jg6njgrlcclxuICovXHJcbmNsYXNzIFVuYXV0aG9yaXplZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZykge1xyXG4gICAgc3VwZXIobWVzc2FnZSk7XHJcbiAgICB0aGlzLm5hbWUgPSAnVW5hdXRob3JpemVkRXJyb3InO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEFQSeOCreODvOiqjeiovOOBruaknOiovFxyXG4gKlxyXG4gKiBAcGFyYW0gZXZlbnQgQVBJIEdhdGV3YXkgUHJveHkgRXZlbnRcclxuICogQHRocm93cyBVbmF1dGhvcml6ZWRFcnJvciBBUEnjgq3jg7zjgYznhKHlirnjgarloLTlkIhcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQXBpS2V5KGV2ZW50OiBRdWVyeUV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3QgYXBpS2V5ID0gZXZlbnQuaGVhZGVyc1sneC1hcGkta2V5J10gfHwgZXZlbnQuaGVhZGVyc1snWC1BcGktS2V5J107XHJcblxyXG4gIGlmICghYXBpS2V5KSB7XHJcbiAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ0FQSSBrZXkgaXMgcmVxdWlyZWQuIFBsZWFzZSBwcm92aWRlIHgtYXBpLWtleSBoZWFkZXIuJyk7XHJcbiAgfVxyXG5cclxuICAvLyBTZWNyZXRzIE1hbmFnZXLjgYvjgolBUEnjgq3jg7zjgpLlj5blvpdcclxuICBjb25zdCB2YWxpZEFwaUtleSA9IGF3YWl0IGdldEFwaUtleSgpO1xyXG5cclxuICBpZiAoYXBpS2V5ICE9PSB2YWxpZEFwaUtleSkge1xyXG4gICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEVycm9yKCdJbnZhbGlkIEFQSSBrZXknKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjgq/jgqjjg6rjg5Hjg6njg6Hjg7zjgr/jga7jg5Hjg7zjgrlcclxuICpcclxuICogQHBhcmFtIGV2ZW50IEFQSSBHYXRld2F5IFByb3h5IEV2ZW50XHJcbiAqIEByZXR1cm5zIOODkeODvOOCuea4iOOBv+OCr+OCqOODquODkeODqeODoeODvOOCv1xyXG4gKiBAdGhyb3dzIFZhbGlkYXRpb25FcnJvciDjg5Djg6rjg4fjg7zjgrfjg6fjg7Pjgqjjg6njg7xcclxuICovXHJcbmZ1bmN0aW9uIHBhcnNlUXVlcnlQYXJhbWV0ZXJzKGV2ZW50OiBRdWVyeUV2ZW50KToge1xyXG4gIGNvbXBhbnlfY29kZT86IHN0cmluZztcclxuICBzdGFydF9kYXRlPzogc3RyaW5nO1xyXG4gIGVuZF9kYXRlPzogc3RyaW5nO1xyXG4gIGRpc2Nsb3N1cmVfdHlwZT86IHN0cmluZztcclxuICBmb3JtYXQ6ICdqc29uJyB8ICdjc3YnO1xyXG4gIGxpbWl0OiBudW1iZXI7XHJcbiAgb2Zmc2V0OiBudW1iZXI7XHJcbn0ge1xyXG4gIGNvbnN0IHBhcmFtcyA9IGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVycyB8fCB7fTtcclxuXHJcbiAgLy8g44OV44Kp44O844Oe44OD44OI44Gu44OQ44Oq44OH44O844K344On44OzXHJcbiAgY29uc3QgZm9ybWF0ID0gKHBhcmFtcy5mb3JtYXQgfHwgJ2pzb24nKSBhcyAnanNvbicgfCAnY3N2JztcclxuICBpZiAoIVsnanNvbicsICdjc3YnXS5pbmNsdWRlcyhmb3JtYXQpKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICBgSW52YWxpZCBmb3JtYXQ6ICR7Zm9ybWF0fS4gRXhwZWN0ZWQgJ2pzb24nIG9yICdjc3YnLmBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyDjg6rjg5/jg4Pjg4jjga7jg5Djg6rjg4fjg7zjgrfjg6fjg7PvvIjjg4fjg5Xjgqnjg6vjg4g6IDEwMOOAgeacgOWkpzogMTAwMO+8iVxyXG4gIGxldCBsaW1pdCA9IDEwMDtcclxuICBpZiAocGFyYW1zLmxpbWl0KSB7XHJcbiAgICBsaW1pdCA9IHBhcnNlSW50KHBhcmFtcy5saW1pdCwgMTApO1xyXG4gICAgaWYgKGlzTmFOKGxpbWl0KSB8fCBsaW1pdCA8IDEgfHwgbGltaXQgPiAxMDAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgICAgYEludmFsaWQgbGltaXQ6ICR7cGFyYW1zLmxpbWl0fS4gRXhwZWN0ZWQgYSBudW1iZXIgYmV0d2VlbiAxIGFuZCAxMDAwLmBcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIOOCquODleOCu+ODg+ODiOOBruODkOODquODh+ODvOOCt+ODp+ODs++8iOODh+ODleOCqeODq+ODiDogMO+8iVxyXG4gIGxldCBvZmZzZXQgPSAwO1xyXG4gIGlmIChwYXJhbXMub2Zmc2V0KSB7XHJcbiAgICBvZmZzZXQgPSBwYXJzZUludChwYXJhbXMub2Zmc2V0LCAxMCk7XHJcbiAgICBpZiAoaXNOYU4ob2Zmc2V0KSB8fCBvZmZzZXQgPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgICAgYEludmFsaWQgb2Zmc2V0OiAke3BhcmFtcy5vZmZzZXR9LiBFeHBlY3RlZCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuYFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g5pel5LuY44OV44Kp44O844Oe44OD44OI44Gu44OQ44Oq44OH44O844K344On44OzXHJcbiAgaWYgKHBhcmFtcy5zdGFydF9kYXRlKSB7XHJcbiAgICB2YWxpZGF0ZURhdGVGb3JtYXQocGFyYW1zLnN0YXJ0X2RhdGUsICdzdGFydF9kYXRlJyk7XHJcbiAgfVxyXG4gIGlmIChwYXJhbXMuZW5kX2RhdGUpIHtcclxuICAgIHZhbGlkYXRlRGF0ZUZvcm1hdChwYXJhbXMuZW5kX2RhdGUsICdlbmRfZGF0ZScpO1xyXG4gIH1cclxuXHJcbiAgLy8g5pel5LuY56+E5Zuy44Gu6aCG5bqP5oCn44OB44Kn44OD44Kv77yIUHJvcGVydHkgOO+8iVxyXG4gIGlmIChwYXJhbXMuc3RhcnRfZGF0ZSAmJiBwYXJhbXMuZW5kX2RhdGUpIHtcclxuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHBhcmFtcy5zdGFydF9kYXRlKTtcclxuICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShwYXJhbXMuZW5kX2RhdGUpO1xyXG5cclxuICAgIGlmIChzdGFydERhdGUgPiBlbmREYXRlKSB7XHJcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgICAgYHN0YXJ0X2RhdGUgKCR7cGFyYW1zLnN0YXJ0X2RhdGV9KSBtdXN0IGJlIGJlZm9yZSBvciBlcXVhbCB0byBlbmRfZGF0ZSAoJHtwYXJhbXMuZW5kX2RhdGV9KWBcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIOS8gealreOCs+ODvOODieOBruODkOODquODh+ODvOOCt+ODp+ODs++8iDTmoYHjga7mlbDlrZfvvIlcclxuICBpZiAocGFyYW1zLmNvbXBhbnlfY29kZSkge1xyXG4gICAgY29uc3QgY29tcGFueUNvZGVSZWdleCA9IC9eXFxkezR9JC87XHJcbiAgICBpZiAoIWNvbXBhbnlDb2RlUmVnZXgudGVzdChwYXJhbXMuY29tcGFueV9jb2RlKSkge1xyXG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICAgIGBJbnZhbGlkIGNvbXBhbnlfY29kZTogJHtwYXJhbXMuY29tcGFueV9jb2RlfS4gRXhwZWN0ZWQgNC1kaWdpdCBudW1iZXIuYFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGNvbXBhbnlfY29kZTogcGFyYW1zLmNvbXBhbnlfY29kZSxcclxuICAgIHN0YXJ0X2RhdGU6IHBhcmFtcy5zdGFydF9kYXRlLFxyXG4gICAgZW5kX2RhdGU6IHBhcmFtcy5lbmRfZGF0ZSxcclxuICAgIGRpc2Nsb3N1cmVfdHlwZTogcGFyYW1zLmRpc2Nsb3N1cmVfdHlwZSxcclxuICAgIGZvcm1hdCxcclxuICAgIGxpbWl0LFxyXG4gICAgb2Zmc2V0LFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDml6Xku5jjg5Xjgqnjg7zjg57jg4Pjg4jjga7jg5Djg6rjg4fjg7zjgrfjg6fjg7NcclxuICpcclxuICogQHBhcmFtIGRhdGUg5pel5LuY5paH5a2X5YiX77yIWVlZWS1NTS1ERO+8iVxyXG4gKiBAcGFyYW0gZmllbGROYW1lIOODleOCo+ODvOODq+ODieWQjVxyXG4gKiBAdGhyb3dzIFZhbGlkYXRpb25FcnJvciDjg5Djg6rjg4fjg7zjgrfjg6fjg7Pjgqjjg6njg7xcclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlRGF0ZUZvcm1hdChkYXRlOiBzdHJpbmcsIGZpZWxkTmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgLy8gWVlZWS1NTS1EROW9ouW8j+OBruODgeOCp+ODg+OCr1xyXG4gIGNvbnN0IGRhdGVSZWdleCA9IC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLztcclxuICBpZiAoIWRhdGVSZWdleC50ZXN0KGRhdGUpKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICBgSW52YWxpZCAke2ZpZWxkTmFtZX0gZm9ybWF0OiAke2RhdGV9LiBFeHBlY3RlZCBZWVlZLU1NLUREIGZvcm1hdC5gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8g5pyJ5Yq544Gq5pel5LuY44GL44OB44Kn44OD44KvXHJcbiAgY29uc3QgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xyXG4gIGlmIChpc05hTihwYXJzZWREYXRlLmdldFRpbWUoKSkpIHtcclxuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXHJcbiAgICAgIGBJbnZhbGlkICR7ZmllbGROYW1lfTogJHtkYXRlfS4gRGF0ZSBkb2VzIG5vdCBleGlzdC5gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8g5pel5LuY44Gu5pW05ZCI5oCn44OB44Kn44OD44Kv77yI5L6LOiAyMDIzLTAyLTI544GvMjAyMy0wMy0wMeOBq+WkieaPm+OBleOCjOOCi+OBn+OCgeaknOWHuu+8iVxyXG4gIGNvbnN0IFt5ZWFyLCBtb250aCwgZGF5XSA9IGRhdGUuc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTtcclxuICBpZiAoXHJcbiAgICBwYXJzZWREYXRlLmdldEZ1bGxZZWFyKCkgIT09IHllYXIgfHxcclxuICAgIHBhcnNlZERhdGUuZ2V0TW9udGgoKSArIDEgIT09IG1vbnRoIHx8XHJcbiAgICBwYXJzZWREYXRlLmdldERhdGUoKSAhPT0gZGF5XHJcbiAgKSB7XHJcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFxyXG4gICAgICBgSW52YWxpZCAke2ZpZWxkTmFtZX06ICR7ZGF0ZX0uIERhdGUgZG9lcyBub3QgZXhpc3QuYFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjgqjjg6njg7zjg4/jg7Pjg4njg6rjg7PjgrBcclxuICpcclxuICog44Kr44K544K/44Og44Ko44Op44O844KS6YGp5YiH44GqSFRUUOOCueODhuODvOOCv+OCueOCs+ODvOODieOBqOOCqOODqeODvOOCs+ODvOODieOBq+WkieaPm+OBl+OBvuOBmeOAglxyXG4gKiBBUEnoqK3oqIjjgqzjgqTjg4njg6njgqTjg7Pjgavmupbmi6DjgZfjgZ/lvaLlvI/jgafjgqjjg6njg7zjg6zjgrnjg53jg7PjgrnjgpLov5TjgZfjgb7jgZnjgIJcclxuICpcclxuICogQHBhcmFtIGVycm9yIOOCqOODqeODvOOCquODluOCuOOCp+OCr+ODiFxyXG4gKiBAcGFyYW0gcmVxdWVzdElkIOODquOCr+OCqOOCueODiElEXHJcbiAqIEByZXR1cm5zIEFQSSBHYXRld2F5IFByb3h5IFJlc3VsdFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyb3I6IEVycm9yLCByZXF1ZXN0SWQ6IHN0cmluZyk6IEFQSUdhdGV3YXlQcm94eVJlc3VsdCB7XHJcbiAgLy8g44Ko44Op44O856iu5Yil44Gr5b+c44GY44Gf44K544OG44O844K/44K544Kz44O844OJ44Go44Ko44Op44O844Kz44O844OJXHJcbiAgbGV0IHN0YXR1c0NvZGUgPSA1MDA7XHJcbiAgbGV0IGVycm9yQ29kZSA9ICdJTlRFUk5BTF9FUlJPUic7XHJcbiAgbGV0IGRldGFpbHM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuXHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yKSB7XHJcbiAgICBzdGF0dXNDb2RlID0gNDAwO1xyXG4gICAgZXJyb3JDb2RlID0gJ1ZBTElEQVRJT05fRVJST1InO1xyXG4gICAgLy8gVmFsaWRhdGlvbkVycm9y44Gu6Kmz57Sw5oOF5aCx44KS5ZCr44KB44KLXHJcbiAgICBpZiAoKGVycm9yIGFzIGFueSkuZGV0YWlscykge1xyXG4gICAgICBkZXRhaWxzID0gKGVycm9yIGFzIGFueSkuZGV0YWlscztcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFcnJvcikge1xyXG4gICAgc3RhdHVzQ29kZSA9IDQwNDtcclxuICAgIGVycm9yQ29kZSA9ICdOT1RfRk9VTkQnO1xyXG4gIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBVbmF1dGhvcml6ZWRFcnJvcikge1xyXG4gICAgc3RhdHVzQ29kZSA9IDQwMTtcclxuICAgIGVycm9yQ29kZSA9ICdVTkFVVEhPUklaRUQnO1xyXG4gIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnQVBJIGtleScpKSB7XHJcbiAgICBzdGF0dXNDb2RlID0gNDAxO1xyXG4gICAgZXJyb3JDb2RlID0gJ1VOQVVUSE9SSVpFRCc7XHJcbiAgfVxyXG5cclxuICAvLyBBUEnoqK3oqIjjgqzjgqTjg4njg6njgqTjg7Pjgavmupbmi6DjgZfjgZ/jgqjjg6njg7zjg6zjgrnjg53jg7PjgrnlvaLlvI9cclxuICBjb25zdCBlcnJvclJlc3BvbnNlID0ge1xyXG4gICAgc3RhdHVzOiAnZXJyb3InLFxyXG4gICAgZXJyb3I6IHtcclxuICAgICAgY29kZTogZXJyb3JDb2RlLFxyXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICBkZXRhaWxzLFxyXG4gICAgfSxcclxuICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZCxcclxuICB9O1xyXG5cclxuICAvLyDmnKznlarnkrDlooPjgafjga/jgrnjgr/jg4Pjgq/jg4jjg6zjg7zjgrnjgpLlkKvjgoHjgarjgYRcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgKGVycm9yUmVzcG9uc2UuZXJyb3IgYXMgYW55KS5zdGFjayA9IGVycm9yLnN0YWNrO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1c0NvZGUsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZXJyb3JSZXNwb25zZSksXHJcbiAgfTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=