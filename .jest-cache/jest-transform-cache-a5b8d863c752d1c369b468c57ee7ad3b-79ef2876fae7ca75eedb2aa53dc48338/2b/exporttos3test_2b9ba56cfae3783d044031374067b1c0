efea5c16ca0f32329f334c85f2ca1f93
"use strict";
/**
 * Export to S3 Unit Tests
 *
 * Requirements: 要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック
jest.mock('@aws-sdk/client-s3');
jest.mock('../../utils/logger');
const export_to_s3_1 = require("../export-to-s3");
const client_s3_1 = require("@aws-sdk/client-s3");
describe('exportToS3', () => {
    const mockDisclosures = [
        {
            disclosure_id: '20240115_1234_001',
            company_code: '1234',
            company_name: 'テスト株式会社',
            disclosure_type: '決算短信',
            title: '2024年3月期 第3四半期決算短信',
            disclosed_at: '2024-01-15T10:30:00Z',
            pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
            collected_at: '2024-01-15T10:35:00Z',
            date_partition: '2024-01',
        },
        {
            disclosure_id: '20240115_5678_001',
            company_code: '5678',
            company_name: 'サンプル株式会社',
            disclosure_type: '有価証券報告書',
            title: '第50期有価証券報告書',
            disclosed_at: '2024-01-15T11:00:00Z',
            pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',
            collected_at: '2024-01-15T11:05:00Z',
            date_partition: '2024-01',
        },
    ];
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
        // S3Client.send のモック
        client_s3_1.S3Client.prototype.send = jest.fn().mockResolvedValue({});
    });
    describe('JSON形式のエクスポート', () => {
        it('JSON形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
            expect(client_s3_1.S3Client.prototype.send).toHaveBeenCalledWith(expect.objectContaining({
                input: expect.objectContaining({
                    Bucket: 'test-exports-bucket',
                    Key: s3_key,
                    ContentType: 'application/json',
                    Tagging: 'auto-delete=true',
                }),
            }));
        });
        it('JSONに件数とデータが含まれる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const parsed = JSON.parse(body);
            expect(parsed).toHaveProperty('count', 2);
            expect(parsed).toHaveProperty('disclosures');
            expect(parsed.disclosures).toHaveLength(2);
            expect(parsed.disclosures[0]).toEqual(mockDisclosures[0]);
        });
    });
    describe('CSV形式のエクスポート', () => {
        it('CSV形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.csv$/);
            expect(client_s3_1.S3Client.prototype.send).toHaveBeenCalledWith(expect.objectContaining({
                input: expect.objectContaining({
                    Bucket: 'test-exports-bucket',
                    Key: s3_key,
                    ContentType: 'text/csv',
                    Tagging: 'auto-delete=true',
                }),
            }));
        });
        it('CSVヘッダーが正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            expect(lines[0]).toBe('disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,s3_key,collected_at,date_partition');
        });
        it('CSVデータ行が正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toBe('20240115_1234_001,1234,テスト株式会社,決算短信,2024年3月期 第3四半期決算短信,2024-01-15T10:30:00Z,https://example.com/pdf/20240115_1234_001.pdf,pdfs/2024/01/15/20240115_1234_001.pdf,2024-01-15T10:35:00Z,2024-01');
            expect(lines[2]).toBe('20240115_5678_001,5678,サンプル株式会社,有価証券報告書,第50期有価証券報告書,2024-01-15T11:00:00Z,https://example.com/pdf/20240115_5678_001.pdf,pdfs/2024/01/15/20240115_5678_001.pdf,2024-01-15T11:05:00Z,2024-01');
        });
        it('カンマを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithComma = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル, カンマ含む',
                },
            ];
            const export_id = 'export_1705305600000_ghi789_11111111';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithComma, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル, カンマ含む"');
        });
        it('ダブルクォートを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithQuote = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル"引用符"含む',
                },
            ];
            const export_id = 'export_1705305600000_jkl012_22222222';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithQuote, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル""引用符""含む"');
        });
        it('改行を含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithNewline = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル\n改行含む',
                },
            ];
            const export_id = 'export_1705305600000_mno345_33333333';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithNewline, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            const body = sendCall.input.Body;
            const lines = body.split('\n');
            // 改行を含む値はダブルクォートで囲まれる
            expect(lines[1]).toContain('"タイトル\n改行含む"');
        });
    });
    describe('S3キー生成', () => {
        it('S3キーが正しいフォーマットで生成される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            // フォーマット: exports/YYYY/MM/DD/export_id.format
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
        });
    });
    describe('ライフサイクルポリシー', () => {
        it('auto-deleteタグが設定される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendCall = client_s3_1.S3Client.prototype.send.mock.calls[0][0];
            expect(sendCall.input.Tagging).toBe('auto-delete=true');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFNSCxNQUFNO0FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQU5oQyxrREFBNkM7QUFFN0Msa0RBQWdFO0FBTWhFLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLE1BQU0sZUFBZSxHQUFpQjtRQUNwQztZQUNFLGFBQWEsRUFBRSxtQkFBbUI7WUFDbEMsWUFBWSxFQUFFLE1BQU07WUFDcEIsWUFBWSxFQUFFLFNBQVM7WUFDdkIsZUFBZSxFQUFFLE1BQU07WUFDdkIsS0FBSyxFQUFFLG9CQUFvQjtZQUMzQixZQUFZLEVBQUUsc0JBQXNCO1lBQ3BDLE9BQU8sRUFBRSwrQ0FBK0M7WUFDeEQsTUFBTSxFQUFFLHVDQUF1QztZQUMvQyxZQUFZLEVBQUUsc0JBQXNCO1lBQ3BDLGNBQWMsRUFBRSxTQUFTO1NBQzFCO1FBQ0Q7WUFDRSxhQUFhLEVBQUUsbUJBQW1CO1lBQ2xDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLFlBQVksRUFBRSxVQUFVO1lBQ3hCLGVBQWUsRUFBRSxTQUFTO1lBQzFCLEtBQUssRUFBRSxhQUFhO1lBQ3BCLFlBQVksRUFBRSxzQkFBc0I7WUFDcEMsT0FBTyxFQUFFLCtDQUErQztZQUN4RCxNQUFNLEVBQUUsdUNBQXVDO1lBQy9DLFlBQVksRUFBRSxzQkFBc0I7WUFDcEMsY0FBYyxFQUFFLFNBQVM7U0FDMUI7S0FDRixDQUFDO0lBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDO1FBQ3ZELE9B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LElBQUksRUFBRTtZQUNuQyxVQUFVO1lBQ1YsTUFBTSxTQUFTLEdBQUcsc0NBQXNDLENBQUM7WUFDekQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBRXRCLE1BQU07WUFDTixNQUFNLElBQUEseUJBQVUsRUFBQyxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXJELFNBQVM7WUFDVCxNQUFNLFFBQVEsR0FBSSxvQkFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFrQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcbGFtYmRhXFxleHBvcnRcXF9fdGVzdHNfX1xcZXhwb3J0LXRvLXMzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEV4cG9ydCB0byBTMyBVbml0IFRlc3RzXHJcbiAqXHJcbiAqIFJlcXVpcmVtZW50czog6KaB5Lu2MTQuMe+8iOODpuODi+ODg+ODiOODhuOCueODiO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGV4cG9ydFRvUzMgfSBmcm9tICcuLi9leHBvcnQtdG8tczMnO1xyXG5pbXBvcnQgeyBEaXNjbG9zdXJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBTM0NsaWVudCwgUHV0T2JqZWN0Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcblxyXG4vLyDjg6Ljg4Pjgq9cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnKTtcclxuamVzdC5tb2NrKCcuLi8uLi91dGlscy9sb2dnZXInKTtcclxuXHJcbmRlc2NyaWJlKCdleHBvcnRUb1MzJywgKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tEaXNjbG9zdXJlczogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAge1xyXG4gICAgICBkaXNjbG9zdXJlX2lkOiAnMjAyNDAxMTVfMTIzNF8wMDEnLFxyXG4gICAgICBjb21wYW55X2NvZGU6ICcxMjM0JyxcclxuICAgICAgY29tcGFueV9uYW1lOiAn44OG44K544OI5qCq5byP5Lya56S+JyxcclxuICAgICAgZGlzY2xvc3VyZV90eXBlOiAn5rG6566X55+t5L+hJyxcclxuICAgICAgdGl0bGU6ICcyMDI05bm0M+aciOacnyDnrKwz5Zub5Y2K5pyf5rG6566X55+t5L+hJyxcclxuICAgICAgZGlzY2xvc2VkX2F0OiAnMjAyNC0wMS0xNVQxMDozMDowMFonLFxyXG4gICAgICBwZGZfdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfMTIzNF8wMDEucGRmJyxcclxuICAgICAgczNfa2V5OiAncGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgIGNvbGxlY3RlZF9hdDogJzIwMjQtMDEtMTVUMTA6MzU6MDBaJyxcclxuICAgICAgZGF0ZV9wYXJ0aXRpb246ICcyMDI0LTAxJyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGRpc2Nsb3N1cmVfaWQ6ICcyMDI0MDExNV81Njc4XzAwMScsXHJcbiAgICAgIGNvbXBhbnlfY29kZTogJzU2NzgnLFxyXG4gICAgICBjb21wYW55X25hbWU6ICfjgrXjg7Pjg5fjg6vmoKrlvI/kvJrnpL4nLFxyXG4gICAgICBkaXNjbG9zdXJlX3R5cGU6ICfmnInkvqHoqLzliLjloLHlkYrmm7gnLFxyXG4gICAgICB0aXRsZTogJ+esrDUw5pyf5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JyxcclxuICAgICAgZGlzY2xvc2VkX2F0OiAnMjAyNC0wMS0xNVQxMTowMDowMFonLFxyXG4gICAgICBwZGZfdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9wZGYvMjAyNDAxMTVfNTY3OF8wMDEucGRmJyxcclxuICAgICAgczNfa2V5OiAncGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzU2NzhfMDAxLnBkZicsXHJcbiAgICAgIGNvbGxlY3RlZF9hdDogJzIwMjQtMDEtMTVUMTE6MDU6MDBaJyxcclxuICAgICAgZGF0ZV9wYXJ0aXRpb246ICcyMDI0LTAxJyxcclxuICAgIH0sXHJcbiAgXTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIHByb2Nlc3MuZW52LkVYUE9SVF9CVUNLRVRfTkFNRSA9ICd0ZXN0LWV4cG9ydHMtYnVja2V0JztcclxuICAgIHByb2Nlc3MuZW52LkFXU19SRUdJT04gPSAnYXAtbm9ydGhlYXN0LTEnO1xyXG5cclxuICAgIC8vIFMzQ2xpZW50LnNlbmQg44Gu44Oi44OD44KvXHJcbiAgICAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdKU09O5b2i5byP44Gu44Ko44Kv44K544Od44O844OIJywgKCkgPT4ge1xyXG4gICAgaXQoJ0pTT07lvaLlvI/jgadTM+OBq+OCqOOCr+OCueODneODvOODiOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHMzX2tleSkudG9NYXRjaCgvXmV4cG9ydHNcXC9cXGR7NH1cXC9cXGR7Mn1cXC9cXGR7Mn1cXC9leHBvcnRfXFxkK19bYS16MC05XStfW2EtejAtOV0rXFwuanNvbiQvKTtcclxuICAgICAgZXhwZWN0KFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICBpbnB1dDogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBCdWNrZXQ6ICd0ZXN0LWV4cG9ydHMtYnVja2V0JyxcclxuICAgICAgICAgICAgS2V5OiBzM19rZXksXHJcbiAgICAgICAgICAgIENvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgIFRhZ2dpbmc6ICdhdXRvLWRlbGV0ZT10cnVlJyxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnSlNPTuOBq+S7tuaVsOOBqOODh+ODvOOCv+OBjOWQq+OBvuOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShib2R5KTtcclxuXHJcbiAgICAgIGV4cGVjdChwYXJzZWQpLnRvSGF2ZVByb3BlcnR5KCdjb3VudCcsIDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkKS50b0hhdmVQcm9wZXJ0eSgnZGlzY2xvc3VyZXMnKTtcclxuICAgICAgZXhwZWN0KHBhcnNlZC5kaXNjbG9zdXJlcykudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgICBleHBlY3QocGFyc2VkLmRpc2Nsb3N1cmVzWzBdKS50b0VxdWFsKG1vY2tEaXNjbG9zdXJlc1swXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NTVuW9ouW8j+OBruOCqOOCr+OCueODneODvOODiCcsICgpID0+IHtcclxuICAgIGl0KCdDU1blvaLlvI/jgadTM+OBq+OCqOOCr+OCueODneODvOODiOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5jc3YkLyk7XHJcbiAgICAgIGV4cGVjdChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgaW5wdXQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgQnVja2V0OiAndGVzdC1leHBvcnRzLWJ1Y2tldCcsXHJcbiAgICAgICAgICAgIEtleTogczNfa2V5LFxyXG4gICAgICAgICAgICBDb250ZW50VHlwZTogJ3RleHQvY3N2JyxcclxuICAgICAgICAgICAgVGFnZ2luZzogJ2F1dG8tZGVsZXRlPXRydWUnLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdDU1bjg5jjg4Pjg4Djg7zjgYzmraPjgZfjgY/lh7rlipvjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2RlZjQ1Nl84NzY1NDMyMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1swXSkudG9CZShcclxuICAgICAgICAnZGlzY2xvc3VyZV9pZCxjb21wYW55X2NvZGUsY29tcGFueV9uYW1lLGRpc2Nsb3N1cmVfdHlwZSx0aXRsZSxkaXNjbG9zZWRfYXQscGRmX3VybCxzM19rZXksY29sbGVjdGVkX2F0LGRhdGVfcGFydGl0aW9uJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0NTVuODh+ODvOOCv+ihjOOBjOato+OBl+OBj+WHuuWKm+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBzZW5kQ2FsbCA9IChTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBzZW5kQ2FsbC5pbnB1dC5Cb2R5O1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgZXhwZWN0KGxpbmVzWzFdKS50b0JlKFxyXG4gICAgICAgICcyMDI0MDExNV8xMjM0XzAwMSwxMjM0LOODhuOCueODiOagquW8j+S8muekvizmsbrnrpfnn63kv6EsMjAyNOW5tDPmnIjmnJ8g56ysM+Wbm+WNiuacn+axuueul+efreS/oSwyMDI0LTAxLTE1VDEwOjMwOjAwWixodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV8xMjM0XzAwMS5wZGYscGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzEyMzRfMDAxLnBkZiwyMDI0LTAxLTE1VDEwOjM1OjAwWiwyMDI0LTAxJ1xyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobGluZXNbMl0pLnRvQmUoXHJcbiAgICAgICAgJzIwMjQwMTE1XzU2NzhfMDAxLDU2Nzgs44K144Oz44OX44Or5qCq5byP5Lya56S+LOacieS+oeiovOWIuOWgseWRiuabuCznrKw1MOacn+acieS+oeiovOWIuOWgseWRiuabuCwyMDI0LTAxLTE1VDExOjAwOjAwWixodHRwczovL2V4YW1wbGUuY29tL3BkZi8yMDI0MDExNV81Njc4XzAwMS5wZGYscGRmcy8yMDI0LzAxLzE1LzIwMjQwMTE1XzU2NzhfMDAxLnBkZiwyMDI0LTAxLTE1VDExOjA1OjAwWiwyMDI0LTAxJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+OCq+ODs+ODnuOCkuWQq+OCgOWApOOBjOato+OBl+OBj+OCqOOCueOCseODvOODl+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkaXNjbG9zdXJlc1dpdGhDb21tYTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrLCDjgqvjg7Pjg57lkKvjgoAnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9naGk3ODlfMTExMTExMTEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgZGlzY2xvc3VyZXNXaXRoQ29tbWEsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODqywg44Kr44Oz44Oe5ZCr44KAXCInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjg4Djg5bjg6vjgq/jgqnjg7zjg4jjgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoUXVvdGU6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5tb2NrRGlzY2xvc3VyZXNbMF0sXHJcbiAgICAgICAgICB0aXRsZTogJ+OCv+OCpOODiOODq1wi5byV55So56ymXCLlkKvjgoAnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9qa2wwMTJfMjIyMjIyMjInO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgZGlzY2xvc3VyZXNXaXRoUXVvdGUsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODq1wiXCLlvJXnlKjnrKZcIlwi5ZCr44KAXCInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmlLnooYzjgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoTmV3bGluZTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrXFxu5pS56KGM5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfbW5vMzQ1XzMzMzMzMzMzJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aE5ld2xpbmUsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZENhbGwgPSAoUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBjb25zdCBib2R5ID0gc2VuZENhbGwuaW5wdXQuQm9keTtcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIC8vIOaUueihjOOCkuWQq+OCgOWApOOBr+ODgOODluODq+OCr+OCqeODvOODiOOBp+WbsuOBvuOCjOOCi1xyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6tcXG7mlLnooYzlkKvjgoBcIicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTM+OCreODvOeUn+aIkCcsICgpID0+IHtcclxuICAgIGl0KCdTM+OCreODvOOBjOato+OBl+OBhOODleOCqeODvOODnuODg+ODiOOBp+eUn+aIkOOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHMzX2tleSA9IGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgLy8g44OV44Kp44O844Oe44OD44OIOiBleHBvcnRzL1lZWVkvTU0vREQvZXhwb3J0X2lkLmZvcm1hdFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfjg6njgqTjg5XjgrXjgqTjgq/jg6vjg53jg6rjgrfjg7wnLCAoKSA9PiB7XHJcbiAgICBpdCgnYXV0by1kZWxldGXjgr/jgrDjgYzoqK3lrprjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2FiYzEyM18xMjM0NTY3OCc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdqc29uJztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IHNlbmRDYWxsID0gKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHNlbmRDYWxsLmlucHV0LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9