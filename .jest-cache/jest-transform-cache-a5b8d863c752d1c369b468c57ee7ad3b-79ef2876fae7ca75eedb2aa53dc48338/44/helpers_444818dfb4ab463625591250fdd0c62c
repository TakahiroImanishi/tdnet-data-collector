4fbbd233e9798ca989326721aca119dc
"use strict";
/**
 * Test Helpers for Lambda Collector
 *
 * テスト環境でのモック設定を簡素化するヘルパー関数。
 *
 * Requirements: テスト環境の整備（Task 9.4）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockRateLimiter = exports.cloudWatchMock = exports.s3Mock = exports.dynamoMock = void 0;
exports.setupTestDependencies = setupTestDependencies;
exports.cleanupTestDependencies = cleanupTestDependencies;
exports.mockGetDisclosure = mockGetDisclosure;
exports.mockPutDisclosure = mockPutDisclosure;
exports.mockUpdateExecutionStatus = mockUpdateExecutionStatus;
exports.mockPutPdf = mockPutPdf;
exports.mockGetPdf = mockGetPdf;
exports.mockPutMetrics = mockPutMetrics;
const aws_sdk_client_mock_1 = require("aws-sdk-client-mock");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const client_s3_1 = require("@aws-sdk/client-s3");
const client_cloudwatch_1 = require("@aws-sdk/client-cloudwatch");
const rate_limiter_1 = require("../../../utils/rate-limiter");
const dependencies_1 = require("../dependencies");
/**
 * AWS SDKモッククライアント
 */
exports.dynamoMock = (0, aws_sdk_client_mock_1.mockClient)(lib_dynamodb_1.DynamoDBDocumentClient);
exports.s3Mock = (0, aws_sdk_client_mock_1.mockClient)(client_s3_1.S3Client);
exports.cloudWatchMock = (0, aws_sdk_client_mock_1.mockClient)(client_cloudwatch_1.CloudWatchClient);
/**
 * RateLimiterモック
 */
class MockRateLimiter extends rate_limiter_1.RateLimiter {
    constructor() {
        super(0); // 遅延なし
    }
    async waitIfNeeded() {
        // テスト環境では遅延なし
        return Promise.resolve();
    }
}
exports.MockRateLimiter = MockRateLimiter;
/**
 * テスト用の依存関係をセットアップ
 *
 * beforeEach()で呼び出して、モックを注入する。
 *
 * @returns CollectorDependencies
 */
function setupTestDependencies() {
    // モックをリセット
    exports.dynamoMock.reset();
    exports.s3Mock.reset();
    exports.cloudWatchMock.reset();
    // デフォルトのモック動作を設定
    exports.dynamoMock.on(lib_dynamodb_1.PutCommand).resolves({});
    exports.dynamoMock.on(lib_dynamodb_1.GetCommand).resolves({ Item: undefined });
    exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).resolves({});
    exports.dynamoMock.on(lib_dynamodb_1.QueryCommand).resolves({ Items: [] });
    exports.s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
    exports.s3Mock.on(client_s3_1.GetObjectCommand).resolves({
        Body: Buffer.from('mock pdf content'),
    });
    exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).resolves({});
    // モック依存関係を作成
    const deps = {
        dynamoClient: exports.dynamoMock,
        s3Client: exports.s3Mock,
        cloudWatchClient: exports.cloudWatchMock,
        rateLimiter: new MockRateLimiter(),
    };
    // 依存関係を注入
    (0, dependencies_1.setDependencies)(deps);
    return deps;
}
/**
 * テスト用の依存関係をクリーンアップ
 *
 * afterEach()で呼び出して、モックをリセットする。
 */
function cleanupTestDependencies() {
    exports.dynamoMock.reset();
    exports.s3Mock.reset();
    exports.cloudWatchMock.reset();
    (0, dependencies_1.resetDependencies)();
}
/**
 * DynamoDBモックの設定: 開示情報の取得
 *
 * @param disclosureId 開示ID
 * @param item 返却するアイテム
 */
function mockGetDisclosure(disclosureId, item) {
    exports.dynamoMock.on(lib_dynamodb_1.GetCommand, {
        TableName: process.env.DYNAMODB_TABLE,
        Key: { disclosure_id: disclosureId },
    }).resolves({ Item: item });
}
/**
 * DynamoDBモックの設定: 開示情報の保存
 *
 * @param success 成功するかどうか
 */
function mockPutDisclosure(success = true) {
    if (success) {
        exports.dynamoMock.on(lib_dynamodb_1.PutCommand).resolves({});
    }
    else {
        exports.dynamoMock.on(lib_dynamodb_1.PutCommand).rejects(new Error('DynamoDB PutItem failed'));
    }
}
/**
 * DynamoDBモックの設定: 実行状態の更新
 *
 * @param success 成功するかどうか
 */
function mockUpdateExecutionStatus(success = true) {
    if (success) {
        exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).resolves({});
    }
    else {
        exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).rejects(new Error('DynamoDB UpdateItem failed'));
    }
}
/**
 * S3モックの設定: PDFアップロード
 *
 * @param success 成功するかどうか
 */
function mockPutPdf(success = true) {
    if (success) {
        exports.s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
    }
    else {
        exports.s3Mock.on(client_s3_1.PutObjectCommand).rejects(new Error('S3 PutObject failed'));
    }
}
/**
 * S3モックの設定: PDFダウンロード
 *
 * @param content PDFコンテンツ
 */
function mockGetPdf(content = Buffer.from('mock pdf content')) {
    exports.s3Mock.on(client_s3_1.GetObjectCommand).resolves({
        Body: content,
    });
}
/**
 * CloudWatchモックの設定: メトリクス送信
 *
 * @param success 成功するかどうか
 */
function mockPutMetrics(success = true) {
    if (success) {
        exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).resolves({});
    }
    else {
        exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).rejects(new Error('CloudWatch PutMetricData failed'));
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3RvclxcX190ZXN0c19fXFxoZWxwZXJzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQXFDSCxzREErQkM7QUFPRCwwREFLQztBQVFELDhDQUtDO0FBT0QsOENBTUM7QUFPRCw4REFNQztBQU9ELGdDQU1DO0FBT0QsZ0NBSUM7QUFPRCx3Q0FNQztBQTFKRCw2REFBaUQ7QUFDakQsd0RBQW9IO0FBQ3BILGtEQUFrRjtBQUNsRixrRUFBb0Y7QUFDcEYsOERBQTBEO0FBQzFELGtEQUE0RjtBQUU1Rjs7R0FFRztBQUNVLFFBQUEsVUFBVSxHQUFHLElBQUEsZ0NBQVUsRUFBQyxxQ0FBc0IsQ0FBQyxDQUFDO0FBQ2hELFFBQUEsTUFBTSxHQUFHLElBQUEsZ0NBQVUsRUFBQyxvQkFBUSxDQUFDLENBQUM7QUFDOUIsUUFBQSxjQUFjLEdBQUcsSUFBQSxnQ0FBVSxFQUFDLG9DQUFnQixDQUFDLENBQUM7QUFFM0Q7O0dBRUc7QUFDSCxNQUFhLGVBQWdCLFNBQVEsMEJBQVc7SUFDOUM7UUFDRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPO0lBQ25CLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNoQixjQUFjO1FBQ2QsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDM0IsQ0FBQztDQUNGO0FBVEQsMENBU0M7QUFFRDs7Ozs7O0dBTUc7QUFDSCxTQUFnQixxQkFBcUI7SUFDbkMsV0FBVztJQUNYLGtCQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbkIsY0FBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2Ysc0JBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUV2QixpQkFBaUI7SUFDakIsa0JBQVUsQ0FBQyxFQUFFLENBQUMseUJBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN2QyxrQkFBVSxDQUFDLEVBQUUs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Q0FBQztRQUNOLGNBQU0sQ0FBQyxFQUFFLENBQUMsNEJBQWdCLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7QUFDSCxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLFVBQVUsQ0FBQyxVQUFrQixNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDO0lBQzFFLGNBQU0sQ0FBQyxFQUFFLENBQUMsNEJBQWdCLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDbkMsSUFBSSxFQUFFLE9BQU87S0FDUCxDQUFDLENBQUM7QUFDWixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLGNBQWMsQ0FBQyxVQUFtQixJQUFJO0lBQ3BELElBQUksT0FBTyxFQUFFLENBQUM7UUFDWixzQkFBYyxDQUFDLEVBQUUsQ0FBQyx3Q0FBb0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN2RCxDQUFDO1NBQU0sQ0FBQztRQUNOLHNCQUFjLENBQUMsRUFBRSxDQUFDLHdDQUFvQixDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUMsQ0FBQztJQUNoRyxDQUFDO0FBQ0gsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpMTk4XFxpbnZlc3RtZW50X2FuYWx5c2lzX29wb3BvXFxzcmNcXGxhbWJkYVxcY29sbGVjdG9yXFxfX3Rlc3RzX19cXGhlbHBlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRlc3QgSGVscGVycyBmb3IgTGFtYmRhIENvbGxlY3RvclxyXG4gKlxyXG4gKiDjg4bjgrnjg4jnkrDlooPjgafjga7jg6Ljg4Pjgq/oqK3lrprjgpLnsKHntKDljJbjgZnjgovjg5jjg6vjg5Hjg7zplqLmlbDjgIJcclxuICpcclxuICogUmVxdWlyZW1lbnRzOiDjg4bjgrnjg4jnkrDlooPjga7mlbTlgpnvvIhUYXNrIDkuNO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IG1vY2tDbGllbnQgfSBmcm9tICdhd3Mtc2RrLWNsaWVudC1tb2NrJztcclxuaW1wb3J0IHsgRHluYW1vREJEb2N1bWVudENsaWVudCwgUHV0Q29tbWFuZCwgR2V0Q29tbWFuZCwgVXBkYXRlQ29tbWFuZCwgUXVlcnlDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvbGliLWR5bmFtb2RiJztcclxuaW1wb3J0IHsgUzNDbGllbnQsIFB1dE9iamVjdENvbW1hbmQsIEdldE9iamVjdENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xyXG5pbXBvcnQgeyBDbG91ZFdhdGNoQ2xpZW50LCBQdXRNZXRyaWNEYXRhQ29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZHdhdGNoJztcclxuaW1wb3J0IHsgUmF0ZUxpbWl0ZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9yYXRlLWxpbWl0ZXInO1xyXG5pbXBvcnQgeyBDb2xsZWN0b3JEZXBlbmRlbmNpZXMsIHNldERlcGVuZGVuY2llcywgcmVzZXREZXBlbmRlbmNpZXMgfSBmcm9tICcuLi9kZXBlbmRlbmNpZXMnO1xyXG5cclxuLyoqXHJcbiAqIEFXUyBTREvjg6Ljg4Pjgq/jgq/jg6njgqTjgqLjg7Pjg4hcclxuICovXHJcbmV4cG9ydCBjb25zdCBkeW5hbW9Nb2NrID0gbW9ja0NsaWVudChEeW5hbW9EQkRvY3VtZW50Q2xpZW50KTtcclxuZXhwb3J0IGNvbnN0IHMzTW9jayA9IG1vY2tDbGllbnQoUzNDbGllbnQpO1xyXG5leHBvcnQgY29uc3QgY2xvdWRXYXRjaE1vY2sgPSBtb2NrQ2xpZW50KENsb3VkV2F0Y2hDbGllbnQpO1xyXG5cclxuLyoqXHJcbiAqIFJhdGVMaW1pdGVy44Oi44OD44KvXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTW9ja1JhdGVMaW1pdGVyIGV4dGVuZHMgUmF0ZUxpbWl0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoMCk7IC8vIOmBheW7tuOBquOBl1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgd2FpdElmTmVlZGVkKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8g44OG44K544OI55Kw5aKD44Gn44Gv6YGF5bu244Gq44GXXHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog44OG44K544OI55So44Gu5L6d5a2Y6Zai5L+C44KS44K744OD44OI44Ki44OD44OXXHJcbiAqXHJcbiAqIGJlZm9yZUVhY2goKeOBp+WRvOOBs+WHuuOBl+OBpuOAgeODouODg+OCr+OCkuazqOWFpeOBmeOCi+OAglxyXG4gKlxyXG4gKiBAcmV0dXJucyBDb2xsZWN0b3JEZXBlbmRlbmNpZXNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXR1cFRlc3REZXBlbmRlbmNpZXMoKTogQ29sbGVjdG9yRGVwZW5kZW5jaWVzIHtcclxuICAvLyDjg6Ljg4Pjgq/jgpLjg6rjgrvjg4Pjg4hcclxuICBkeW5hbW9Nb2NrLnJlc2V0KCk7XHJcbiAgczNNb2NrLnJlc2V0KCk7XHJcbiAgY2xvdWRXYXRjaE1vY2sucmVzZXQoKTtcclxuXHJcbiAgLy8g44OH44OV44Kp44Or44OI44Gu44Oi44OD44Kv5YuV5L2c44KS6Kit5a6aXHJcbiAgZHluYW1vTW9jay5vbihQdXRDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgZHluYW1vTW9jay5vbihHZXRDb21tYW5kKS5yZXNvbHZlcyh7IEl0ZW06IHVuZGVmaW5lZCB9KTtcclxuICBkeW5hbW9Nb2NrLm9uKFVwZGF0ZUNvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuICBkeW5hbW9Nb2NrLm9uKFF1ZXJ5Q29tbWFuZCkucmVzb2x2ZXMoeyBJdGVtczogW10gfSk7XHJcblxyXG4gIHMzTW9jay5vbihQdXRPYmplY3RDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgczNNb2NrLm9uKEdldE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHtcclxuICAgIEJvZHk6IEJ1ZmZlci5mcm9tKCdtb2NrIHBkZiBjb250ZW50JyksXHJcbiAgfSBhcyBhbnkpO1xyXG5cclxuICBjbG91ZFdhdGNoTW9jay5vbihQdXRNZXRyaWNEYXRhQ29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG5cclxuICAvLyDjg6Ljg4Pjgq/kvp3lrZjplqLkv4LjgpLkvZzmiJBcclxuICBjb25zdCBkZXBzOiBDb2xsZWN0b3JEZXBlbmRlbmNpZXMgPSB7XHJcbiAgICBkeW5hbW9DbGllbnQ6IGR5bmFtb01vY2sgYXMgYW55LFxyXG4gICAgczNDbGllbnQ6IHMzTW9jayBhcyBhbnksXHJcbiAgICBjbG91ZFdhdGNoQ2xpZW50OiBjbG91ZFdhdGNoTW9jayBhcyBhbnksXHJcbiAgICByYXRlTGltaXRlcjogbmV3IE1vY2tSYXRlTGltaXRlcigpLFxyXG4gIH07XHJcblxyXG4gIC8vIOS+neWtmOmWouS/guOCkuazqOWFpVxyXG4gIHNldERlcGVuZGVuY2llcyhkZXBzKTtcclxuXHJcbiAgcmV0dXJuIGRlcHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDjg4bjgrnjg4jnlKjjga7kvp3lrZjplqLkv4LjgpLjgq/jg6rjg7zjg7PjgqLjg4Pjg5dcclxuICpcclxuICogYWZ0ZXJFYWNoKCnjgaflkbzjgbPlh7rjgZfjgabjgIHjg6Ljg4Pjgq/jgpLjg6rjgrvjg4Pjg4jjgZnjgovjgIJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhbnVwVGVzdERlcGVuZGVuY2llcygpOiB2b2lkIHtcclxuICBkeW5hbW9Nb2NrLnJlc2V0KCk7XHJcbiAgczNNb2NrLnJlc2V0KCk7XHJcbiAgY2xvdWRXYXRjaE1vY2sucmVzZXQoKTtcclxuICByZXNldERlcGVuZGVuY2llcygpO1xyXG59XHJcblxyXG4vKipcclxuICogRHluYW1vRELjg6Ljg4Pjgq/jga7oqK3lrpo6IOmWi+ekuuaDheWgseOBruWPluW+l1xyXG4gKlxyXG4gKiBAcGFyYW0gZGlzY2xvc3VyZUlkIOmWi+ekuklEXHJcbiAqIEBwYXJhbSBpdGVtIOi/lOWNtOOBmeOCi+OCouOCpOODhuODoFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1vY2tHZXREaXNjbG9zdXJlKGRpc2Nsb3N1cmVJZDogc3RyaW5nLCBpdGVtOiBhbnkpOiB2b2lkIHtcclxuICBkeW5hbW9Nb2NrLm9uKEdldENvbW1hbmQsIHtcclxuICAgIFRhYmxlTmFtZTogcHJvY2Vzcy5lbnYuRFlOQU1PREJfVEFCTEUsXHJcbiAgICBLZXk6IHsgZGlzY2xvc3VyZV9pZDogZGlzY2xvc3VyZUlkIH0sXHJcbiAgfSkucmVzb2x2ZXMoeyBJdGVtOiBpdGVtIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRHluYW1vRELjg6Ljg4Pjgq/jga7oqK3lrpo6IOmWi+ekuuaDheWgseOBruS/neWtmFxyXG4gKlxyXG4gKiBAcGFyYW0gc3VjY2VzcyDmiJDlip/jgZnjgovjgYvjganjgYbjgYtcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2NrUHV0RGlzY2xvc3VyZShzdWNjZXNzOiBib29sZWFuID0gdHJ1ZSk6IHZvaWQge1xyXG4gIGlmIChzdWNjZXNzKSB7XHJcbiAgICBkeW5hbW9Nb2NrLm9uKFB1dENvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgZHluYW1vTW9jay5vbihQdXRDb21tYW5kKS5yZWplY3RzKG5ldyBFcnJvcignRHluYW1vREIgUHV0SXRlbSBmYWlsZWQnKSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRHluYW1vRELjg6Ljg4Pjgq/jga7oqK3lrpo6IOWun+ihjOeKtuaFi+OBruabtOaWsFxyXG4gKlxyXG4gKiBAcGFyYW0gc3VjY2VzcyDmiJDlip/jgZnjgovjgYvjganjgYbjgYtcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2NrVXBkYXRlRXhlY3V0aW9uU3RhdHVzKHN1Y2Nlc3M6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XHJcbiAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgIGR5bmFtb01vY2sub24oVXBkYXRlQ29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkeW5hbW9Nb2NrLm9uKFVwZGF0ZUNvbW1hbmQpLnJlamVjdHMobmV3IEVycm9yKCdEeW5hbW9EQiBVcGRhdGVJdGVtIGZhaWxlZCcpKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTM+ODouODg+OCr+OBruioreWumjogUERG44Ki44OD44OX44Ot44O844OJXHJcbiAqXHJcbiAqIEBwYXJhbSBzdWNjZXNzIOaIkOWKn+OBmeOCi+OBi+OBqeOBhuOBi1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1vY2tQdXRQZGYoc3VjY2VzczogYm9vbGVhbiA9IHRydWUpOiB2b2lkIHtcclxuICBpZiAoc3VjY2Vzcykge1xyXG4gICAgczNNb2NrLm9uKFB1dE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgczNNb2NrLm9uKFB1dE9iamVjdENvbW1hbmQpLnJlamVjdHMobmV3IEVycm9yKCdTMyBQdXRPYmplY3QgZmFpbGVkJykpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFMz44Oi44OD44Kv44Gu6Kit5a6aOiBQREbjg4Djgqbjg7Pjg63jg7zjg4lcclxuICpcclxuICogQHBhcmFtIGNvbnRlbnQgUERG44Kz44Oz44OG44Oz44OEXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbW9ja0dldFBkZihjb250ZW50OiBCdWZmZXIgPSBCdWZmZXIuZnJvbSgnbW9jayBwZGYgY29udGVudCcpKTogdm9pZCB7XHJcbiAgczNNb2NrLm9uKEdldE9iamVjdENvbW1hbmQpLnJlc29sdmVzKHtcclxuICAgIEJvZHk6IGNvbnRlbnQsXHJcbiAgfSBhcyBhbnkpO1xyXG59XHJcblxyXG4vKipcclxuICogQ2xvdWRXYXRjaOODouODg+OCr+OBruioreWumjog44Oh44OI44Oq44Kv44K56YCB5L+hXHJcbiAqXHJcbiAqIEBwYXJhbSBzdWNjZXNzIOaIkOWKn+OBmeOCi+OBi+OBqeOBhuOBi1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1vY2tQdXRNZXRyaWNzKHN1Y2Nlc3M6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XHJcbiAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgIGNsb3VkV2F0Y2hNb2NrLm9uKFB1dE1ldHJpY0RhdGFDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNsb3VkV2F0Y2hNb2NrLm9uKFB1dE1ldHJpY0RhdGFDb21tYW5kKS5yZWplY3RzKG5ldyBFcnJvcignQ2xvdWRXYXRjaCBQdXRNZXRyaWNEYXRhIGZhaWxlZCcpKTtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9