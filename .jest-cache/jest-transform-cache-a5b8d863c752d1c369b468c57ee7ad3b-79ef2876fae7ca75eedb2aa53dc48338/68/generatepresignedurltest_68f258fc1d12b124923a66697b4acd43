aeace9d47f77a52251f1a70f6dfa4520
"use strict";
/**
 * Generate Presigned URL Unit Tests
 *
 * Requirements: 要件4.4（PDFダウンロード）、要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック設定（importより前に定義）
jest.mock('@aws-sdk/s3-request-presigner', () => ({
    getSignedUrl: jest.fn(),
}));
jest.mock('@aws-sdk/client-s3', () => {
    const actualModule = jest.requireActual('@aws-sdk/client-s3');
    return {
        ...actualModule,
        S3Client: jest.fn().mockImplementation(() => ({})),
    };
});
jest.mock('../../../utils/logger');
const generate_presigned_url_1 = require("../generate-presigned-url");
const s3_request_presigner_1 = require("@aws-sdk/s3-request-presigner");
const client_s3_1 = require("@aws-sdk/client-s3");
const mockGetSignedUrl = s3_request_presigner_1.getSignedUrl;
describe('generatePresignedUrl', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('正常系', () => {
        it('S3署名付きURLを生成できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/2024/01/15/TD20240115001.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(1);
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.any(client_s3_1.GetObjectCommand), { expiresIn: 3600 });
        });
        it('GetObjectCommandに正しいパラメータが設定される', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Bucket).toBe('test-pdfs-bucket');
            expect(command.input.Key).toBe(s3Key);
        });
        it('カスタム有効期限を指定できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 7200; // 2時間
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 7200,
            });
        });
        it('デフォルト有効期限は3600秒（1時間）', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 3600,
            });
        });
    });
    describe('異常系', () => {
        it('S3エラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const s3Error = new Error('NoSuchKey');
            s3Error.name = 'NoSuchKey';
            mockGetSignedUrl.mockRejectedValue(s3Error);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('NoSuchKey');
        });
        it('AccessDeniedエラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const accessDeniedError = new Error('AccessDenied');
            accessDeniedError.name = 'AccessDenied';
            mockGetSignedUrl.mockRejectedValue(accessDeniedError);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('AccessDenied');
        });
        it('ネットワークエラーで失敗する', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const networkError = new Error('Network error');
            mockGetSignedUrl.mockRejectedValue(networkError);
            // Act & Assert
            await expect((0, generate_presigned_url_1.generatePresignedUrl)(s3Key)).rejects.toThrow('Network error');
        });
    });
    describe('エッジケース', () => {
        it('環境変数S3_BUCKET_NAMEが未設定の場合、デフォルト値を使用する', async () => {
            // Arrange
            delete process.env.S3_BUCKET_NAME;
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expectedUrl = 'https://tdnet-data-collector-pdfs.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Bucket).toBe('tdnet-data-collector-pdfs');
        });
        it('S3キーに日本語が含まれる場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/決算短信_TD20240115001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Key).toBe(s3Key);
        });
        it('S3キーにスペースが含まれる場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD 20240115 001.pdf';
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            const url = await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key);
            // Assert
            expect(url).toBe(expectedUrl);
            const command = mockGetSignedUrl.mock.calls[0][1];
            expect(command.input.Key).toBe(s3Key);
        });
        it('有効期限が0秒の場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 0;
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 0,
            });
        });
        it('有効期限が最大値（604800秒=7日）の場合も処理できる', async () => {
            // Arrange
            const s3Key = '2024/01/15/TD20240115001.pdf';
            const expiresIn = 604800; // 7日
            const expectedUrl = 'https://test-pdfs-bucket.s3.amazonaws.com/...';
            mockGetSignedUrl.mockResolvedValue(expectedUrl);
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrl)(s3Key, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledWith(expect.anything(), expect.anything(), {
                expiresIn: 604800,
            });
        });
    });
});
describe('generatePresignedUrls', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.S3_BUCKET_NAME = 'test-pdfs-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
    });
    describe('正常系', () => {
        it('複数のS3署名付きURLを一括生成できる', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
            ];
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(3);
            expect(urlMap.get(s3Keys[0])).toContain(s3Keys[0]);
            expect(urlMap.get(s3Keys[1])).toContain(s3Keys[1]);
            expect(urlMap.get(s3Keys[2])).toContain(s3Keys[2]);
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(3);
        });
        it('空配列の場合、空のMapを返す', async () => {
            // Arrange
            const s3Keys = [];
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(0);
            expect(mockGetSignedUrl).not.toHaveBeenCalled();
        });
        it('カスタム有効期限を指定できる', async () => {
            // Arrange
            const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];
            const expiresIn = 7200; // 2時間
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys, expiresIn);
            // Assert
            expect(mockGetSignedUrl).toHaveBeenCalledTimes(2);
            mockGetSignedUrl.mock.calls.forEach((call) => {
                expect(call[2]).toEqual({ expiresIn: 7200 });
            });
        });
    });
    describe('部分的失敗', () => {
        it('一部のURLが失敗しても、成功したURLは返す', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
            ];
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                const key = command.input.Key;
                if (key === s3Keys[1]) {
                    throw new Error('NoSuchKey');
                }
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(2);
            expect(urlMap.has(s3Keys[0])).toBe(true);
            expect(urlMap.has(s3Keys[1])).toBe(false); // 失敗したキーは含まれない
            expect(urlMap.has(s3Keys[2])).toBe(true);
        });
        it('全てのURLが失敗した場合、空のMapを返す', async () => {
            // Arrange
            const s3Keys = ['2024/01/15/TD20240115001.pdf', '2024/01/15/TD20240115002.pdf'];
            mockGetSignedUrl.mockRejectedValue(new Error('AccessDenied'));
            // Act
            const urlMap = await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(urlMap.size).toBe(0);
        });
    });
    describe('並行処理', () => {
        it('複数のURLを並行生成する', async () => {
            // Arrange
            const s3Keys = [
                '2024/01/15/TD20240115001.pdf',
                '2024/01/15/TD20240115002.pdf',
                '2024/01/16/TD20240116001.pdf',
                '2024/01/16/TD20240116002.pdf',
                '2024/01/17/TD20240117001.pdf',
            ];
            let concurrentCalls = 0;
            let maxConcurrentCalls = 0;
            mockGetSignedUrl.mockImplementation(async (client, command) => {
                concurrentCalls++;
                maxConcurrentCalls = Math.max(maxConcurrentCalls, concurrentCalls);
                // 非同期処理をシミュレート
                await new Promise((resolve) => setTimeout(resolve, 10));
                concurrentCalls--;
                const key = command.input.Key;
                return `https://test-pdfs-bucket.s3.amazonaws.com/${key}?X-Amz-...`;
            });
            // Act
            await (0, generate_presigned_url_1.generatePresignedUrls)(s3Keys);
            // Assert
            expect(maxConcurrentCalls).toBeGreaterThan(1); // 並行実行されている
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXHF1ZXJ5XFxfX3Rlc3RzX19cXGdlbmVyYXRlLXByZXNpZ25lZC11cmwudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFFSCxzQkFBc0I7QUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3hCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbkMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzlELE9BQU87UUFDTCxHQUFHLFlBQVk7UUFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDbkQsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRW5DLHNFQUF3RjtBQUN4Rix3RUFBNkQ7QUFDN0Qsa0RBQXNEO0FBRXRELE1BQU0sZ0JBQWdCLEdBQUcsbUNBQXdELENBQUM7QUFFbEYsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLGtCQUFrQixDQUFDO1FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLGdCQUFnQixDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLGlC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QUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUV4RCxlQUFlLEVBQUUsQ0FBQztnQkFDbEIsTUFBTSxHQUFHLEdBQUksT0FBNEIsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO2dCQUNwRCxPQUFPLDZDQUE2QyxHQUFHLFlBQVksQ0FBQztZQUN0RSxDQUFDLENBQUMsQ0FBQztZQUVILE1BQU07WUFDTixNQUFNLElBQUEsOENBQXFCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFcEMsU0FBUztZQUNULE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVk7UUFDN0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcbGFtYmRhXFxxdWVyeVxcX190ZXN0c19fXFxnZW5lcmF0ZS1wcmVzaWduZWQtdXJsLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEdlbmVyYXRlIFByZXNpZ25lZCBVUkwgVW5pdCBUZXN0c1xyXG4gKlxyXG4gKiBSZXF1aXJlbWVudHM6IOimgeS7tjQuNO+8iFBERuODgOOCpuODs+ODreODvOODie+8ieOAgeimgeS7tjE0LjHvvIjjg6bjg4vjg4Pjg4jjg4bjgrnjg4jvvIlcclxuICovXHJcblxyXG4vLyDjg6Ljg4Pjgq/oqK3lrprvvIhpbXBvcnTjgojjgorliY3jgavlrprnvqnvvIlcclxuamVzdC5tb2NrKCdAYXdzLXNkay9zMy1yZXF1ZXN0LXByZXNpZ25lcicsICgpID0+ICh7XHJcbiAgZ2V0U2lnbmVkVXJsOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LXMzJywgKCkgPT4ge1xyXG4gIGNvbnN0IGFjdHVhbE1vZHVsZSA9IGplc3QucmVxdWlyZUFjdHVhbCgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLmFjdHVhbE1vZHVsZSxcclxuICAgIFMzQ2xpZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7fSkpLFxyXG4gIH07XHJcbn0pO1xyXG5cclxuamVzdC5tb2NrKCcuLi8uLi8uLi91dGlscy9sb2dnZXInKTtcclxuXHJcbmltcG9ydCB7IGdlbmVyYXRlUHJlc2lnbmVkVXJsLCBnZW5lcmF0ZVByZXNpZ25lZFVybHMgfSBmcm9tICcuLi9nZW5lcmF0ZS1wcmVzaWduZWQtdXJsJztcclxuaW1wb3J0IHsgZ2V0U2lnbmVkVXJsIH0gZnJvbSAnQGF3cy1zZGsvczMtcmVxdWVzdC1wcmVzaWduZXInO1xyXG5pbXBvcnQgeyBHZXRPYmplY3RDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcclxuXHJcbmNvbnN0IG1vY2tHZXRTaWduZWRVcmwgPSBnZXRTaWduZWRVcmwgYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgZ2V0U2lnbmVkVXJsPjtcclxuXHJcbmRlc2NyaWJlKCdnZW5lcmF0ZVByZXNpZ25lZFVybCcsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgcHJvY2Vzcy5lbnYuUzNfQlVDS0VUX05BTUUgPSAndGVzdC1wZGZzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+ato+W4uOezuycsICgpID0+IHtcclxuICAgIGl0KCdTM+e9suWQjeS7mOOBjVVSTOOCkueUn+aIkOOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleSA9ICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPVxyXG4gICAgICAgICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8yMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9Li4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsKS50b0JlKGV4cGVjdGVkVXJsKTtcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpLFxyXG4gICAgICAgIGV4cGVjdC5hbnkoR2V0T2JqZWN0Q29tbWFuZCksXHJcbiAgICAgICAgeyBleHBpcmVzSW46IDM2MDAgfVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0dldE9iamVjdENvbW1hbmTjgavmraPjgZfjgYTjg5Hjg6njg6Hjg7zjgr/jgYzoqK3lrprjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gJ2h0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLy4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tHZXRTaWduZWRVcmwubW9jay5jYWxsc1swXVsxXSBhcyBHZXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5CdWNrZXQpLnRvQmUoJ3Rlc3QtcGRmcy1idWNrZXQnKTtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuS2V5KS50b0JlKHMzS2V5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjgqvjgrnjgr/jg6DmnInlirnmnJ/pmZDjgpLmjIflrprjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IDcyMDA7IC8vIDLmmYLplpNcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPSAnaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vLi4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5LCBleHBpcmVzSW4pO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55dGhpbmcoKSwgZXhwZWN0LmFueXRoaW5nKCksIHtcclxuICAgICAgICBleHBpcmVzSW46IDcyMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+ODh+ODleOCqeODq+ODiOacieWKueacn+mZkOOBrzM2MDDnp5LvvIgx5pmC6ZaT77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXkpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55dGhpbmcoKSwgZXhwZWN0LmFueXRoaW5nKCksIHtcclxuICAgICAgICBleHBpcmVzSW46IDM2MDAsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfnlbDluLjns7snLCAoKSA9PiB7XHJcbiAgICBpdCgnUzPjgqjjg6njg7zjgaflpLHmlZfjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IHMzRXJyb3IgPSBuZXcgRXJyb3IoJ05vU3VjaEtleScpO1xyXG4gICAgICBzM0Vycm9yLm5hbWUgPSAnTm9TdWNoS2V5JztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1JlamVjdGVkVmFsdWUoczNFcnJvcik7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KSkucmVqZWN0cy50b1Rocm93KCdOb1N1Y2hLZXknKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdBY2Nlc3NEZW5pZWTjgqjjg6njg7zjgaflpLHmlZfjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGFjY2Vzc0RlbmllZEVycm9yID0gbmV3IEVycm9yKCdBY2Nlc3NEZW5pZWQnKTtcclxuICAgICAgYWNjZXNzRGVuaWVkRXJyb3IubmFtZSA9ICdBY2Nlc3NEZW5pZWQnO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVqZWN0ZWRWYWx1ZShhY2Nlc3NEZW5pZWRFcnJvcik7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KSkucmVqZWN0cy50b1Rocm93KCdBY2Nlc3NEZW5pZWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfjg43jg4Pjg4jjg6/jg7zjgq/jgqjjg6njg7zjgaflpLHmlZfjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXR3b3JrRXJyb3IpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSkpLnJlamVjdHMudG9UaHJvdygnTmV0d29yayBlcnJvcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfjgqjjg4PjgrjjgrHjg7zjgrknLCAoKSA9PiB7XHJcbiAgICBpdCgn55Kw5aKD5aSJ5pWwUzNfQlVDS0VUX05BTUXjgYzmnKroqK3lrprjga7loLTlkIjjgIHjg4fjg5Xjgqnjg6vjg4jlgKTjgpLkvb/nlKjjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LlMzX0JVQ0tFVF9OQU1FO1xyXG4gICAgICBjb25zdCBzM0tleSA9ICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPSAnaHR0cHM6Ly90ZG5ldC1kYXRhLWNvbGxlY3Rvci1wZGZzLnMzLmFtYXpvbmF3cy5jb20vLi4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBjb21tYW5kID0gbW9ja0dldFNpZ25lZFVybC5tb2NrLmNhbGxzWzBdWzFdIGFzIEdldE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LkJ1Y2tldCkudG9CZSgndGRuZXQtZGF0YS1jb2xsZWN0b3ItcGRmcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ1Mz44Kt44O844Gr5pel5pys6Kqe44GM5ZCr44G+44KM44KL5aC05ZCI44KC5Yem55CG44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUv5rG6566X55+t5L+hX1REMjAyNDAxMTUwMDEucGRmJztcclxuICAgICAgY29uc3QgZXhwZWN0ZWRVcmwgPSAnaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vLi4uJztcclxuXHJcbiAgICAgIG1vY2tHZXRTaWduZWRVcmwubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcmwpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJsKHMzS2V5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsKS50b0JlKGV4cGVjdGVkVXJsKTtcclxuICAgICAgY29uc3QgY29tbWFuZCA9IG1vY2tHZXRTaWduZWRVcmwubW9jay5jYWxsc1swXVsxXSBhcyBHZXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5LZXkpLnRvQmUoczNLZXkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ1Mz44Kt44O844Gr44K544Oa44O844K544GM5ZCr44G+44KM44KL5aC05ZCI44KC5Yem55CG44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQgMjAyNDAxMTUgMDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gJ2h0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLy4uLic7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGVjdGVkVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCB1cmwgPSBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybChzM0tleSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHVybCkudG9CZShleHBlY3RlZFVybCk7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBtb2NrR2V0U2lnbmVkVXJsLm1vY2suY2FsbHNbMF1bMV0gYXMgR2V0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuS2V5KS50b0JlKHMzS2V5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmnInlirnmnJ/pmZDjgYww56eS44Gu5aC05ZCI44KC5Yem55CG44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5ID0gJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnO1xyXG4gICAgICBjb25zdCBleHBpcmVzSW4gPSAwO1xyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXksIGV4cGlyZXNJbik7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnl0aGluZygpLCBleHBlY3QuYW55dGhpbmcoKSwge1xyXG4gICAgICAgIGV4cGlyZXNJbjogMCxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5pyJ5Yq55pyf6ZmQ44GM5pyA5aSn5YCk77yINjA0ODAw56eSPTfml6XvvInjga7loLTlkIjjgoLlh6bnkIbjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXkgPSAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAxLnBkZic7XHJcbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IDYwNDgwMDsgLy8gN+aXpVxyXG4gICAgICBjb25zdCBleHBlY3RlZFVybCA9ICdodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8uLi4nO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVybCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmwoczNLZXksIGV4cGlyZXNJbik7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnl0aGluZygpLCBleHBlY3QuYW55dGhpbmcoKSwge1xyXG4gICAgICAgIGV4cGlyZXNJbjogNjA0ODAwLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdnZW5lcmF0ZVByZXNpZ25lZFVybHMnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIHByb2Nlc3MuZW52LlMzX0JVQ0tFVF9OQU1FID0gJ3Rlc3QtcGRmcy1idWNrZXQnO1xyXG4gICAgcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiA9ICdhcC1ub3J0aGVhc3QtMSc7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCfmraPluLjns7snLCAoKSA9PiB7XHJcbiAgICBpdCgn6KSH5pWw44GuUzPnvbLlkI3ku5jjgY1VUkzjgpLkuIDmi6znlJ/miJDjgafjgY3jgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXlzID0gW1xyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAyLnBkZicsXHJcbiAgICAgICAgJzIwMjQvMDEvMTYvVEQyMDI0MDExNjAwMS5wZGYnLFxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNsaWVudCwgY29tbWFuZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IChjb21tYW5kIGFzIEdldE9iamVjdENvbW1hbmQpLmlucHV0LktleTtcclxuICAgICAgICByZXR1cm4gYGh0dHBzOi8vdGVzdC1wZGZzLWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tLyR7a2V5fT9YLUFtei0uLi5gO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCB1cmxNYXAgPSBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybHMoczNLZXlzKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsTWFwLnNpemUpLnRvQmUoMyk7XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuZ2V0KHMzS2V5c1swXSkpLnRvQ29udGFpbihzM0tleXNbMF0pO1xyXG4gICAgICBleHBlY3QodXJsTWFwLmdldChzM0tleXNbMV0pKS50b0NvbnRhaW4oczNLZXlzWzFdKTtcclxuICAgICAgZXhwZWN0KHVybE1hcC5nZXQoczNLZXlzWzJdKSkudG9Db250YWluKHMzS2V5c1syXSk7XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn56m66YWN5YiX44Gu5aC05ZCI44CB56m644GuTWFw44KS6L+U44GZJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHMzS2V5czogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCB1cmxNYXAgPSBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybHMoczNLZXlzKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsTWFwLnNpemUpLnRvQmUoMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrR2V0U2lnbmVkVXJsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+OCq+OCueOCv+ODoOacieWKueacn+mZkOOCkuaMh+WumuOBp+OBjeOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleXMgPSBbJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnLCAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAyLnBkZiddO1xyXG4gICAgICBjb25zdCBleHBpcmVzSW4gPSA3MjAwOyAvLyAy5pmC6ZaTXHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2xpZW50LCBjb21tYW5kKSA9PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gKGNvbW1hbmQgYXMgR2V0T2JqZWN0Q29tbWFuZCkuaW5wdXQuS2V5O1xyXG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vJHtrZXl9P1gtQW16LS4uLmA7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJscyhzM0tleXMsIGV4cGlyZXNJbik7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tHZXRTaWduZWRVcmwpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrLmNhbGxzLmZvckVhY2goKGNhbGwpID0+IHtcclxuICAgICAgICBleHBlY3QoY2FsbFsyXSkudG9FcXVhbCh7IGV4cGlyZXNJbjogNzIwMCB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+mDqOWIhueahOWkseaVlycsICgpID0+IHtcclxuICAgIGl0KCfkuIDpg6jjga5VUkzjgYzlpLHmlZfjgZfjgabjgoLjgIHmiJDlip/jgZfjgZ9VUkzjga/ov5TjgZknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXlzID0gW1xyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAyLnBkZicsXHJcbiAgICAgICAgJzIwMjQvMDEvMTYvVEQyMDI0MDExNjAwMS5wZGYnLFxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNsaWVudCwgY29tbWFuZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IChjb21tYW5kIGFzIEdldE9iamVjdENvbW1hbmQpLmlucHV0LktleTtcclxuICAgICAgICBpZiAoa2V5ID09PSBzM0tleXNbMV0pIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm9TdWNoS2V5Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly90ZXN0LXBkZnMtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vJHtrZXl9P1gtQW16LS4uLmA7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHVybE1hcCA9IGF3YWl0IGdlbmVyYXRlUHJlc2lnbmVkVXJscyhzM0tleXMpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdCh1cmxNYXAuc2l6ZSkudG9CZSgyKTtcclxuICAgICAgZXhwZWN0KHVybE1hcC5oYXMoczNLZXlzWzBdKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHVybE1hcC5oYXMoczNLZXlzWzFdKSkudG9CZShmYWxzZSk7IC8vIOWkseaVl+OBl+OBn+OCreODvOOBr+WQq+OBvuOCjOOBquOBhFxyXG4gICAgICBleHBlY3QodXJsTWFwLmhhcyhzM0tleXNbMl0pKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+WFqOOBpuOBrlVSTOOBjOWkseaVl+OBl+OBn+WgtOWQiOOAgeepuuOBrk1hcOOCkui/lOOBmScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzM0tleXMgPSBbJzIwMjQvMDEvMTUvVEQyMDI0MDExNTAwMS5wZGYnLCAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAyLnBkZiddO1xyXG5cclxuICAgICAgbW9ja0dldFNpZ25lZFVybC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0FjY2Vzc0RlbmllZCcpKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCB1cmxNYXAgPSBhd2FpdCBnZW5lcmF0ZVByZXNpZ25lZFVybHMoczNLZXlzKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXJsTWFwLnNpemUpLnRvQmUoMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+S4puihjOWHpueQhicsICgpID0+IHtcclxuICAgIGl0KCfopIfmlbDjga5VUkzjgpLkuKbooYznlJ/miJDjgZnjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgczNLZXlzID0gW1xyXG4gICAgICAgICcyMDI0LzAxLzE1L1REMjAyNDAxMTUwMDEucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNS9URDIwMjQwMTE1MDAyLnBkZicsXHJcbiAgICAgICAgJzIwMjQvMDEvMTYvVEQyMDI0MDExNjAwMS5wZGYnLFxyXG4gICAgICAgICcyMDI0LzAxLzE2L1REMjAyNDAxMTYwMDIucGRmJyxcclxuICAgICAgICAnMjAyNC8wMS8xNy9URDIwMjQwMTE3MDAxLnBkZicsXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBsZXQgY29uY3VycmVudENhbGxzID0gMDtcclxuICAgICAgbGV0IG1heENvbmN1cnJlbnRDYWxscyA9IDA7XHJcblxyXG4gICAgICBtb2NrR2V0U2lnbmVkVXJsLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2xpZW50LCBjb21tYW5kKSA9PiB7XHJcbiAgICAgICAgY29uY3VycmVudENhbGxzKys7XHJcbiAgICAgICAgbWF4Q29uY3VycmVudENhbGxzID0gTWF0aC5tYXgobWF4Q29uY3VycmVudENhbGxzLCBjb25jdXJyZW50Q2FsbHMpO1xyXG5cclxuICAgICAgICAvLyDpnZ7lkIzmnJ/lh6bnkIbjgpLjgrfjg5/jg6Xjg6zjg7zjg4hcclxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMCkpO1xyXG5cclxuICAgICAgICBjb25jdXJyZW50Q2FsbHMtLTtcclxuICAgICAgICBjb25zdCBrZXkgPSAoY29tbWFuZCBhcyBHZXRPYmplY3RDb21tYW5kKS5pbnB1dC5LZXk7XHJcbiAgICAgICAgcmV0dXJuIGBodHRwczovL3Rlc3QtcGRmcy1idWNrZXQuczMuYW1hem9uYXdzLmNvbS8ke2tleX0/WC1BbXotLi4uYDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2VuZXJhdGVQcmVzaWduZWRVcmxzKHMzS2V5cyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1heENvbmN1cnJlbnRDYWxscykudG9CZUdyZWF0ZXJUaGFuKDEpOyAvLyDkuKbooYzlrp/ooYzjgZXjgozjgabjgYTjgotcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9