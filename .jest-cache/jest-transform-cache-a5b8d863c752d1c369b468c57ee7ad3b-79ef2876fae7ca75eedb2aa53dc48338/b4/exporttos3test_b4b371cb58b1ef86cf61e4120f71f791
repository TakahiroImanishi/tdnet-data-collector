33d9342c988c39f75adf964310d10e8b
"use strict";
/**
 * Export to S3 Unit Tests
 *
 * Requirements: 要件14.1（ユニットテスト）
 */
Object.defineProperty(exports, "__esModule", { value: true });
// モック
jest.mock('@aws-sdk/client-s3');
jest.mock('../../../utils/logger');
jest.mock('../../../utils/retry', () => ({
    retryWithBackoff: jest.fn((fn) => fn()), // retryをバイパス
}));
const export_to_s3_1 = require("../export-to-s3");
const client_s3_1 = require("@aws-sdk/client-s3");
describe('exportToS3', () => {
    const mockDisclosures = [
        {
            disclosure_id: '20240115_1234_001',
            company_code: '1234',
            company_name: 'テスト株式会社',
            disclosure_type: '決算短信',
            title: '2024年3月期 第3四半期決算短信',
            disclosed_at: '2024-01-15T10:30:00Z',
            pdf_url: 'https://example.com/pdf/20240115_1234_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_1234_001.pdf',
            collected_at: '2024-01-15T10:35:00Z',
            date_partition: '2024-01',
        },
        {
            disclosure_id: '20240115_5678_001',
            company_code: '5678',
            company_name: 'サンプル株式会社',
            disclosure_type: '有価証券報告書',
            title: '第50期有価証券報告書',
            disclosed_at: '2024-01-15T11:00:00Z',
            pdf_url: 'https://example.com/pdf/20240115_5678_001.pdf',
            s3_key: 'pdfs/2024/01/15/20240115_5678_001.pdf',
            collected_at: '2024-01-15T11:05:00Z',
            date_partition: '2024-01',
        },
    ];
    beforeEach(() => {
        jest.clearAllMocks();
        process.env.EXPORT_BUCKET_NAME = 'test-exports-bucket';
        process.env.AWS_REGION = 'ap-northeast-1';
        // S3Client.send のモック
        client_s3_1.S3Client.prototype.send = jest.fn().mockResolvedValue({
            $metadata: { httpStatusCode: 200 },
            ETag: '"mock-etag"',
        });
    });
    describe('JSON形式のエクスポート', () => {
        it('JSON形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
            const sendMock = client_s3_1.S3Client.prototype.send;
            expect(sendMock).toHaveBeenCalledTimes(1);
            const command = sendMock.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('application/json');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('JSONに件数とデータが含まれる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const parsed = JSON.parse(body);
            expect(parsed).toHaveProperty('count', 2);
            expect(parsed).toHaveProperty('disclosures');
            expect(parsed.disclosures).toHaveLength(2);
            expect(parsed.disclosures[0]).toEqual(mockDisclosures[0]);
        });
    });
    describe('CSV形式のエクスポート', () => {
        it('CSV形式でS3にエクスポートできる', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.csv$/);
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            expect(command.input.Bucket).toBe('test-exports-bucket');
            expect(command.input.Key).toBe(s3_key);
            expect(command.input.ContentType).toBe('text/csv');
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
        it('CSVヘッダーが正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[0]).toBe('disclosure_id,company_code,company_name,disclosure_type,title,disclosed_at,pdf_url,s3_key,collected_at,date_partition');
        });
        it('CSVデータ行が正しく出力される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_def456_87654321';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toBe('20240115_1234_001,1234,テスト株式会社,決算短信,2024年3月期 第3四半期決算短信,2024-01-15T10:30:00Z,https://example.com/pdf/20240115_1234_001.pdf,pdfs/2024/01/15/20240115_1234_001.pdf,2024-01-15T10:35:00Z,2024-01');
            expect(lines[2]).toBe('20240115_5678_001,5678,サンプル株式会社,有価証券報告書,第50期有価証券報告書,2024-01-15T11:00:00Z,https://example.com/pdf/20240115_5678_001.pdf,pdfs/2024/01/15/20240115_5678_001.pdf,2024-01-15T11:05:00Z,2024-01');
        });
        it('カンマを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithComma = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル, カンマ含む',
                },
            ];
            const export_id = 'export_1705305600000_ghi789_11111111';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithComma, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル, カンマ含む"');
        });
        it('ダブルクォートを含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithQuote = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル"引用符"含む',
                },
            ];
            const export_id = 'export_1705305600000_jkl012_22222222';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithQuote, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            expect(lines[1]).toContain('"タイトル""引用符""含む"');
        });
        it('改行を含む値が正しくエスケープされる', async () => {
            // Arrange
            const disclosuresWithNewline = [
                {
                    ...mockDisclosures[0],
                    title: 'タイトル\n改行含む',
                },
            ];
            const export_id = 'export_1705305600000_mno345_33333333';
            const format = 'csv';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, disclosuresWithNewline, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            const body = command.input.Body;
            const lines = body.split('\n');
            // 改行を含む値はダブルクォートで囲まれる
            expect(lines[1]).toContain('"タイトル\n改行含む"');
        });
    });
    describe('S3キー生成', () => {
        it('S3キーが正しいフォーマットで生成される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            const s3_key = await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            // フォーマット: exports/YYYY/MM/DD/export_id.format
            expect(s3_key).toMatch(/^exports\/\d{4}\/\d{2}\/\d{2}\/export_\d+_[a-z0-9]+_[a-z0-9]+\.json$/);
        });
    });
    describe('ライフサイクルポリシー', () => {
        it('auto-deleteタグが設定される', async () => {
            // Arrange
            const export_id = 'export_1705305600000_abc123_12345678';
            const format = 'json';
            // Act
            await (0, export_to_s3_1.exportToS3)(export_id, mockDisclosures, format);
            // Assert
            const sendMock = client_s3_1.S3Client.prototype.send;
            const command = sendMock.mock.calls[0][0];
            expect(command.input.Tagging).toBe('auto-delete=true');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGV4cG9ydFxcX190ZXN0c19fXFxleHBvcnQtdG8tczMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFNSCxNQUFNO0FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdkMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxhQUFhO0NBQ3ZELENBQUMsQ0FBQyxDQUFDO0FBVEosa0RBQTZDO0FBRTdDLGtEQUFnRTtBQVNoRSxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixNQUFNLGVBQWUsR0FBaUI7UUFDcEM7WUFDRSxhQUFhLEVBQUUsbUJBQW1CO1lBQ2xDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLFlBQVksRUFBRSxTQUFTO1lBQ3ZCLGVBQWUsRUFBRSxNQUFNO1lBQ3ZCLEtBQUssRUFBRSxvQkFBb0I7WUFDM0IsWUFBWSxFQUFFLHNCQUFzQjtZQUNwQyxPQUFPLEVBQUUsK0NBQStDO1lBQ3hELE1BQU0sRUFBRSx1Q0FBdUM7WUFDL0MsWUFBWSxFQUFFLHNCQUFzQjtZQUNwQyxjQUFjLEVBQUUsU0FBUztTQUMxQjtRQUNEO1lBQ0UsYUFBYSxFQUFFLG1CQUFtQjtZQUNsQyxZQUFZLEVBQUUsTUFBTTtZQUNwQixZQUFZLEVBQUUsVUFBVTtZQUN4QixlQUFlLEVBQUUsU0FBUztZQUMxQixLQUFLLEVBQUUsYUFBYTtZQUNwQixZQUFZLEVBQUUsc0JBQXNCO1lBQ3BDLE9BQU8sRUFBRSwrQ0FBK0M7WUFDeEQsTUFBTSxFQUFFLHVDQUF1QztZQUMvQyxZ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U0FBUyxHQUFHLHNDQUFzQyxDQUFDO1lBQ3pELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUV0QixNQUFNO1lBQ04sTUFBTSxJQUFBLHlCQUFVLEVBQUMsU0FBUyxFQUFFLGVBQWUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVyRCxTQUFTO1lBQ1QsTUFBTSxRQUFRLEdBQUcsb0JBQVEsQ0FBQyxTQUFTLENBQUMsSUFBaUIsQ0FBQztZQUN0RCxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQXFCLENBQUM7WUFDOUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcbGFtYmRhXFxleHBvcnRcXF9fdGVzdHNfX1xcZXhwb3J0LXRvLXMzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEV4cG9ydCB0byBTMyBVbml0IFRlc3RzXHJcbiAqXHJcbiAqIFJlcXVpcmVtZW50czog6KaB5Lu2MTQuMe+8iOODpuODi+ODg+ODiOODhuOCueODiO+8iVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGV4cG9ydFRvUzMgfSBmcm9tICcuLi9leHBvcnQtdG8tczMnO1xyXG5pbXBvcnQgeyBEaXNjbG9zdXJlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBTM0NsaWVudCwgUHV0T2JqZWN0Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcblxyXG4vLyDjg6Ljg4Pjgq9cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnKTtcclxuamVzdC5tb2NrKCcuLi8uLi8uLi91dGlscy9sb2dnZXInKTtcclxuamVzdC5tb2NrKCcuLi8uLi8uLi91dGlscy9yZXRyeScsICgpID0+ICh7XHJcbiAgcmV0cnlXaXRoQmFja29mZjogamVzdC5mbigoZm4pID0+IGZuKCkpLCAvLyByZXRyeeOCkuODkOOCpOODkeOCuVxyXG59KSk7XHJcblxyXG5kZXNjcmliZSgnZXhwb3J0VG9TMycsICgpID0+IHtcclxuICBjb25zdCBtb2NrRGlzY2xvc3VyZXM6IERpc2Nsb3N1cmVbXSA9IFtcclxuICAgIHtcclxuICAgICAgZGlzY2xvc3VyZV9pZDogJzIwMjQwMTE1XzEyMzRfMDAxJyxcclxuICAgICAgY29tcGFueV9jb2RlOiAnMTIzNCcsXHJcbiAgICAgIGNvbXBhbnlfbmFtZTogJ+ODhuOCueODiOagquW8j+S8muekvicsXHJcbiAgICAgIGRpc2Nsb3N1cmVfdHlwZTogJ+axuueul+efreS/oScsXHJcbiAgICAgIHRpdGxlOiAnMjAyNOW5tDPmnIjmnJ8g56ysM+Wbm+WNiuacn+axuueul+efreS/oScsXHJcbiAgICAgIGRpc2Nsb3NlZF9hdDogJzIwMjQtMDEtMTVUMTA6MzA6MDBaJyxcclxuICAgICAgcGRmX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzEyMzRfMDAxLnBkZicsXHJcbiAgICAgIHMzX2tleTogJ3BkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV8xMjM0XzAwMS5wZGYnLFxyXG4gICAgICBjb2xsZWN0ZWRfYXQ6ICcyMDI0LTAxLTE1VDEwOjM1OjAwWicsXHJcbiAgICAgIGRhdGVfcGFydGl0aW9uOiAnMjAyNC0wMScsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBkaXNjbG9zdXJlX2lkOiAnMjAyNDAxMTVfNTY3OF8wMDEnLFxyXG4gICAgICBjb21wYW55X2NvZGU6ICc1Njc4JyxcclxuICAgICAgY29tcGFueV9uYW1lOiAn44K144Oz44OX44Or5qCq5byP5Lya56S+JyxcclxuICAgICAgZGlzY2xvc3VyZV90eXBlOiAn5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4JyxcclxuICAgICAgdGl0bGU6ICfnrKw1MOacn+acieS+oeiovOWIuOWgseWRiuabuCcsXHJcbiAgICAgIGRpc2Nsb3NlZF9hdDogJzIwMjQtMDEtMTVUMTE6MDA6MDBaJyxcclxuICAgICAgcGRmX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzU2NzhfMDAxLnBkZicsXHJcbiAgICAgIHMzX2tleTogJ3BkZnMvMjAyNC8wMS8xNS8yMDI0MDExNV81Njc4XzAwMS5wZGYnLFxyXG4gICAgICBjb2xsZWN0ZWRfYXQ6ICcyMDI0LTAxLTE1VDExOjA1OjAwWicsXHJcbiAgICAgIGRhdGVfcGFydGl0aW9uOiAnMjAyNC0wMScsXHJcbiAgICB9LFxyXG4gIF07XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBwcm9jZXNzLmVudi5FWFBPUlRfQlVDS0VUX05BTUUgPSAndGVzdC1leHBvcnRzLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ2FwLW5vcnRoZWFzdC0xJztcclxuXHJcbiAgICAvLyBTM0NsaWVudC5zZW5kIOOBruODouODg+OCr1xyXG4gICAgKFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaykgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAkbWV0YWRhdGE6IHsgaHR0cFN0YXR1c0NvZGU6IDIwMCB9LFxyXG4gICAgICBFVGFnOiAnXCJtb2NrLWV0YWdcIicsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0pTT07lvaLlvI/jga7jgqjjgq/jgrnjg53jg7zjg4gnLCAoKSA9PiB7XHJcbiAgICBpdCgnSlNPTuW9ouW8j+OBp1Mz44Gr44Ko44Kv44K544Od44O844OI44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoczNfa2V5KS50b01hdGNoKC9eZXhwb3J0c1xcL1xcZHs0fVxcL1xcZHsyfVxcL1xcZHsyfVxcL2V4cG9ydF9cXGQrX1thLXowLTldK19bYS16MC05XStcXC5qc29uJC8pO1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgc2VuZE1vY2sgPSBTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2s7XHJcbiAgICAgIGV4cGVjdChzZW5kTW9jaykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY29tbWFuZCA9IHNlbmRNb2NrLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuQnVja2V0KS50b0JlKCd0ZXN0LWV4cG9ydHMtYnVja2V0Jyk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LktleSkudG9CZShzM19rZXkpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5Db250ZW50VHlwZSkudG9CZSgnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5UYWdnaW5nKS50b0JlKCdhdXRvLWRlbGV0ZT10cnVlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnSlNPTuOBq+S7tuaVsOOBqOODh+ODvOOCv+OBjOWQq+OBvuOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZE1vY2sgPSBTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2s7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBzZW5kTW9jay5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKGJvZHkpO1xyXG5cclxuICAgICAgZXhwZWN0KHBhcnNlZCkudG9IYXZlUHJvcGVydHkoJ2NvdW50JywgMik7XHJcbiAgICAgIGV4cGVjdChwYXJzZWQpLnRvSGF2ZVByb3BlcnR5KCdkaXNjbG9zdXJlcycpO1xyXG4gICAgICBleHBlY3QocGFyc2VkLmRpc2Nsb3N1cmVzKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICAgIGV4cGVjdChwYXJzZWQuZGlzY2xvc3VyZXNbMF0pLnRvRXF1YWwobW9ja0Rpc2Nsb3N1cmVzWzBdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnQ1NW5b2i5byP44Gu44Ko44Kv44K544Od44O844OIJywgKCkgPT4ge1xyXG4gICAgaXQoJ0NTVuW9ouW8j+OBp1Mz44Gr44Ko44Kv44K544Od44O844OI44Gn44GN44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9kZWY0NTZfODc2NTQzMjEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCBzM19rZXkgPSBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChzM19rZXkpLnRvTWF0Y2goL15leHBvcnRzXFwvXFxkezR9XFwvXFxkezJ9XFwvXFxkezJ9XFwvZXhwb3J0X1xcZCtfW2EtejAtOV0rX1thLXowLTldK1xcLmNzdiQvKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHNlbmRNb2NrID0gUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrO1xyXG4gICAgICBjb25zdCBjb21tYW5kID0gc2VuZE1vY2subW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5CdWNrZXQpLnRvQmUoJ3Rlc3QtZXhwb3J0cy1idWNrZXQnKTtcclxuICAgICAgZXhwZWN0KGNvbW1hbmQuaW5wdXQuS2V5KS50b0JlKHMzX2tleSk7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LkNvbnRlbnRUeXBlKS50b0JlKCd0ZXh0L2NzdicpO1xyXG4gICAgICBleHBlY3QoY29tbWFuZC5pbnB1dC5UYWdnaW5nKS50b0JlKCdhdXRvLWRlbGV0ZT10cnVlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnQ1NW44OY44OD44OA44O844GM5q2j44GX44GP5Ye65Yqb44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9kZWY0NTZfODc2NTQzMjEnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnY3N2JztcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBleHBvcnRUb1MzKGV4cG9ydF9pZCwgbW9ja0Rpc2Nsb3N1cmVzLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IHNlbmRNb2NrID0gUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrO1xyXG4gICAgICBjb25zdCBjb21tYW5kID0gc2VuZE1vY2subW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1swXSkudG9CZShcclxuICAgICAgICAnZGlzY2xvc3VyZV9pZCxjb21wYW55X2NvZGUsY29tcGFueV9uYW1lLGRpc2Nsb3N1cmVfdHlwZSx0aXRsZSxkaXNjbG9zZWRfYXQscGRmX3VybCxzM19rZXksY29sbGVjdGVkX2F0LGRhdGVfcGFydGl0aW9uJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ0NTVuODh+ODvOOCv+ihjOOBjOato+OBl+OBj+WHuuWKm+OBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfZGVmNDU2Xzg3NjU0MzIxJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBzZW5kTW9jayA9IFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaztcclxuICAgICAgY29uc3QgY29tbWFuZCA9IHNlbmRNb2NrLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgY29uc3QgYm9keSA9IGNvbW1hbmQuaW5wdXQuQm9keSBhcyBzdHJpbmc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQmUoXHJcbiAgICAgICAgJzIwMjQwMTE1XzEyMzRfMDAxLDEyMzQs44OG44K544OI5qCq5byP5Lya56S+LOaxuueul+efreS/oSwyMDI05bm0M+aciOacnyDnrKwz5Zub5Y2K5pyf5rG6566X55+t5L+hLDIwMjQtMDEtMTVUMTA6MzA6MDBaLGh0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzEyMzRfMDAxLnBkZixwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfMTIzNF8wMDEucGRmLDIwMjQtMDEtMTVUMTA6MzU6MDBaLDIwMjQtMDEnXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChsaW5lc1syXSkudG9CZShcclxuICAgICAgICAnMjAyNDAxMTVfNTY3OF8wMDEsNTY3OCzjgrXjg7Pjg5fjg6vmoKrlvI/kvJrnpL4s5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4LOesrDUw5pyf5pyJ5L6h6Ki85Yi45aCx5ZGK5pu4LDIwMjQtMDEtMTVUMTE6MDA6MDBaLGh0dHBzOi8vZXhhbXBsZS5jb20vcGRmLzIwMjQwMTE1XzU2NzhfMDAxLnBkZixwZGZzLzIwMjQvMDEvMTUvMjAyNDAxMTVfNTY3OF8wMDEucGRmLDIwMjQtMDEtMTVUMTE6MDU6MDBaLDIwMjQtMDEnXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44Kr44Oz44Oe44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVzV2l0aENvbW1hOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubW9ja0Rpc2Nsb3N1cmVzWzBdLFxyXG4gICAgICAgICAgdGl0bGU6ICfjgr/jgqTjg4jjg6ssIOOCq+ODs+ODnuWQq+OCgCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgZXhwb3J0X2lkID0gJ2V4cG9ydF8xNzA1MzA1NjAwMDAwX2doaTc4OV8xMTExMTExMSc7XHJcbiAgICAgIGNvbnN0IGZvcm1hdCA9ICdjc3YnO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBkaXNjbG9zdXJlc1dpdGhDb21tYSwgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBjb25zdCBzZW5kTW9jayA9IFMzQ2xpZW50LnByb3RvdHlwZS5zZW5kIGFzIGplc3QuTW9jaztcclxuICAgICAgY29uc3QgY29tbWFuZCA9IHNlbmRNb2NrLm1vY2suY2FsbHNbMF1bMF0gYXMgUHV0T2JqZWN0Q29tbWFuZDtcclxuICAgICAgY29uc3QgYm9keSA9IGNvbW1hbmQuaW5wdXQuQm9keSBhcyBzdHJpbmc7XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gYm9keS5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICBleHBlY3QobGluZXNbMV0pLnRvQ29udGFpbignXCLjgr/jgqTjg4jjg6ssIOOCq+ODs+ODnuWQq+OCgFwiJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn44OA44OW44Or44Kv44Kp44O844OI44KS5ZCr44KA5YCk44GM5q2j44GX44GP44Ko44K544Kx44O844OX44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRpc2Nsb3N1cmVzV2l0aFF1b3RlOiBEaXNjbG9zdXJlW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubW9ja0Rpc2Nsb3N1cmVzWzBdLFxyXG4gICAgICAgICAgdGl0bGU6ICfjgr/jgqTjg4jjg6tcIuW8leeUqOesplwi5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfamtsMDEyXzIyMjIyMjIyJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aFF1b3RlLCBmb3JtYXQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGNvbnN0IHNlbmRNb2NrID0gUzNDbGllbnQucHJvdG90eXBlLnNlbmQgYXMgamVzdC5Nb2NrO1xyXG4gICAgICBjb25zdCBjb21tYW5kID0gc2VuZE1vY2subW9jay5jYWxsc1swXVswXSBhcyBQdXRPYmplY3RDb21tYW5kO1xyXG4gICAgICBjb25zdCBib2R5ID0gY29tbWFuZC5pbnB1dC5Cb2R5IGFzIHN0cmluZztcclxuICAgICAgY29uc3QgbGluZXMgPSBib2R5LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODq1wiXCLlvJXnlKjnrKZcIlwi5ZCr44KAXCInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCfmlLnooYzjgpLlkKvjgoDlgKTjgYzmraPjgZfjgY/jgqjjgrnjgrHjg7zjg5fjgZXjgozjgosnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGlzY2xvc3VyZXNXaXRoTmV3bGluZTogRGlzY2xvc3VyZVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC4uLm1vY2tEaXNjbG9zdXJlc1swXSxcclxuICAgICAgICAgIHRpdGxlOiAn44K/44Kk44OI44OrXFxu5pS56KGM5ZCr44KAJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfbW5vMzQ1XzMzMzMzMzMzJztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2Nzdic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIGRpc2Nsb3N1cmVzV2l0aE5ld2xpbmUsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZE1vY2sgPSBTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2s7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBzZW5kTW9jay5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBjb21tYW5kLmlucHV0LkJvZHkgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCBsaW5lcyA9IGJvZHkuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgLy8g5pS56KGM44KS5ZCr44KA5YCk44Gv44OA44OW44Or44Kv44Kp44O844OI44Gn5Zuy44G+44KM44KLXHJcbiAgICAgIGV4cGVjdChsaW5lc1sxXSkudG9Db250YWluKCdcIuOCv+OCpOODiOODq1xcbuaUueihjOWQq+OCgFwiJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1Mz44Kt44O855Sf5oiQJywgKCkgPT4ge1xyXG4gICAgaXQoJ1Mz44Kt44O844GM5q2j44GX44GE44OV44Kp44O844Oe44OD44OI44Gn55Sf5oiQ44GV44KM44KLJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV4cG9ydF9pZCA9ICdleHBvcnRfMTcwNTMwNTYwMDAwMF9hYmMxMjNfMTIzNDU2NzgnO1xyXG4gICAgICBjb25zdCBmb3JtYXQgPSAnanNvbic7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgczNfa2V5ID0gYXdhaXQgZXhwb3J0VG9TMyhleHBvcnRfaWQsIG1vY2tEaXNjbG9zdXJlcywgZm9ybWF0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICAvLyDjg5Xjgqnjg7zjg57jg4Pjg4g6IGV4cG9ydHMvWVlZWS9NTS9ERC9leHBvcnRfaWQuZm9ybWF0XHJcbiAgICAgIGV4cGVjdChzM19rZXkpLnRvTWF0Y2goL15leHBvcnRzXFwvXFxkezR9XFwvXFxkezJ9XFwvXFxkezJ9XFwvZXhwb3J0X1xcZCtfW2EtejAtOV0rX1thLXowLTldK1xcLmpzb24kLyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+ODqeOCpOODleOCteOCpOOCr+ODq+ODneODquOCt+ODvCcsICgpID0+IHtcclxuICAgIGl0KCdhdXRvLWRlbGV0ZeOCv+OCsOOBjOioreWumuOBleOCjOOCiycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleHBvcnRfaWQgPSAnZXhwb3J0XzE3MDUzMDU2MDAwMDBfYWJjMTIzXzEyMzQ1Njc4JztcclxuICAgICAgY29uc3QgZm9ybWF0ID0gJ2pzb24nO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGV4cG9ydFRvUzMoZXhwb3J0X2lkLCBtb2NrRGlzY2xvc3VyZXMsIGZvcm1hdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgY29uc3Qgc2VuZE1vY2sgPSBTM0NsaWVudC5wcm90b3R5cGUuc2VuZCBhcyBqZXN0Lk1vY2s7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBzZW5kTW9jay5tb2NrLmNhbGxzWzBdWzBdIGFzIFB1dE9iamVjdENvbW1hbmQ7XHJcbiAgICAgIGV4cGVjdChjb21tYW5kLmlucHV0LlRhZ2dpbmcpLnRvQmUoJ2F1dG8tZGVsZXRlPXRydWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9