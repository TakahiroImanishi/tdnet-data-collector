c8c63b49579696d9b3219d0117b25079
"use strict";
/**
 * Test Helpers for Lambda Collector
 *
 * テスト環境でのモック設定を簡素化するヘルパー関数。
 *
 * Requirements: テスト環境の整備（Task 9.4）
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockRateLimiter = exports.cloudWatchMock = exports.s3Mock = exports.dynamoMock = void 0;
exports.setupTestDependencies = setupTestDependencies;
exports.cleanupTestDependencies = cleanupTestDependencies;
exports.mockGetDisclosure = mockGetDisclosure;
exports.mockPutDisclosure = mockPutDisclosure;
exports.mockUpdateExecutionStatus = mockUpdateExecutionStatus;
exports.mockPutPdf = mockPutPdf;
exports.mockGetPdf = mockGetPdf;
exports.mockPutMetrics = mockPutMetrics;
const aws_sdk_client_mock_1 = require("aws-sdk-client-mock");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const client_s3_1 = require("@aws-sdk/client-s3");
const client_cloudwatch_1 = require("@aws-sdk/client-cloudwatch");
const rate_limiter_1 = require("../../../utils/rate-limiter");
const dependencies_1 = require("../dependencies");
/**
 * AWS SDKモッククライアント
 */
exports.dynamoMock = (0, aws_sdk_client_mock_1.mockClient)(lib_dynamodb_1.DynamoDBDocumentClient);
exports.s3Mock = (0, aws_sdk_client_mock_1.mockClient)(client_s3_1.S3Client);
exports.cloudWatchMock = (0, aws_sdk_client_mock_1.mockClient)(client_cloudwatch_1.CloudWatchClient);
/**
 * RateLimiterモック
 */
class MockRateLimiter extends rate_limiter_1.RateLimiter {
    constructor() {
        super(0); // 遅延なし
    }
    async waitIfNeeded() {
        // テスト環境では遅延なし
        return Promise.resolve();
    }
}
exports.MockRateLimiter = MockRateLimiter;
/**
 * テスト用の依存関係をセットアップ
 *
 * beforeEach()で呼び出して、モックを注入する。
 *
 * @returns CollectorDependencies
 */
function setupTestDependencies() {
    // モックをリセット
    exports.dynamoMock.reset();
    exports.s3Mock.reset();
    exports.cloudWatchMock.reset();
    // デフォルトのモック動作を設定
    exports.dynamoMock.on(lib_dynamodb_1.PutCommand).resolves({});
    exports.dynamoMock.on(lib_dynamodb_1.GetCommand).resolves({ Item: undefined });
    exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).resolves({});
    exports.dynamoMock.on(lib_dynamodb_1.QueryCommand).resolves({ Items: [] });
    exports.s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
    exports.s3Mock.on(client_s3_1.GetObjectCommand).resolves({
        Body: Buffer.from('mock pdf content'),
    });
    exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).resolves({});
    // モック依存関係を作成
    const deps = {
        dynamoClient: exports.dynamoMock,
        s3Client: exports.s3Mock,
        cloudWatchClient: exports.cloudWatchMock,
        rateLimiter: new MockRateLimiter(),
    };
    // 依存関係を注入
    (0, dependencies_1.setDependencies)(deps);
    return deps;
}
/**
 * テスト用の依存関係をクリーンアップ
 *
 * afterEach()で呼び出して、モックをリセットする。
 */
function cleanupTestDependencies() {
    exports.dynamoMock.reset();
    exports.s3Mock.reset();
    exports.cloudWatchMock.reset();
    (0, dependencies_1.resetDependencies)();
}
/**
 * DynamoDBモックの設定: 開示情報の取得
 *
 * @param disclosureId 開示ID
 * @param item 返却するアイテム
 */
function mockGetDisclosure(disclosureId, item) {
    exports.dynamoMock.on(lib_dynamodb_1.GetCommand, {
        TableName: process.env.DYNAMODB_TABLE,
        Key: { disclosure_id: disclosureId },
    }).resolves({ Item: item });
}
/**
 * DynamoDBモックの設定: 開示情報の保存
 *
 * @param success 成功するかどうか
 */
function mockPutDisclosure(success = true) {
    if (success) {
        exports.dynamoMock.on(lib_dynamodb_1.PutCommand).resolves({});
    }
    else {
        exports.dynamoMock.on(lib_dynamodb_1.PutCommand).rejects(new Error('DynamoDB PutItem failed'));
    }
}
/**
 * DynamoDBモックの設定: 実行状態の更新
 *
 * @param success 成功するかどうか
 */
function mockUpdateExecutionStatus(success = true) {
    if (success) {
        exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).resolves({});
    }
    else {
        exports.dynamoMock.on(lib_dynamodb_1.UpdateCommand).rejects(new Error('DynamoDB UpdateItem failed'));
    }
}
/**
 * S3モックの設定: PDFアップロード
 *
 * @param success 成功するかどうか
 */
function mockPutPdf(success = true) {
    if (success) {
        exports.s3Mock.on(client_s3_1.PutObjectCommand).resolves({});
    }
    else {
        exports.s3Mock.on(client_s3_1.PutObjectCommand).rejects(new Error('S3 PutObject failed'));
    }
}
/**
 * S3モックの設定: PDFダウンロード
 *
 * @param content PDFコンテンツ
 */
function mockGetPdf(content = Buffer.from('mock pdf content')) {
    exports.s3Mock.on(client_s3_1.GetObjectCommand).resolves({
        Body: content,
    });
}
/**
 * CloudWatchモックの設定: メトリクス送信
 *
 * @param success 成功するかどうか
 */
function mockPutMetrics(success = true) {
    if (success) {
        exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).resolves({});
    }
    else {
        exports.cloudWatchMock.on(client_cloudwatch_1.PutMetricDataCommand).rejects(new Error('CloudWatch PutMetricData failed'));
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aTE5OFxcaW52ZXN0bWVudF9hbmFseXNpc19vcG9wb1xcc3JjXFxsYW1iZGFcXGNvbGxlY3RvclxcX190ZXN0c19fXFx0ZXN0LWhlbHBlcnMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBcUNILHNEQStCQztBQU9ELDBEQUtDO0FBUUQsOENBS0M7QUFPRCw4Q0FNQztBQU9ELDhEQU1DO0FBT0QsZ0NBTUM7QUFPRCxnQ0FJQztBQU9ELHdDQU1DO0FBMUpELDZEQUFpRDtBQUNqRCx3REFBb0g7QUFDcEgsa0RBQWtGO0FBQ2xGLGtFQUFvRjtBQUNwRiw4REFBMEQ7QUFDMUQsa0RBQTRGO0FBRTVGOztHQUVHO0FBQ1UsUUFBQSxVQUFVLEdBQUcsSUFBQSxnQ0FBVSxFQUFDLHFDQUFzQixDQUFDLENBQUM7QUFDaEQsUUFBQSxNQUFNLEdBQUcsSUFBQSxnQ0FBVSxFQUFDLG9CQUFRLENBQUMsQ0FBQztBQUM5QixRQUFBLGNBQWMsR0FBRyxJQUFBLGdDQUFVLEVBQUMsb0NBQWdCLENBQUMsQ0FBQztBQUUzRDs7R0FFRztBQUNILE1BQWEsZUFBZ0IsU0FBUSwwQkFBVztJQUM5QztRQUNFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU87SUFDbkIsQ0FBQztJQUVELEtBQUssQ0FBQyxZQUFZO1FBQ2hCLGNBQWM7UUFDZCxPQUFPLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMzQixDQUFDO0NBQ0Y7QUFURCwwQ0FTQztBQUVEOzs7Ozs7R0FNRztBQUNILFNBQWdCLHFCQUFxQjtJQUNuQyxXQUFXO0lBQ1gsa0JBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNuQixjQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixzQkFBYyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRXZCLGlCQUFpQjtJQUNqQixrQkFBVSxDQUFDLEVBQUUsQ0FBQyx5QkFBVSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLGtCQUFVLENBQUMs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U0FBTSxDQUFDO1FBQ04sY0FBTSxDQUFDLEVBQUUsQ0FBQyw0QkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7SUFDeEUsQ0FBQztBQUNILENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsVUFBVSxDQUFDLFVBQWtCLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDMUUsY0FBTSxDQUFDLEVBQUUsQ0FBQyw0QkFBZ0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUNuQyxJQUFJLEVBQUUsT0FBTztLQUNQLENBQUMsQ0FBQztBQUNaLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsY0FBYyxDQUFDLFVBQW1CLElBQUk7SUFDcEQsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUNaLHNCQUFjLENBQUMsRUFBRSxDQUFDLHdDQUFvQixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7U0FBTSxDQUFDO1FBQ04sc0JBQWMsQ0FBQyxFQUFFLENBQUMsd0NBQW9CLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQyxDQUFDO0lBQ2hHLENBQUM7QUFDSCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGkxOThcXGludmVzdG1lbnRfYW5hbHlzaXNfb3BvcG9cXHNyY1xcbGFtYmRhXFxjb2xsZWN0b3JcXF9fdGVzdHNfX1xcdGVzdC1oZWxwZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUZXN0IEhlbHBlcnMgZm9yIExhbWJkYSBDb2xsZWN0b3JcclxuICpcclxuICog44OG44K544OI55Kw5aKD44Gn44Gu44Oi44OD44Kv6Kit5a6a44KS57Ch57Sg5YyW44GZ44KL44OY44Or44OR44O86Zai5pWw44CCXHJcbiAqXHJcbiAqIFJlcXVpcmVtZW50czog44OG44K544OI55Kw5aKD44Gu5pW05YKZ77yIVGFzayA5LjTvvIlcclxuICovXHJcblxyXG5pbXBvcnQgeyBtb2NrQ2xpZW50IH0gZnJvbSAnYXdzLXNkay1jbGllbnQtbW9jayc7XHJcbmltcG9ydCB7IER5bmFtb0RCRG9jdW1lbnRDbGllbnQsIFB1dENvbW1hbmQsIEdldENvbW1hbmQsIFVwZGF0ZUNvbW1hbmQsIFF1ZXJ5Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2xpYi1keW5hbW9kYic7XHJcbmltcG9ydCB7IFMzQ2xpZW50LCBQdXRPYmplY3RDb21tYW5kLCBHZXRPYmplY3RDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcclxuaW1wb3J0IHsgQ2xvdWRXYXRjaENsaWVudCwgUHV0TWV0cmljRGF0YUNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtY2xvdWR3YXRjaCc7XHJcbmltcG9ydCB7IFJhdGVMaW1pdGVyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvcmF0ZS1saW1pdGVyJztcclxuaW1wb3J0IHsgQ29sbGVjdG9yRGVwZW5kZW5jaWVzLCBzZXREZXBlbmRlbmNpZXMsIHJlc2V0RGVwZW5kZW5jaWVzIH0gZnJvbSAnLi4vZGVwZW5kZW5jaWVzJztcclxuXHJcbi8qKlxyXG4gKiBBV1MgU0RL44Oi44OD44Kv44Kv44Op44Kk44Ki44Oz44OIXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZHluYW1vTW9jayA9IG1vY2tDbGllbnQoRHluYW1vREJEb2N1bWVudENsaWVudCk7XHJcbmV4cG9ydCBjb25zdCBzM01vY2sgPSBtb2NrQ2xpZW50KFMzQ2xpZW50KTtcclxuZXhwb3J0IGNvbnN0IGNsb3VkV2F0Y2hNb2NrID0gbW9ja0NsaWVudChDbG91ZFdhdGNoQ2xpZW50KTtcclxuXHJcbi8qKlxyXG4gKiBSYXRlTGltaXRlcuODouODg+OCr1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE1vY2tSYXRlTGltaXRlciBleHRlbmRzIFJhdGVMaW1pdGVyIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKDApOyAvLyDpgYXlu7bjgarjgZdcclxuICB9XHJcblxyXG4gIGFzeW5jIHdhaXRJZk5lZWRlZCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIOODhuOCueODiOeSsOWig+OBp+OBr+mBheW7tuOBquOBl1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOODhuOCueODiOeUqOOBruS+neWtmOmWouS/guOCkuOCu+ODg+ODiOOCouODg+ODl1xyXG4gKlxyXG4gKiBiZWZvcmVFYWNoKCnjgaflkbzjgbPlh7rjgZfjgabjgIHjg6Ljg4Pjgq/jgpLms6jlhaXjgZnjgovjgIJcclxuICpcclxuICogQHJldHVybnMgQ29sbGVjdG9yRGVwZW5kZW5jaWVzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc2V0dXBUZXN0RGVwZW5kZW5jaWVzKCk6IENvbGxlY3RvckRlcGVuZGVuY2llcyB7XHJcbiAgLy8g44Oi44OD44Kv44KS44Oq44K744OD44OIXHJcbiAgZHluYW1vTW9jay5yZXNldCgpO1xyXG4gIHMzTW9jay5yZXNldCgpO1xyXG4gIGNsb3VkV2F0Y2hNb2NrLnJlc2V0KCk7XHJcblxyXG4gIC8vIOODh+ODleOCqeODq+ODiOOBruODouODg+OCr+WLleS9nOOCkuioreWumlxyXG4gIGR5bmFtb01vY2sub24oUHV0Q29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG4gIGR5bmFtb01vY2sub24oR2V0Q29tbWFuZCkucmVzb2x2ZXMoeyBJdGVtOiB1bmRlZmluZWQgfSk7XHJcbiAgZHluYW1vTW9jay5vbihVcGRhdGVDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgZHluYW1vTW9jay5vbihRdWVyeUNvbW1hbmQpLnJlc29sdmVzKHsgSXRlbXM6IFtdIH0pO1xyXG5cclxuICBzM01vY2sub24oUHV0T2JqZWN0Q29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG4gIHMzTW9jay5vbihHZXRPYmplY3RDb21tYW5kKS5yZXNvbHZlcyh7XHJcbiAgICBCb2R5OiBCdWZmZXIuZnJvbSgnbW9jayBwZGYgY29udGVudCcpLFxyXG4gIH0gYXMgYW55KTtcclxuXHJcbiAgY2xvdWRXYXRjaE1vY2sub24oUHV0TWV0cmljRGF0YUNvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuXHJcbiAgLy8g44Oi44OD44Kv5L6d5a2Y6Zai5L+C44KS5L2c5oiQXHJcbiAgY29uc3QgZGVwczogQ29sbGVjdG9yRGVwZW5kZW5jaWVzID0ge1xyXG4gICAgZHluYW1vQ2xpZW50OiBkeW5hbW9Nb2NrIGFzIGFueSxcclxuICAgIHMzQ2xpZW50OiBzM01vY2sgYXMgYW55LFxyXG4gICAgY2xvdWRXYXRjaENsaWVudDogY2xvdWRXYXRjaE1vY2sgYXMgYW55LFxyXG4gICAgcmF0ZUxpbWl0ZXI6IG5ldyBNb2NrUmF0ZUxpbWl0ZXIoKSxcclxuICB9O1xyXG5cclxuICAvLyDkvp3lrZjplqLkv4LjgpLms6jlhaVcclxuICBzZXREZXBlbmRlbmNpZXMoZGVwcyk7XHJcblxyXG4gIHJldHVybiBkZXBzO1xyXG59XHJcblxyXG4vKipcclxuICog44OG44K544OI55So44Gu5L6d5a2Y6Zai5L+C44KS44Kv44Oq44O844Oz44Ki44OD44OXXHJcbiAqXHJcbiAqIGFmdGVyRWFjaCgp44Gn5ZG844Gz5Ye644GX44Gm44CB44Oi44OD44Kv44KS44Oq44K744OD44OI44GZ44KL44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2xlYW51cFRlc3REZXBlbmRlbmNpZXMoKTogdm9pZCB7XHJcbiAgZHluYW1vTW9jay5yZXNldCgpO1xyXG4gIHMzTW9jay5yZXNldCgpO1xyXG4gIGNsb3VkV2F0Y2hNb2NrLnJlc2V0KCk7XHJcbiAgcmVzZXREZXBlbmRlbmNpZXMoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIER5bmFtb0RC44Oi44OD44Kv44Gu6Kit5a6aOiDplovnpLrmg4XloLHjga7lj5blvpdcclxuICpcclxuICogQHBhcmFtIGRpc2Nsb3N1cmVJZCDplovnpLpJRFxyXG4gKiBAcGFyYW0gaXRlbSDov5TljbTjgZnjgovjgqLjgqTjg4bjg6BcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2NrR2V0RGlzY2xvc3VyZShkaXNjbG9zdXJlSWQ6IHN0cmluZywgaXRlbTogYW55KTogdm9pZCB7XHJcbiAgZHluYW1vTW9jay5vbihHZXRDb21tYW5kLCB7XHJcbiAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LkRZTkFNT0RCX1RBQkxFLFxyXG4gICAgS2V5OiB7IGRpc2Nsb3N1cmVfaWQ6IGRpc2Nsb3N1cmVJZCB9LFxyXG4gIH0pLnJlc29sdmVzKHsgSXRlbTogaXRlbSB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIER5bmFtb0RC44Oi44OD44Kv44Gu6Kit5a6aOiDplovnpLrmg4XloLHjga7kv53lrZhcclxuICpcclxuICogQHBhcmFtIHN1Y2Nlc3Mg5oiQ5Yqf44GZ44KL44GL44Gp44GG44GLXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbW9ja1B1dERpc2Nsb3N1cmUoc3VjY2VzczogYm9vbGVhbiA9IHRydWUpOiB2b2lkIHtcclxuICBpZiAoc3VjY2Vzcykge1xyXG4gICAgZHluYW1vTW9jay5vbihQdXRDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGR5bmFtb01vY2sub24oUHV0Q29tbWFuZCkucmVqZWN0cyhuZXcgRXJyb3IoJ0R5bmFtb0RCIFB1dEl0ZW0gZmFpbGVkJykpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIER5bmFtb0RC44Oi44OD44Kv44Gu6Kit5a6aOiDlrp/ooYznirbmhYvjga7mm7TmlrBcclxuICpcclxuICogQHBhcmFtIHN1Y2Nlc3Mg5oiQ5Yqf44GZ44KL44GL44Gp44GG44GLXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbW9ja1VwZGF0ZUV4ZWN1dGlvblN0YXR1cyhzdWNjZXNzOiBib29sZWFuID0gdHJ1ZSk6IHZvaWQge1xyXG4gIGlmIChzdWNjZXNzKSB7XHJcbiAgICBkeW5hbW9Nb2NrLm9uKFVwZGF0ZUNvbW1hbmQpLnJlc29sdmVzKHt9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgZHluYW1vTW9jay5vbihVcGRhdGVDb21tYW5kKS5yZWplY3RzKG5ldyBFcnJvcignRHluYW1vREIgVXBkYXRlSXRlbSBmYWlsZWQnKSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogUzPjg6Ljg4Pjgq/jga7oqK3lrpo6IFBERuOCouODg+ODl+ODreODvOODiVxyXG4gKlxyXG4gKiBAcGFyYW0gc3VjY2VzcyDmiJDlip/jgZnjgovjgYvjganjgYbjgYtcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2NrUHV0UGRmKHN1Y2Nlc3M6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XHJcbiAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgIHMzTW9jay5vbihQdXRPYmplY3RDb21tYW5kKS5yZXNvbHZlcyh7fSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHMzTW9jay5vbihQdXRPYmplY3RDb21tYW5kKS5yZWplY3RzKG5ldyBFcnJvcignUzMgUHV0T2JqZWN0IGZhaWxlZCcpKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTM+ODouODg+OCr+OBruioreWumjogUERG44OA44Km44Oz44Ot44O844OJXHJcbiAqXHJcbiAqIEBwYXJhbSBjb250ZW50IFBERuOCs+ODs+ODhuODs+ODhFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1vY2tHZXRQZGYoY29udGVudDogQnVmZmVyID0gQnVmZmVyLmZyb20oJ21vY2sgcGRmIGNvbnRlbnQnKSk6IHZvaWQge1xyXG4gIHMzTW9jay5vbihHZXRPYmplY3RDb21tYW5kKS5yZXNvbHZlcyh7XHJcbiAgICBCb2R5OiBjb250ZW50LFxyXG4gIH0gYXMgYW55KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENsb3VkV2F0Y2jjg6Ljg4Pjgq/jga7oqK3lrpo6IOODoeODiOODquOCr+OCuemAgeS/oVxyXG4gKlxyXG4gKiBAcGFyYW0gc3VjY2VzcyDmiJDlip/jgZnjgovjgYvjganjgYbjgYtcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2NrUHV0TWV0cmljcyhzdWNjZXNzOiBib29sZWFuID0gdHJ1ZSk6IHZvaWQge1xyXG4gIGlmIChzdWNjZXNzKSB7XHJcbiAgICBjbG91ZFdhdGNoTW9jay5vbihQdXRNZXRyaWNEYXRhQ29tbWFuZCkucmVzb2x2ZXMoe30pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG91ZFdhdGNoTW9jay5vbihQdXRNZXRyaWNEYXRhQ29tbWFuZCkucmVqZWN0cyhuZXcgRXJyb3IoJ0Nsb3VkV2F0Y2ggUHV0TWV0cmljRGF0YSBmYWlsZWQnKSk7XHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==